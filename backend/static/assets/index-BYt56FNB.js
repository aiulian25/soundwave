const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/RelatedTracks-4mg7PID2.js","assets/mui-CaAFxKVL.js","assets/vendor-4GryFJQ2.js"])))=>i.map(i=>d[i]);
import{u as sh,r as te,a as re,j as e,B as h,T as x,b as je,I as tr,c as J,F as $e,C as Mi,d as q,A as ge,Z as Jc,e as Xc,M as la,f as ve,L as Ye,g as Se,D as De,h as Qe,i as Xe,P as ah,k as Ke,l as Ae,m as Zc,n as Oe,o as Zt,p as rr,q as Ge,Q as Ei,s as tt,S as ct,t as Et,v as Ue,w as Or,x as pt,y as Fr,z as Lr,E as ut,G as Q,H as Wr,J as ih,K as oh,N as Ks,O as Ji,R as qt,U as de,V as K,W as Ce,X as go,Y as Ie,_ as rt,$ as be,a0 as ed,a1 as lh,a2 as ch,a3 as td,a4 as La,a5 as Zr,a6 as rd,a7 as Js,a8 as Ti,a9 as nr,aa as dh,ab as vr,ac as Xs,ad as Qa,ae as uh,af as hh,ag as cr,ah as nd,ai as yo,aj as Gr,ak as Dr,al as sd,am as zi,an as jt,ao as zt,ap as _t,aq as ad,ar as id,as as fh,at as od,au as xh,av as Zs,aw as ph,ax as ca,ay as Ot,az as $r,aA as bo,aB as mh,aC as Yr,aD as et,aE as ld,aF as gh,aG as Mr,aH as jr,aI as Oi,aJ as cd,aK as Ir,aL as Fi,aM as wr,aN as yh,aO as bh,aP as vh,aQ as jh,aR as wh,aS as Sh,aT as Ch,aU as vo,aV as dd,aW as Ka,aX as Ut,aY as Wa,aZ as ud,a_ as jo,a$ as hd,b0 as qe,b1 as $a,b2 as kh,b3 as Ja,b4 as _h,b5 as Rh,b6 as Ih,b7 as fd,b8 as xd,b9 as Ah,ba as Li,bb as wo,bc as Ph,bd as pd,be as Dh,bf as Mh,bg as mi,bh as Eh,bi as Th,bj as ea,bk as zh,bl as Oh,bm as Fh,bn as gi,bo as Xa,bp as Lh,bq as Wh,br as $h,bs as Bh,bt as qh}from"./mui-CaAFxKVL.js";import{f as Nh,b as ee,g as Uh,a as l,u as At,r as Hh,h as Vh,i as md,c as Ee,e as qs,j as Xi,N as gd,k as Yh,l as at,B as Gh}from"./vendor-4GryFJQ2.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function n(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(a){if(a.ep)return;a.ep=!0;const i=n(a);fetch(a.href,i)}})();var _a={},So;function Qh(){if(So)return _a;So=1;var t=Nh();return _a.createRoot=t.createRoot,_a.hydrateRoot=t.hydrateRoot,_a}var Kh=Qh();const Jh=ee(Kh);var un={},yi={};const Xh=Uh(sh);var Co;function ne(){return Co||(Co=1,(function(t){"use client";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return r.createSvgIcon}});var r=Xh})(yi)),yi}var ko;function Zh(){if(ko)return un;ko=1;var t=te();Object.defineProperty(un,"__esModule",{value:!0}),un.default=void 0;var r=t(ne()),n=re();return un.default=(0,r.default)((0,n.jsx)("path",{d:"M8 5v14l11-7z"}),"PlayArrow"),un}var ef=Zh();const St=ee(ef);var hn={},_o;function tf(){if(_o)return hn;_o=1;var t=te();Object.defineProperty(hn,"__esModule",{value:!0}),hn.default=void 0;var r=t(ne()),n=re();return hn.default=(0,r.default)((0,n.jsx)("path",{d:"M6 19h4V5H6zm8-14v14h4V5z"}),"Pause"),hn}var rf=tf();const yd=ee(rf);var fn={},Ro;function nf(){if(Ro)return fn;Ro=1;var t=te();Object.defineProperty(fn,"__esModule",{value:!0}),fn.default=void 0;var r=t(ne()),n=re();return fn.default=(0,r.default)((0,n.jsx)("path",{d:"M12 5.9c1.16 0 2.1.94 2.1 2.1s-.94 2.1-2.1 2.1S9.9 9.16 9.9 8s.94-2.1 2.1-2.1m0 9c2.97 0 6.1 1.46 6.1 2.1v1.1H5.9V17c0-.64 3.13-2.1 6.1-2.1M12 4C9.79 4 8 5.79 8 8s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4m0 9c-2.67 0-8 1.34-8 4v3h16v-3c0-2.66-5.33-4-8-4"}),"PersonOutline"),fn}var sf=nf();const af=ee(sf);var xn={},Io;function of(){if(Io)return xn;Io=1;var t=te();Object.defineProperty(xn,"__esModule",{value:!0}),xn.default=void 0;var r=t(ne()),n=re();return xn.default=(0,r.default)((0,n.jsx)("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2M9 6c0-1.66 1.34-3 3-3s3 1.34 3 3v2H9zm9 14H6V10h12zm-6-3c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2"}),"LockOutlined"),xn}var lf=of();const Ao=ee(lf);var pn={},Po;function cf(){if(Po)return pn;Po=1;var t=te();Object.defineProperty(pn,"__esModule",{value:!0}),pn.default=void 0;var r=t(ne()),n=re();return pn.default=(0,r.default)((0,n.jsx)("path",{d:"M12 6c3.79 0 7.17 2.13 8.82 5.5C19.17 14.87 15.79 17 12 17s-7.17-2.13-8.82-5.5C4.83 8.13 8.21 6 12 6m0-2C7 4 2.73 7.11 1 11.5 2.73 15.89 7 19 12 19s9.27-3.11 11-7.5C21.27 7.11 17 4 12 4m0 5c1.38 0 2.5 1.12 2.5 2.5S13.38 14 12 14s-2.5-1.12-2.5-2.5S10.62 9 12 9m0-2c-2.48 0-4.5 2.02-4.5 4.5S9.52 16 12 16s4.5-2.02 4.5-4.5S14.48 7 12 7"}),"VisibilityOutlined"),pn}var df=cf();const uf=ee(df);var mn={},Do;function hf(){if(Do)return mn;Do=1;var t=te();Object.defineProperty(mn,"__esModule",{value:!0}),mn.default=void 0;var r=t(ne()),n=re();return mn.default=(0,r.default)((0,n.jsx)("path",{d:"M12 6c3.79 0 7.17 2.13 8.82 5.5-.59 1.22-1.42 2.27-2.41 3.12l1.41 1.41c1.39-1.23 2.49-2.77 3.18-4.53C21.27 7.11 17 4 12 4c-1.27 0-2.49.2-3.64.57l1.65 1.65C10.66 6.09 11.32 6 12 6m-1.07 1.14L13 9.21c.57.25 1.03.71 1.28 1.28l2.07 2.07c.08-.34.14-.7.14-1.07C16.5 9.01 14.48 7 12 7c-.37 0-.72.05-1.07.14M2.01 3.87l2.68 2.68C3.06 7.83 1.77 9.53 1 11.5 2.73 15.89 7 19 12 19c1.52 0 2.98-.29 4.32-.82l3.42 3.42 1.41-1.41L3.42 2.45zm7.5 7.5 2.61 2.61c-.04.01-.08.02-.12.02-1.38 0-2.5-1.12-2.5-2.5 0-.05.01-.08.01-.13m-3.4-3.4 1.75 1.75c-.23.55-.36 1.15-.36 1.78 0 2.48 2.02 4.5 4.5 4.5.63 0 1.23-.13 1.77-.36l.98.98c-.88.24-1.8.38-2.75.38-3.79 0-7.17-2.13-8.82-5.5.7-1.43 1.72-2.61 2.93-3.53"}),"VisibilityOffOutlined"),mn}var ff=hf();const xf=ee(ff);var gn={},Mo;function pf(){if(Mo)return gn;Mo=1;var t=te();Object.defineProperty(gn,"__esModule",{value:!0}),gn.default=void 0;var r=t(ne()),n=re();return gn.default=(0,r.default)((0,n.jsx)("path",{d:"m12 4-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"}),"ArrowForward"),gn}var mf=pf();const gf=ee(mf);var yn={},Eo;function yf(){if(Eo)return yn;Eo=1;var t=te();Object.defineProperty(yn,"__esModule",{value:!0}),yn.default=void 0;var r=t(ne()),n=re();return yn.default=(0,r.default)((0,n.jsx)("path",{d:"m14.5 14.2 2.9 1.7-.8 1.3L13 15v-5h1.5zM22 14c0 4.41-3.59 8-8 8-2.02 0-3.86-.76-5.27-2H4c-1.15 0-2-.85-2-2V9c0-1.12.89-1.96 2-2v-.5C4 4.01 6.01 2 8.5 2c2.34 0 4.24 1.79 4.46 4.08.34-.05.69-.08 1.04-.08 4.41 0 8 3.59 8 8M6 7h5v-.74C10.88 4.99 9.8 4 8.5 4 7.12 4 6 5.12 6 6.5zm14 7c0-3.31-2.69-6-6-6s-6 2.69-6 6 2.69 6 6 6 6-2.69 6-6"}),"LockClock"),yn}var bf=yf();const To=ee(bf);function bd(t,r){return function(){return t.apply(r,arguments)}}const{toString:vf}=Object.prototype,{getPrototypeOf:Zi}=Object,{iterator:Za,toStringTag:vd}=Symbol,ei=(t=>r=>{const n=vf.call(r);return t[n]||(t[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),Kt=t=>(t=t.toLowerCase(),r=>ei(r)===t),ti=t=>r=>typeof r===t,{isArray:rn}=Array,en=ti("undefined");function da(t){return t!==null&&!en(t)&&t.constructor!==null&&!en(t.constructor)&&Rt(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const jd=Kt("ArrayBuffer");function jf(t){let r;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?r=ArrayBuffer.isView(t):r=t&&t.buffer&&jd(t.buffer),r}const wf=ti("string"),Rt=ti("function"),wd=ti("number"),ua=t=>t!==null&&typeof t=="object",Sf=t=>t===!0||t===!1,Ea=t=>{if(ei(t)!=="object")return!1;const r=Zi(t);return(r===null||r===Object.prototype||Object.getPrototypeOf(r)===null)&&!(vd in t)&&!(Za in t)},Cf=t=>{if(!ua(t)||da(t))return!1;try{return Object.keys(t).length===0&&Object.getPrototypeOf(t)===Object.prototype}catch{return!1}},kf=Kt("Date"),_f=Kt("File"),Rf=Kt("Blob"),If=Kt("FileList"),Af=t=>ua(t)&&Rt(t.pipe),Pf=t=>{let r;return t&&(typeof FormData=="function"&&t instanceof FormData||Rt(t.append)&&((r=ei(t))==="formdata"||r==="object"&&Rt(t.toString)&&t.toString()==="[object FormData]"))},Df=Kt("URLSearchParams"),[Mf,Ef,Tf,zf]=["ReadableStream","Request","Response","Headers"].map(Kt),Of=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function ha(t,r,{allOwnKeys:n=!1}={}){if(t===null||typeof t>"u")return;let s,a;if(typeof t!="object"&&(t=[t]),rn(t))for(s=0,a=t.length;s<a;s++)r.call(null,t[s],s,t);else{if(da(t))return;const i=n?Object.getOwnPropertyNames(t):Object.keys(t),o=i.length;let c;for(s=0;s<o;s++)c=i[s],r.call(null,t[c],c,t)}}function Sd(t,r){if(da(t))return null;r=r.toLowerCase();const n=Object.keys(t);let s=n.length,a;for(;s-- >0;)if(a=n[s],r===a.toLowerCase())return a;return null}const _r=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Cd=t=>!en(t)&&t!==_r;function Wi(){const{caseless:t,skipUndefined:r}=Cd(this)&&this||{},n={},s=(a,i)=>{const o=t&&Sd(n,i)||i;Ea(n[o])&&Ea(a)?n[o]=Wi(n[o],a):Ea(a)?n[o]=Wi({},a):rn(a)?n[o]=a.slice():(!r||!en(a))&&(n[o]=a)};for(let a=0,i=arguments.length;a<i;a++)arguments[a]&&ha(arguments[a],s);return n}const Ff=(t,r,n,{allOwnKeys:s}={})=>(ha(r,(a,i)=>{n&&Rt(a)?t[i]=bd(a,n):t[i]=a},{allOwnKeys:s}),t),Lf=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),Wf=(t,r,n,s)=>{t.prototype=Object.create(r.prototype,s),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:r.prototype}),n&&Object.assign(t.prototype,n)},$f=(t,r,n,s)=>{let a,i,o;const c={};if(r=r||{},t==null)return r;do{for(a=Object.getOwnPropertyNames(t),i=a.length;i-- >0;)o=a[i],(!s||s(o,t,r))&&!c[o]&&(r[o]=t[o],c[o]=!0);t=n!==!1&&Zi(t)}while(t&&(!n||n(t,r))&&t!==Object.prototype);return r},Bf=(t,r,n)=>{t=String(t),(n===void 0||n>t.length)&&(n=t.length),n-=r.length;const s=t.indexOf(r,n);return s!==-1&&s===n},qf=t=>{if(!t)return null;if(rn(t))return t;let r=t.length;if(!wd(r))return null;const n=new Array(r);for(;r-- >0;)n[r]=t[r];return n},Nf=(t=>r=>t&&r instanceof t)(typeof Uint8Array<"u"&&Zi(Uint8Array)),Uf=(t,r)=>{const s=(t&&t[Za]).call(t);let a;for(;(a=s.next())&&!a.done;){const i=a.value;r.call(t,i[0],i[1])}},Hf=(t,r)=>{let n;const s=[];for(;(n=t.exec(r))!==null;)s.push(n);return s},Vf=Kt("HTMLFormElement"),Yf=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,s,a){return s.toUpperCase()+a}),zo=(({hasOwnProperty:t})=>(r,n)=>t.call(r,n))(Object.prototype),Gf=Kt("RegExp"),kd=(t,r)=>{const n=Object.getOwnPropertyDescriptors(t),s={};ha(n,(a,i)=>{let o;(o=r(a,i,t))!==!1&&(s[i]=o||a)}),Object.defineProperties(t,s)},Qf=t=>{kd(t,(r,n)=>{if(Rt(t)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const s=t[n];if(Rt(s)){if(r.enumerable=!1,"writable"in r){r.writable=!1;return}r.set||(r.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},Kf=(t,r)=>{const n={},s=a=>{a.forEach(i=>{n[i]=!0})};return rn(t)?s(t):s(String(t).split(r)),n},Jf=()=>{},Xf=(t,r)=>t!=null&&Number.isFinite(t=+t)?t:r;function Zf(t){return!!(t&&Rt(t.append)&&t[vd]==="FormData"&&t[Za])}const ex=t=>{const r=new Array(10),n=(s,a)=>{if(ua(s)){if(r.indexOf(s)>=0)return;if(da(s))return s;if(!("toJSON"in s)){r[a]=s;const i=rn(s)?[]:{};return ha(s,(o,c)=>{const f=n(o,a+1);!en(f)&&(i[c]=f)}),r[a]=void 0,i}}return s};return n(t,0)},tx=Kt("AsyncFunction"),rx=t=>t&&(ua(t)||Rt(t))&&Rt(t.then)&&Rt(t.catch),_d=((t,r)=>t?setImmediate:r?((n,s)=>(_r.addEventListener("message",({source:a,data:i})=>{a===_r&&i===n&&s.length&&s.shift()()},!1),a=>{s.push(a),_r.postMessage(n,"*")}))(`axios@${Math.random()}`,[]):n=>setTimeout(n))(typeof setImmediate=="function",Rt(_r.postMessage)),nx=typeof queueMicrotask<"u"?queueMicrotask.bind(_r):typeof process<"u"&&process.nextTick||_d,sx=t=>t!=null&&Rt(t[Za]),F={isArray:rn,isArrayBuffer:jd,isBuffer:da,isFormData:Pf,isArrayBufferView:jf,isString:wf,isNumber:wd,isBoolean:Sf,isObject:ua,isPlainObject:Ea,isEmptyObject:Cf,isReadableStream:Mf,isRequest:Ef,isResponse:Tf,isHeaders:zf,isUndefined:en,isDate:kf,isFile:_f,isBlob:Rf,isRegExp:Gf,isFunction:Rt,isStream:Af,isURLSearchParams:Df,isTypedArray:Nf,isFileList:If,forEach:ha,merge:Wi,extend:Ff,trim:Of,stripBOM:Lf,inherits:Wf,toFlatObject:$f,kindOf:ei,kindOfTest:Kt,endsWith:Bf,toArray:qf,forEachEntry:Uf,matchAll:Hf,isHTMLForm:Vf,hasOwnProperty:zo,hasOwnProp:zo,reduceDescriptors:kd,freezeMethods:Qf,toObjectSet:Kf,toCamelCase:Yf,noop:Jf,toFiniteNumber:Xf,findKey:Sd,global:_r,isContextDefined:Cd,isSpecCompliantForm:Zf,toJSONObject:ex,isAsyncFn:tx,isThenable:rx,setImmediate:_d,asap:nx,isIterable:sx};function _e(t,r,n,s,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",r&&(this.code=r),n&&(this.config=n),s&&(this.request=s),a&&(this.response=a,this.status=a.status?a.status:null)}F.inherits(_e,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:F.toJSONObject(this.config),code:this.code,status:this.status}}});const Rd=_e.prototype,Id={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{Id[t]={value:t}});Object.defineProperties(_e,Id);Object.defineProperty(Rd,"isAxiosError",{value:!0});_e.from=(t,r,n,s,a,i)=>{const o=Object.create(Rd);F.toFlatObject(t,o,function(u){return u!==Error.prototype},d=>d!=="isAxiosError");const c=t&&t.message?t.message:"Error",f=r==null&&t?t.code:r;return _e.call(o,c,f,n,s,a),t&&o.cause==null&&Object.defineProperty(o,"cause",{value:t,configurable:!0}),o.name=t&&t.name||"Error",i&&Object.assign(o,i),o};const ax=null;function $i(t){return F.isPlainObject(t)||F.isArray(t)}function Ad(t){return F.endsWith(t,"[]")?t.slice(0,-2):t}function Oo(t,r,n){return t?t.concat(r).map(function(a,i){return a=Ad(a),!n&&i?"["+a+"]":a}).join(n?".":""):r}function ix(t){return F.isArray(t)&&!t.some($i)}const ox=F.toFlatObject(F,{},null,function(r){return/^is[A-Z]/.test(r)});function ri(t,r,n){if(!F.isObject(t))throw new TypeError("target must be an object");r=r||new FormData,n=F.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(b,S){return!F.isUndefined(S[b])});const s=n.metaTokens,a=n.visitor||u,i=n.dots,o=n.indexes,f=(n.Blob||typeof Blob<"u"&&Blob)&&F.isSpecCompliantForm(r);if(!F.isFunction(a))throw new TypeError("visitor must be a function");function d(m){if(m===null)return"";if(F.isDate(m))return m.toISOString();if(F.isBoolean(m))return m.toString();if(!f&&F.isBlob(m))throw new _e("Blob is not supported. Use a Buffer instead.");return F.isArrayBuffer(m)||F.isTypedArray(m)?f&&typeof Blob=="function"?new Blob([m]):Buffer.from(m):m}function u(m,b,S){let v=m;if(m&&!S&&typeof m=="object"){if(F.endsWith(b,"{}"))b=s?b:b.slice(0,-2),m=JSON.stringify(m);else if(F.isArray(m)&&ix(m)||(F.isFileList(m)||F.endsWith(b,"[]"))&&(v=F.toArray(m)))return b=Ad(b),v.forEach(function(w,C){!(F.isUndefined(w)||w===null)&&r.append(o===!0?Oo([b],C,i):o===null?b:b+"[]",d(w))}),!1}return $i(m)?!0:(r.append(Oo(S,b,i),d(m)),!1)}const p=[],g=Object.assign(ox,{defaultVisitor:u,convertValue:d,isVisitable:$i});function y(m,b){if(!F.isUndefined(m)){if(p.indexOf(m)!==-1)throw Error("Circular reference detected in "+b.join("."));p.push(m),F.forEach(m,function(v,j){(!(F.isUndefined(v)||v===null)&&a.call(r,v,F.isString(j)?j.trim():j,b,g))===!0&&y(v,b?b.concat(j):[j])}),p.pop()}}if(!F.isObject(t))throw new TypeError("data must be an object");return y(t),r}function Fo(t){const r={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(s){return r[s]})}function eo(t,r){this._pairs=[],t&&ri(t,this,r)}const Pd=eo.prototype;Pd.append=function(r,n){this._pairs.push([r,n])};Pd.toString=function(r){const n=r?function(s){return r.call(this,s,Fo)}:Fo;return this._pairs.map(function(a){return n(a[0])+"="+n(a[1])},"").join("&")};function lx(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function Dd(t,r,n){if(!r)return t;const s=n&&n.encode||lx;F.isFunction(n)&&(n={serialize:n});const a=n&&n.serialize;let i;if(a?i=a(r,n):i=F.isURLSearchParams(r)?r.toString():new eo(r,n).toString(s),i){const o=t.indexOf("#");o!==-1&&(t=t.slice(0,o)),t+=(t.indexOf("?")===-1?"?":"&")+i}return t}class Lo{constructor(){this.handlers=[]}use(r,n,s){return this.handlers.push({fulfilled:r,rejected:n,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(r){this.handlers[r]&&(this.handlers[r]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(r){F.forEach(this.handlers,function(s){s!==null&&r(s)})}}const Md={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},cx=typeof URLSearchParams<"u"?URLSearchParams:eo,dx=typeof FormData<"u"?FormData:null,ux=typeof Blob<"u"?Blob:null,hx={isBrowser:!0,classes:{URLSearchParams:cx,FormData:dx,Blob:ux},protocols:["http","https","file","blob","url","data"]},to=typeof window<"u"&&typeof document<"u",Bi=typeof navigator=="object"&&navigator||void 0,fx=to&&(!Bi||["ReactNative","NativeScript","NS"].indexOf(Bi.product)<0),xx=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",px=to&&window.location.href||"http://localhost",mx=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:to,hasStandardBrowserEnv:fx,hasStandardBrowserWebWorkerEnv:xx,navigator:Bi,origin:px},Symbol.toStringTag,{value:"Module"})),xt={...mx,...hx};function gx(t,r){return ri(t,new xt.classes.URLSearchParams,{visitor:function(n,s,a,i){return xt.isNode&&F.isBuffer(n)?(this.append(s,n.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)},...r})}function yx(t){return F.matchAll(/\w+|\[(\w*)]/g,t).map(r=>r[0]==="[]"?"":r[1]||r[0])}function bx(t){const r={},n=Object.keys(t);let s;const a=n.length;let i;for(s=0;s<a;s++)i=n[s],r[i]=t[i];return r}function Ed(t){function r(n,s,a,i){let o=n[i++];if(o==="__proto__")return!0;const c=Number.isFinite(+o),f=i>=n.length;return o=!o&&F.isArray(a)?a.length:o,f?(F.hasOwnProp(a,o)?a[o]=[a[o],s]:a[o]=s,!c):((!a[o]||!F.isObject(a[o]))&&(a[o]=[]),r(n,s,a[o],i)&&F.isArray(a[o])&&(a[o]=bx(a[o])),!c)}if(F.isFormData(t)&&F.isFunction(t.entries)){const n={};return F.forEachEntry(t,(s,a)=>{r(yx(s),a,n,0)}),n}return null}function vx(t,r,n){if(F.isString(t))try{return(r||JSON.parse)(t),F.trim(t)}catch(s){if(s.name!=="SyntaxError")throw s}return(n||JSON.stringify)(t)}const fa={transitional:Md,adapter:["xhr","http","fetch"],transformRequest:[function(r,n){const s=n.getContentType()||"",a=s.indexOf("application/json")>-1,i=F.isObject(r);if(i&&F.isHTMLForm(r)&&(r=new FormData(r)),F.isFormData(r))return a?JSON.stringify(Ed(r)):r;if(F.isArrayBuffer(r)||F.isBuffer(r)||F.isStream(r)||F.isFile(r)||F.isBlob(r)||F.isReadableStream(r))return r;if(F.isArrayBufferView(r))return r.buffer;if(F.isURLSearchParams(r))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),r.toString();let c;if(i){if(s.indexOf("application/x-www-form-urlencoded")>-1)return gx(r,this.formSerializer).toString();if((c=F.isFileList(r))||s.indexOf("multipart/form-data")>-1){const f=this.env&&this.env.FormData;return ri(c?{"files[]":r}:r,f&&new f,this.formSerializer)}}return i||a?(n.setContentType("application/json",!1),vx(r)):r}],transformResponse:[function(r){const n=this.transitional||fa.transitional,s=n&&n.forcedJSONParsing,a=this.responseType==="json";if(F.isResponse(r)||F.isReadableStream(r))return r;if(r&&F.isString(r)&&(s&&!this.responseType||a)){const o=!(n&&n.silentJSONParsing)&&a;try{return JSON.parse(r,this.parseReviver)}catch(c){if(o)throw c.name==="SyntaxError"?_e.from(c,_e.ERR_BAD_RESPONSE,this,null,this.response):c}}return r}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:xt.classes.FormData,Blob:xt.classes.Blob},validateStatus:function(r){return r>=200&&r<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};F.forEach(["delete","get","head","post","put","patch"],t=>{fa.headers[t]={}});const jx=F.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),wx=t=>{const r={};let n,s,a;return t&&t.split(`
`).forEach(function(o){a=o.indexOf(":"),n=o.substring(0,a).trim().toLowerCase(),s=o.substring(a+1).trim(),!(!n||r[n]&&jx[n])&&(n==="set-cookie"?r[n]?r[n].push(s):r[n]=[s]:r[n]=r[n]?r[n]+", "+s:s)}),r},Wo=Symbol("internals");function bn(t){return t&&String(t).trim().toLowerCase()}function Ta(t){return t===!1||t==null?t:F.isArray(t)?t.map(Ta):String(t)}function Sx(t){const r=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=n.exec(t);)r[s[1]]=s[2];return r}const Cx=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function bi(t,r,n,s,a){if(F.isFunction(s))return s.call(this,r,n);if(a&&(r=n),!!F.isString(r)){if(F.isString(s))return r.indexOf(s)!==-1;if(F.isRegExp(s))return s.test(r)}}function kx(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(r,n,s)=>n.toUpperCase()+s)}function _x(t,r){const n=F.toCamelCase(" "+r);["get","set","has"].forEach(s=>{Object.defineProperty(t,s+n,{value:function(a,i,o){return this[s].call(this,r,a,i,o)},configurable:!0})})}let It=class{constructor(r){r&&this.set(r)}set(r,n,s){const a=this;function i(c,f,d){const u=bn(f);if(!u)throw new Error("header name must be a non-empty string");const p=F.findKey(a,u);(!p||a[p]===void 0||d===!0||d===void 0&&a[p]!==!1)&&(a[p||f]=Ta(c))}const o=(c,f)=>F.forEach(c,(d,u)=>i(d,u,f));if(F.isPlainObject(r)||r instanceof this.constructor)o(r,n);else if(F.isString(r)&&(r=r.trim())&&!Cx(r))o(wx(r),n);else if(F.isObject(r)&&F.isIterable(r)){let c={},f,d;for(const u of r){if(!F.isArray(u))throw TypeError("Object iterator must return a key-value pair");c[d=u[0]]=(f=c[d])?F.isArray(f)?[...f,u[1]]:[f,u[1]]:u[1]}o(c,n)}else r!=null&&i(n,r,s);return this}get(r,n){if(r=bn(r),r){const s=F.findKey(this,r);if(s){const a=this[s];if(!n)return a;if(n===!0)return Sx(a);if(F.isFunction(n))return n.call(this,a,s);if(F.isRegExp(n))return n.exec(a);throw new TypeError("parser must be boolean|regexp|function")}}}has(r,n){if(r=bn(r),r){const s=F.findKey(this,r);return!!(s&&this[s]!==void 0&&(!n||bi(this,this[s],s,n)))}return!1}delete(r,n){const s=this;let a=!1;function i(o){if(o=bn(o),o){const c=F.findKey(s,o);c&&(!n||bi(s,s[c],c,n))&&(delete s[c],a=!0)}}return F.isArray(r)?r.forEach(i):i(r),a}clear(r){const n=Object.keys(this);let s=n.length,a=!1;for(;s--;){const i=n[s];(!r||bi(this,this[i],i,r,!0))&&(delete this[i],a=!0)}return a}normalize(r){const n=this,s={};return F.forEach(this,(a,i)=>{const o=F.findKey(s,i);if(o){n[o]=Ta(a),delete n[i];return}const c=r?kx(i):String(i).trim();c!==i&&delete n[i],n[c]=Ta(a),s[c]=!0}),this}concat(...r){return this.constructor.concat(this,...r)}toJSON(r){const n=Object.create(null);return F.forEach(this,(s,a)=>{s!=null&&s!==!1&&(n[a]=r&&F.isArray(s)?s.join(", "):s)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([r,n])=>r+": "+n).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(r){return r instanceof this?r:new this(r)}static concat(r,...n){const s=new this(r);return n.forEach(a=>s.set(a)),s}static accessor(r){const s=(this[Wo]=this[Wo]={accessors:{}}).accessors,a=this.prototype;function i(o){const c=bn(o);s[c]||(_x(a,o),s[c]=!0)}return F.isArray(r)?r.forEach(i):i(r),this}};It.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);F.reduceDescriptors(It.prototype,({value:t},r)=>{let n=r[0].toUpperCase()+r.slice(1);return{get:()=>t,set(s){this[n]=s}}});F.freezeMethods(It);function vi(t,r){const n=this||fa,s=r||n,a=It.from(s.headers);let i=s.data;return F.forEach(t,function(c){i=c.call(n,i,a.normalize(),r?r.status:void 0)}),a.normalize(),i}function Td(t){return!!(t&&t.__CANCEL__)}function nn(t,r,n){_e.call(this,t??"canceled",_e.ERR_CANCELED,r,n),this.name="CanceledError"}F.inherits(nn,_e,{__CANCEL__:!0});function zd(t,r,n){const s=n.config.validateStatus;!n.status||!s||s(n.status)?t(n):r(new _e("Request failed with status code "+n.status,[_e.ERR_BAD_REQUEST,_e.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}function Rx(t){const r=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return r&&r[1]||""}function Ix(t,r){t=t||10;const n=new Array(t),s=new Array(t);let a=0,i=0,o;return r=r!==void 0?r:1e3,function(f){const d=Date.now(),u=s[i];o||(o=d),n[a]=f,s[a]=d;let p=i,g=0;for(;p!==a;)g+=n[p++],p=p%t;if(a=(a+1)%t,a===i&&(i=(i+1)%t),d-o<r)return;const y=u&&d-u;return y?Math.round(g*1e3/y):void 0}}function Ax(t,r){let n=0,s=1e3/r,a,i;const o=(d,u=Date.now())=>{n=u,a=null,i&&(clearTimeout(i),i=null),t(...d)};return[(...d)=>{const u=Date.now(),p=u-n;p>=s?o(d,u):(a=d,i||(i=setTimeout(()=>{i=null,o(a)},s-p)))},()=>a&&o(a)]}const Ba=(t,r,n=3)=>{let s=0;const a=Ix(50,250);return Ax(i=>{const o=i.loaded,c=i.lengthComputable?i.total:void 0,f=o-s,d=a(f),u=o<=c;s=o;const p={loaded:o,total:c,progress:c?o/c:void 0,bytes:f,rate:d||void 0,estimated:d&&c&&u?(c-o)/d:void 0,event:i,lengthComputable:c!=null,[r?"download":"upload"]:!0};t(p)},n)},$o=(t,r)=>{const n=t!=null;return[s=>r[0]({lengthComputable:n,total:t,loaded:s}),r[1]]},Bo=t=>(...r)=>F.asap(()=>t(...r)),Px=xt.hasStandardBrowserEnv?((t,r)=>n=>(n=new URL(n,xt.origin),t.protocol===n.protocol&&t.host===n.host&&(r||t.port===n.port)))(new URL(xt.origin),xt.navigator&&/(msie|trident)/i.test(xt.navigator.userAgent)):()=>!0,Dx=xt.hasStandardBrowserEnv?{write(t,r,n,s,a,i,o){if(typeof document>"u")return;const c=[`${t}=${encodeURIComponent(r)}`];F.isNumber(n)&&c.push(`expires=${new Date(n).toUTCString()}`),F.isString(s)&&c.push(`path=${s}`),F.isString(a)&&c.push(`domain=${a}`),i===!0&&c.push("secure"),F.isString(o)&&c.push(`SameSite=${o}`),document.cookie=c.join("; ")},read(t){if(typeof document>"u")return null;const r=document.cookie.match(new RegExp("(?:^|; )"+t+"=([^;]*)"));return r?decodeURIComponent(r[1]):null},remove(t){this.write(t,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function Mx(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function Ex(t,r){return r?t.replace(/\/?\/$/,"")+"/"+r.replace(/^\/+/,""):t}function Od(t,r,n){let s=!Mx(r);return t&&(s||n==!1)?Ex(t,r):r}const qo=t=>t instanceof It?{...t}:t;function Er(t,r){r=r||{};const n={};function s(d,u,p,g){return F.isPlainObject(d)&&F.isPlainObject(u)?F.merge.call({caseless:g},d,u):F.isPlainObject(u)?F.merge({},u):F.isArray(u)?u.slice():u}function a(d,u,p,g){if(F.isUndefined(u)){if(!F.isUndefined(d))return s(void 0,d,p,g)}else return s(d,u,p,g)}function i(d,u){if(!F.isUndefined(u))return s(void 0,u)}function o(d,u){if(F.isUndefined(u)){if(!F.isUndefined(d))return s(void 0,d)}else return s(void 0,u)}function c(d,u,p){if(p in r)return s(d,u);if(p in t)return s(void 0,d)}const f={url:i,method:i,data:i,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:c,headers:(d,u,p)=>a(qo(d),qo(u),p,!0)};return F.forEach(Object.keys({...t,...r}),function(u){const p=f[u]||a,g=p(t[u],r[u],u);F.isUndefined(g)&&p!==c||(n[u]=g)}),n}const Fd=t=>{const r=Er({},t);let{data:n,withXSRFToken:s,xsrfHeaderName:a,xsrfCookieName:i,headers:o,auth:c}=r;if(r.headers=o=It.from(o),r.url=Dd(Od(r.baseURL,r.url,r.allowAbsoluteUrls),t.params,t.paramsSerializer),c&&o.set("Authorization","Basic "+btoa((c.username||"")+":"+(c.password?unescape(encodeURIComponent(c.password)):""))),F.isFormData(n)){if(xt.hasStandardBrowserEnv||xt.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if(F.isFunction(n.getHeaders)){const f=n.getHeaders(),d=["content-type","content-length"];Object.entries(f).forEach(([u,p])=>{d.includes(u.toLowerCase())&&o.set(u,p)})}}if(xt.hasStandardBrowserEnv&&(s&&F.isFunction(s)&&(s=s(r)),s||s!==!1&&Px(r.url))){const f=a&&i&&Dx.read(i);f&&o.set(a,f)}return r},Tx=typeof XMLHttpRequest<"u",zx=Tx&&function(t){return new Promise(function(n,s){const a=Fd(t);let i=a.data;const o=It.from(a.headers).normalize();let{responseType:c,onUploadProgress:f,onDownloadProgress:d}=a,u,p,g,y,m;function b(){y&&y(),m&&m(),a.cancelToken&&a.cancelToken.unsubscribe(u),a.signal&&a.signal.removeEventListener("abort",u)}let S=new XMLHttpRequest;S.open(a.method.toUpperCase(),a.url,!0),S.timeout=a.timeout;function v(){if(!S)return;const w=It.from("getAllResponseHeaders"in S&&S.getAllResponseHeaders()),A={data:!c||c==="text"||c==="json"?S.responseText:S.response,status:S.status,statusText:S.statusText,headers:w,config:t,request:S};zd(function(D){n(D),b()},function(D){s(D),b()},A),S=null}"onloadend"in S?S.onloadend=v:S.onreadystatechange=function(){!S||S.readyState!==4||S.status===0&&!(S.responseURL&&S.responseURL.indexOf("file:")===0)||setTimeout(v)},S.onabort=function(){S&&(s(new _e("Request aborted",_e.ECONNABORTED,t,S)),S=null)},S.onerror=function(C){const A=C&&C.message?C.message:"Network Error",P=new _e(A,_e.ERR_NETWORK,t,S);P.event=C||null,s(P),S=null},S.ontimeout=function(){let C=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const A=a.transitional||Md;a.timeoutErrorMessage&&(C=a.timeoutErrorMessage),s(new _e(C,A.clarifyTimeoutError?_e.ETIMEDOUT:_e.ECONNABORTED,t,S)),S=null},i===void 0&&o.setContentType(null),"setRequestHeader"in S&&F.forEach(o.toJSON(),function(C,A){S.setRequestHeader(A,C)}),F.isUndefined(a.withCredentials)||(S.withCredentials=!!a.withCredentials),c&&c!=="json"&&(S.responseType=a.responseType),d&&([g,m]=Ba(d,!0),S.addEventListener("progress",g)),f&&S.upload&&([p,y]=Ba(f),S.upload.addEventListener("progress",p),S.upload.addEventListener("loadend",y)),(a.cancelToken||a.signal)&&(u=w=>{S&&(s(!w||w.type?new nn(null,t,S):w),S.abort(),S=null)},a.cancelToken&&a.cancelToken.subscribe(u),a.signal&&(a.signal.aborted?u():a.signal.addEventListener("abort",u)));const j=Rx(a.url);if(j&&xt.protocols.indexOf(j)===-1){s(new _e("Unsupported protocol "+j+":",_e.ERR_BAD_REQUEST,t));return}S.send(i||null)})},Ox=(t,r)=>{const{length:n}=t=t?t.filter(Boolean):[];if(r||n){let s=new AbortController,a;const i=function(d){if(!a){a=!0,c();const u=d instanceof Error?d:this.reason;s.abort(u instanceof _e?u:new nn(u instanceof Error?u.message:u))}};let o=r&&setTimeout(()=>{o=null,i(new _e(`timeout ${r} of ms exceeded`,_e.ETIMEDOUT))},r);const c=()=>{t&&(o&&clearTimeout(o),o=null,t.forEach(d=>{d.unsubscribe?d.unsubscribe(i):d.removeEventListener("abort",i)}),t=null)};t.forEach(d=>d.addEventListener("abort",i));const{signal:f}=s;return f.unsubscribe=()=>F.asap(c),f}},Fx=function*(t,r){let n=t.byteLength;if(n<r){yield t;return}let s=0,a;for(;s<n;)a=s+r,yield t.slice(s,a),s=a},Lx=async function*(t,r){for await(const n of Wx(t))yield*Fx(n,r)},Wx=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const r=t.getReader();try{for(;;){const{done:n,value:s}=await r.read();if(n)break;yield s}}finally{await r.cancel()}},No=(t,r,n,s)=>{const a=Lx(t,r);let i=0,o,c=f=>{o||(o=!0,s&&s(f))};return new ReadableStream({async pull(f){try{const{done:d,value:u}=await a.next();if(d){c(),f.close();return}let p=u.byteLength;if(n){let g=i+=p;n(g)}f.enqueue(new Uint8Array(u))}catch(d){throw c(d),d}},cancel(f){return c(f),a.return()}},{highWaterMark:2})},Uo=64*1024,{isFunction:Ra}=F,$x=(({Request:t,Response:r})=>({Request:t,Response:r}))(F.global),{ReadableStream:Ho,TextEncoder:Vo}=F.global,Yo=(t,...r)=>{try{return!!t(...r)}catch{return!1}},Bx=t=>{t=F.merge.call({skipUndefined:!0},$x,t);const{fetch:r,Request:n,Response:s}=t,a=r?Ra(r):typeof fetch=="function",i=Ra(n),o=Ra(s);if(!a)return!1;const c=a&&Ra(Ho),f=a&&(typeof Vo=="function"?(m=>b=>m.encode(b))(new Vo):async m=>new Uint8Array(await new n(m).arrayBuffer())),d=i&&c&&Yo(()=>{let m=!1;const b=new n(xt.origin,{body:new Ho,method:"POST",get duplex(){return m=!0,"half"}}).headers.has("Content-Type");return m&&!b}),u=o&&c&&Yo(()=>F.isReadableStream(new s("").body)),p={stream:u&&(m=>m.body)};a&&["text","arrayBuffer","blob","formData","stream"].forEach(m=>{!p[m]&&(p[m]=(b,S)=>{let v=b&&b[m];if(v)return v.call(b);throw new _e(`Response type '${m}' is not supported`,_e.ERR_NOT_SUPPORT,S)})});const g=async m=>{if(m==null)return 0;if(F.isBlob(m))return m.size;if(F.isSpecCompliantForm(m))return(await new n(xt.origin,{method:"POST",body:m}).arrayBuffer()).byteLength;if(F.isArrayBufferView(m)||F.isArrayBuffer(m))return m.byteLength;if(F.isURLSearchParams(m)&&(m=m+""),F.isString(m))return(await f(m)).byteLength},y=async(m,b)=>{const S=F.toFiniteNumber(m.getContentLength());return S??g(b)};return async m=>{let{url:b,method:S,data:v,signal:j,cancelToken:w,timeout:C,onDownloadProgress:A,onUploadProgress:P,responseType:D,headers:R,withCredentials:_="same-origin",fetchOptions:z}=Fd(m),W=r||fetch;D=D?(D+"").toLowerCase():"text";let B=Ox([j,w&&w.toAbortSignal()],C),H=null;const se=B&&B.unsubscribe&&(()=>{B.unsubscribe()});let I;try{if(P&&d&&S!=="get"&&S!=="head"&&(I=await y(R,v))!==0){let M=new n(b,{method:"POST",body:v,duplex:"half"}),T;if(F.isFormData(v)&&(T=M.headers.get("content-type"))&&R.setContentType(T),M.body){const[ae,L]=$o(I,Ba(Bo(P)));v=No(M.body,Uo,ae,L)}}F.isString(_)||(_=_?"include":"omit");const k=i&&"credentials"in n.prototype,O={...z,signal:B,method:S.toUpperCase(),headers:R.normalize().toJSON(),body:v,duplex:"half",credentials:k?_:void 0};H=i&&new n(b,O);let E=await(i?W(H,z):W(b,O));const Z=u&&(D==="stream"||D==="response");if(u&&(A||Z&&se)){const M={};["status","statusText","headers"].forEach(N=>{M[N]=E[N]});const T=F.toFiniteNumber(E.headers.get("content-length")),[ae,L]=A&&$o(T,Ba(Bo(A),!0))||[];E=new s(No(E.body,Uo,ae,()=>{L&&L(),se&&se()}),M)}D=D||"text";let G=await p[F.findKey(p,D)||"text"](E,m);return!Z&&se&&se(),await new Promise((M,T)=>{zd(M,T,{data:G,headers:It.from(E.headers),status:E.status,statusText:E.statusText,config:m,request:H})})}catch(k){throw se&&se(),k&&k.name==="TypeError"&&/Load failed|fetch/i.test(k.message)?Object.assign(new _e("Network Error",_e.ERR_NETWORK,m,H),{cause:k.cause||k}):_e.from(k,k&&k.code,m,H)}}},qx=new Map,Ld=t=>{let r=t&&t.env||{};const{fetch:n,Request:s,Response:a}=r,i=[s,a,n];let o=i.length,c=o,f,d,u=qx;for(;c--;)f=i[c],d=u.get(f),d===void 0&&u.set(f,d=c?new Map:Bx(r)),u=d;return d};Ld();const ro={http:ax,xhr:zx,fetch:{get:Ld}};F.forEach(ro,(t,r)=>{if(t){try{Object.defineProperty(t,"name",{value:r})}catch{}Object.defineProperty(t,"adapterName",{value:r})}});const Go=t=>`- ${t}`,Nx=t=>F.isFunction(t)||t===null||t===!1;function Ux(t,r){t=F.isArray(t)?t:[t];const{length:n}=t;let s,a;const i={};for(let o=0;o<n;o++){s=t[o];let c;if(a=s,!Nx(s)&&(a=ro[(c=String(s)).toLowerCase()],a===void 0))throw new _e(`Unknown adapter '${c}'`);if(a&&(F.isFunction(a)||(a=a.get(r))))break;i[c||"#"+o]=a}if(!a){const o=Object.entries(i).map(([f,d])=>`adapter ${f} `+(d===!1?"is not supported by the environment":"is not available in the build"));let c=n?o.length>1?`since :
`+o.map(Go).join(`
`):" "+Go(o[0]):"as no adapter specified";throw new _e("There is no suitable adapter to dispatch the request "+c,"ERR_NOT_SUPPORT")}return a}const Wd={getAdapter:Ux,adapters:ro};function ji(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new nn(null,t)}function Qo(t){return ji(t),t.headers=It.from(t.headers),t.data=vi.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),Wd.getAdapter(t.adapter||fa.adapter,t)(t).then(function(s){return ji(t),s.data=vi.call(t,t.transformResponse,s),s.headers=It.from(s.headers),s},function(s){return Td(s)||(ji(t),s&&s.response&&(s.response.data=vi.call(t,t.transformResponse,s.response),s.response.headers=It.from(s.response.headers))),Promise.reject(s)})}const $d="1.13.2",ni={};["object","boolean","number","function","string","symbol"].forEach((t,r)=>{ni[t]=function(s){return typeof s===t||"a"+(r<1?"n ":" ")+t}});const Ko={};ni.transitional=function(r,n,s){function a(i,o){return"[Axios v"+$d+"] Transitional option '"+i+"'"+o+(s?". "+s:"")}return(i,o,c)=>{if(r===!1)throw new _e(a(o," has been removed"+(n?" in "+n:"")),_e.ERR_DEPRECATED);return n&&!Ko[o]&&(Ko[o]=!0,console.warn(a(o," has been deprecated since v"+n+" and will be removed in the near future"))),r?r(i,o,c):!0}};ni.spelling=function(r){return(n,s)=>(console.warn(`${s} is likely a misspelling of ${r}`),!0)};function Hx(t,r,n){if(typeof t!="object")throw new _e("options must be an object",_e.ERR_BAD_OPTION_VALUE);const s=Object.keys(t);let a=s.length;for(;a-- >0;){const i=s[a],o=r[i];if(o){const c=t[i],f=c===void 0||o(c,i,t);if(f!==!0)throw new _e("option "+i+" must be "+f,_e.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new _e("Unknown option "+i,_e.ERR_BAD_OPTION)}}const za={assertOptions:Hx,validators:ni},Xt=za.validators;let Ar=class{constructor(r){this.defaults=r||{},this.interceptors={request:new Lo,response:new Lo}}async request(r,n){try{return await this._request(r,n)}catch(s){if(s instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const i=a.stack?a.stack.replace(/^.+\n/,""):"";try{s.stack?i&&!String(s.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+i):s.stack=i}catch{}}throw s}}_request(r,n){typeof r=="string"?(n=n||{},n.url=r):n=r||{},n=Er(this.defaults,n);const{transitional:s,paramsSerializer:a,headers:i}=n;s!==void 0&&za.assertOptions(s,{silentJSONParsing:Xt.transitional(Xt.boolean),forcedJSONParsing:Xt.transitional(Xt.boolean),clarifyTimeoutError:Xt.transitional(Xt.boolean)},!1),a!=null&&(F.isFunction(a)?n.paramsSerializer={serialize:a}:za.assertOptions(a,{encode:Xt.function,serialize:Xt.function},!0)),n.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?n.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:n.allowAbsoluteUrls=!0),za.assertOptions(n,{baseUrl:Xt.spelling("baseURL"),withXsrfToken:Xt.spelling("withXSRFToken")},!0),n.method=(n.method||this.defaults.method||"get").toLowerCase();let o=i&&F.merge(i.common,i[n.method]);i&&F.forEach(["delete","get","head","post","put","patch","common"],m=>{delete i[m]}),n.headers=It.concat(o,i);const c=[];let f=!0;this.interceptors.request.forEach(function(b){typeof b.runWhen=="function"&&b.runWhen(n)===!1||(f=f&&b.synchronous,c.unshift(b.fulfilled,b.rejected))});const d=[];this.interceptors.response.forEach(function(b){d.push(b.fulfilled,b.rejected)});let u,p=0,g;if(!f){const m=[Qo.bind(this),void 0];for(m.unshift(...c),m.push(...d),g=m.length,u=Promise.resolve(n);p<g;)u=u.then(m[p++],m[p++]);return u}g=c.length;let y=n;for(;p<g;){const m=c[p++],b=c[p++];try{y=m(y)}catch(S){b.call(this,S);break}}try{u=Qo.call(this,y)}catch(m){return Promise.reject(m)}for(p=0,g=d.length;p<g;)u=u.then(d[p++],d[p++]);return u}getUri(r){r=Er(this.defaults,r);const n=Od(r.baseURL,r.url,r.allowAbsoluteUrls);return Dd(n,r.params,r.paramsSerializer)}};F.forEach(["delete","get","head","options"],function(r){Ar.prototype[r]=function(n,s){return this.request(Er(s||{},{method:r,url:n,data:(s||{}).data}))}});F.forEach(["post","put","patch"],function(r){function n(s){return function(i,o,c){return this.request(Er(c||{},{method:r,headers:s?{"Content-Type":"multipart/form-data"}:{},url:i,data:o}))}}Ar.prototype[r]=n(),Ar.prototype[r+"Form"]=n(!0)});let Vx=class Bd{constructor(r){if(typeof r!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(i){n=i});const s=this;this.promise.then(a=>{if(!s._listeners)return;let i=s._listeners.length;for(;i-- >0;)s._listeners[i](a);s._listeners=null}),this.promise.then=a=>{let i;const o=new Promise(c=>{s.subscribe(c),i=c}).then(a);return o.cancel=function(){s.unsubscribe(i)},o},r(function(i,o,c){s.reason||(s.reason=new nn(i,o,c),n(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(r){if(this.reason){r(this.reason);return}this._listeners?this._listeners.push(r):this._listeners=[r]}unsubscribe(r){if(!this._listeners)return;const n=this._listeners.indexOf(r);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const r=new AbortController,n=s=>{r.abort(s)};return this.subscribe(n),r.signal.unsubscribe=()=>this.unsubscribe(n),r.signal}static source(){let r;return{token:new Bd(function(a){r=a}),cancel:r}}};function Yx(t){return function(n){return t.apply(null,n)}}function Gx(t){return F.isObject(t)&&t.isAxiosError===!0}const qi={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(qi).forEach(([t,r])=>{qi[r]=t});function qd(t){const r=new Ar(t),n=bd(Ar.prototype.request,r);return F.extend(n,Ar.prototype,r,{allOwnKeys:!0}),F.extend(n,r,null,{allOwnKeys:!0}),n.create=function(a){return qd(Er(t,a))},n}const Ne=qd(fa);Ne.Axios=Ar;Ne.CanceledError=nn;Ne.CancelToken=Vx;Ne.isCancel=Td;Ne.VERSION=$d;Ne.toFormData=ri;Ne.AxiosError=_e;Ne.Cancel=Ne.CanceledError;Ne.all=function(r){return Promise.all(r)};Ne.spread=Yx;Ne.isAxiosError=Gx;Ne.mergeConfig=Er;Ne.AxiosHeaders=It;Ne.formToJSON=t=>Ed(F.isHTMLForm(t)?new FormData(t):t);Ne.getAdapter=Wd.getAdapter;Ne.HttpStatusCode=qi;Ne.default=Ne;const{Axios:Ov,AxiosError:Fv,CanceledError:Lv,isCancel:Wv,CancelToken:$v,VERSION:Bv,all:qv,Cancel:Nv,isAxiosError:Uv,spread:Hv,toFormData:Vv,AxiosHeaders:Yv,HttpStatusCode:Gv,formToJSON:Qv,getAdapter:Kv,mergeConfig:Jv}=Ne;function Qx(t){const n=`; ${document.cookie}`.split(`; ${t}=`);return n.length===2&&n.pop()?.split(";").shift()||null}const U=Ne.create({baseURL:"/api",headers:{"Content-Type":"application/json"},withCredentials:!0});U.interceptors.request.use(t=>{const r=localStorage.getItem("token");if(r&&(t.headers.Authorization=`Token ${r}`),t.method&&!["get","head","options"].includes(t.method.toLowerCase())){const n=Qx("csrftoken");n&&(t.headers["X-CSRFToken"]=n)}return t});U.interceptors.response.use(t=>t,t=>{if(t.response?.status===401){const r=t.response?.data?.detail||t.response?.data?.error||"";(r.includes("expired")||r.includes("Invalid token"))&&(localStorage.removeItem("token"),window.dispatchEvent(new CustomEvent("token-expired",{detail:{message:"Your session has expired. Please log in again."}})))}return Promise.reject(t)});const wt={list:t=>U.get("/audio/list/",{params:t}),get:t=>U.get(`/audio/${t}/`),delete:t=>U.delete(`/audio/${t}/`),download:t=>U.post(`/audio/${t}/`,{action:"download"}),toggleFavorite:t=>U.post(`/audio/${t}/`,{action:"toggle_favorite"}),downloadFile:async t=>{const r=localStorage.getItem("token"),n=await fetch(`/api/audio/${t}/download/`,{headers:{Authorization:`Token ${r}`}});if(!n.ok)throw new Error("Download failed");return await n.blob()},getPlayer:t=>U.get(`/audio/${t}/player/`),updateProgress:(t,r)=>U.post(`/audio/${t}/progress/`,r),getLyrics:t=>U.get(`/audio/${t}/lyrics/`),fetchLyrics:(t,r)=>U.post(`/audio/${t}/lyrics/fetch/`,{force:r}),updateLyrics:(t,r)=>U.put(`/audio/${t}/lyrics/`,r),deleteLyrics:t=>U.delete(`/audio/${t}/lyrics/`),uploadLrcFile:(t,r)=>{const n=new FormData;return n.append("lrc_file",r),U.post(`/audio/${t}/lyrics/upload/`,n,{headers:{"Content-Type":"multipart/form-data"}})},fetchBatchLyrics:t=>U.post("/audio/lyrics/fetch_batch/",{youtube_ids:t}),fetchAllMissingLyrics:t=>U.post("/audio/lyrics/fetch_all_missing/",{limit:t}),getLyricsStats:()=>U.get("/audio/lyrics/stats/"),getRecommendations:t=>U.get(`/audio/${t}/recommendations/`),getSimilarTracks:t=>U.get(`/audio/${t}/similar/`),searchMetadata:(t,r)=>U.get(`/audio/${t}/metadata/search/`,{params:r}),applyMetadata:(t,r)=>U.post(`/audio/${t}/metadata/apply/`,r),autoFetchMetadata:t=>U.post(`/audio/${t}/metadata/auto/`)},Qr={list:t=>U.get("/channel/",{params:t}),get:t=>U.get(`/channel/${t}/`),subscribe:t=>U.post("/channel/",t),unsubscribe:t=>U.delete(`/channel/${t}/`)},Nt={list:t=>U.get("/playlist/",{params:t}),get:t=>U.get(`/playlist/${t}/`),getWithItems:t=>U.get(`/playlist/${t}/`,{params:{include_items:"true"}}),create:t=>U.post("/playlist/",t),delete:t=>U.delete(`/playlist/${t}/`),download:t=>U.post(`/playlist/${t}/`,{action:"download"}),getItems:t=>U.get(`/playlist/${t}/items/`),addItem:(t,r)=>U.post(`/playlist/${t}/items/`,{youtube_id:r}),removeItem:(t,r)=>U.delete(`/playlist/${t}/items/`,{data:{youtube_id:r}}),findContaining:t=>U.get(`/playlist/containing/${t}/`)},er={list:()=>U.get("/playlist/smart/"),get:t=>U.get(`/playlist/smart/${t}/`),getWithTracks:t=>U.get(`/playlist/smart/${t}/`,{params:{include_tracks:"true"}}),getTracks:(t,r)=>U.get(`/playlist/smart/${t}/tracks/`,{params:r}),create:t=>U.post("/playlist/smart/",t),update:(t,r)=>U.put(`/playlist/smart/${t}/`,r),delete:t=>U.delete(`/playlist/smart/${t}/`),getChoices:()=>U.get("/playlist/smart/choices/"),preview:t=>U.post("/playlist/smart/preview/",t),getRules:t=>U.get(`/playlist/smart/${t}/rules/`),addRule:(t,r)=>U.post(`/playlist/smart/${t}/rules/`,r),setRules:(t,r)=>U.put(`/playlist/smart/${t}/rules/`,{rules:r})},dr={audio:()=>U.get("/stats/audio/"),channel:()=>U.get("/stats/channel/"),download:()=>U.get("/stats/download/"),insights:t=>U.get("/stats/insights/",{params:t?{days:t}:{}}),recordListening:t=>U.post("/stats/record/",t),history:t=>U.get("/stats/history/",{params:t}),clearHistory:t=>U.delete("/stats/history/",{params:t?{days:t}:{}}),onThisDay:()=>U.get("/stats/on-this-day/"),achievements:t=>U.get("/stats/achievements/",{params:t}),checkAchievements:()=>U.post("/stats/achievements/"),markAchievementsSeen:t=>U.patch("/stats/achievements/",t?{ids:t}:{all:!0}),streak:()=>U.get("/stats/streak/"),yearlyWrapped:t=>U.get("/stats/wrapped/",{params:t?{year:t}:{}})},Cr={login:t=>U.post("/user/login/",t),logout:()=>U.post("/user/logout/"),account:()=>U.get("/user/account/"),config:()=>U.get("/user/config/"),updateConfig:t=>U.post("/user/config/",t),twoFactorStatus:()=>U.get("/user/2fa/status/"),twoFactorSetup:()=>U.post("/user/2fa/setup/"),twoFactorVerify:t=>U.post("/user/2fa/verify/",t),twoFactorDisable:t=>U.post("/user/2fa/disable/",t),twoFactorRegenerateCodes:()=>U.post("/user/2fa/regenerate-codes/"),twoFactorDownloadCodes:()=>U.get("/user/2fa/download-codes/",{responseType:"blob"})},Oa={getSession:()=>U.get("/playback-sync/"),checkStatus:()=>U.get("/playback-sync/status/"),syncPlayback:t=>U.post("/playback-sync/",t),clearSession:()=>U.delete("/playback-sync/")},lr={start:t=>U.post("/radio/start/",t),stop:()=>U.post("/radio/stop/"),status:()=>U.get("/radio/status/"),next:()=>U.get("/radio/next/"),skip:t=>U.post("/radio/skip/",t),like:t=>U.post("/radio/like/",t),getSettings:()=>U.get("/radio/settings/"),updateSettings:t=>U.post("/radio/settings/",t)};function Kx({onLoginSuccess:t}){const[r,n]=l.useState(""),[s,a]=l.useState(""),[i,o]=l.useState(!1),[c,f]=l.useState(!1),[d,u]=l.useState(""),[p,g]=l.useState(!1),[y,m]=l.useState(""),[b,S]=l.useState(!1),[v,j]=l.useState(0),[w,C]=l.useState(null);l.useEffect(()=>{if(v>0){const R=setInterval(()=>{j(_=>_<=1?(S(!1),u(""),0):_-1)},1e3);return()=>clearInterval(R)}},[v]);const A=R=>{const _=Math.floor(R/60),z=R%60;return`${_}:${z.toString().padStart(2,"0")}`},P=async()=>{if(!b)try{C(null);const R=await Cr.login({username:r,password:s,...p&&{two_factor_code:y}});if(R.data.requires_2fa){g(!0),u("Please enter your two-factor authentication code");return}localStorage.setItem("token",R.data.token),t()}catch(R){const _=R.response?.data;if(R.response?.status===429&&_?.locked){S(!0),j(_.remaining_seconds||3600),u(_.error||"Account temporarily locked"),C(null);return}if(_?.remaining_attempts!==void 0){C(_.remaining_attempts),u(_.message||"Invalid credentials");return}_?.requires_2fa?(g(!0),u("Please enter your two-factor authentication code")):u(_?.error||"Invalid credentials or verification code")}},D=R=>{R.key==="Enter"&&!b&&P()};return e.jsxs(h,{sx:{display:"flex",flexDirection:"column",minHeight:"100vh",width:"100vw",background:"linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%)",position:"relative",overflow:"auto"},children:[e.jsxs(h,{sx:{flex:{xs:.6,sm:1},display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:{xs:3,sm:4},paddingTop:{xs:6,sm:8}},children:[e.jsx(h,{component:"img",src:"/img/logo.png",alt:"SoundWave Logo",sx:{width:{xs:180,sm:220},height:{xs:180,sm:220},borderRadius:"50%",mb:3,boxShadow:"0 20px 60px rgba(34, 211, 238, 0.3)",border:"4px solid rgba(34, 211, 238, 0.2)",position:"relative",animation:"pulse 2s ease-in-out infinite","@keyframes pulse":{"0%, 100%":{transform:"scale(1)",boxShadow:"0 20px 60px rgba(34, 211, 238, 0.3)"},"50%":{transform:"scale(1.05)",boxShadow:"0 25px 70px rgba(34, 211, 238, 0.5)"}}}}),e.jsx(x,{sx:{fontSize:{xs:"2.5rem",sm:"3.5rem"},fontWeight:800,letterSpacing:"-0.03em",color:"#22d3ee",textAlign:"center",textShadow:"0 4px 20px rgba(34, 211, 238, 0.4)",mb:1},children:"SoundWave"}),e.jsx(x,{sx:{fontSize:{xs:"0.9rem",sm:"1rem"},color:"#94a3b8",textAlign:"center",fontWeight:500},children:"Your Personal Music Hub"})]}),e.jsx(h,{sx:{flex:{xs:1,sm:1.2},backgroundColor:"rgba(30, 41, 59, 0.8)",backdropFilter:"blur(20px)",borderTopLeftRadius:{xs:32,sm:40},borderTopRightRadius:{xs:32,sm:40},padding:{xs:3,sm:4},paddingTop:{xs:4,sm:5},display:"flex",flexDirection:"column",alignItems:"center",border:"1px solid rgba(34, 211, 238, 0.1)",borderBottom:"none"},children:e.jsxs(h,{sx:{width:"100%",maxWidth:{xs:"100%",sm:420},padding:{xs:0,sm:2}},children:[e.jsx(x,{variant:"h4",sx:{color:"#f8fafc",fontWeight:700,marginBottom:{xs:3,sm:4},fontSize:{xs:"1.5rem",sm:"1.75rem"},textAlign:"center"},children:"Welcome Back"}),e.jsx(je,{fullWidth:!0,placeholder:"Username",value:r,onChange:R=>n(R.target.value),onKeyPress:D,autoFocus:!0,sx:{marginBottom:2,"& .MuiOutlinedInput-root":{backgroundColor:"rgba(15, 23, 42, 0.6)",borderRadius:3,boxShadow:"0 2px 8px rgba(0, 0, 0, 0.3)","& fieldset":{borderColor:"rgba(34, 211, 238, 0.2)",borderWidth:2},"&:hover fieldset":{borderColor:"rgba(34, 211, 238, 0.4)"},"&.Mui-focused fieldset":{borderColor:"#22d3ee",borderWidth:2}},"& .MuiOutlinedInput-input":{padding:{xs:"14px 16px",sm:"16px 18px"},fontSize:"0.95rem",color:"#f8fafc"}},InputProps:{startAdornment:e.jsx(tr,{position:"start",children:e.jsx(af,{sx:{color:"#94a3b8",fontSize:22}})})}}),e.jsx(je,{fullWidth:!0,type:i?"text":"password",placeholder:"Password",value:s,onChange:R=>a(R.target.value),onKeyPress:D,sx:{marginBottom:1.5,"& .MuiOutlinedInput-root":{backgroundColor:"rgba(15, 23, 42, 0.6)",borderRadius:3,boxShadow:"0 2px 8px rgba(0, 0, 0, 0.3)","& fieldset":{borderColor:"rgba(34, 211, 238, 0.2)",borderWidth:2},"&:hover fieldset":{borderColor:"rgba(34, 211, 238, 0.4)"},"&.Mui-focused fieldset":{borderColor:"#22d3ee",borderWidth:2}},"& .MuiOutlinedInput-input":{padding:{xs:"14px 16px",sm:"16px 18px"},fontSize:"0.95rem",color:"#f8fafc"}},InputProps:{startAdornment:e.jsx(tr,{position:"start",children:e.jsx(Ao,{sx:{color:"#94a3b8",fontSize:22}})}),endAdornment:e.jsx(tr,{position:"end",children:e.jsx(J,{onClick:()=>o(!i),edge:"end",sx:{backgroundColor:"rgba(34, 211, 238, 0.2)",borderRadius:"50%",width:36,height:36,"&:hover":{backgroundColor:"rgba(34, 211, 238, 0.3)"}},children:i?e.jsx(xf,{sx:{color:"#22d3ee",fontSize:18}}):e.jsx(uf,{sx:{color:"#22d3ee",fontSize:18}})})})}}),p&&e.jsx(je,{fullWidth:!0,placeholder:"Two-Factor Code",value:y,onChange:R=>m(R.target.value),onKeyPress:D,autoFocus:!0,inputProps:{maxLength:6},sx:{marginBottom:1.5,"& .MuiOutlinedInput-root":{backgroundColor:"rgba(15, 23, 42, 0.6)",borderRadius:3,boxShadow:"0 2px 8px rgba(0, 0, 0, 0.3)","& fieldset":{borderColor:"rgba(34, 211, 238, 0.2)",borderWidth:2},"&:hover fieldset":{borderColor:"rgba(34, 211, 238, 0.4)"},"&.Mui-focused fieldset":{borderColor:"#22d3ee",borderWidth:2}},"& .MuiOutlinedInput-input":{padding:"14px 16px",fontSize:"0.95rem",color:"#f8fafc",textAlign:"center",letterSpacing:"0.5em"}},InputProps:{startAdornment:e.jsx(tr,{position:"start",children:e.jsx(Ao,{sx:{color:"#94a3b8",fontSize:22}})})}}),e.jsx($e,{control:e.jsx(Mi,{checked:c,onChange:R=>f(R.target.checked),sx:{color:"#475569","&.Mui-checked":{color:"#22d3ee"}}}),label:e.jsx(x,{sx:{color:"#94a3b8",fontSize:"0.9rem"},children:"Remember Password"}),sx:{marginBottom:{xs:2.5,sm:3}}}),e.jsx(q,{fullWidth:!0,variant:"contained",onClick:P,sx:{background:"linear-gradient(135deg, #22d3ee 0%, #06b6d4 100%)",color:"#0f172a",padding:{xs:"14px",sm:"16px"},borderRadius:3,fontSize:"0.95rem",fontWeight:700,textTransform:"uppercase",letterSpacing:"0.5px",boxShadow:"0 4px 20px rgba(34, 211, 238, 0.4)",border:"1px solid rgba(34, 211, 238, 0.3)","&:hover":{background:"linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)",boxShadow:"0 6px 30px rgba(34, 211, 238, 0.6)",transform:"translateY(-2px)"},transition:"all 0.3s ease","&:disabled":{backgroundColor:"rgba(100, 100, 100, 0.5)",color:"rgba(255, 255, 255, 0.5)"}},endIcon:b?e.jsx(To,{}):e.jsx(gf,{}),disabled:b,children:b?`Locked (${A(v)})`:"Login"}),b&&e.jsxs(ge,{severity:"error",icon:e.jsx(To,{}),sx:{mt:2,backgroundColor:"rgba(239, 68, 68, 0.15)",border:"1px solid rgba(239, 68, 68, 0.3)","& .MuiAlert-icon":{color:"#ef4444"}},children:[e.jsx(x,{variant:"body2",fontWeight:600,children:"Account Temporarily Locked"}),e.jsxs(x,{variant:"caption",children:["Too many failed login attempts. Please wait ",A(v)," before trying again."]})]}),!b&&w!==null&&e.jsxs(ge,{severity:w<=1?"error":"warning",sx:{mt:2,backgroundColor:w<=1?"rgba(239, 68, 68, 0.15)":"rgba(251, 191, 36, 0.15)",border:w<=1?"1px solid rgba(239, 68, 68, 0.3)":"1px solid rgba(251, 191, 36, 0.3)"},children:[e.jsx(x,{variant:"body2",fontWeight:600,children:w<=1?" Last Attempt!":"Invalid Credentials"}),e.jsx(x,{variant:"caption",children:w===0?"Account will be locked on next failed attempt.":`${w} attempt${w!==1?"s":""} remaining before your account is locked for 60 minutes.`})]}),d&&!b&&w===null&&e.jsx(x,{sx:{color:"#ef4444",fontSize:"0.875rem",marginTop:2,textAlign:"center",backgroundColor:"rgba(239, 68, 68, 0.1)",padding:"8px 12px",borderRadius:2,border:"1px solid rgba(239, 68, 68, 0.2)"},children:d})]})})]})}function Jx({setCurrentAudio:t}){const r=At(),[n,s]=l.useState([]),[a,i]=l.useState([]);l.useEffect(()=>{o(),c()},[]);const o=async()=>{try{const f=await wt.list({sort:"downloaded",order:"desc",page:1}),d=f.data?.data||f.data||[];s(Array.isArray(d)?d.slice(0,3):[])}catch(f){console.error("Failed to load audio:",f),s([])}},c=async()=>{try{const f=await Nt.list(),d=f.data?.data||f.data||[];i(Array.isArray(d)?d.slice(0,3):[])}catch(f){console.error("Failed to load playlists:",f),i([])}};return e.jsxs(h,{children:[e.jsxs(h,{sx:{mb:6},children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2,px:.5},children:[e.jsx(x,{variant:"h6",sx:{fontWeight:700,letterSpacing:"-0.02em"},children:"Newly Added Songs"}),e.jsx(x,{variant:"body2",onClick:()=>r("/library"),sx:{color:"primary.main",cursor:"pointer",fontWeight:500,"&:hover":{opacity:.8}},children:"See All"})]}),e.jsx(h,{sx:{display:"flex",gap:3,overflowX:"auto",pb:2,"&::-webkit-scrollbar":{height:8},"&::-webkit-scrollbar-thumb":{bgcolor:"rgba(255,255,255,0.1)",borderRadius:1}},children:n.map(f=>e.jsxs(h,{sx:{minWidth:160,width:160,cursor:"pointer","& .play-button":{opacity:0,transform:"translateY(8px)"},"&:hover .play-button":{opacity:1,transform:"translateY(0)"},"&:hover .card-image":{transform:"scale(1.05)"}},onClick:()=>t(f,n),children:[e.jsxs(h,{sx:{position:"relative",aspectRatio:"1",borderRadius:3,overflow:"hidden",mb:1.5},children:[e.jsx(h,{className:"card-image",sx:{width:"100%",height:"100%",backgroundImage:`url(${f.thumbnail_url||"/placeholder.jpg"})`,backgroundSize:"cover",backgroundPosition:"center",transition:"transform 0.5s ease"}}),e.jsx(h,{sx:{position:"absolute",inset:0,bgcolor:"rgba(0, 0, 0, 0.2)",transition:"background-color 0.3s ease","&:hover":{bgcolor:"rgba(0, 0, 0, 0.4)"}}}),e.jsx(J,{className:"play-button",sx:{position:"absolute",bottom:12,right:12,width:40,height:40,bgcolor:"primary.main",color:"background.dark",transition:"all 0.3s ease",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)","&:hover":{bgcolor:"primary.main",transform:"scale(1.1)"}},children:e.jsx(St,{})})]}),e.jsx(x,{variant:"body2",noWrap:!0,sx:{fontWeight:600,mb:.5},children:f.title}),e.jsx(x,{variant:"caption",color:"text.secondary",noWrap:!0,children:f.channel_name})]},f.id))})]}),e.jsxs(h,{children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2,px:.5},children:[e.jsx(x,{variant:"h6",sx:{fontWeight:700,letterSpacing:"-0.02em"},children:"Your Playlists"}),e.jsx(x,{variant:"body2",onClick:()=>r("/playlists"),sx:{color:"primary.main",cursor:"pointer",fontWeight:500,"&:hover":{opacity:.8}},children:"See All"})]}),e.jsx(h,{sx:{display:"flex",flexDirection:"column",gap:1.5},children:a.map(f=>e.jsxs(h,{onClick:()=>r(`/playlists/${f.playlist_id}`),sx:{display:"flex",alignItems:"center",gap:2,p:1.5,borderRadius:3,cursor:"pointer",transition:"background-color 0.3s ease","&:hover":{bgcolor:"rgba(255, 255, 255, 0.05)"},"& .play-btn":{opacity:0,transition:"opacity 0.3s ease"},"&:hover .play-btn":{opacity:1}},children:[e.jsx(h,{sx:{width:56,height:56,borderRadius:2,bgcolor:"primary.main",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,boxShadow:"0 2px 8px rgba(0, 0, 0, 0.2)"},children:e.jsx(St,{sx:{fontSize:28,color:"background.dark"}})}),e.jsxs(h,{sx:{flexGrow:1,minWidth:0},children:[e.jsx(x,{variant:"subtitle2",noWrap:!0,sx:{fontWeight:600,mb:.25},children:f.title}),e.jsxs(x,{variant:"caption",color:"text.secondary",children:[f.item_count," Tracks"]})]}),e.jsx(J,{className:"play-btn",size:"small",sx:{width:32,height:32,border:"1px solid",borderColor:"rgba(255, 255, 255, 0.1)"},children:e.jsx(St,{sx:{fontSize:18}})})]},f.id))})]})]})}var vn={},Jo;function Xx(){if(Jo)return vn;Jo=1;var t=te();Object.defineProperty(vn,"__esModule",{value:!0}),vn.default=void 0;var r=t(ne()),n=re();return vn.default=(0,r.default)((0,n.jsx)("path",{d:"M10.59 9.17 5.41 4 4 5.41l5.17 5.17zM14.5 4l2.04 2.04L4 18.59 5.41 20 17.96 7.46 20 9.5V4zm.33 9.41-1.41 1.41 3.13 3.13L14.5 20H20v-5.5l-2.04 2.04z"}),"Shuffle"),vn}var Zx=Xx();const si=ee(Zx);var jn={},Xo;function ep(){if(Xo)return jn;Xo=1;var t=te();Object.defineProperty(jn,"__esModule",{value:!0}),jn.default=void 0;var r=t(ne()),n=re();return jn.default=(0,r.default)((0,n.jsx)("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4z"}),"Refresh"),jn}var tp=ep();const Us=ee(tp),ta=50;async function qa(t={}){let r=[],n=1,s=!0;for(;s;){const a=await wt.list({...t,page:n}),i=a.data?.data||a.data||[];Array.isArray(i)&&i.length>0?(r=[...r,...i],n++,i.length<ta&&(s=!1)):s=!1}return r}async function Nd(t={}){const r=await Nt.list(t);if(Array.isArray(r.data))return r.data;const n=r.data?.data||r.data?.results||[];if(r.data?.paginate||r.data?.next){let s=Array.isArray(n)?[...n]:[],a=2,i=n.length>=ta;for(;i;){const o=await Nt.list({...t,page:a}),c=o.data?.data||o.data?.results||o.data||[];Array.isArray(c)&&c.length>0?(s=[...s,...c],a++,c.length<ta&&(i=!1)):i=!1}return s}return Array.isArray(n)?n:[]}async function Ud(t={}){const r=await Qr.list(t);if(Array.isArray(r.data))return r.data;const n=r.data?.data||r.data?.results||[];if(r.data?.paginate||r.data?.next){let s=Array.isArray(n)?[...n]:[],a=2,i=n.length>=ta;for(;i;){const o=await Qr.list({...t,page:a}),c=o.data?.data||o.data?.results||o.data||[];Array.isArray(c)&&c.length>0?(s=[...s,...c],a++,c.length<ta&&(i=!1)):i=!1}return s}return Array.isArray(n)?n:[]}var wn={},Zo;function rp(){if(Zo)return wn;Zo=1;var t=te();Object.defineProperty(wn,"__esModule",{value:!0}),wn.default=void 0;var r=t(ne()),n=re();return wn.default=(0,r.default)((0,n.jsx)("path",{d:"M7.41 15.41 12 10.83l4.59 4.58L18 14l-6-6-6 6z"}),"KeyboardArrowUp"),wn}var np=rp();const sp=ee(np);function sn({threshold:t=300}){const[r,n]=l.useState(!1);l.useEffect(()=>{const a=()=>{n(window.scrollY>t)};return window.addEventListener("scroll",a),()=>window.removeEventListener("scroll",a)},[t]);const s=()=>{window.scrollTo({top:0,behavior:"smooth"})};return e.jsx(Jc,{in:r,children:e.jsx(Xc,{color:"primary",size:"medium",onClick:s,sx:{position:"fixed",bottom:100,right:24,zIndex:1e3},"aria-label":"scroll to top",children:e.jsx(sp,{})})})}var Sn={},el;function ap(){if(el)return Sn;el=1;var t=te();Object.defineProperty(Sn,"__esModule",{value:!0}),Sn.default=void 0;var r=t(ne()),n=re();return Sn.default=(0,r.default)((0,n.jsx)("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"}),"MoreVert"),Sn}var ip=ap();const Hd=ee(ip);var Cn={},tl;function op(){if(tl)return Cn;tl=1;var t=te();Object.defineProperty(Cn,"__esModule",{value:!0}),Cn.default=void 0;var r=t(ne()),n=re();return Cn.default=(0,r.default)((0,n.jsx)("path",{d:"M3.24 6.15C2.51 6.43 2 7.17 2 8v12c0 1.1.89 2 2 2h16c1.11 0 2-.9 2-2V8c0-1.11-.89-2-2-2H8.3l8.26-3.34L15.88 1zM7 20c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m13-8h-2v-2h-2v2H4V8h16z"}),"Radio"),Cn}var lp=op();const tn=ee(lp);var kn={},rl;function cp(){if(rl)return kn;rl=1;var t=te();Object.defineProperty(kn,"__esModule",{value:!0}),kn.default=void 0;var r=t(ne()),n=re();return kn.default=(0,r.default)((0,n.jsx)("path",{d:"m12 21.35-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54z"}),"Favorite"),kn}var dp=cp();const xa=ee(dp);var _n={},nl;function up(){if(nl)return _n;nl=1;var t=te();Object.defineProperty(_n,"__esModule",{value:!0}),_n.default=void 0;var r=t(ne()),n=re();return _n.default=(0,r.default)((0,n.jsx)("path",{d:"M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3m-4.4 15.55-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05"}),"FavoriteBorder"),_n}var hp=up();const Vd=ee(hp);var Rn={},sl;function fp(){if(sl)return Rn;sl=1;var t=te();Object.defineProperty(Rn,"__esModule",{value:!0}),Rn.default=void 0;var r=t(ne()),n=re();return Rn.default=(0,r.default)((0,n.jsx)("path",{d:"M14 10H3v2h11zm0-4H3v2h11zm4 8v-4h-2v4h-4v2h4v4h2v-4h4v-2zM3 16h7v-2H3z"}),"PlaylistAdd"),Rn}var xp=fp();const Yd=ee(xp);var In={},al;function pp(){if(al)return In;al=1;var t=te();Object.defineProperty(In,"__esModule",{value:!0}),In.default=void 0;var r=t(ne()),n=re();return In.default=(0,r.default)((0,n.jsx)("path",{d:"M3 10h11v2H3zm0-4h11v2H3zm0 8h7v2H3zm13-1v8l6-4z"}),"PlaylistPlay"),In}var mp=pp();const ra=ee(mp);var An={},il;function gp(){if(il)return An;il=1;var t=te();Object.defineProperty(An,"__esModule",{value:!0}),An.default=void 0;var r=t(ne()),n=re();return An.default=(0,r.default)((0,n.jsx)("path",{d:"M15 6H3v2h12zm0 4H3v2h12zM3 16h8v-2H3zM17 6v8.18c-.31-.11-.65-.18-1-.18-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3V8h3V6z"}),"QueueMusic"),An}var yp=gp();const Gd=ee(yp);var Pn={},ol;function bp(){if(ol)return Pn;ol=1;var t=te();Object.defineProperty(Pn,"__esModule",{value:!0}),Pn.default=void 0;var r=t(ne()),n=re();return Pn.default=(0,r.default)((0,n.jsx)("path",{d:"M5 20h14v-2H5zM19 9h-4V3H9v6H5l7 7z"}),"Download"),Pn}var vp=bp();const Tr=ee(vp);var Dn={},ll;function jp(){if(ll)return Dn;ll=1;var t=te();Object.defineProperty(Dn,"__esModule",{value:!0}),Dn.default=void 0,a(Hh());var r=t(ne()),n=re();function s(i){if(typeof WeakMap!="function")return null;var o=new WeakMap,c=new WeakMap;return(s=function(f){return f?c:o})(i)}function a(i,o){if(i&&i.__esModule)return i;if(i===null||typeof i!="object"&&typeof i!="function")return{default:i};var c=s(o);if(c&&c.has(i))return c.get(i);var f={__proto__:null},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in i)if(u!=="default"&&Object.prototype.hasOwnProperty.call(i,u)){var p=d?Object.getOwnPropertyDescriptor(i,u):null;p&&(p.get||p.set)?Object.defineProperty(f,u,p):f[u]=i[u]}return f.default=i,c&&c.set(i,f),f}return Dn.default=(0,r.default)((0,n.jsx)("path",{d:"M10 15l5.19-3L10 9v6m11.56-7.83c.13.47.22 1.1.28 1.9.07.8.1 1.49.1 2.09L22 12c0 2.19-.16 3.8-.44 4.83-.25.9-.83 1.48-1.73 1.73-.47.13-1.33.22-2.65.28-1.3.07-2.49.1-3.59.1L12 19c-4.19 0-6.8-.16-7.83-.44-.9-.25-1.48-.83-1.73-1.73-.13-.47-.22-1.1-.28-1.9-.07-.8-.1-1.49-.1-2.09L2 12c0-2.19.16-3.8.44-4.83.25-.9.83-1.48 1.73-1.73.47-.13 1.33-.22 2.65-.28 1.3-.07 2.49-.1 3.59-.1L12 5c4.19 0 6.8.16 7.83.44.9.25 1.48.83 1.73 1.73z"}),"YouTube"),Dn}var wp=jp();const Kr=ee(wp);var Mn={},cl;function Sp(){if(cl)return Mn;cl=1;var t=te();Object.defineProperty(Mn,"__esModule",{value:!0}),Mn.default=void 0;var r=t(ne()),n=re();return Mn.default=(0,r.default)((0,n.jsx)("path",{d:"M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8z"}),"Folder"),Mn}var Cp=Sp();const kp=ee(Cp);var En={},dl;function _p(){if(dl)return En;dl=1;var t=te();Object.defineProperty(En,"__esModule",{value:!0}),En.default=void 0;var r=t(ne()),n=re();return En.default=(0,r.default)((0,n.jsx)("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"}),"Person"),En}var Rp=_p();const Ni=ee(Rp);var Tn={},ul;function Ip(){if(ul)return Tn;ul=1;var t=te();Object.defineProperty(Tn,"__esModule",{value:!0}),Tn.default=void 0;var r=t(ne()),n=re();return Tn.default=(0,r.default)((0,n.jsx)("path",{d:"M12 10.9c-.61 0-1.1.49-1.1 1.1s.49 1.1 1.1 1.1c.61 0 1.1-.49 1.1-1.1s-.49-1.1-1.1-1.1M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m2.19 12.19L6 18l3.81-8.19L18 6z"}),"Explore"),Tn}var Ap=Ip();const Pp=ee(Ap);var zn={},hl;function Dp(){if(hl)return zn;hl=1;var t=te();Object.defineProperty(zn,"__esModule",{value:!0}),zn.default=void 0;var r=t(ne()),n=re();return zn.default=(0,r.default)((0,n.jsx)("path",{d:"m23 12-2.44-2.78.34-3.68-3.61-.82-1.89-3.18L12 3 8.6 1.54 6.71 4.72l-3.61.81.34 3.68L1 12l2.44 2.78-.34 3.69 3.61.82 1.89 3.18L12 21l3.4 1.46 1.89-3.18 3.61-.82-.34-3.68zm-10 5h-2v-2h2zm0-4h-2V7h2z"}),"NewReleases"),zn}var Mp=Dp();const Ep=ee(Mp),Qd=l.createContext(null);function Tp({children:t}){const[r,n]=l.useState(!1),[s,a]=l.useState(null),[i,o]=l.useState(!1),[c,f]=l.useState(""),d=l.useRef(null),u=l.useCallback((w,C)=>{d.current={youtubeId:w,duration:C,startTime:Date.now()}},[]);l.useEffect(()=>{p()},[]);const p=l.useCallback(async()=>{try{const w=await lr.status();w.data?.has_session&&w.data?.session?.is_active?(a(w.data.session),n(!0)):(a(null),n(!1))}catch(w){console.debug("[Radio] Failed to get status:",w)}},[]),g=l.useCallback(async(w,C,A,P=50)=>{o(!0);try{const D=await lr.start({mode:w,seed_youtube_id:C,seed_channel_id:A,variety_level:P});return D.data?.session?(a(D.data.session),n(!0),f("Radio started"),D.data.first_track||null):null}catch(D){return console.error("[Radio] Failed to start:",D),null}finally{o(!1)}},[]),y=l.useCallback(async()=>{try{await lr.stop(),n(!1),a(null),f("")}catch(w){console.error("[Radio] Failed to stop:",w)}},[]),m=l.useCallback(async()=>{if(!r)return null;o(!0);try{const w=await lr.next();return w.data?.track?(f(w.data.reason||""),s&&a({...s,current_youtube_id:w.data.track.youtube_id,tracks_played:w.data.total_played}),w.data.track):null}catch(w){return console.error("[Radio] Failed to get next track:",w),w?.response?.status===404&&n(!1),null}finally{o(!1)}},[r,s]),b=l.useCallback(async()=>{if(!r||!d.current)return;const{youtubeId:w,duration:C,startTime:A}=d.current,P=(Date.now()-A)/1e3;try{await lr.skip({youtube_id:w,listen_duration:Math.floor(P),track_duration:Math.floor(C)}),s&&a({...s,tracks_skipped:s.tracks_skipped+1})}catch(D){console.debug("[Radio] Failed to report skip:",D)}},[r,s]),S=l.useCallback(async()=>{if(!r||!d.current)return;const{youtubeId:w,duration:C,startTime:A}=d.current,P=(Date.now()-A)/1e3;try{await lr.like({youtube_id:w,feedback_type:"played",listen_duration:Math.floor(P),track_duration:Math.floor(C)})}catch(D){console.debug("[Radio] Failed to report played:",D)}},[r]),v=l.useCallback(async()=>{if(!(!r||!d.current))try{await lr.like({youtube_id:d.current.youtubeId,feedback_type:"liked"})}catch(w){console.debug("[Radio] Failed to report liked:",w)}},[r]),j={isRadioMode:r,radioSession:s,isLoading:i,currentReason:c,startRadio:g,stopRadio:y,getNextTrack:m,reportSkip:b,reportPlayed:S,reportLiked:v,setCurrentTrackInfo:u,refreshStatus:p};return e.jsx(Qd.Provider,{value:j,children:t})}function ai(){const t=l.useContext(Qd);if(!t)throw new Error("useRadio must be used within a RadioProvider");return t}const fl=[{mode:"track",label:"Track Radio",description:"Similar to this song",icon:e.jsx(tn,{}),requiresTrack:!0},{mode:"artist",label:"Artist Radio",description:"More from this artist",icon:e.jsx(Ni,{}),requiresTrack:!0},{mode:"favorites",label:"Favorites Mix",description:"Your most played tracks",icon:e.jsx(xa,{}),requiresTrack:!1},{mode:"discovery",label:"Discovery Mode",description:"Explore your unplayed tracks",icon:e.jsx(Pp,{}),requiresTrack:!1},{mode:"recent",label:"New Additions",description:"Recently added tracks",icon:e.jsx(Ep,{}),requiresTrack:!1}];function Kd({anchorEl:t,open:r,onClose:n,track:s}){const{startRadio:a,isLoading:i}=ai(),o=async c=>{let f,d;s&&(c==="track"||c==="artist")&&(f=s.youtube_id,d=s.channel_id),await a(c,f,d),n()};return e.jsxs(la,{anchorEl:t,open:r,onClose:n,PaperProps:{sx:{width:280}},children:[e.jsx(x,{variant:"overline",sx:{px:2,color:"text.secondary"},children:"Start Radio"}),s&&e.jsxs(e.Fragment,{children:[fl.filter(c=>c.requiresTrack).map(c=>e.jsxs(ve,{onClick:()=>o(c.mode),disabled:i,children:[e.jsx(Ye,{sx:{color:"primary.main"},children:c.icon}),e.jsx(Se,{primary:c.label,secondary:`${c.description}: ${s.title}`,secondaryTypographyProps:{noWrap:!0,sx:{maxWidth:180}}})]},c.mode)),e.jsx(De,{sx:{my:.5}}),e.jsx(x,{variant:"overline",sx:{px:2,color:"text.secondary"},children:"Or start a mix"})]}),fl.filter(c=>!c.requiresTrack).map(c=>e.jsxs(ve,{onClick:()=>o(c.mode),disabled:i,children:[e.jsx(Ye,{sx:{color:"secondary.main"},children:c.icon}),e.jsx(Se,{primary:c.label,secondary:c.description})]},c.mode))]})}function Jd({open:t,onClose:r,track:n,onSuccess:s}){const[a,i]=l.useState([]),[o,c]=l.useState(!0),[f,d]=l.useState(null),[u,p]=l.useState(!1),[g,y]=l.useState(""),[m,b]=l.useState(!1),[S,v]=l.useState({open:!1,message:"",severity:"success"}),j=l.useCallback(async()=>{try{c(!0);const D=((await Nt.list()).data.data||[]).filter(R=>R.playlist_type==="custom");i(D)}catch(P){console.error("Failed to load playlists:",P)}finally{c(!1)}},[]);l.useEffect(()=>{t&&(j(),p(!1),y(""))},[t,j]);const w=async P=>{if(n?.youtube_id)try{d(P.playlist_id),await Nt.addItem(P.playlist_id,n.youtube_id),v({open:!0,message:`Added to "${P.title}"`,severity:"success"}),s&&s(P.title),r()}catch(D){const R=D.response?.data?.error||"Failed to add to playlist";v({open:!0,message:R,severity:"error"})}finally{d(null)}},C=async()=>{if(!(!g.trim()||!n?.youtube_id))try{b(!0);const D=(await Nt.create({name:g.trim(),playlist_type:"custom"})).data;await Nt.addItem(D.playlist_id,n.youtube_id),v({open:!0,message:`Created "${g}" and added track`,severity:"success"}),s&&s(g),r()}catch(P){const D=P.response?.data?.error||"Failed to create playlist";v({open:!0,message:D,severity:"error"})}finally{b(!1)}},A=()=>{p(!1),y(""),r()};return e.jsxs(e.Fragment,{children:[e.jsxs(Qe,{open:t,onClose:A,maxWidth:"xs",fullWidth:!0,children:[e.jsxs(Xe,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ah,{color:"primary"}),"Add to Playlist"]}),e.jsxs(Ke,{dividers:!0,children:[n&&e.jsxs(h,{sx:{mb:2,p:1.5,bgcolor:"action.hover",borderRadius:1},children:[e.jsx(x,{variant:"body2",noWrap:!0,fontWeight:"medium",children:n.title}),e.jsx(x,{variant:"caption",color:"text.secondary",noWrap:!0,children:n.artist||n.channel_name})]}),o?e.jsx(h,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(Ae,{size:32})}):u?e.jsxs(h,{sx:{py:1},children:[e.jsx(je,{autoFocus:!0,fullWidth:!0,label:"Playlist Name",value:g,onChange:P=>y(P.target.value),onKeyDown:P=>{P.key==="Enter"&&g.trim()&&C()},disabled:m,sx:{mb:2}}),e.jsxs(h,{sx:{display:"flex",gap:1},children:[e.jsx(q,{variant:"outlined",onClick:()=>p(!1),disabled:m,children:"Back"}),e.jsx(q,{variant:"contained",onClick:C,disabled:!g.trim()||m,startIcon:m?e.jsx(Ae,{size:16}):e.jsx(Zc,{}),children:m?"Creating...":"Create & Add"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(Oe,{disablePadding:!0,children:e.jsxs(Zt,{onClick:()=>p(!0),children:[e.jsx(Ye,{children:e.jsx(rr,{color:"primary"})}),e.jsx(Se,{primary:"Create New Playlist",primaryTypographyProps:{color:"primary",fontWeight:"medium"}})]})}),a.length>0&&e.jsx(De,{sx:{my:1}}),a.length===0?e.jsx(x,{variant:"body2",color:"text.secondary",sx:{py:2,textAlign:"center"},children:"No custom playlists yet. Create one!"}):e.jsx(Ge,{disablePadding:!0,children:a.map(P=>e.jsx(Oe,{disablePadding:!0,children:e.jsxs(Zt,{onClick:()=>w(P),disabled:f!==null,children:[e.jsx(Ye,{children:f===P.playlist_id?e.jsx(Ae,{size:24}):e.jsx(Ei,{})}),e.jsx(Se,{primary:P.title,secondary:`${P.item_count} tracks`})]})},P.playlist_id))})]})]}),e.jsx(tt,{children:e.jsx(q,{onClick:A,children:"Cancel"})})]}),e.jsx(ct,{open:S.open,autoHideDuration:3e3,onClose:()=>v({...S,open:!1}),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(ge,{severity:S.severity,onClose:()=>v({...S,open:!1}),children:S.message})})]})}function zr({track:t,onTrackUpdate:r,onDownload:n,onPlayNext:s,onAddToQueue:a,size:i="small",showQueueActions:o=!0}){const c=At(),[f,d]=l.useState(null),[u,p]=l.useState(null),[g,y]=l.useState(!1),[m,b]=l.useState(!1),[S,v]=l.useState([]),[j,w]=l.useState(!1),[C,A]=l.useState(t.is_favorite),P=E=>{E.stopPropagation(),d(E.currentTarget)},D=()=>{d(null)},R=E=>{E.stopPropagation(),p(E.currentTarget),D()},_=()=>{p(null)},z=E=>{E.stopPropagation(),s&&s(),D()},W=E=>{E.stopPropagation(),a&&a(),D()},B=async E=>{if(E.stopPropagation(),!!t.youtube_id){try{const G=(await wt.toggleFavorite(t.youtube_id)).data.is_favorite;A(G),r&&r({...t,is_favorite:G})}catch(Z){console.error("Failed to toggle favorite:",Z)}D()}},H=E=>{E.stopPropagation(),y(!0),D()},se=E=>{E.stopPropagation(),n&&n(),D()},I=E=>{E.stopPropagation(),t.channel_id&&t.youtube_id&&c(`/channels/${t.channel_id}?highlight=${t.youtube_id}`),D()},k=async E=>{if(E.stopPropagation(),!!t.youtube_id){b(!0),w(!0),D();try{const Z=await Nt.findContaining(t.youtube_id);v(Z.data.data||[])}catch(Z){console.error("Failed to find playlists:",Z),v([])}finally{w(!1)}}},O=E=>{b(!1),c(`/playlists/${E}?highlight=${t.youtube_id}`)};return e.jsxs(e.Fragment,{children:[e.jsx(J,{size:i,onClick:P,sx:{color:"text.secondary","&:hover":{color:"text.primary",bgcolor:"rgba(255, 255, 255, 0.1)"}},children:e.jsx(Hd,{fontSize:i})}),e.jsxs(la,{anchorEl:f,open:!!f,onClose:D,onClick:E=>E.stopPropagation(),children:[o&&s&&e.jsxs(ve,{onClick:z,children:[e.jsx(Ye,{children:e.jsx(ra,{fontSize:"small",sx:{color:"primary.main"}})}),e.jsx(Se,{children:"Play Next"})]}),o&&a&&e.jsxs(ve,{onClick:W,children:[e.jsx(Ye,{children:e.jsx(Gd,{fontSize:"small"})}),e.jsx(Se,{children:"Add to Queue"})]}),o&&(s||a)&&e.jsx(De,{sx:{my:.5}}),e.jsxs(ve,{onClick:R,children:[e.jsx(Ye,{children:e.jsx(tn,{fontSize:"small",sx:{color:"primary.main"}})}),e.jsx(Se,{children:"Start Radio"})]}),e.jsx(De,{sx:{my:.5}}),e.jsxs(ve,{onClick:B,children:[e.jsx(Ye,{children:C?e.jsx(xa,{fontSize:"small",sx:{color:"error.main"}}):e.jsx(Vd,{fontSize:"small"})}),e.jsx(Se,{children:C?"Remove from Favorites":"Add to Favorites"})]}),e.jsxs(ve,{onClick:H,children:[e.jsx(Ye,{children:e.jsx(Yd,{fontSize:"small"})}),e.jsx(Se,{children:"Add to Playlist"})]}),n&&e.jsxs(ve,{onClick:se,children:[e.jsx(Ye,{children:e.jsx(Tr,{fontSize:"small"})}),e.jsx(Se,{children:"Download"})]}),t.channel_id&&e.jsxs(e.Fragment,{children:[e.jsx(De,{sx:{my:.5}}),e.jsxs(ve,{onClick:I,children:[e.jsx(Ye,{children:e.jsx(Kr,{fontSize:"small",sx:{color:"error.main"}})}),e.jsx(Se,{children:"Go to Channel"})]})]}),t.youtube_id&&e.jsxs(ve,{onClick:k,children:[e.jsx(Ye,{children:e.jsx(kp,{fontSize:"small",sx:{color:"info.main"}})}),e.jsx(Se,{children:"Find in Playlists"})]})]}),e.jsx(Kd,{anchorEl:u,open:!!u,onClose:_,track:t}),e.jsx(Jd,{open:g,onClose:()=>y(!1),track:t}),e.jsxs(Qe,{open:m,onClose:()=>b(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(Xe,{children:"Playlists containing this track"}),e.jsx(Ke,{children:j?e.jsx(h,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(Ae,{})}):S.length===0?e.jsx(x,{color:"text.secondary",sx:{py:2,textAlign:"center"},children:"This track is not in any playlist yet."}):e.jsx(Ge,{children:S.map(E=>e.jsx(Oe,{disablePadding:!0,children:e.jsxs(Zt,{onClick:()=>O(E.playlist_id),children:[e.jsx(Et,{children:e.jsx(Ue,{src:E.thumbnail_url,variant:"rounded",sx:{width:48,height:48},children:e.jsx(ra,{})})}),e.jsx(Se,{primary:E.title,secondary:`${E.item_count} tracks  Position #${E.position}`})]})},E.playlist_id))})})]})]})}function pa(t={}){const{scrollDelay:r=300,highlightDuration:n=3e3}=t,[s,a]=Vh(),i=l.useRef(null),o=s.get("highlight"),c=l.useCallback(d=>!d||d!==o?null:u=>{!u||i.current===d||(i.current=d,setTimeout(()=>{u.scrollIntoView({behavior:"smooth",block:"center"}),u.classList.add("highlight-track"),setTimeout(()=>{u.classList.remove("highlight-track");const p=new URLSearchParams(s);p.delete("highlight"),a(p,{replace:!0})},n)},r))},[o,r,n,s,a]),f=l.useCallback(d=>d===o,[o]);return l.useEffect(()=>{o||(i.current=null)},[o]),{highlightYoutubeId:o,getTrackRef:c,shouldHighlight:f}}function zp({setCurrentAudio:t}){const[r,n]=l.useState([]),[s,a]=l.useState(!1),i=md(),{getTrackRef:o,shouldHighlight:c}=pa(),[f,d]=l.useState(!1),[u,p]=l.useState(""),g=l.useCallback(async()=>{a(!0);try{const v=await qa();n(v)}catch(v){console.error("Failed to load audio:",v),n([])}finally{a(!1)}},[]);l.useEffect(()=>{g()},[i.key,g]);const y=v=>{const j=Math.floor(v/60),w=v%60;return`${j}:${w.toString().padStart(2,"0")}`},m=v=>`${(v/1048576).toFixed(1)} MB`,b=()=>{if(r.length===0){p("No tracks in library"),d(!0);return}t(r[0],r),p(`Playing ${r.length} tracks`),d(!0)},S=()=>{if(r.length===0){p("No tracks to shuffle"),d(!0);return}const v=[...r];for(let j=v.length-1;j>0;j--){const w=Math.floor(Math.random()*(j+1));[v[j],v[w]]=[v[w],v[j]]}t(v[0],v),p(`Shuffled ${v.length} tracks`),d(!0)};return e.jsxs(h,{children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:3,flexWrap:"wrap",gap:2},children:[e.jsx(x,{variant:"h4",sx:{fontWeight:700,letterSpacing:"-0.02em"},children:"Library"}),e.jsxs(h,{sx:{display:"flex",gap:1.5},children:[e.jsx(q,{variant:"contained",startIcon:e.jsx(St,{}),onClick:b,disabled:r.length===0,sx:{minWidth:{xs:"48px",sm:"120px"},bgcolor:"primary.main",color:"background.dark",fontWeight:600,"&:hover":{bgcolor:"primary.dark"},"&:disabled":{bgcolor:"rgba(255, 255, 255, 0.1)"}},children:e.jsx(h,{sx:{display:{xs:"none",sm:"block"}},children:"Play All"})}),e.jsx(q,{variant:"outlined",startIcon:e.jsx(si,{}),onClick:S,disabled:r.length===0,sx:{minWidth:{xs:"48px",sm:"120px"},borderColor:"primary.main",color:"primary.main",fontWeight:600,"&:hover":{borderColor:"primary.dark",bgcolor:"rgba(19, 236, 106, 0.05)"},"&:disabled":{borderColor:"rgba(255, 255, 255, 0.1)",color:"rgba(255, 255, 255, 0.3)"}},children:e.jsx(h,{sx:{display:{xs:"none",sm:"block"}},children:"Shuffle"})}),e.jsx(J,{onClick:g,disabled:s,sx:{color:"text.secondary","&:hover":{color:"primary.main"}},title:"Refresh library",children:e.jsx(Us,{sx:{animation:s?"spin 1s linear infinite":"none","@keyframes spin":{"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}}})})]})]}),e.jsxs(x,{variant:"body2",color:"text.secondary",sx:{mb:2},children:[r.length," tracks in your library"]}),e.jsx(Or,{component:pt,sx:{bgcolor:"background.paper",borderRadius:3,border:"1px solid",borderColor:"rgba(255, 255, 255, 0.05)","& .MuiTableCell-root":{borderColor:"rgba(255, 255, 255, 0.05)"}},children:e.jsxs(Fr,{children:[e.jsx(Lr,{children:e.jsxs(ut,{children:[e.jsx(Q,{width:50,sx:{fontWeight:600},children:"#"}),e.jsx(Q,{sx:{fontWeight:600},children:"Title"}),e.jsx(Q,{sx:{fontWeight:600},children:"Channel"}),e.jsx(Q,{align:"right",sx:{fontWeight:600},children:"Duration"}),e.jsx(Q,{align:"right",sx:{fontWeight:600},children:"Size"}),e.jsx(Q,{align:"right",sx:{fontWeight:600},children:"Plays"}),e.jsx(Q,{align:"center",width:100,sx:{fontWeight:600},children:"Actions"})]})}),e.jsx(Wr,{children:r.map((v,j)=>e.jsxs(ut,{ref:o(v.youtube_id),sx:{cursor:"pointer",transition:"background-color 0.3s ease","&:hover":{bgcolor:"rgba(19, 236, 106, 0.05)"},...c(v.youtube_id)&&{bgcolor:"rgba(19, 236, 106, 0.1)"}},onClick:()=>t(v,r),children:[e.jsx(Q,{sx:{color:"text.secondary"},children:j+1}),e.jsx(Q,{children:e.jsx(x,{variant:"body2",noWrap:!0,sx:{maxWidth:300,fontWeight:500},children:v.title})}),e.jsx(Q,{children:e.jsx(x,{variant:"body2",color:"text.secondary",children:v.channel_name})}),e.jsx(Q,{align:"right",sx:{color:"text.secondary"},children:y(v.duration)}),e.jsx(Q,{align:"right",sx:{color:"text.secondary"},children:m(v.file_size)}),e.jsx(Q,{align:"right",sx:{color:"text.secondary"},children:v.play_count}),e.jsxs(Q,{align:"center",onClick:w=>w.stopPropagation(),children:[e.jsx(J,{size:"small",sx:{color:"primary.main","&:hover":{bgcolor:"rgba(19, 236, 106, 0.1)"}},children:e.jsx(St,{})}),e.jsx(zr,{track:v,onTrackUpdate:w=>{n(C=>C.map(A=>A.id===w.id?w:A))}})]})]},v.id))})]})}),e.jsx(ct,{open:f,autoHideDuration:3e3,onClose:()=>d(!1),message:u,anchorOrigin:{vertical:"bottom",horizontal:"center"}}),e.jsx(sn,{})]})}var On={},xl;function Op(){if(xl)return On;xl=1;var t=te();Object.defineProperty(On,"__esModule",{value:!0}),On.default=void 0;var r=t(ne()),n=re();return On.default=(0,r.default)((0,n.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search"),On}var Fp=Op();const Pr=ee(Fp);var Fn={},pl;function Lp(){if(pl)return Fn;pl=1;var t=te();Object.defineProperty(Fn,"__esModule",{value:!0}),Fn.default=void 0;var r=t(ne()),n=re();return Fn.default=(0,r.default)((0,n.jsx)("path",{d:"M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3z"}),"MusicNote"),Fn}var Wp=Lp();const Tt=ee(Wp);var Ln={},ml;function $p(){if(ml)return Ln;ml=1;var t=te();Object.defineProperty(Ln,"__esModule",{value:!0}),Ln.default=void 0;var r=t(ne()),n=re();return Ln.default=(0,r.default)((0,n.jsx)("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9m-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8z"}),"History"),Ln}var Bp=$p();const Ns=ee(Bp);var Wn={},gl;function qp(){if(gl)return Wn;gl=1;var t=te();Object.defineProperty(Wn,"__esModule",{value:!0}),Wn.default=void 0;var r=t(ne()),n=re();return Wn.default=(0,r.default)((0,n.jsx)("path",{d:"m16 6 2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"}),"TrendingUp"),Wn}var Np=qp();const wi=ee(Np);var $n={},yl;function Up(){if(yl)return $n;yl=1;var t=te();Object.defineProperty($n,"__esModule",{value:!0}),$n.default=void 0;var r=t(ne()),n=re();return $n.default=(0,r.default)((0,n.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Clear"),$n}var Hp=Up();const Vp=ee(Hp);function Yp({setCurrentAudio:t}){const r=At(),[n,s]=l.useState(""),[a,i]=l.useState(0),[o,c]=l.useState(!1),[f,d]=l.useState(!1),[u,p]=l.useState([]),[g,y]=l.useState(-1),[m,b]=l.useState([]),[S]=l.useState(["hip hop","rock music","jazz","classical","electronic","blues"]),v=l.useRef(null),j=l.useRef(null),[w,C]=l.useState([]),[A,P]=l.useState([]),[D,R]=l.useState([]);l.useEffect(()=>{(async()=>{try{const T=await qa();b(T)}catch(T){console.error("Failed to load audio for suggestions:",T)}})()},[]),l.useEffect(()=>{const M=localStorage.getItem("soundwave_recent_searches");M&&p(JSON.parse(M))},[]);const _=M=>{if(!M.trim())return;const T=[M,...u.filter(ae=>ae!==M)].slice(0,10);p(T),localStorage.setItem("soundwave_recent_searches",JSON.stringify(T))},z=()=>{p([]),localStorage.removeItem("soundwave_recent_searches")},W=l.useMemo(()=>{const M=[],T=n.toLowerCase().trim();if(!T)return u.slice(0,5).forEach(X=>{M.push({type:"recent",text:X,icon:e.jsx(Ns,{fontSize:"small",color:"action"})})}),S.slice(0,3).forEach(X=>{M.push({type:"popular",text:X,icon:e.jsx(wi,{fontSize:"small",color:"action"})})}),M;const ae=new Set,L=[];return m.forEach(X=>{X.channel_name&&ae.add(X.channel_name),X.title?.toLowerCase().includes(T)&&L.push(X)}),Array.from(ae).filter(X=>X.toLowerCase().includes(T)).slice(0,3).forEach(X=>{M.push({type:"artist",text:X,icon:e.jsx(Ni,{fontSize:"small",color:"primary"})})}),L.slice(0,3).forEach(X=>{M.push({type:"song",text:X.title,icon:e.jsx(Tt,{fontSize:"small",color:"secondary"}),audio:X})}),u.filter(X=>X.toLowerCase().includes(T)&&X.toLowerCase()!==T).slice(0,2).forEach(X=>{M.push({type:"recent",text:X,icon:e.jsx(Ns,{fontSize:"small",color:"action"})})}),S.filter(X=>X.toLowerCase().includes(T)&&X.toLowerCase()!==T).slice(0,2).forEach(X=>{M.push({type:"popular",text:X,icon:e.jsx(wi,{fontSize:"small",color:"action"})})}),M},[n,u,S,m]);l.useEffect(()=>{y(-1)},[W]);const B=(M,T)=>{if(!T.trim())return M;const ae=M.toLowerCase(),L=T.toLowerCase(),N=ae.indexOf(L);return N===-1?M:e.jsxs(e.Fragment,{children:[M.slice(0,N),e.jsx(h,{component:"span",sx:{fontWeight:700,color:"primary.main"},children:M.slice(N,N+T.length)}),M.slice(N+T.length)]})};l.useEffect(()=>{if(!n.trim()){C([]),P([]),R([]);return}const M=setTimeout(()=>{H()},500);return()=>clearTimeout(M)},[n]);const H=async(M=n)=>{if(M.trim()){_(M.trim()),d(!1),c(!0);try{const T=M.toLowerCase(),ae=await qa(),L=ae.filter(ie=>ie.title?.toLowerCase().includes(T)||ie.channel_name?.toLowerCase().includes(T));C(L),b(ae);const X=(await Nd()).filter(ie=>ie.title?.toLowerCase().includes(T)||ie.channel_name?.toLowerCase().includes(T));P(X);const $=(await Ud()).filter(ie=>ie.channel_name?.toLowerCase().includes(T));R($)}catch(T){console.error("Search failed:",T)}finally{c(!1)}}},se=M=>{s(M),H(M)},I=M=>{M.type==="song"&&M.audio?(t(M.audio,w.length>0?w:[M.audio]),d(!1),_(M.text)):se(M.text)},k=M=>{if(!f||W.length===0){M.key==="Enter"&&H();return}switch(M.key){case"ArrowDown":M.preventDefault(),y(T=>T<W.length-1?T+1:T);break;case"ArrowUp":M.preventDefault(),y(T=>T>0?T-1:-1);break;case"Enter":M.preventDefault(),g>=0&&g<W.length?I(W[g]):H();break;case"Escape":d(!1),y(-1);break}},O=()=>{d(!0)},E=()=>{d(!1),y(-1)},Z=M=>{const T=Math.floor(M/60),ae=M%60;return`${T}:${ae.toString().padStart(2,"0")}`},G=w.length+A.length+D.length;return e.jsxs(h,{children:[e.jsx(x,{variant:"h5",sx:{mb:3,fontWeight:700,letterSpacing:"-0.02em"},children:"Search"}),e.jsx(ih,{onClickAway:E,children:e.jsxs(h,{sx:{position:"relative",maxWidth:800,mb:3},children:[e.jsx(je,{ref:v,inputRef:j,fullWidth:!0,value:n,onChange:M=>s(M.target.value),onFocus:O,onKeyDown:k,placeholder:"Search for songs, artists, playlists, or channels...",variant:"outlined",InputProps:{startAdornment:e.jsx(tr,{position:"start",children:e.jsx(Pr,{})}),endAdornment:n&&e.jsx(tr,{position:"end",children:e.jsx(J,{onClick:()=>{s(""),C([]),P([]),R([])},size:"small",children:e.jsx(Vp,{})})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:"9999px",bgcolor:"rgba(255, 255, 255, 0.05)"}}}),e.jsx(oh,{open:f&&W.length>0,anchorEl:v.current,placement:"bottom-start",style:{width:v.current?.offsetWidth,zIndex:1300},transition:!0,children:({TransitionProps:M})=>e.jsx(Ks,{...M,timeout:200,children:e.jsxs(pt,{elevation:8,sx:{mt:1,maxHeight:400,overflowY:"auto",bgcolor:"background.paper",border:"1px solid",borderColor:"divider"},children:[!n.trim()&&u.length>0&&e.jsxs(h,{sx:{px:2,py:1,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(x,{variant:"caption",color:"text.secondary",sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Ns,{fontSize:"small"}),"Recent searches"]}),e.jsx(x,{variant:"caption",color:"primary",sx:{cursor:"pointer","&:hover":{textDecoration:"underline"}},onClick:T=>{T.stopPropagation(),z()},children:"Clear all"})]}),n.trim()&&W.some(T=>T.type==="artist")&&e.jsx(h,{sx:{px:2,py:.5},children:e.jsxs(x,{variant:"caption",color:"text.secondary",sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Ni,{fontSize:"small"}),"Artists"]})}),W.map((T,ae)=>{const L=ae>0?W[ae-1]:null,N=n.trim()&&T.type==="song"&&L?.type!=="song",X=n.trim()&&T.type==="recent"&&L?.type!=="recent",ue=T.type==="popular"&&L?.type!=="popular";return e.jsxs(h,{children:[N&&e.jsxs(e.Fragment,{children:[e.jsx(De,{sx:{my:.5}}),e.jsx(h,{sx:{px:2,py:.5},children:e.jsxs(x,{variant:"caption",color:"text.secondary",sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Tt,{fontSize:"small"}),"Songs"]})})]}),X&&e.jsxs(e.Fragment,{children:[e.jsx(De,{sx:{my:.5}}),e.jsx(h,{sx:{px:2,py:.5},children:e.jsxs(x,{variant:"caption",color:"text.secondary",sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Ns,{fontSize:"small"}),"Recent"]})})]}),ue&&e.jsxs(e.Fragment,{children:[e.jsx(De,{sx:{my:.5}}),e.jsx(h,{sx:{px:2,py:.5},children:e.jsxs(x,{variant:"caption",color:"text.secondary",sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(wi,{fontSize:"small"}),"Popular"]})})]}),e.jsxs(Zt,{onClick:()=>I(T),selected:ae===g,sx:{py:1,"&.Mui-selected":{bgcolor:"action.selected"}},children:[e.jsx(Et,{sx:{minWidth:40},children:T.icon}),e.jsx(Se,{primary:B(T.text,n),secondary:T.type==="song"&&T.audio?.channel_name,primaryTypographyProps:{sx:{fontWeight:ae===g?600:400,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}}),T.type==="song"&&e.jsx(St,{fontSize:"small",color:"action",sx:{opacity:.5}})]})]},`suggestion-${ae}`)}),W.length===0&&!n.trim()&&e.jsx(h,{sx:{p:2,textAlign:"center"},children:e.jsx(x,{variant:"body2",color:"text.secondary",children:"Start typing to search"})})]})})})]})}),n&&e.jsxs(e.Fragment,{children:[e.jsx(h,{sx:{borderBottom:1,borderColor:"divider",mb:3},children:e.jsxs(Ji,{value:a,onChange:(M,T)=>i(T),children:[e.jsx(qt,{label:`All (${G})`,sx:{textTransform:"none",fontWeight:600}}),e.jsx(qt,{label:`Songs (${w.length})`,sx:{textTransform:"none",fontWeight:600}}),e.jsx(qt,{label:`Playlists (${A.length})`,sx:{textTransform:"none",fontWeight:600}}),e.jsx(qt,{label:`Channels (${D.length})`,sx:{textTransform:"none",fontWeight:600}})]})}),o?e.jsx(h,{sx:{display:"flex",justifyContent:"center",py:8},children:e.jsx(Ae,{})}):G===0?e.jsxs(h,{sx:{textAlign:"center",py:8},children:[e.jsx(Pr,{sx:{fontSize:64,color:"text.secondary",opacity:.3,mb:2}}),e.jsx(x,{variant:"h6",color:"text.secondary",children:"No results found"}),e.jsx(x,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Try searching with different keywords"})]}):e.jsxs(h,{children:[a===0&&e.jsxs(h,{children:[w.length>0&&e.jsxs(h,{sx:{mb:4},children:[e.jsxs(x,{variant:"h6",sx:{mb:2,fontWeight:600,display:"flex",alignItems:"center",gap:1},children:[e.jsx(Tt,{})," Songs"]}),e.jsx(Ge,{children:w.slice(0,5).map(M=>e.jsx(Oe,{disablePadding:!0,secondaryAction:e.jsxs(h,{sx:{display:"flex",gap:.5},children:[e.jsx(J,{edge:"end",onClick:()=>t(M,w),disabled:!M.file_path,sx:{color:"primary.main"},children:e.jsx(St,{})}),e.jsx(zr,{track:M,onTrackUpdate:T=>{C(ae=>ae.map(L=>L.id===T.id?T:L)),b(ae=>ae.map(L=>L.id===T.id?T:L))}})]}),children:e.jsxs(Zt,{onClick:()=>t(M,w),disabled:!M.file_path,children:[e.jsx(Et,{children:e.jsx(Ue,{src:M.thumbnail_url,variant:"rounded",sx:{width:56,height:56},children:e.jsx(Tt,{})})}),e.jsx(Se,{primary:M.title,secondary:`${M.channel_name}  ${Z(M.duration)}`,primaryTypographyProps:{fontWeight:500}}),!M.file_path&&e.jsx(de,{label:"Not Downloaded",size:"small",color:"warning",sx:{mr:2}})]})},M.id))})]}),A.length>0&&e.jsxs(h,{sx:{mb:4},children:[e.jsxs(x,{variant:"h6",sx:{mb:2,fontWeight:600,display:"flex",alignItems:"center",gap:1},children:[e.jsx(ra,{})," Playlists"]}),e.jsx(K,{container:!0,spacing:2,children:A.slice(0,4).map(M=>e.jsx(K,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(Ce,{onClick:()=>r(`/playlists/${M.playlist_id}`),sx:{cursor:"pointer",transition:"transform 0.2s","&:hover":{transform:"translateY(-4px)"}},children:[e.jsx(go,{component:"img",height:"160",image:M.thumbnail_url,alt:M.title}),e.jsxs(Ie,{children:[e.jsx(x,{variant:"body2",fontWeight:600,noWrap:!0,children:M.title}),e.jsxs(x,{variant:"caption",color:"text.secondary",noWrap:!0,children:[M.downloaded_count,"/",M.item_count," tracks"]})]})]})},M.id))})]}),D.length>0&&e.jsxs(h,{sx:{mb:4},children:[e.jsxs(x,{variant:"h6",sx:{mb:2,fontWeight:600,display:"flex",alignItems:"center",gap:1},children:[e.jsx(Kr,{})," Channels"]}),e.jsx(Ge,{children:D.slice(0,5).map(M=>e.jsx(Oe,{disablePadding:!0,children:e.jsxs(Zt,{onClick:()=>r("/channels"),children:[e.jsx(Et,{children:e.jsx(Ue,{src:M.thumbnail_url,children:e.jsx(Kr,{})})}),e.jsx(Se,{primary:M.channel_name,secondary:M.subscribed?"Subscribed":"Not subscribed",primaryTypographyProps:{fontWeight:500}})]})},M.id))})]})]}),a===1&&e.jsx(Ge,{children:w.map(M=>e.jsx(Oe,{disablePadding:!0,secondaryAction:e.jsxs(h,{sx:{display:"flex",gap:.5},children:[e.jsx(J,{edge:"end",onClick:()=>t(M,w),disabled:!M.file_path,sx:{color:"primary.main"},children:e.jsx(St,{})}),e.jsx(zr,{track:M,onTrackUpdate:T=>{C(ae=>ae.map(L=>L.id===T.id?T:L)),b(ae=>ae.map(L=>L.id===T.id?T:L))}})]}),children:e.jsxs(Zt,{onClick:()=>t(M,w),disabled:!M.file_path,children:[e.jsx(Et,{children:e.jsx(Ue,{src:M.thumbnail_url,variant:"rounded",sx:{width:56,height:56},children:e.jsx(Tt,{})})}),e.jsx(Se,{primary:M.title,secondary:`${M.channel_name}  ${Z(M.duration)}`,primaryTypographyProps:{fontWeight:500}}),!M.file_path&&e.jsx(de,{label:"Not Downloaded",size:"small",color:"warning",sx:{mr:2}})]})},M.id))}),a===2&&e.jsx(K,{container:!0,spacing:2,children:A.map(M=>e.jsx(K,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(Ce,{onClick:()=>r(`/playlists/${M.playlist_id}`),sx:{cursor:"pointer",transition:"transform 0.2s","&:hover":{transform:"translateY(-4px)"}},children:[e.jsx(go,{component:"img",height:"160",image:M.thumbnail_url,alt:M.title}),e.jsxs(Ie,{children:[e.jsx(x,{variant:"body2",fontWeight:600,noWrap:!0,children:M.title}),e.jsx(x,{variant:"caption",color:"text.secondary",noWrap:!0,children:M.channel_name}),e.jsxs(x,{variant:"caption",color:"text.secondary",display:"block",children:[M.downloaded_count,"/",M.item_count," tracks"]})]})]})},M.id))}),a===3&&e.jsx(Ge,{children:D.map(M=>e.jsx(Oe,{disablePadding:!0,children:e.jsxs(Zt,{onClick:()=>r("/channels"),children:[e.jsx(Et,{children:e.jsx(Ue,{src:M.thumbnail_url,sx:{width:56,height:56},children:e.jsx(Kr,{})})}),e.jsx(Se,{primary:M.channel_name,secondary:M.subscribed?"Subscribed":"Not subscribed",primaryTypographyProps:{fontWeight:500,fontSize:"1rem"}}),M.subscribed&&e.jsx(de,{label:"Subscribed",size:"small",color:"success"})]})},M.id))})]})]}),!n&&e.jsxs(h,{sx:{textAlign:"center",py:8},children:[e.jsx(Pr,{sx:{fontSize:80,color:"text.secondary",opacity:.3,mb:2}}),e.jsx(x,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"Search Your Library"}),e.jsx(x,{variant:"body2",color:"text.secondary",children:"Find songs, playlists, and channels in your collection"})]}),e.jsx(sn,{})]})}function Gp({setCurrentAudio:t}){const[r,n]=l.useState([]),[s,a]=l.useState(!0),{getTrackRef:i,shouldHighlight:o}=pa(),[c,f]=l.useState(!1),[d,u]=l.useState("");l.useEffect(()=>{p()},[]);const p=async()=>{try{a(!0);const j=(await qa({favorites:!0})).filter(w=>w.is_favorite);n(j)}catch(v){console.error("Failed to load favorites:",v),n([])}finally{a(!1)}},g=v=>{v.is_favorite?n(j=>j.map(w=>w.id===v.id?v:w)):(n(j=>j.filter(w=>w.id!==v.id)),u("Removed from favorites"),f(!0))},y=()=>{if(r.length===0){u("No favorites to play"),f(!0);return}t(r[0],r),u(`Playing ${r.length} favorite tracks`),f(!0)},m=()=>{if(r.length===0){u("No favorites to shuffle"),f(!0);return}const v=[...r];for(let j=v.length-1;j>0;j--){const w=Math.floor(Math.random()*(j+1));[v[j],v[w]]=[v[w],v[j]]}t(v[0],v),u(`Shuffled ${v.length} favorite tracks`),f(!0)},b=v=>{const j=Math.floor(v/60),w=v%60;return`${j}:${w.toString().padStart(2,"0")}`},S=v=>`${(v/1048576).toFixed(1)} MB`;return s?e.jsxs(h,{children:[e.jsx(x,{variant:"h4",sx:{mb:2,fontWeight:600},children:"Favorites"}),e.jsx(x,{children:"Loading favorites..."})]}):e.jsxs(h,{children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:3,flexWrap:"wrap",gap:2},children:[e.jsx(x,{variant:"h4",sx:{fontWeight:700,letterSpacing:"-0.02em"},children:"Favorites"}),r.length>0&&e.jsxs(h,{sx:{display:"flex",gap:1.5},children:[e.jsx(q,{variant:"contained",startIcon:e.jsx(St,{}),onClick:y,sx:{borderRadius:2.5,px:3,py:1.25,fontSize:"0.95rem",fontWeight:600},children:"Play All"}),e.jsx(q,{variant:"outlined",startIcon:e.jsx(si,{}),onClick:m,sx:{borderRadius:2.5,px:3,py:1.25,fontSize:"0.95rem",fontWeight:600},children:"Shuffle"})]})]}),r.length===0?e.jsxs(h,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:300,gap:1.5},children:[e.jsx(xa,{sx:{fontSize:48,color:"text.secondary"}}),e.jsx(x,{variant:"subtitle1",color:"text.secondary",children:"No favorites yet"}),e.jsx(x,{variant:"caption",color:"text.secondary",children:"Start adding songs to your favorites"})]}):e.jsx(Or,{component:pt,sx:{borderRadius:3,overflow:"hidden"},children:e.jsxs(Fr,{children:[e.jsx(Lr,{children:e.jsxs(ut,{children:[e.jsx(Q,{width:50,sx:{fontWeight:600},children:"#"}),e.jsx(Q,{sx:{fontWeight:600},children:"Title"}),e.jsx(Q,{sx:{fontWeight:600},children:"Channel"}),e.jsx(Q,{align:"right",sx:{fontWeight:600},children:"Duration"}),e.jsx(Q,{align:"right",sx:{fontWeight:600},children:"Size"}),e.jsx(Q,{align:"right",sx:{fontWeight:600},children:"Plays"}),e.jsx(Q,{align:"center",width:100,sx:{fontWeight:600},children:"Actions"})]})}),e.jsx(Wr,{children:r.map((v,j)=>e.jsxs(ut,{ref:i(v.youtube_id),sx:{cursor:"pointer",transition:"background-color 0.3s ease","&:hover":{bgcolor:"rgba(19, 236, 106, 0.05)"},...o(v.youtube_id)&&{bgcolor:"rgba(19, 236, 106, 0.1)"}},onClick:()=>t(v,r),children:[e.jsx(Q,{sx:{color:"text.secondary"},children:j+1}),e.jsx(Q,{children:e.jsx(x,{variant:"body2",noWrap:!0,sx:{maxWidth:300,fontWeight:500},children:v.title})}),e.jsx(Q,{children:e.jsx(x,{variant:"body2",color:"text.secondary",children:v.channel_name})}),e.jsx(Q,{align:"right",sx:{color:"text.secondary"},children:b(v.duration)}),e.jsx(Q,{align:"right",sx:{color:"text.secondary"},children:S(v.file_size)}),e.jsx(Q,{align:"right",sx:{color:"text.secondary"},children:v.play_count}),e.jsxs(Q,{align:"center",onClick:w=>w.stopPropagation(),children:[e.jsx(J,{size:"small",sx:{color:"primary.main","&:hover":{bgcolor:"rgba(19, 236, 106, 0.1)"}},onClick:w=>{w.stopPropagation(),t(v,r)},children:e.jsx(St,{})}),e.jsx(zr,{track:v,onTrackUpdate:g})]})]},v.id))})]})}),e.jsx(ct,{open:c,autoHideDuration:3e3,onClose:()=>f(!1),message:d,anchorOrigin:{vertical:"bottom",horizontal:"center"}}),e.jsx(sn,{})]})}function Qp(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return l.useMemo(()=>s=>{r.forEach(a=>a(s))},r)}const ii=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function an(t){const r=Object.prototype.toString.call(t);return r==="[object Window]"||r==="[object global]"}function no(t){return"nodeType"in t}function Pt(t){var r,n;return t?an(t)?t:no(t)&&(r=(n=t.ownerDocument)==null?void 0:n.defaultView)!=null?r:window:window}function so(t){const{Document:r}=Pt(t);return t instanceof r}function ma(t){return an(t)?!1:t instanceof Pt(t).HTMLElement}function Xd(t){return t instanceof Pt(t).SVGElement}function on(t){return t?an(t)?t.document:no(t)?so(t)?t:ma(t)||Xd(t)?t.ownerDocument:document:document:document}const sr=ii?l.useLayoutEffect:l.useEffect;function ao(t){const r=l.useRef(t);return sr(()=>{r.current=t}),l.useCallback(function(){for(var n=arguments.length,s=new Array(n),a=0;a<n;a++)s[a]=arguments[a];return r.current==null?void 0:r.current(...s)},[])}function Kp(){const t=l.useRef(null),r=l.useCallback((s,a)=>{t.current=setInterval(s,a)},[]),n=l.useCallback(()=>{t.current!==null&&(clearInterval(t.current),t.current=null)},[]);return[r,n]}function na(t,r){r===void 0&&(r=[t]);const n=l.useRef(t);return sr(()=>{n.current!==t&&(n.current=t)},r),n}function ga(t,r){const n=l.useRef();return l.useMemo(()=>{const s=t(n.current);return n.current=s,s},[...r])}function Na(t){const r=ao(t),n=l.useRef(null),s=l.useCallback(a=>{a!==n.current&&r?.(a,n.current),n.current=a},[]);return[n,s]}function Ui(t){const r=l.useRef();return l.useEffect(()=>{r.current=t},[t]),r.current}let Si={};function ya(t,r){return l.useMemo(()=>{if(r)return r;const n=Si[t]==null?0:Si[t]+1;return Si[t]=n,t+"-"+n},[t,r])}function Zd(t){return function(r){for(var n=arguments.length,s=new Array(n>1?n-1:0),a=1;a<n;a++)s[a-1]=arguments[a];return s.reduce((i,o)=>{const c=Object.entries(o);for(const[f,d]of c){const u=i[f];u!=null&&(i[f]=u+t*d)}return i},{...r})}}const Jr=Zd(1),sa=Zd(-1);function Jp(t){return"clientX"in t&&"clientY"in t}function io(t){if(!t)return!1;const{KeyboardEvent:r}=Pt(t.target);return r&&t instanceof r}function Xp(t){if(!t)return!1;const{TouchEvent:r}=Pt(t.target);return r&&t instanceof r}function Hi(t){if(Xp(t)){if(t.touches&&t.touches.length){const{clientX:r,clientY:n}=t.touches[0];return{x:r,y:n}}else if(t.changedTouches&&t.changedTouches.length){const{clientX:r,clientY:n}=t.changedTouches[0];return{x:r,y:n}}}return Jp(t)?{x:t.clientX,y:t.clientY}:null}const aa=Object.freeze({Translate:{toString(t){if(!t)return;const{x:r,y:n}=t;return"translate3d("+(r?Math.round(r):0)+"px, "+(n?Math.round(n):0)+"px, 0)"}},Scale:{toString(t){if(!t)return;const{scaleX:r,scaleY:n}=t;return"scaleX("+r+") scaleY("+n+")"}},Transform:{toString(t){if(t)return[aa.Translate.toString(t),aa.Scale.toString(t)].join(" ")}},Transition:{toString(t){let{property:r,duration:n,easing:s}=t;return r+" "+n+"ms "+s}}}),bl="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function Zp(t){return t.matches(bl)?t:t.querySelector(bl)}const em={display:"none"};function tm(t){let{id:r,value:n}=t;return Ee.createElement("div",{id:r,style:em},n)}function rm(t){let{id:r,announcement:n,ariaLiveType:s="assertive"}=t;const a={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return Ee.createElement("div",{id:r,style:a,role:"status","aria-live":s,"aria-atomic":!0},n)}function nm(){const[t,r]=l.useState("");return{announce:l.useCallback(s=>{s!=null&&r(s)},[]),announcement:t}}const eu=l.createContext(null);function sm(t){const r=l.useContext(eu);l.useEffect(()=>{if(!r)throw new Error("useDndMonitor must be used within a children of <DndContext>");return r(t)},[t,r])}function am(){const[t]=l.useState(()=>new Set),r=l.useCallback(s=>(t.add(s),()=>t.delete(s)),[t]);return[l.useCallback(s=>{let{type:a,event:i}=s;t.forEach(o=>{var c;return(c=o[a])==null?void 0:c.call(o,i)})},[t]),r]}const im={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},om={onDragStart(t){let{active:r}=t;return"Picked up draggable item "+r.id+"."},onDragOver(t){let{active:r,over:n}=t;return n?"Draggable item "+r.id+" was moved over droppable area "+n.id+".":"Draggable item "+r.id+" is no longer over a droppable area."},onDragEnd(t){let{active:r,over:n}=t;return n?"Draggable item "+r.id+" was dropped over droppable area "+n.id:"Draggable item "+r.id+" was dropped."},onDragCancel(t){let{active:r}=t;return"Dragging was cancelled. Draggable item "+r.id+" was dropped."}};function lm(t){let{announcements:r=om,container:n,hiddenTextDescribedById:s,screenReaderInstructions:a=im}=t;const{announce:i,announcement:o}=nm(),c=ya("DndLiveRegion"),[f,d]=l.useState(!1);if(l.useEffect(()=>{d(!0)},[]),sm(l.useMemo(()=>({onDragStart(p){let{active:g}=p;i(r.onDragStart({active:g}))},onDragMove(p){let{active:g,over:y}=p;r.onDragMove&&i(r.onDragMove({active:g,over:y}))},onDragOver(p){let{active:g,over:y}=p;i(r.onDragOver({active:g,over:y}))},onDragEnd(p){let{active:g,over:y}=p;i(r.onDragEnd({active:g,over:y}))},onDragCancel(p){let{active:g,over:y}=p;i(r.onDragCancel({active:g,over:y}))}}),[i,r])),!f)return null;const u=Ee.createElement(Ee.Fragment,null,Ee.createElement(tm,{id:s,value:a.draggable}),Ee.createElement(rm,{id:c,announcement:o}));return n?qs.createPortal(u,n):u}var it;(function(t){t.DragStart="dragStart",t.DragMove="dragMove",t.DragEnd="dragEnd",t.DragCancel="dragCancel",t.DragOver="dragOver",t.RegisterDroppable="registerDroppable",t.SetDroppableDisabled="setDroppableDisabled",t.UnregisterDroppable="unregisterDroppable"})(it||(it={}));function Ua(){}function Xr(t,r){return l.useMemo(()=>({sensor:t,options:r??{}}),[t,r])}function tu(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return l.useMemo(()=>[...r].filter(s=>s!=null),[...r])}const Qt=Object.freeze({x:0,y:0});function ru(t,r){return Math.sqrt(Math.pow(t.x-r.x,2)+Math.pow(t.y-r.y,2))}function nu(t,r){let{data:{value:n}}=t,{data:{value:s}}=r;return n-s}function cm(t,r){let{data:{value:n}}=t,{data:{value:s}}=r;return s-n}function vl(t){let{left:r,top:n,height:s,width:a}=t;return[{x:r,y:n},{x:r+a,y:n},{x:r,y:n+s},{x:r+a,y:n+s}]}function su(t,r){if(!t||t.length===0)return null;const[n]=t;return n[r]}function jl(t,r,n){return r===void 0&&(r=t.left),n===void 0&&(n=t.top),{x:r+t.width*.5,y:n+t.height*.5}}const au=t=>{let{collisionRect:r,droppableRects:n,droppableContainers:s}=t;const a=jl(r,r.left,r.top),i=[];for(const o of s){const{id:c}=o,f=n.get(c);if(f){const d=ru(jl(f),a);i.push({id:c,data:{droppableContainer:o,value:d}})}}return i.sort(nu)},dm=t=>{let{collisionRect:r,droppableRects:n,droppableContainers:s}=t;const a=vl(r),i=[];for(const o of s){const{id:c}=o,f=n.get(c);if(f){const d=vl(f),u=a.reduce((g,y,m)=>g+ru(d[m],y),0),p=Number((u/4).toFixed(4));i.push({id:c,data:{droppableContainer:o,value:p}})}}return i.sort(nu)};function um(t,r){const n=Math.max(r.top,t.top),s=Math.max(r.left,t.left),a=Math.min(r.left+r.width,t.left+t.width),i=Math.min(r.top+r.height,t.top+t.height),o=a-s,c=i-n;if(s<a&&n<i){const f=r.width*r.height,d=t.width*t.height,u=o*c,p=u/(f+d-u);return Number(p.toFixed(4))}return 0}const hm=t=>{let{collisionRect:r,droppableRects:n,droppableContainers:s}=t;const a=[];for(const i of s){const{id:o}=i,c=n.get(o);if(c){const f=um(c,r);f>0&&a.push({id:o,data:{droppableContainer:i,value:f}})}}return a.sort(cm)};function fm(t,r,n){return{...t,scaleX:r&&n?r.width/n.width:1,scaleY:r&&n?r.height/n.height:1}}function iu(t,r){return t&&r?{x:t.left-r.left,y:t.top-r.top}:Qt}function xm(t){return function(n){for(var s=arguments.length,a=new Array(s>1?s-1:0),i=1;i<s;i++)a[i-1]=arguments[i];return a.reduce((o,c)=>({...o,top:o.top+t*c.y,bottom:o.bottom+t*c.y,left:o.left+t*c.x,right:o.right+t*c.x}),{...n})}}const pm=xm(1);function mm(t){if(t.startsWith("matrix3d(")){const r=t.slice(9,-1).split(/, /);return{x:+r[12],y:+r[13],scaleX:+r[0],scaleY:+r[5]}}else if(t.startsWith("matrix(")){const r=t.slice(7,-1).split(/, /);return{x:+r[4],y:+r[5],scaleX:+r[0],scaleY:+r[3]}}return null}function gm(t,r,n){const s=mm(r);if(!s)return t;const{scaleX:a,scaleY:i,x:o,y:c}=s,f=t.left-o-(1-a)*parseFloat(n),d=t.top-c-(1-i)*parseFloat(n.slice(n.indexOf(" ")+1)),u=a?t.width/a:t.width,p=i?t.height/i:t.height;return{width:u,height:p,top:d,right:f+u,bottom:d+p,left:f}}const ym={ignoreTransform:!1};function ln(t,r){r===void 0&&(r=ym);let n=t.getBoundingClientRect();if(r.ignoreTransform){const{transform:d,transformOrigin:u}=Pt(t).getComputedStyle(t);d&&(n=gm(n,d,u))}const{top:s,left:a,width:i,height:o,bottom:c,right:f}=n;return{top:s,left:a,width:i,height:o,bottom:c,right:f}}function wl(t){return ln(t,{ignoreTransform:!0})}function bm(t){const r=t.innerWidth,n=t.innerHeight;return{top:0,left:0,right:r,bottom:n,width:r,height:n}}function vm(t,r){return r===void 0&&(r=Pt(t).getComputedStyle(t)),r.position==="fixed"}function jm(t,r){r===void 0&&(r=Pt(t).getComputedStyle(t));const n=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(a=>{const i=r[a];return typeof i=="string"?n.test(i):!1})}function oi(t,r){const n=[];function s(a){if(r!=null&&n.length>=r||!a)return n;if(so(a)&&a.scrollingElement!=null&&!n.includes(a.scrollingElement))return n.push(a.scrollingElement),n;if(!ma(a)||Xd(a)||n.includes(a))return n;const i=Pt(t).getComputedStyle(a);return a!==t&&jm(a,i)&&n.push(a),vm(a,i)?n:s(a.parentNode)}return t?s(t):n}function ou(t){const[r]=oi(t,1);return r??null}function Ci(t){return!ii||!t?null:an(t)?t:no(t)?so(t)||t===on(t).scrollingElement?window:ma(t)?t:null:null}function lu(t){return an(t)?t.scrollX:t.scrollLeft}function cu(t){return an(t)?t.scrollY:t.scrollTop}function Vi(t){return{x:lu(t),y:cu(t)}}var lt;(function(t){t[t.Forward=1]="Forward",t[t.Backward=-1]="Backward"})(lt||(lt={}));function du(t){return!ii||!t?!1:t===document.scrollingElement}function uu(t){const r={x:0,y:0},n=du(t)?{height:window.innerHeight,width:window.innerWidth}:{height:t.clientHeight,width:t.clientWidth},s={x:t.scrollWidth-n.width,y:t.scrollHeight-n.height},a=t.scrollTop<=r.y,i=t.scrollLeft<=r.x,o=t.scrollTop>=s.y,c=t.scrollLeft>=s.x;return{isTop:a,isLeft:i,isBottom:o,isRight:c,maxScroll:s,minScroll:r}}const wm={x:.2,y:.2};function Sm(t,r,n,s,a){let{top:i,left:o,right:c,bottom:f}=n;s===void 0&&(s=10),a===void 0&&(a=wm);const{isTop:d,isBottom:u,isLeft:p,isRight:g}=uu(t),y={x:0,y:0},m={x:0,y:0},b={height:r.height*a.y,width:r.width*a.x};return!d&&i<=r.top+b.height?(y.y=lt.Backward,m.y=s*Math.abs((r.top+b.height-i)/b.height)):!u&&f>=r.bottom-b.height&&(y.y=lt.Forward,m.y=s*Math.abs((r.bottom-b.height-f)/b.height)),!g&&c>=r.right-b.width?(y.x=lt.Forward,m.x=s*Math.abs((r.right-b.width-c)/b.width)):!p&&o<=r.left+b.width&&(y.x=lt.Backward,m.x=s*Math.abs((r.left+b.width-o)/b.width)),{direction:y,speed:m}}function Cm(t){if(t===document.scrollingElement){const{innerWidth:i,innerHeight:o}=window;return{top:0,left:0,right:i,bottom:o,width:i,height:o}}const{top:r,left:n,right:s,bottom:a}=t.getBoundingClientRect();return{top:r,left:n,right:s,bottom:a,width:t.clientWidth,height:t.clientHeight}}function hu(t){return t.reduce((r,n)=>Jr(r,Vi(n)),Qt)}function km(t){return t.reduce((r,n)=>r+lu(n),0)}function _m(t){return t.reduce((r,n)=>r+cu(n),0)}function Rm(t,r){if(r===void 0&&(r=ln),!t)return;const{top:n,left:s,bottom:a,right:i}=r(t);ou(t)&&(a<=0||i<=0||n>=window.innerHeight||s>=window.innerWidth)&&t.scrollIntoView({block:"center",inline:"center"})}const Im=[["x",["left","right"],km],["y",["top","bottom"],_m]];class oo{constructor(r,n){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const s=oi(n),a=hu(s);this.rect={...r},this.width=r.width,this.height=r.height;for(const[i,o,c]of Im)for(const f of o)Object.defineProperty(this,f,{get:()=>{const d=c(s),u=a[i]-d;return this.rect[f]+u},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Hs{constructor(r){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(n=>{var s;return(s=this.target)==null?void 0:s.removeEventListener(...n)})},this.target=r}add(r,n,s){var a;(a=this.target)==null||a.addEventListener(r,n,s),this.listeners.push([r,n,s])}}function Am(t){const{EventTarget:r}=Pt(t);return t instanceof r?t:on(t)}function ki(t,r){const n=Math.abs(t.x),s=Math.abs(t.y);return typeof r=="number"?Math.sqrt(n**2+s**2)>r:"x"in r&&"y"in r?n>r.x&&s>r.y:"x"in r?n>r.x:"y"in r?s>r.y:!1}var Bt;(function(t){t.Click="click",t.DragStart="dragstart",t.Keydown="keydown",t.ContextMenu="contextmenu",t.Resize="resize",t.SelectionChange="selectionchange",t.VisibilityChange="visibilitychange"})(Bt||(Bt={}));function Sl(t){t.preventDefault()}function Pm(t){t.stopPropagation()}var Pe;(function(t){t.Space="Space",t.Down="ArrowDown",t.Right="ArrowRight",t.Left="ArrowLeft",t.Up="ArrowUp",t.Esc="Escape",t.Enter="Enter",t.Tab="Tab"})(Pe||(Pe={}));const fu={start:[Pe.Space,Pe.Enter],cancel:[Pe.Esc],end:[Pe.Space,Pe.Enter,Pe.Tab]},Dm=(t,r)=>{let{currentCoordinates:n}=r;switch(t.code){case Pe.Right:return{...n,x:n.x+25};case Pe.Left:return{...n,x:n.x-25};case Pe.Down:return{...n,y:n.y+25};case Pe.Up:return{...n,y:n.y-25}}};class li{constructor(r){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=r;const{event:{target:n}}=r;this.props=r,this.listeners=new Hs(on(n)),this.windowListeners=new Hs(Pt(n)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(Bt.Resize,this.handleCancel),this.windowListeners.add(Bt.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(Bt.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:r,onStart:n}=this.props,s=r.node.current;s&&Rm(s),n(Qt)}handleKeyDown(r){if(io(r)){const{active:n,context:s,options:a}=this.props,{keyboardCodes:i=fu,coordinateGetter:o=Dm,scrollBehavior:c="smooth"}=a,{code:f}=r;if(i.end.includes(f)){this.handleEnd(r);return}if(i.cancel.includes(f)){this.handleCancel(r);return}const{collisionRect:d}=s.current,u=d?{x:d.left,y:d.top}:Qt;this.referenceCoordinates||(this.referenceCoordinates=u);const p=o(r,{active:n,context:s.current,currentCoordinates:u});if(p){const g=sa(p,u),y={x:0,y:0},{scrollableAncestors:m}=s.current;for(const b of m){const S=r.code,{isTop:v,isRight:j,isLeft:w,isBottom:C,maxScroll:A,minScroll:P}=uu(b),D=Cm(b),R={x:Math.min(S===Pe.Right?D.right-D.width/2:D.right,Math.max(S===Pe.Right?D.left:D.left+D.width/2,p.x)),y:Math.min(S===Pe.Down?D.bottom-D.height/2:D.bottom,Math.max(S===Pe.Down?D.top:D.top+D.height/2,p.y))},_=S===Pe.Right&&!j||S===Pe.Left&&!w,z=S===Pe.Down&&!C||S===Pe.Up&&!v;if(_&&R.x!==p.x){const W=b.scrollLeft+g.x,B=S===Pe.Right&&W<=A.x||S===Pe.Left&&W>=P.x;if(B&&!g.y){b.scrollTo({left:W,behavior:c});return}B?y.x=b.scrollLeft-W:y.x=S===Pe.Right?b.scrollLeft-A.x:b.scrollLeft-P.x,y.x&&b.scrollBy({left:-y.x,behavior:c});break}else if(z&&R.y!==p.y){const W=b.scrollTop+g.y,B=S===Pe.Down&&W<=A.y||S===Pe.Up&&W>=P.y;if(B&&!g.x){b.scrollTo({top:W,behavior:c});return}B?y.y=b.scrollTop-W:y.y=S===Pe.Down?b.scrollTop-A.y:b.scrollTop-P.y,y.y&&b.scrollBy({top:-y.y,behavior:c});break}}this.handleMove(r,Jr(sa(p,this.referenceCoordinates),y))}}}handleMove(r,n){const{onMove:s}=this.props;r.preventDefault(),s(n)}handleEnd(r){const{onEnd:n}=this.props;r.preventDefault(),this.detach(),n()}handleCancel(r){const{onCancel:n}=this.props;r.preventDefault(),this.detach(),n()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}li.activators=[{eventName:"onKeyDown",handler:(t,r,n)=>{let{keyboardCodes:s=fu,onActivation:a}=r,{active:i}=n;const{code:o}=t.nativeEvent;if(s.start.includes(o)){const c=i.activatorNode.current;return c&&t.target!==c?!1:(t.preventDefault(),a?.({event:t.nativeEvent}),!0)}return!1}}];function Cl(t){return!!(t&&"distance"in t)}function kl(t){return!!(t&&"delay"in t)}class lo{constructor(r,n,s){var a;s===void 0&&(s=Am(r.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=r,this.events=n;const{event:i}=r,{target:o}=i;this.props=r,this.events=n,this.document=on(o),this.documentListeners=new Hs(this.document),this.listeners=new Hs(s),this.windowListeners=new Hs(Pt(o)),this.initialCoordinates=(a=Hi(i))!=null?a:Qt,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:r,props:{options:{activationConstraint:n,bypassActivationConstraint:s}}}=this;if(this.listeners.add(r.move.name,this.handleMove,{passive:!1}),this.listeners.add(r.end.name,this.handleEnd),r.cancel&&this.listeners.add(r.cancel.name,this.handleCancel),this.windowListeners.add(Bt.Resize,this.handleCancel),this.windowListeners.add(Bt.DragStart,Sl),this.windowListeners.add(Bt.VisibilityChange,this.handleCancel),this.windowListeners.add(Bt.ContextMenu,Sl),this.documentListeners.add(Bt.Keydown,this.handleKeydown),n){if(s!=null&&s({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(kl(n)){this.timeoutId=setTimeout(this.handleStart,n.delay),this.handlePending(n);return}if(Cl(n)){this.handlePending(n);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(r,n){const{active:s,onPending:a}=this.props;a(s,r,this.initialCoordinates,n)}handleStart(){const{initialCoordinates:r}=this,{onStart:n}=this.props;r&&(this.activated=!0,this.documentListeners.add(Bt.Click,Pm,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(Bt.SelectionChange,this.removeTextSelection),n(r))}handleMove(r){var n;const{activated:s,initialCoordinates:a,props:i}=this,{onMove:o,options:{activationConstraint:c}}=i;if(!a)return;const f=(n=Hi(r))!=null?n:Qt,d=sa(a,f);if(!s&&c){if(Cl(c)){if(c.tolerance!=null&&ki(d,c.tolerance))return this.handleCancel();if(ki(d,c.distance))return this.handleStart()}if(kl(c)&&ki(d,c.tolerance))return this.handleCancel();this.handlePending(c,d);return}r.cancelable&&r.preventDefault(),o(f)}handleEnd(){const{onAbort:r,onEnd:n}=this.props;this.detach(),this.activated||r(this.props.active),n()}handleCancel(){const{onAbort:r,onCancel:n}=this.props;this.detach(),this.activated||r(this.props.active),n()}handleKeydown(r){r.code===Pe.Esc&&this.handleCancel()}removeTextSelection(){var r;(r=this.document.getSelection())==null||r.removeAllRanges()}}const Mm={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class ci extends lo{constructor(r){const{event:n}=r,s=on(n.target);super(r,Mm,s)}}ci.activators=[{eventName:"onPointerDown",handler:(t,r)=>{let{nativeEvent:n}=t,{onActivation:s}=r;return!n.isPrimary||n.button!==0?!1:(s?.({event:n}),!0)}}];const Em={move:{name:"mousemove"},end:{name:"mouseup"}};var Yi;(function(t){t[t.RightClick=2]="RightClick"})(Yi||(Yi={}));class Tm extends lo{constructor(r){super(r,Em,on(r.event.target))}}Tm.activators=[{eventName:"onMouseDown",handler:(t,r)=>{let{nativeEvent:n}=t,{onActivation:s}=r;return n.button===Yi.RightClick?!1:(s?.({event:n}),!0)}}];const _i={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class co extends lo{constructor(r){super(r,_i)}static setup(){return window.addEventListener(_i.move.name,r,{capture:!1,passive:!1}),function(){window.removeEventListener(_i.move.name,r)};function r(){}}}co.activators=[{eventName:"onTouchStart",handler:(t,r)=>{let{nativeEvent:n}=t,{onActivation:s}=r;const{touches:a}=n;return a.length>1?!1:(s?.({event:n}),!0)}}];var Vs;(function(t){t[t.Pointer=0]="Pointer",t[t.DraggableRect=1]="DraggableRect"})(Vs||(Vs={}));var Ha;(function(t){t[t.TreeOrder=0]="TreeOrder",t[t.ReversedTreeOrder=1]="ReversedTreeOrder"})(Ha||(Ha={}));function zm(t){let{acceleration:r,activator:n=Vs.Pointer,canScroll:s,draggingRect:a,enabled:i,interval:o=5,order:c=Ha.TreeOrder,pointerCoordinates:f,scrollableAncestors:d,scrollableAncestorRects:u,delta:p,threshold:g}=t;const y=Fm({delta:p,disabled:!i}),[m,b]=Kp(),S=l.useRef({x:0,y:0}),v=l.useRef({x:0,y:0}),j=l.useMemo(()=>{switch(n){case Vs.Pointer:return f?{top:f.y,bottom:f.y,left:f.x,right:f.x}:null;case Vs.DraggableRect:return a}},[n,a,f]),w=l.useRef(null),C=l.useCallback(()=>{const P=w.current;if(!P)return;const D=S.current.x*v.current.x,R=S.current.y*v.current.y;P.scrollBy(D,R)},[]),A=l.useMemo(()=>c===Ha.TreeOrder?[...d].reverse():d,[c,d]);l.useEffect(()=>{if(!i||!d.length||!j){b();return}for(const P of A){if(s?.(P)===!1)continue;const D=d.indexOf(P),R=u[D];if(!R)continue;const{direction:_,speed:z}=Sm(P,R,j,r,g);for(const W of["x","y"])y[W][_[W]]||(z[W]=0,_[W]=0);if(z.x>0||z.y>0){b(),w.current=P,m(C,o),S.current=z,v.current=_;return}}S.current={x:0,y:0},v.current={x:0,y:0},b()},[r,C,s,b,i,o,JSON.stringify(j),JSON.stringify(y),m,d,A,u,JSON.stringify(g)])}const Om={x:{[lt.Backward]:!1,[lt.Forward]:!1},y:{[lt.Backward]:!1,[lt.Forward]:!1}};function Fm(t){let{delta:r,disabled:n}=t;const s=Ui(r);return ga(a=>{if(n||!s||!a)return Om;const i={x:Math.sign(r.x-s.x),y:Math.sign(r.y-s.y)};return{x:{[lt.Backward]:a.x[lt.Backward]||i.x===-1,[lt.Forward]:a.x[lt.Forward]||i.x===1},y:{[lt.Backward]:a.y[lt.Backward]||i.y===-1,[lt.Forward]:a.y[lt.Forward]||i.y===1}}},[n,r,s])}function Lm(t,r){const n=r!=null?t.get(r):void 0,s=n?n.node.current:null;return ga(a=>{var i;return r==null?null:(i=s??a)!=null?i:null},[s,r])}function Wm(t,r){return l.useMemo(()=>t.reduce((n,s)=>{const{sensor:a}=s,i=a.activators.map(o=>({eventName:o.eventName,handler:r(o.handler,s)}));return[...n,...i]},[]),[t,r])}var ia;(function(t){t[t.Always=0]="Always",t[t.BeforeDragging=1]="BeforeDragging",t[t.WhileDragging=2]="WhileDragging"})(ia||(ia={}));var Gi;(function(t){t.Optimized="optimized"})(Gi||(Gi={}));const _l=new Map;function $m(t,r){let{dragging:n,dependencies:s,config:a}=r;const[i,o]=l.useState(null),{frequency:c,measure:f,strategy:d}=a,u=l.useRef(t),p=S(),g=na(p),y=l.useCallback(function(v){v===void 0&&(v=[]),!g.current&&o(j=>j===null?v:j.concat(v.filter(w=>!j.includes(w))))},[g]),m=l.useRef(null),b=ga(v=>{if(p&&!n)return _l;if(!v||v===_l||u.current!==t||i!=null){const j=new Map;for(let w of t){if(!w)continue;if(i&&i.length>0&&!i.includes(w.id)&&w.rect.current){j.set(w.id,w.rect.current);continue}const C=w.node.current,A=C?new oo(f(C),C):null;w.rect.current=A,A&&j.set(w.id,A)}return j}return v},[t,i,n,p,f]);return l.useEffect(()=>{u.current=t},[t]),l.useEffect(()=>{p||y()},[n,p]),l.useEffect(()=>{i&&i.length>0&&o(null)},[JSON.stringify(i)]),l.useEffect(()=>{p||typeof c!="number"||m.current!==null||(m.current=setTimeout(()=>{y(),m.current=null},c))},[c,p,y,...s]),{droppableRects:b,measureDroppableContainers:y,measuringScheduled:i!=null};function S(){switch(d){case ia.Always:return!1;case ia.BeforeDragging:return n;default:return!n}}}function xu(t,r){return ga(n=>t?n||(typeof r=="function"?r(t):t):null,[r,t])}function Bm(t,r){return xu(t,r)}function qm(t){let{callback:r,disabled:n}=t;const s=ao(r),a=l.useMemo(()=>{if(n||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:i}=window;return new i(s)},[s,n]);return l.useEffect(()=>()=>a?.disconnect(),[a]),a}function di(t){let{callback:r,disabled:n}=t;const s=ao(r),a=l.useMemo(()=>{if(n||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:i}=window;return new i(s)},[n]);return l.useEffect(()=>()=>a?.disconnect(),[a]),a}function Nm(t){return new oo(ln(t),t)}function Rl(t,r,n){r===void 0&&(r=Nm);const[s,a]=l.useState(null);function i(){a(f=>{if(!t)return null;if(t.isConnected===!1){var d;return(d=f??n)!=null?d:null}const u=r(t);return JSON.stringify(f)===JSON.stringify(u)?f:u})}const o=qm({callback(f){if(t)for(const d of f){const{type:u,target:p}=d;if(u==="childList"&&p instanceof HTMLElement&&p.contains(t)){i();break}}}}),c=di({callback:i});return sr(()=>{i(),t?(c?.observe(t),o?.observe(document.body,{childList:!0,subtree:!0})):(c?.disconnect(),o?.disconnect())},[t]),s}function Um(t){const r=xu(t);return iu(t,r)}const Il=[];function Hm(t){const r=l.useRef(t),n=ga(s=>t?s&&s!==Il&&t&&r.current&&t.parentNode===r.current.parentNode?s:oi(t):Il,[t]);return l.useEffect(()=>{r.current=t},[t]),n}function Vm(t){const[r,n]=l.useState(null),s=l.useRef(t),a=l.useCallback(i=>{const o=Ci(i.target);o&&n(c=>c?(c.set(o,Vi(o)),new Map(c)):null)},[]);return l.useEffect(()=>{const i=s.current;if(t!==i){o(i);const c=t.map(f=>{const d=Ci(f);return d?(d.addEventListener("scroll",a,{passive:!0}),[d,Vi(d)]):null}).filter(f=>f!=null);n(c.length?new Map(c):null),s.current=t}return()=>{o(t),o(i)};function o(c){c.forEach(f=>{const d=Ci(f);d?.removeEventListener("scroll",a)})}},[a,t]),l.useMemo(()=>t.length?r?Array.from(r.values()).reduce((i,o)=>Jr(i,o),Qt):hu(t):Qt,[t,r])}function Al(t,r){r===void 0&&(r=[]);const n=l.useRef(null);return l.useEffect(()=>{n.current=null},r),l.useEffect(()=>{const s=t!==Qt;s&&!n.current&&(n.current=t),!s&&n.current&&(n.current=null)},[t]),n.current?sa(t,n.current):Qt}function Ym(t){l.useEffect(()=>{if(!ii)return;const r=t.map(n=>{let{sensor:s}=n;return s.setup==null?void 0:s.setup()});return()=>{for(const n of r)n?.()}},t.map(r=>{let{sensor:n}=r;return n}))}function Gm(t,r){return l.useMemo(()=>t.reduce((n,s)=>{let{eventName:a,handler:i}=s;return n[a]=o=>{i(o,r)},n},{}),[t,r])}function pu(t){return l.useMemo(()=>t?bm(t):null,[t])}const Pl=[];function Qm(t,r){r===void 0&&(r=ln);const[n]=t,s=pu(n?Pt(n):null),[a,i]=l.useState(Pl);function o(){i(()=>t.length?t.map(f=>du(f)?s:new oo(r(f),f)):Pl)}const c=di({callback:o});return sr(()=>{c?.disconnect(),o(),t.forEach(f=>c?.observe(f))},[t]),a}function Km(t){if(!t)return null;if(t.children.length>1)return t;const r=t.children[0];return ma(r)?r:t}function Jm(t){let{measure:r}=t;const[n,s]=l.useState(null),a=l.useCallback(d=>{for(const{target:u}of d)if(ma(u)){s(p=>{const g=r(u);return p?{...p,width:g.width,height:g.height}:g});break}},[r]),i=di({callback:a}),o=l.useCallback(d=>{const u=Km(d);i?.disconnect(),u&&i?.observe(u),s(u?r(u):null)},[r,i]),[c,f]=Na(o);return l.useMemo(()=>({nodeRef:c,rect:n,setRef:f}),[n,c,f])}const Xm=[{sensor:ci,options:{}},{sensor:li,options:{}}],Zm={current:{}},Fa={draggable:{measure:wl},droppable:{measure:wl,strategy:ia.WhileDragging,frequency:Gi.Optimized},dragOverlay:{measure:ln}};class Ys extends Map{get(r){var n;return r!=null&&(n=super.get(r))!=null?n:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(r=>{let{disabled:n}=r;return!n})}getNodeFor(r){var n,s;return(n=(s=this.get(r))==null?void 0:s.node.current)!=null?n:void 0}}const eg={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new Ys,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:Ua},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:Fa,measureDroppableContainers:Ua,windowRect:null,measuringScheduled:!1},tg={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:Ua,draggableNodes:new Map,over:null,measureDroppableContainers:Ua},ui=l.createContext(tg),mu=l.createContext(eg);function rg(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new Ys}}}function ng(t,r){switch(r.type){case it.DragStart:return{...t,draggable:{...t.draggable,initialCoordinates:r.initialCoordinates,active:r.active}};case it.DragMove:return t.draggable.active==null?t:{...t,draggable:{...t.draggable,translate:{x:r.coordinates.x-t.draggable.initialCoordinates.x,y:r.coordinates.y-t.draggable.initialCoordinates.y}}};case it.DragEnd:case it.DragCancel:return{...t,draggable:{...t.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case it.RegisterDroppable:{const{element:n}=r,{id:s}=n,a=new Ys(t.droppable.containers);return a.set(s,n),{...t,droppable:{...t.droppable,containers:a}}}case it.SetDroppableDisabled:{const{id:n,key:s,disabled:a}=r,i=t.droppable.containers.get(n);if(!i||s!==i.key)return t;const o=new Ys(t.droppable.containers);return o.set(n,{...i,disabled:a}),{...t,droppable:{...t.droppable,containers:o}}}case it.UnregisterDroppable:{const{id:n,key:s}=r,a=t.droppable.containers.get(n);if(!a||s!==a.key)return t;const i=new Ys(t.droppable.containers);return i.delete(n),{...t,droppable:{...t.droppable,containers:i}}}default:return t}}function sg(t){let{disabled:r}=t;const{active:n,activatorEvent:s,draggableNodes:a}=l.useContext(ui),i=Ui(s),o=Ui(n?.id);return l.useEffect(()=>{if(!r&&!s&&i&&o!=null){if(!io(i)||document.activeElement===i.target)return;const c=a.get(o);if(!c)return;const{activatorNode:f,node:d}=c;if(!f.current&&!d.current)return;requestAnimationFrame(()=>{for(const u of[f.current,d.current]){if(!u)continue;const p=Zp(u);if(p){p.focus();break}}})}},[s,r,a,o,i]),null}function ag(t,r){let{transform:n,...s}=r;return t!=null&&t.length?t.reduce((a,i)=>i({transform:a,...s}),n):n}function ig(t){return l.useMemo(()=>({draggable:{...Fa.draggable,...t?.draggable},droppable:{...Fa.droppable,...t?.droppable},dragOverlay:{...Fa.dragOverlay,...t?.dragOverlay}}),[t?.draggable,t?.droppable,t?.dragOverlay])}function og(t){let{activeNode:r,measure:n,initialRect:s,config:a=!0}=t;const i=l.useRef(!1),{x:o,y:c}=typeof a=="boolean"?{x:a,y:a}:a;sr(()=>{if(!o&&!c||!r){i.current=!1;return}if(i.current||!s)return;const d=r?.node.current;if(!d||d.isConnected===!1)return;const u=n(d),p=iu(u,s);if(o||(p.x=0),c||(p.y=0),i.current=!0,Math.abs(p.x)>0||Math.abs(p.y)>0){const g=ou(d);g&&g.scrollBy({top:p.y,left:p.x})}},[r,o,c,s,n])}const gu=l.createContext({...Qt,scaleX:1,scaleY:1});var yr;(function(t){t[t.Uninitialized=0]="Uninitialized",t[t.Initializing=1]="Initializing",t[t.Initialized=2]="Initialized"})(yr||(yr={}));const yu=l.memo(function(r){var n,s,a,i;let{id:o,accessibility:c,autoScroll:f=!0,children:d,sensors:u=Xm,collisionDetection:p=hm,measuring:g,modifiers:y,...m}=r;const b=l.useReducer(ng,void 0,rg),[S,v]=b,[j,w]=am(),[C,A]=l.useState(yr.Uninitialized),P=C===yr.Initialized,{draggable:{active:D,nodes:R,translate:_},droppable:{containers:z}}=S,W=D!=null?R.get(D):null,B=l.useRef({initial:null,translated:null}),H=l.useMemo(()=>{var nt;return D!=null?{id:D,data:(nt=W?.data)!=null?nt:Zm,rect:B}:null},[D,W]),se=l.useRef(null),[I,k]=l.useState(null),[O,E]=l.useState(null),Z=na(m,Object.values(m)),G=ya("DndDescribedBy",o),M=l.useMemo(()=>z.getEnabled(),[z]),T=ig(g),{droppableRects:ae,measureDroppableContainers:L,measuringScheduled:N}=$m(M,{dragging:P,dependencies:[_.x,_.y],config:T.droppable}),X=Lm(R,D),ue=l.useMemo(()=>O?Hi(O):null,[O]),$=qr(),ie=Bm(X,T.draggable.measure);og({activeNode:D!=null?R.get(D):null,config:$.layoutShiftCompensation,initialRect:ie,measure:T.draggable.measure});const le=Rl(X,T.draggable.measure,ie),He=Rl(X?X.parentElement:null),Be=l.useRef({activatorEvent:null,active:null,activeNode:X,collisionRect:null,collisions:null,droppableRects:ae,draggableNodes:R,draggingNode:null,draggingNodeRect:null,droppableContainers:z,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),oe=z.getNodeFor((n=Be.current.over)==null?void 0:n.id),pe=Jm({measure:T.dragOverlay.measure}),me=(s=pe.nodeRef.current)!=null?s:X,he=P?(a=pe.rect)!=null?a:le:null,Fe=!!(pe.nodeRef.current&&pe.rect),Dt=Um(Fe?null:le),ur=pu(me?Pt(me):null),mt=Hm(P?oe??X:null),ar=Qm(mt),Jt=ag(y,{transform:{x:_.x-Dt.x,y:_.y-Dt.y,scaleX:1,scaleY:1},activatorEvent:O,active:H,activeNodeRect:le,containerNodeRect:He,draggingNodeRect:he,over:Be.current.over,overlayNodeRect:pe.rect,scrollableAncestors:mt,scrollableAncestorRects:ar,windowRect:ur}),hr=ue?Jr(ue,_):null,Ft=Vm(mt),Br=Al(Ft),Ht=Al(Ft,[le]),gt=Jr(Jt,Br),V=he?pm(he,Jt):null,xe=H&&V?p({active:H,collisionRect:V,droppableRects:ae,droppableContainers:M,pointerCoordinates:hr}):null,ye=su(xe,"id"),[we,Me]=l.useState(null),Te=Fe?Jt:Jr(Jt,Ht),Ct=fm(Te,(i=we?.rect)!=null?i:null,le),Vt=l.useRef(null),fr=l.useCallback((nt,yt)=>{let{sensor:ht,options:ce}=yt;if(se.current==null)return;const bt=R.get(se.current);if(!bt)return;const Ze=nt.nativeEvent,st=new ht({active:se.current,activeNode:bt,event:Ze,options:ce,context:Be,onAbort(Ve){if(!R.get(Ve))return;const{onDragAbort:kt}=Z.current,ot={id:Ve};kt?.(ot),j({type:"onDragAbort",event:ot})},onPending(Ve,vt,kt,ot){if(!R.get(Ve))return;const{onDragPending:xr}=Z.current,Wt={id:Ve,constraint:vt,initialCoordinates:kt,offset:ot};xr?.(Wt),j({type:"onDragPending",event:Wt})},onStart(Ve){const vt=se.current;if(vt==null)return;const kt=R.get(vt);if(!kt)return;const{onDragStart:ot}=Z.current,Je={activatorEvent:Ze,active:{id:vt,data:kt.data,rect:B}};qs.unstable_batchedUpdates(()=>{ot?.(Je),A(yr.Initializing),v({type:it.DragStart,initialCoordinates:Ve,active:vt}),j({type:"onDragStart",event:Je}),k(Vt.current),E(Ze)})},onMove(Ve){v({type:it.DragMove,coordinates:Ve})},onEnd:ir(it.DragEnd),onCancel:ir(it.DragCancel)});Vt.current=st;function ir(Ve){return async function(){const{active:kt,collisions:ot,over:Je,scrollAdjustedTranslate:xr}=Be.current;let Wt=null;if(kt&&xr){const{cancelDrop:or}=Z.current;Wt={activatorEvent:Ze,active:kt,collisions:ot,delta:xr,over:Je},Ve===it.DragEnd&&typeof or=="function"&&await Promise.resolve(or(Wt))&&(Ve=it.DragCancel)}se.current=null,qs.unstable_batchedUpdates(()=>{v({type:Ve}),A(yr.Uninitialized),Me(null),k(null),E(null),Vt.current=null;const or=Ve===it.DragEnd?"onDragEnd":"onDragCancel";if(Wt){const pr=Z.current[or];pr?.(Wt),j({type:or,event:Wt})}})}}},[R]),cn=l.useCallback((nt,yt)=>(ht,ce)=>{const bt=ht.nativeEvent,Ze=R.get(ce);if(se.current!==null||!Ze||bt.dndKit||bt.defaultPrevented)return;const st={active:Ze};nt(ht,yt.options,st)===!0&&(bt.dndKit={capturedBy:yt.sensor},se.current=ce,fr(ht,yt))},[R,fr]),Lt=Wm(u,cn);Ym(u),sr(()=>{le&&C===yr.Initializing&&A(yr.Initialized)},[le,C]),l.useEffect(()=>{const{onDragMove:nt}=Z.current,{active:yt,activatorEvent:ht,collisions:ce,over:bt}=Be.current;if(!yt||!ht)return;const Ze={active:yt,activatorEvent:ht,collisions:ce,delta:{x:gt.x,y:gt.y},over:bt};qs.unstable_batchedUpdates(()=>{nt?.(Ze),j({type:"onDragMove",event:Ze})})},[gt.x,gt.y]),l.useEffect(()=>{const{active:nt,activatorEvent:yt,collisions:ht,droppableContainers:ce,scrollAdjustedTranslate:bt}=Be.current;if(!nt||se.current==null||!yt||!bt)return;const{onDragOver:Ze}=Z.current,st=ce.get(ye),ir=st&&st.rect.current?{id:st.id,rect:st.rect.current,data:st.data,disabled:st.disabled}:null,Ve={active:nt,activatorEvent:yt,collisions:ht,delta:{x:bt.x,y:bt.y},over:ir};qs.unstable_batchedUpdates(()=>{Me(ir),Ze?.(Ve),j({type:"onDragOver",event:Ve})})},[ye]),sr(()=>{Be.current={activatorEvent:O,active:H,activeNode:X,collisionRect:V,collisions:xe,droppableRects:ae,draggableNodes:R,draggingNode:me,draggingNodeRect:he,droppableContainers:z,over:we,scrollableAncestors:mt,scrollAdjustedTranslate:gt},B.current={initial:he,translated:V}},[H,X,xe,V,R,me,he,ae,z,we,mt,gt]),zm({...$,delta:_,draggingRect:V,pointerCoordinates:hr,scrollableAncestors:mt,scrollableAncestorRects:ar});const dn=l.useMemo(()=>({active:H,activeNode:X,activeNodeRect:le,activatorEvent:O,collisions:xe,containerNodeRect:He,dragOverlay:pe,draggableNodes:R,droppableContainers:z,droppableRects:ae,over:we,measureDroppableContainers:L,scrollableAncestors:mt,scrollableAncestorRects:ar,measuringConfiguration:T,measuringScheduled:N,windowRect:ur}),[H,X,le,O,xe,He,pe,R,z,ae,we,L,mt,ar,T,N,ur]),Ca=l.useMemo(()=>({activatorEvent:O,activators:Lt,active:H,activeNodeRect:le,ariaDescribedById:{draggable:G},dispatch:v,draggableNodes:R,over:we,measureDroppableContainers:L}),[O,Lt,H,le,v,G,R,we,L]);return Ee.createElement(eu.Provider,{value:w},Ee.createElement(ui.Provider,{value:Ca},Ee.createElement(mu.Provider,{value:dn},Ee.createElement(gu.Provider,{value:Ct},d)),Ee.createElement(sg,{disabled:c?.restoreFocus===!1})),Ee.createElement(lm,{...c,hiddenTextDescribedById:G}));function qr(){const nt=I?.autoScrollEnabled===!1,yt=typeof f=="object"?f.enabled===!1:f===!1,ht=P&&!nt&&!yt;return typeof f=="object"?{...f,enabled:ht}:{enabled:ht}}}),lg=l.createContext(null),Dl="button",cg="Draggable";function dg(t){let{id:r,data:n,disabled:s=!1,attributes:a}=t;const i=ya(cg),{activators:o,activatorEvent:c,active:f,activeNodeRect:d,ariaDescribedById:u,draggableNodes:p,over:g}=l.useContext(ui),{role:y=Dl,roleDescription:m="draggable",tabIndex:b=0}=a??{},S=f?.id===r,v=l.useContext(S?gu:lg),[j,w]=Na(),[C,A]=Na(),P=Gm(o,r),D=na(n);sr(()=>(p.set(r,{id:r,key:i,node:j,activatorNode:C,data:D}),()=>{const _=p.get(r);_&&_.key===i&&p.delete(r)}),[p,r]);const R=l.useMemo(()=>({role:y,tabIndex:b,"aria-disabled":s,"aria-pressed":S&&y===Dl?!0:void 0,"aria-roledescription":m,"aria-describedby":u.draggable}),[s,y,b,S,m,u.draggable]);return{active:f,activatorEvent:c,activeNodeRect:d,attributes:R,isDragging:S,listeners:s?void 0:P,node:j,over:g,setNodeRef:w,setActivatorNodeRef:A,transform:v}}function ug(){return l.useContext(mu)}const hg="Droppable",fg={timeout:25};function xg(t){let{data:r,disabled:n=!1,id:s,resizeObserverConfig:a}=t;const i=ya(hg),{active:o,dispatch:c,over:f,measureDroppableContainers:d}=l.useContext(ui),u=l.useRef({disabled:n}),p=l.useRef(!1),g=l.useRef(null),y=l.useRef(null),{disabled:m,updateMeasurementsFor:b,timeout:S}={...fg,...a},v=na(b??s),j=l.useCallback(()=>{if(!p.current){p.current=!0;return}y.current!=null&&clearTimeout(y.current),y.current=setTimeout(()=>{d(Array.isArray(v.current)?v.current:[v.current]),y.current=null},S)},[S]),w=di({callback:j,disabled:m||!o}),C=l.useCallback((R,_)=>{w&&(_&&(w.unobserve(_),p.current=!1),R&&w.observe(R))},[w]),[A,P]=Na(C),D=na(r);return l.useEffect(()=>{!w||!A.current||(w.disconnect(),p.current=!1,w.observe(A.current))},[A,w]),l.useEffect(()=>(c({type:it.RegisterDroppable,element:{id:s,key:i,disabled:n,node:A,rect:g,data:D}}),()=>c({type:it.UnregisterDroppable,key:i,id:s})),[s]),l.useEffect(()=>{n!==u.current.disabled&&(c({type:it.SetDroppableDisabled,id:s,key:i,disabled:n}),u.current.disabled=n)},[s,i,n,c]),{active:o,rect:g,isOver:f?.id===s,node:A,over:f,setNodeRef:P}}function uo(t,r,n){const s=t.slice();return s.splice(n<0?s.length+n:n,0,s.splice(r,1)[0]),s}function pg(t,r){return t.reduce((n,s,a)=>{const i=r.get(s);return i&&(n[a]=i),n},Array(t.length))}function Ia(t){return t!==null&&t>=0}function mg(t,r){if(t===r)return!0;if(t.length!==r.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==r[n])return!1;return!0}function gg(t){return typeof t=="boolean"?{draggable:t,droppable:t}:t}const hi=t=>{let{rects:r,activeIndex:n,overIndex:s,index:a}=t;const i=uo(r,s,n),o=r[a],c=i[a];return!c||!o?null:{x:c.left-o.left,y:c.top-o.top,scaleX:c.width/o.width,scaleY:c.height/o.height}},bu="Sortable",vu=Ee.createContext({activeIndex:-1,containerId:bu,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:hi,disabled:{draggable:!1,droppable:!1}});function ju(t){let{children:r,id:n,items:s,strategy:a=hi,disabled:i=!1}=t;const{active:o,dragOverlay:c,droppableRects:f,over:d,measureDroppableContainers:u}=ug(),p=ya(bu,n),g=c.rect!==null,y=l.useMemo(()=>s.map(P=>typeof P=="object"&&"id"in P?P.id:P),[s]),m=o!=null,b=o?y.indexOf(o.id):-1,S=d?y.indexOf(d.id):-1,v=l.useRef(y),j=!mg(y,v.current),w=S!==-1&&b===-1||j,C=gg(i);sr(()=>{j&&m&&u(y)},[j,y,m,u]),l.useEffect(()=>{v.current=y},[y]);const A=l.useMemo(()=>({activeIndex:b,containerId:p,disabled:C,disableTransforms:w,items:y,overIndex:S,useDragOverlay:g,sortedRects:pg(y,f),strategy:a}),[b,p,C.draggable,C.droppable,w,y,S,f,g,a]);return Ee.createElement(vu.Provider,{value:A},r)}const yg=t=>{let{id:r,items:n,activeIndex:s,overIndex:a}=t;return uo(n,s,a).indexOf(r)},bg=t=>{let{containerId:r,isSorting:n,wasDragging:s,index:a,items:i,newIndex:o,previousItems:c,previousContainerId:f,transition:d}=t;return!d||!s||c!==i&&a===o?!1:n?!0:o!==a&&r===f},vg={duration:200,easing:"ease"},wu="transform",jg=aa.Transition.toString({property:wu,duration:0,easing:"linear"}),wg={roleDescription:"sortable"};function Sg(t){let{disabled:r,index:n,node:s,rect:a}=t;const[i,o]=l.useState(null),c=l.useRef(n);return sr(()=>{if(!r&&n!==c.current&&s.current){const f=a.current;if(f){const d=ln(s.current,{ignoreTransform:!0}),u={x:f.left-d.left,y:f.top-d.top,scaleX:f.width/d.width,scaleY:f.height/d.height};(u.x||u.y)&&o(u)}}n!==c.current&&(c.current=n)},[r,n,s,a]),l.useEffect(()=>{i&&o(null)},[i]),i}function Cg(t){let{animateLayoutChanges:r=bg,attributes:n,disabled:s,data:a,getNewIndex:i=yg,id:o,strategy:c,resizeObserverConfig:f,transition:d=vg}=t;const{items:u,containerId:p,activeIndex:g,disabled:y,disableTransforms:m,sortedRects:b,overIndex:S,useDragOverlay:v,strategy:j}=l.useContext(vu),w=kg(s,y),C=u.indexOf(o),A=l.useMemo(()=>({sortable:{containerId:p,index:C,items:u},...a}),[p,a,C,u]),P=l.useMemo(()=>u.slice(u.indexOf(o)),[u,o]),{rect:D,node:R,isOver:_,setNodeRef:z}=xg({id:o,data:A,disabled:w.droppable,resizeObserverConfig:{updateMeasurementsFor:P,...f}}),{active:W,activatorEvent:B,activeNodeRect:H,attributes:se,setNodeRef:I,listeners:k,isDragging:O,over:E,setActivatorNodeRef:Z,transform:G}=dg({id:o,data:A,attributes:{...wg,...n},disabled:w.draggable}),M=Qp(z,I),T=!!W,ae=T&&!m&&Ia(g)&&Ia(S),L=!v&&O,N=L&&ae?G:null,ue=ae?N??(c??j)({rects:b,activeNodeRect:H,activeIndex:g,overIndex:S,index:C}):null,$=Ia(g)&&Ia(S)?i({id:o,items:u,activeIndex:g,overIndex:S}):C,ie=W?.id,le=l.useRef({activeId:ie,items:u,newIndex:$,containerId:p}),He=u!==le.current.items,Be=r({active:W,containerId:p,isDragging:O,isSorting:T,id:o,index:C,items:u,newIndex:le.current.newIndex,previousItems:le.current.items,previousContainerId:le.current.containerId,transition:d,wasDragging:le.current.activeId!=null}),oe=Sg({disabled:!Be,index:C,node:R,rect:D});return l.useEffect(()=>{T&&le.current.newIndex!==$&&(le.current.newIndex=$),p!==le.current.containerId&&(le.current.containerId=p),u!==le.current.items&&(le.current.items=u)},[T,$,p,u]),l.useEffect(()=>{if(ie===le.current.activeId)return;if(ie!=null&&le.current.activeId==null){le.current.activeId=ie;return}const me=setTimeout(()=>{le.current.activeId=ie},50);return()=>clearTimeout(me)},[ie]),{active:W,activeIndex:g,attributes:se,data:A,rect:D,index:C,newIndex:$,items:u,isOver:_,isSorting:T,isDragging:O,listeners:k,node:R,overIndex:S,over:E,setNodeRef:M,setActivatorNodeRef:Z,setDroppableNodeRef:z,setDraggableNodeRef:I,transform:oe??ue,transition:pe()};function pe(){if(oe||He&&le.current.newIndex===C)return jg;if(!(L&&!io(B)||!d)&&(T||Be))return aa.Transition.toString({...d,property:wu})}}function kg(t,r){var n,s;return typeof t=="boolean"?{draggable:t,droppable:!1}:{draggable:(n=t?.draggable)!=null?n:r.draggable,droppable:(s=t?.droppable)!=null?s:r.droppable}}function Va(t){if(!t)return!1;const r=t.data.current;return!!(r&&"sortable"in r&&typeof r.sortable=="object"&&"containerId"in r.sortable&&"items"in r.sortable&&"index"in r.sortable)}const _g=[Pe.Down,Pe.Right,Pe.Up,Pe.Left],Su=(t,r)=>{let{context:{active:n,collisionRect:s,droppableRects:a,droppableContainers:i,over:o,scrollableAncestors:c}}=r;if(_g.includes(t.code)){if(t.preventDefault(),!n||!s)return;const f=[];i.getEnabled().forEach(p=>{if(!p||p!=null&&p.disabled)return;const g=a.get(p.id);if(g)switch(t.code){case Pe.Down:s.top<g.top&&f.push(p);break;case Pe.Up:s.top>g.top&&f.push(p);break;case Pe.Left:s.left>g.left&&f.push(p);break;case Pe.Right:s.left<g.left&&f.push(p);break}});const d=dm({collisionRect:s,droppableRects:a,droppableContainers:f});let u=su(d,"id");if(u===o?.id&&d.length>1&&(u=d[1].id),u!=null){const p=i.get(n.id),g=i.get(u),y=g?a.get(g.id):null,m=g?.node.current;if(m&&y&&p&&g){const S=oi(m).some((P,D)=>c[D]!==P),v=Cu(p,g),j=Rg(p,g),w=S||!v?{x:0,y:0}:{x:j?s.width-y.width:0,y:j?s.height-y.height:0},C={x:y.left,y:y.top};return w.x&&w.y?C:sa(C,w)}}}};function Cu(t,r){return!Va(t)||!Va(r)?!1:t.data.current.sortable.containerId===r.data.current.sortable.containerId}function Rg(t,r){return!Va(t)||!Va(r)||!Cu(t,r)?!1:t.data.current.sortable.index<r.data.current.sortable.index}const Ri={theme:"dark",volume:80,repeat_mode:"none",shuffle_enabled:!1,smart_shuffle_enabled:!0,smart_shuffle_history_size:10,audio_quality:"high",items_per_page:50,visualizer_theme:"rounded-bars",visualizer_enabled:!0,visualizer_glow:!0,seek_duration:3,prefetch_enabled:!0,extra_settings:{}},Ig=()=>{const[t,r]=l.useState(Ri),[n,s]=l.useState(!0),[a,i]=l.useState(null),o=l.useCallback(async()=>{try{s(!0),i(null);const p=await U.get("/user/config/");console.log("[Settings] Loaded from backend:",p.data),r(p.data)}catch(p){console.error("Failed to load user settings:",p),i(p?.message||"Failed to load settings"),r(Ri)}finally{s(!1)}},[]),c=l.useCallback(async p=>{try{const g=await U.post("/user/config/",p);return r(g.data.config),!0}catch(g){return console.error("Failed to save user settings:",g),i(g?.message||"Failed to save settings"),!1}},[]),f=l.useCallback(async(p,g)=>{r(m=>({...m,[p]:g}));const y=await c({[p]:g});return y||await o(),y},[c,o]),d=l.useCallback(async(p,g)=>{const y={...t.extra_settings,[p]:g};return await f("extra_settings",y)},[t.extra_settings,f]),u=l.useCallback((p,g=null)=>t.extra_settings[p]??g,[t.extra_settings]);return l.useEffect(()=>{const p=localStorage.getItem("token");console.log("[Settings] Mount check - token exists:",!!p),p?o():(r(Ri),s(!1))},[o]),{settings:t,loading:n,error:a,updateSetting:f,updateExtraSetting:d,getExtraSetting:u,saveSettings:c,loadSettings:o}},ku=l.createContext(void 0),Ag=({children:t})=>{const r=Ig();return e.jsx(ku.Provider,{value:r,children:t})},Sr=()=>{const t=l.useContext(ku);if(t===void 0)throw new Error("useSettings must be used within a SettingsProvider");return t};var Bn={},Ml;function Pg(){if(Ml)return Bn;Ml=1;var t=te();Object.defineProperty(Bn,"__esModule",{value:!0}),Bn.default=void 0;var r=t(ne()),n=re();return Bn.default=(0,r.default)((0,n.jsx)("path",{d:"M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8m0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4z"}),"Sync"),Bn}var Dg=Pg();const _u=ee(Dg);var qn={},El;function Mg(){if(El)return qn;El=1;var t=te();Object.defineProperty(qn,"__esModule",{value:!0}),qn.default=void 0;var r=t(ne()),n=re();return qn.default=(0,r.default)((0,n.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete"),qn}var Eg=Mg();const fi=ee(Eg);var Nn={},Tl;function Tg(){if(Tl)return Nn;Tl=1;var t=te();Object.defineProperty(Nn,"__esModule",{value:!0}),Nn.default=void 0;var r=t(ne()),n=re();return Nn.default=(0,r.default)((0,n.jsx)("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2m-9 14-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8z"}),"CheckBox"),Nn}var zg=Tg();const Og=ee(zg);var Un={},zl;function Fg(){if(zl)return Un;zl=1;var t=te();Object.defineProperty(Un,"__esModule",{value:!0}),Un.default=void 0;var r=t(ne()),n=re();return Un.default=(0,r.default)((0,n.jsx)("path",{d:"M19 5v14H5V5zm0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2"}),"CheckBoxOutlineBlank"),Un}var Lg=Fg();const Wg=ee(Lg);var Hn={},Ol;function $g(){if(Ol)return Hn;Ol=1;var t=te();Object.defineProperty(Hn,"__esModule",{value:!0}),Hn.default=void 0;var r=t(ne()),n=re();return Hn.default=(0,r.default)((0,n.jsx)("path",{d:"M20 8H4V6h16zm-2-6H6v2h12zm4 10v8c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2v-8c0-1.1.9-2 2-2h16c1.1 0 2 .9 2 2m-6 4-6-3.27v6.53z"}),"Subscriptions"),Hn}var Bg=$g();const qg=ee(Bg);var Vn={},Fl;function Ng(){if(Fl)return Vn;Fl=1;var t=te();Object.defineProperty(Vn,"__esModule",{value:!0}),Vn.default=void 0;var r=t(ne()),n=re();return Vn.default=(0,r.default)((0,n.jsx)("path",{d:"M4 6H2v14c0 1.1.9 2 2 2h14v-2H4zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m-8 12.5v-9l6 4.5z"}),"VideoLibrary"),Vn}var Ug=Ng();const Hg=ee(Ug);var Yn={},Ll;function Vg(){if(Ll)return Yn;Ll=1;var t=te();Object.defineProperty(Yn,"__esModule",{value:!0}),Yn.default=void 0;var r=t(ne()),n=re();return Yn.default=(0,r.default)((0,n.jsx)("path",{d:"M20.13 5.41 18.72 4l-9.19 9.19-4.25-4.24-1.41 1.41 5.66 5.66zM5 18h14v2H5z"}),"DownloadDone"),Yn}var Yg=Vg();const Gg=ee(Yg),Wl=t=>t>=1e6?`${(t/1e6).toFixed(1)}M`:t>=1e3?`${(t/1e3).toFixed(1)}K`:t.toString();function Qg({channel:t,selectionMode:r=!1,isSelected:n=!1,onSync:s,onDelete:a,onClick:i,onToggleSelect:o}){const c=d=>{switch(d){case"syncing":return"primary";case"success":return"success";case"failed":return"error";case"stale":return"warning";default:return"default"}},f=d=>{if(!d)return"Never synced";const u=new Date(d),g=new Date().getTime()-u.getTime(),y=Math.floor(g/6e4),m=Math.floor(g/36e5),b=Math.floor(g/864e5);return y<1?"Just now":y<60?`${y}m ago`:m<24?`${m}h ago`:`${b}d ago`};return e.jsxs(h,{onClick:()=>{r?o?.():i?.()},sx:{width:"100%",borderRadius:3,overflow:"hidden",bgcolor:"background.paper",cursor:"pointer",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",position:"relative",border:n?"2px solid":"2px solid transparent",borderColor:n?"primary.main":"transparent","&:hover":{transform:"translateY(-4px)",boxShadow:d=>`0 12px 24px ${d.palette.mode==="dark"?"rgba(0,0,0,0.4)":"rgba(0,0,0,0.12)"}`,"& .channel-overlay":{opacity:1},"& .channel-play-btn":{opacity:1,transform:"scale(1)"}}},children:[e.jsxs(h,{sx:{height:100,background:t.channel_thumbnail?`linear-gradient(135deg, rgba(102, 126, 234, 0.8), rgba(118, 75, 162, 0.8)), url(${t.channel_thumbnail})`:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",backgroundSize:"cover",backgroundPosition:"center",position:"relative"},children:[e.jsx(h,{className:"channel-overlay",sx:{position:"absolute",inset:0,background:"rgba(0,0,0,0.3)",opacity:0,transition:"opacity 0.3s ease",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(h,{className:"channel-play-btn",sx:{transform:"scale(0.8)",opacity:0,transition:"all 0.3s ease"},children:e.jsx(h,{sx:{width:48,height:48,borderRadius:"50%",bgcolor:"white",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 20px rgba(0,0,0,0.3)"},children:e.jsx(St,{sx:{fontSize:28,color:"primary.main"}})})})}),r&&e.jsx(h,{sx:{position:"absolute",top:8,right:8,zIndex:2,bgcolor:"background.paper",borderRadius:"50%",width:32,height:32,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:2},children:n?e.jsx(Og,{color:"primary"}):e.jsx(Wg,{color:"action"})}),e.jsx(h,{sx:{position:"absolute",top:8,left:8},children:e.jsx(de,{label:t.status_display,color:c(t.sync_status),size:"small",sx:{height:24,fontSize:"0.7rem",fontWeight:600,backdropFilter:"blur(4px)"}})})]}),e.jsx(h,{sx:{display:"flex",justifyContent:"center",mt:-5,position:"relative",zIndex:1},children:e.jsx(Ue,{src:t.channel_thumbnail,sx:{width:80,height:80,border:"4px solid",borderColor:"background.paper",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",bgcolor:"primary.main"},children:e.jsx(Kr,{sx:{fontSize:40}})})}),e.jsxs(h,{sx:{p:2,pt:1.5},children:[e.jsx(x,{variant:"subtitle1",fontWeight:700,textAlign:"center",noWrap:!0,sx:{mb:.5},children:t.channel_name}),e.jsxs(x,{variant:"caption",color:"text.secondary",textAlign:"center",display:"block",sx:{mb:2},children:["Updated ",f(t.last_refreshed)]}),t.error_message&&e.jsx(ge,{severity:"error",sx:{mb:2,py:0,"& .MuiAlert-message":{fontSize:"0.75rem"}},children:t.error_message}),e.jsxs(h,{sx:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:1,mb:2,p:1.5,bgcolor:d=>d.palette.mode==="dark"?"rgba(255,255,255,0.03)":"rgba(0,0,0,0.02)",borderRadius:2},children:[e.jsxs(h,{sx:{textAlign:"center"},children:[e.jsx(qg,{sx:{fontSize:20,color:"text.secondary",mb:.5}}),e.jsx(x,{variant:"body2",fontWeight:700,children:Wl(t.subscriber_count)}),e.jsx(x,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.65rem"},children:"Subs"})]}),e.jsxs(h,{sx:{textAlign:"center"},children:[e.jsx(Hg,{sx:{fontSize:20,color:"text.secondary",mb:.5}}),e.jsx(x,{variant:"body2",fontWeight:700,children:Wl(t.video_count)}),e.jsx(x,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.65rem"},children:"Videos"})]}),e.jsxs(h,{sx:{textAlign:"center"},children:[e.jsx(Gg,{sx:{fontSize:20,color:"primary.main",mb:.5}}),e.jsx(x,{variant:"body2",fontWeight:700,color:"primary.main",children:t.downloaded_count}),e.jsx(x,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.65rem"},children:"Downloaded"})]})]}),e.jsxs(h,{sx:{mb:2},children:[e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",mb:.5},children:[e.jsx(x,{variant:"caption",color:"text.secondary",children:"Download progress"}),e.jsxs(x,{variant:"caption",color:"primary.main",fontWeight:600,children:[t.progress_percent,"%"]})]}),e.jsx(rt,{variant:"determinate",value:t.progress_percent,sx:{height:6,borderRadius:3,bgcolor:"rgba(255,255,255,0.1)","& .MuiLinearProgress-bar":{borderRadius:3,background:t.progress_percent===100?"linear-gradient(90deg, #00C853, #69F0AE)":"linear-gradient(90deg, #667eea, #764ba2)"}}})]}),e.jsxs(h,{sx:{display:"flex",justifyContent:"center",gap:1},children:[e.jsx(be,{title:"Sync channel",children:e.jsx(J,{size:"small",color:"primary",onClick:d=>{d.stopPropagation(),s?.()},disabled:t.sync_status==="syncing",sx:{bgcolor:"rgba(102, 126, 234, 0.1)","&:hover":{bgcolor:"rgba(102, 126, 234, 0.2)"}},children:e.jsx(_u,{sx:{fontSize:20}})})}),e.jsx(be,{title:"Remove channel",children:e.jsx(J,{size:"small",color:"error",onClick:d=>{d.stopPropagation(),a?.()},sx:{bgcolor:"rgba(244, 67, 54, 0.1)","&:hover":{bgcolor:"rgba(244, 67, 54, 0.2)"}},children:e.jsx(fi,{sx:{fontSize:20}})})})]}),!t.active&&e.jsx(h,{sx:{mt:1.5,textAlign:"center"},children:e.jsx(de,{label:"Inactive",color:"error",size:"small",variant:"outlined",sx:{fontSize:"0.7rem"}})})]})]})}var Gn={},$l;function Kg(){if($l)return Gn;$l=1;var t=te();Object.defineProperty(Gn,"__esModule",{value:!0}),Gn.default=void 0;var r=t(ne()),n=re();return Gn.default=(0,r.default)((0,n.jsx)("path",{d:"M11 18c0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2 2 .9 2 2m-2-8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0-6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m6 4c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"}),"DragIndicator"),Gn}var Jg=Kg();const Xg=ee(Jg);function Ru({id:t,children:r,disabled:n=!1}){const{attributes:s,listeners:a,setNodeRef:i,transform:o,transition:c,isDragging:f}=Cg({id:t,disabled:n}),d={transform:aa.Transform.toString(o),transition:c,opacity:f?.5:1,zIndex:f?1e3:"auto"};return e.jsxs(h,{ref:i,style:d,sx:{position:"relative","&:hover .drag-handle":{opacity:n?0:1},"@media (hover: none)":{"& .drag-handle":{opacity:n?0:.7}}},children:[!n&&e.jsx(h,{className:"drag-handle",...s,...a,sx:{position:"absolute",top:8,left:8,zIndex:10,cursor:f?"grabbing":"grab",opacity:0,transition:"opacity 0.2s ease",bgcolor:"rgba(0,0,0,0.6)",borderRadius:1,p:.5,display:"flex",alignItems:"center",justifyContent:"center",backdropFilter:"blur(4px)","@media (hover: none)":{p:.75,minWidth:32,minHeight:32},"&:hover":{bgcolor:"rgba(0,0,0,0.8)"},"&:focus":{opacity:1,outline:"2px solid",outlineColor:"primary.main"},touchAction:"none",userSelect:"none",WebkitUserSelect:"none"},children:e.jsx(Xg,{sx:{fontSize:20,color:"white"}})}),r]})}function Iu({items:t,storageKey:r,getItemId:n,getExtraSetting:s,updateExtraSetting:a}){const[i,o]=l.useState(t),[c,f]=l.useState(null),[d,u]=l.useState(!1),p=l.useRef(!0),g=!!(s&&a);l.useEffect(()=>{const b=()=>{let S=null;if(g&&s){const v=s(r,null);v&&Array.isArray(v)&&(S=v)}if(!S){const v=localStorage.getItem(r);if(v)try{const j=JSON.parse(v);Array.isArray(j)&&(S=j,g&&a&&a(r,j))}catch(j){console.error("Failed to parse saved order:",j)}}S&&f(S),u(!0)};p.current&&(b(),p.current=!1)},[r,g,s,a]),l.useEffect(()=>{if(g&&s&&d){const b=s(r,null);b&&Array.isArray(b)&&f(b)}},[g,s,r,d]),l.useEffect(()=>{if(c&&t.length>0){const b=[...t].sort((S,v)=>{const j=c.indexOf(n(S)),w=c.indexOf(n(v));return j===-1&&w===-1?0:j===-1?1:w===-1?-1:j-w});o(b)}else o(t)},[t,c,n]);const y=l.useCallback(b=>{const{active:S,over:v}=b;v&&S.id!==v.id&&o(j=>{const w=j.findIndex(D=>n(D)===S.id),C=j.findIndex(D=>n(D)===v.id),A=uo(j,w,C),P=A.map(n);return localStorage.setItem(r,JSON.stringify(P)),g&&a&&a(r,P),f(P),A})},[n,r,g,a]),m=l.useCallback(()=>{localStorage.removeItem(r),g&&a&&a(r,null),f(null),o(t)},[r,t,g,a]);return{sortedItems:i,handleDragEnd:y,resetOrder:m,hasCustomOrder:c!==null}}function Zg(){const t=At(),{getExtraSetting:r,updateExtraSetting:n}=Sr(),[s,a]=l.useState([]),[i,o]=l.useState(!0),[c,f]=l.useState(!1),[d,u]=l.useState(""),[p,g]=l.useState(""),[y,m]=l.useState(new Set),[b,S]=l.useState(!1),[v,j]=l.useState(!1),[w,C]=l.useState(""),[A,P]=l.useState([]),D=l.useCallback(G=>G.channel_id,[]),{sortedItems:R,handleDragEnd:_,resetOrder:z,hasCustomOrder:W}=Iu({items:s,storageKey:"soundwave-channel-order",getItemId:D,getExtraSetting:r,updateExtraSetting:n}),B=tu(Xr(ci,{activationConstraint:{distance:8}}),Xr(co,{activationConstraint:{delay:250,tolerance:5}}),Xr(li,{coordinateGetter:Su})),H=async()=>{try{const G=await Ud();a(G)}catch(G){console.error("Failed to load channels:",G),a([])}finally{o(!1)}};l.useEffect(()=>{H();const G=setInterval(()=>{A.length>0&&H()},1e4);return()=>clearInterval(G)},[A]);const se=async()=>{g(""),j(!0);try{const G=await Qr.subscribe({url:d}),M=G.data?.task_id,T=G.data?.message||"Channel subscription started",ae=d.match(/@([^/?]+)/),L=ae?`@${ae[1]}`:"channel";C(` Subscribing to ${L}... Downloading channel info and videos in background.`),u(""),f(!1),M&&P(N=>[...N,M]),setTimeout(()=>{H()},2e3)}catch(G){g(G.response?.data?.error||G.response?.data?.detail||"Failed to subscribe to channel")}finally{j(!1)}},I=async G=>{if(confirm("Are you sure you want to unsubscribe from this channel?"))try{await Qr.unsubscribe(G),H()}catch(M){console.error("Failed to unsubscribe:",M)}},k=async()=>{if(y.size!==0&&confirm(`Are you sure you want to unsubscribe from ${y.size} channel(s)?`))try{await Promise.all(Array.from(y).map(G=>Qr.unsubscribe(G))),m(new Set),S(!1),H()}catch(G){console.error("Failed to bulk delete:",G)}},O=G=>{const M=new Set(y);M.has(G)?M.delete(G):M.add(G),m(M)},E=()=>{y.size===s.length?m(new Set):m(new Set(s.map(G=>G.channel_id)))},Z=()=>{S(!b),m(new Set)};return e.jsxs(h,{children:[e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(x,{variant:"h4",fontWeight:"bold",children:"YouTube Channels"}),W&&e.jsx(be,{title:"Reset to default order",children:e.jsx(J,{size:"small",onClick:z,sx:{opacity:.7},children:e.jsx(ed,{fontSize:"small"})})})]}),e.jsxs(h,{sx:{display:"flex",gap:1},children:[s.length>0&&e.jsx(q,{variant:b?"contained":"outlined",size:"small",startIcon:b?e.jsx(lh,{}):e.jsx(ch,{}),onClick:Z,color:b?"primary":"inherit",children:b?"Cancel":"Select"}),e.jsx(q,{variant:"contained",size:"small",startIcon:e.jsx(rr,{}),onClick:()=>f(!0),children:"Subscribe to Channel"})]})]}),A.length>0&&e.jsx(ge,{severity:"info",sx:{mb:2},children:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsxs(x,{variant:"body2",children:[" Processing ",A.length," channel subscription",A.length>1?"s":"","..."]}),e.jsx(x,{variant:"caption",sx:{opacity:.7},children:"Downloading channel info and videos in background"})]})}),b&&e.jsxs(h,{sx:{mb:2,p:2,bgcolor:"primary.main",color:"primary.contrastText",borderRadius:2,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(q,{variant:"outlined",size:"small",onClick:E,sx:{color:"inherit",borderColor:"currentColor","&:hover":{borderColor:"currentColor",bgcolor:"rgba(255,255,255,0.1)"}},children:y.size===s.length?"Deselect All":"Select All"}),e.jsxs(x,{variant:"body2",children:[y.size," of ",s.length," selected"]})]}),e.jsx(q,{variant:"contained",color:"error",size:"small",startIcon:e.jsx(td,{}),onClick:k,disabled:y.size===0,children:"Delete Selected"})]}),e.jsx(yu,{sensors:B,collisionDetection:au,onDragEnd:_,children:e.jsx(ju,{items:R.map(G=>G.channel_id),strategy:hi,children:e.jsx(K,{container:!0,spacing:3,children:R.map(G=>e.jsx(K,{item:!0,xs:12,sm:6,md:4,lg:3,children:e.jsx(Ru,{id:G.channel_id,disabled:b,children:e.jsx(Qg,{channel:G,selectionMode:b,isSelected:y.has(G.channel_id),onDelete:()=>I(G.channel_id),onClick:()=>t(`/channels/${G.channel_id}`),onToggleSelect:()=>O(G.channel_id)})})},G.channel_id))})})}),!i&&s.length===0&&e.jsxs(h,{sx:{textAlign:"center",py:8,color:"text.secondary"},children:[e.jsx(La,{sx:{fontSize:64,mb:2,opacity:.3}}),e.jsx(x,{variant:"h6",gutterBottom:!0,children:"No channels subscribed"}),e.jsx(x,{variant:"body2",sx:{mb:3},children:"Subscribe to YouTube channels to automatically download their content"}),e.jsx(q,{variant:"contained",startIcon:e.jsx(rr,{}),onClick:()=>f(!0),children:"Subscribe to Channel"})]}),e.jsxs(Qe,{open:c,onClose:()=>f(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(Xe,{children:"Subscribe to YouTube Channel"}),e.jsxs(Ke,{children:[p&&e.jsx(ge,{severity:"error",sx:{mb:2},children:p}),e.jsx(je,{autoFocus:!0,margin:"dense",label:"Channel URL",placeholder:"https://www.youtube.com/@channelname or channel ID",fullWidth:!0,value:d,onChange:G=>u(G.target.value),helperText:"Enter a YouTube channel URL or channel ID"})]}),e.jsxs(tt,{children:[e.jsx(q,{onClick:()=>f(!1),disabled:v,children:"Cancel"}),e.jsx(q,{onClick:se,variant:"contained",disabled:!d||v,children:v?"Subscribing...":"Subscribe"})]})]}),e.jsx(ct,{open:!!w,autoHideDuration:6e3,onClose:()=>C(""),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(ge,{onClose:()=>C(""),severity:"success",sx:{width:"100%"},children:w})}),e.jsx(sn,{})]})}function e0({setCurrentAudio:t}){const{channelId:r}=Xi(),n=At(),{getTrackRef:s,shouldHighlight:a}=pa(),[i,o]=l.useState(null),[c,f]=l.useState(!0),[d,u]=l.useState(""),[p,g]=l.useState(!1),[y,m]=l.useState("");l.useEffect(()=>{r&&b()},[r]);const b=async()=>{try{f(!0);const R=await Qr.get(r);o(R.data),u("")}catch(R){console.error("Failed to load channel:",R),u(R.response?.data?.detail||"Failed to load channel")}finally{f(!1)}},S=R=>{i?.audio_files?t(R,i.audio_files):t(R)},v=()=>{i?.audio_files&&i.audio_files.length>0&&(t(i.audio_files[0],i.audio_files),m(`Playing all ${i.audio_files.length} tracks from ${i.channel_name}`),g(!0))},j=()=>{if(i?.audio_files&&i.audio_files.length>0){const R=[...i.audio_files].sort(()=>Math.random()-.5);t(R[0],R),m(`Shuffling ${i.audio_files.length} tracks from ${i.channel_name}`),g(!0)}},w=async()=>{if(!i?.audio_files)return;const R=i.audio_files.filter(_=>_.file_path&&_.youtube_id);if(R.length===0){m("No downloaded tracks to save"),g(!0);return}m(`Downloading ${R.length} tracks to your device`),g(!0);for(const _ of R)try{const z=await wt.downloadFile(_.youtube_id),W=window.URL.createObjectURL(z),B=document.createElement("a");B.href=W,B.download=_.title||"audio",B.style.display="none",document.body.appendChild(B),B.click(),document.body.removeChild(B),window.URL.revokeObjectURL(W),await new Promise(H=>setTimeout(H,500))}catch(z){console.error(`Failed to download ${_.title}:`,z)}},C=R=>{o(_=>_?.audio_files?{..._,audio_files:_.audio_files.map(z=>z.id===R.id?R:z)}:_)},A=R=>{const _=Math.floor(R/3600),z=Math.floor(R%3600/60),W=R%60;return _>0?`${_}:${z.toString().padStart(2,"0")}:${W.toString().padStart(2,"0")}`:`${z}:${W.toString().padStart(2,"0")}`},P=R=>R>=1e6?`${(R/1e6).toFixed(1)}M`:R>=1e3?`${(R/1e3).toFixed(1)}K`:R.toString(),D=R=>{switch(R){case"syncing":return"primary";case"success":return"success";case"failed":return"error";case"stale":return"warning";default:return"default"}};return c?e.jsx(h,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"50vh",children:e.jsx(Ae,{})}):d||!i?e.jsxs(h,{children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(J,{onClick:()=>n("/channels"),children:e.jsx(Zr,{})}),e.jsx(x,{variant:"h5",children:"Channel Details"})]}),e.jsx(ge,{severity:"error",children:d||"Channel not found"})]}):e.jsxs(h,{children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(J,{onClick:()=>n("/channels"),sx:{mr:1},children:e.jsx(Zr,{})}),e.jsx(x,{variant:"h4",fontWeight:"bold",children:"Channel Details"})]}),e.jsx(Ce,{sx:{mb:3,p:3},children:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(Ue,{src:i.channel_thumbnail,sx:{width:80,height:80},children:e.jsx(La,{sx:{fontSize:40}})}),e.jsxs(h,{sx:{flex:1},children:[e.jsx(x,{variant:"h5",fontWeight:"bold",gutterBottom:!0,children:i.channel_name}),e.jsxs(h,{sx:{display:"flex",gap:1,flexWrap:"wrap",mb:2},children:[e.jsx(de,{label:i.status_display,color:D(i.sync_status),size:"small"}),e.jsx(de,{label:`${P(i.subscriber_count)} subscribers`,variant:"outlined",size:"small"}),e.jsx(de,{label:`${i.audio_count||0} tracks`,variant:"outlined",size:"small"}),e.jsx(de,{label:`${i.downloaded_count} downloaded`,variant:"outlined",size:"small"})]}),e.jsx(h,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:i.audio_files&&i.audio_files.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(q,{variant:"contained",startIcon:e.jsx(rd,{}),onClick:v,children:"Play All"}),e.jsx(q,{variant:"outlined",startIcon:e.jsx(Js,{}),onClick:j,children:"Shuffle"}),e.jsx(q,{variant:"outlined",startIcon:e.jsx(Ti,{}),onClick:w,children:"Download All"})]})})]})]})}),i.audio_files&&i.audio_files.length>0?e.jsx(Or,{component:pt,children:e.jsxs(Fr,{children:[e.jsx(Lr,{children:e.jsxs(ut,{children:[e.jsx(Q,{width:60,children:"#"}),e.jsx(Q,{children:"Title"}),e.jsx(Q,{width:120,children:"Duration"}),e.jsx(Q,{width:120,children:"Published"}),e.jsx(Q,{width:100,children:"Plays"}),e.jsx(Q,{width:100,children:"Actions"})]})}),e.jsx(Wr,{children:i.audio_files.map((R,_)=>e.jsxs(ut,{ref:s(R.youtube_id),hover:!0,sx:{cursor:"pointer","&:hover":{bgcolor:"action.hover"},...a(R.youtube_id)&&{bgcolor:"rgba(19, 236, 106, 0.1)"}},onClick:()=>S(R),children:[e.jsx(Q,{children:e.jsxs(h,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(x,{variant:"body2",color:"text.secondary",sx:{mr:1},children:_+1}),e.jsx(J,{size:"small",onClick:z=>{z.stopPropagation(),S(R)},children:e.jsx(nr,{fontSize:"small"})})]})}),e.jsx(Q,{children:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(h,{component:"img",src:R.thumbnail_url,alt:R.title,sx:{width:40,height:30,objectFit:"cover",borderRadius:1},onError:z=>{z.currentTarget.style.display="none"}}),e.jsxs(h,{children:[e.jsx(x,{variant:"body2",fontWeight:"medium",noWrap:!0,children:R.title}),e.jsxs(x,{variant:"caption",color:"text.secondary",children:[P(R.view_count||0)," views"]})]})]})}),e.jsx(Q,{children:e.jsx(x,{variant:"body2",color:"text.secondary",children:A(R.duration)})}),e.jsx(Q,{children:e.jsx(x,{variant:"body2",color:"text.secondary",children:R.published_date?new Date(R.published_date).toLocaleDateString():"N/A"})}),e.jsx(Q,{children:e.jsx(x,{variant:"body2",color:"text.secondary",children:R.play_count})}),e.jsx(Q,{children:e.jsxs(h,{sx:{display:"flex",gap:.5},children:[e.jsx(be,{title:"Download",children:e.jsx(J,{size:"small",onClick:async z=>{z.stopPropagation();try{const W=await wt.downloadFile(R.youtube_id),B=window.URL.createObjectURL(W),H=document.createElement("a");H.href=B,H.download=R.title||"audio",H.click(),window.URL.revokeObjectURL(B)}catch(W){console.error("Download failed:",W)}},children:e.jsx(Ti,{fontSize:"small"})})}),e.jsx(zr,{track:R,onTrackUpdate:C})]})})]},R.id))})]})}):e.jsxs(pt,{sx:{p:4,textAlign:"center"},children:[e.jsx(La,{sx:{fontSize:64,mb:2,opacity:.3}}),e.jsx(x,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No audio files found"}),e.jsx(x,{variant:"body2",color:"text.secondary",children:"Audio files will appear here once they are downloaded from this channel."})]}),e.jsx(ct,{open:p,autoHideDuration:4e3,onClose:()=>g(!1),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(ge,{onClose:()=>g(!1),severity:"success",sx:{width:"100%"},children:y})})]})}class t0{deferredPrompt=null;isInstalled=!1;isOnline=navigator.onLine;listeners=new Map;registration=null;constructor(){this.init()}init(){this.checkIfInstalled(),window.addEventListener("beforeinstallprompt",r=>{r.preventDefault(),this.deferredPrompt=r,this.emit("canInstall",!0)}),window.addEventListener("appinstalled",()=>{this.isInstalled=!0,this.deferredPrompt=null,this.emit("installed",!0)}),window.addEventListener("online",()=>{this.isOnline=!0,this.emit("online",!0)}),window.addEventListener("offline",()=>{this.isOnline=!1,this.emit("offline",!0)}),"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("controllerchange",()=>{this.emit("update",!0)})}checkIfInstalled(){return window.matchMedia("(display-mode: standalone)").matches?(this.isInstalled=!0,!0):navigator.standalone===!0?(this.isInstalled=!0,!0):!1}async registerServiceWorker(){if(!("serviceWorker"in navigator))return null;try{return this.registration=await navigator.serviceWorker.register("/service-worker.js",{scope:"/"}),console.log("Service Worker registered:",this.registration),this.registration.addEventListener("updatefound",()=>{const r=this.registration.installing;r&&r.addEventListener("statechange",()=>{r.state==="installed"&&navigator.serviceWorker.controller&&this.emit("updateAvailable",r)})}),this.registration}catch(r){return console.error("Service Worker registration failed:",r),null}}async showInstallPrompt(){if(!this.deferredPrompt)return console.warn("Install prompt not available"),!1;try{await this.deferredPrompt.prompt();const{outcome:r}=await this.deferredPrompt.userChoice;return r==="accepted"?(console.log("User accepted install prompt"),this.deferredPrompt=null,!0):(console.log("User dismissed install prompt"),!1)}catch(r){return console.error("Error showing install prompt:",r),!1}}async updateServiceWorker(){if(!this.registration)return;const r=this.registration.waiting;r&&(r.postMessage({type:"SKIP_WAITING"}),window.location.reload())}async clearCache(){if(!("serviceWorker"in navigator))return!1;try{const r=await navigator.serviceWorker.ready,n=new MessageChannel;return new Promise(s=>{n.port1.onmessage=a=>{s(a.data.success)},r.active?.postMessage({type:"CLEAR_CACHE"},[n.port2])})}catch(r){return console.error("Error clearing cache:",r),!1}}async cacheAudio(r){if(!("serviceWorker"in navigator))return!1;try{const n=await navigator.serviceWorker.ready,s=new MessageChannel;return new Promise(a=>{s.port1.onmessage=i=>{a(i.data.success)},n.active?.postMessage({type:"CACHE_AUDIO",url:r},[s.port2])})}catch(n){return console.error("Error caching audio:",n),!1}}async requestNotificationPermission(){return"Notification"in window?Notification.permission==="granted"?"granted":Notification.permission!=="denied"?await Notification.requestPermission():Notification.permission:(console.warn("Notifications not supported"),"denied")}async showNotification(r,n){if(Notification.permission==="granted"){if(!this.registration){new Notification(r,n);return}await this.registration.showNotification(r,{icon:"/img/icons/icon-192x192.png",badge:"/img/icon-72x72.png",...n})}}canInstall(){return this.deferredPrompt!==null}getIsInstalled(){return this.isInstalled}getIsOnline(){return this.isOnline}on(r,n){this.listeners.has(r)||this.listeners.set(r,new Set),this.listeners.get(r).add(n)}off(r,n){this.listeners.has(r)&&this.listeners.get(r).delete(n)}emit(r,n){this.listeners.has(r)&&this.listeners.get(r).forEach(s=>s(n))}async cachePlaylist(r,n,s){if(!("serviceWorker"in navigator))return console.log("[PWA] Service Worker not supported"),{success:!1,cached:0,failed:0};try{const a=await navigator.serviceWorker.ready,i=new MessageChannel,o=localStorage.getItem("token");return o?new Promise(c=>{const f=setTimeout(()=>{console.error("[PWA] Playlist caching timed out"),c({success:!1,cached:0,failed:n.length})},3e5);i.port1.onmessage=d=>{const u=d.data;if(u.type==="progress"){console.log("[PWA] Cache progress:",u),s&&s({current:u.current,total:u.total,percent:u.percent,currentItem:u.currentItem,status:u.status});return}(u.type==="complete"||u.success!==void 0)&&(clearTimeout(f),console.log("[PWA] Playlist cache complete:",u),c({success:u.success,cached:u.cached||0,failed:u.failed||0}))},a.active?.postMessage({type:"CACHE_PLAYLIST",playlistId:r,audioUrls:n,authToken:o},[i.port2])}):(console.error("[PWA] No auth token available for caching"),{success:!1,cached:0,failed:0})}catch(a){return console.error("Error caching playlist:",a),{success:!1,cached:0,failed:n.length}}}async removePlaylistCache(r,n){if(!("serviceWorker"in navigator))return!1;try{const s=await navigator.serviceWorker.ready,a=new MessageChannel;return new Promise(i=>{a.port1.onmessage=o=>{i(o.data.success)},s.active?.postMessage({type:"REMOVE_PLAYLIST_CACHE",playlistId:r,audioUrls:n},[a.port2])})}catch(s){return console.error("Error removing playlist cache:",s),!1}}async getCacheSize(){if("storage"in navigator&&"estimate"in navigator.storage){const r=await navigator.storage.estimate();return{usage:r.usage||0,quota:r.quota||0}}return null}}const We=new t0,r0="soundwave-audio-cache",n0=2,ze={AUDIO_BLOBS:"audioBlobs",METADATA:"metadata",ANALYTICS:"analytics"},kr={maxCacheSize:500*1024*1024,maxCachedTracks:50,prefetchCount:3,staleTime:10080*60*1e3,cleanupInterval:3600*1e3};class s0{db=null;prefetchQueue=new Set;prefetchingInProgress=new Set;cleanupScheduled=!1;initialized=!1;cachedTrackIds=new Set;swCachedTrackIds=new Set;async init(){if(!this.initialized)return new Promise((r,n)=>{const s=indexedDB.open(r0,n0);s.onerror=()=>{console.error("[AudioCache] Failed to open database:",s.error),n(s.error)},s.onsuccess=()=>{this.db=s.result,this.initialized=!0,this.scheduleCleanup(),this.buildCacheIndex(),this.buildServiceWorkerCacheIndex(),console.log("[AudioCache] Initialized successfully"),r()},s.onupgradeneeded=a=>{const i=a.target.result;if(!i.objectStoreNames.contains(ze.AUDIO_BLOBS)){const o=i.createObjectStore(ze.AUDIO_BLOBS,{keyPath:"id"});o.createIndex("lastAccessed","lastAccessed",{unique:!1}),o.createIndex("cachedAt","cachedAt",{unique:!1})}if(i.objectStoreNames.contains(ze.METADATA)||i.createObjectStore(ze.METADATA,{keyPath:"id"}),!i.objectStoreNames.contains(ze.ANALYTICS)){const o=i.createObjectStore(ze.ANALYTICS,{keyPath:"id"});o.createIndex("playCount","playCount",{unique:!1}),o.createIndex("lastPlayed","lastPlayed",{unique:!1})}}})}async buildCacheIndex(){if(this.db)try{const s=this.db.transaction(ze.AUDIO_BLOBS,"readonly").objectStore(ze.AUDIO_BLOBS).getAllKeys();s.onsuccess=()=>{this.cachedTrackIds=new Set(s.result),console.log(`[AudioCache] Index built: ${this.cachedTrackIds.size} tracks in IndexedDB cache`)}}catch(r){console.error("[AudioCache] Failed to build cache index:",r)}}async buildServiceWorkerCacheIndex(){try{if(!("caches"in window))return;const n=await(await caches.open("soundwave-audio-v1")).keys();this.swCachedTrackIds=new Set(n.map(s=>{const a=s.url.match(/\/api\/audio\/([^/]+)\/download\//);return a?a[1]:null}).filter(s=>s!==null)),console.log(`[AudioCache] SW Index built: ${this.swCachedTrackIds.size} tracks in Service Worker cache`)}catch(r){console.error("[AudioCache] Failed to build SW cache index:",r)}}isLikelyCached(r){return this.cachedTrackIds.has(r)||this.swCachedTrackIds.has(r)}async isCached(r){return this.cachedTrackIds.has(r)?!0:(this.db||await this.init(),new Promise(n=>{try{const i=this.db.transaction(ze.AUDIO_BLOBS,"readonly").objectStore(ze.AUDIO_BLOBS).get(r);i.onsuccess=()=>{const o=!!i.result;o&&this.cachedTrackIds.add(r),n(o)},i.onerror=()=>n(!1)}catch{n(!1)}}))}async getCachedAudio(r){return this.db||await this.init(),new Promise(n=>{try{const a=this.db.transaction(ze.AUDIO_BLOBS,"readwrite").objectStore(ze.AUDIO_BLOBS),i=a.get(r);i.onsuccess=()=>{const o=i.result;o?(o.lastAccessed=Date.now(),o.accessCount+=1,a.put(o),n(o.blob)):n(null)},i.onerror=()=>n(null)}catch{n(null)}})}async getCachedUrl(r){const n=await this.getCachedAudio(r);return n?URL.createObjectURL(n):null}async cacheAudio(r,n,s){return this.db||await this.init(),await this.ensureCacheSpace(n.size),new Promise(a=>{try{const i=this.db.transaction([ze.AUDIO_BLOBS,ze.METADATA],"readwrite"),o=i.objectStore(ze.AUDIO_BLOBS),c=i.objectStore(ze.METADATA),f=Date.now(),d={id:r,blob:n,size:n.size,cachedAt:f,lastAccessed:f,accessCount:1,duration:s?.duration};if(o.put(d),s){const u={id:r,youtube_id:r,title:s.title||"",artist:s.artist,duration:s.duration,cachedAt:f,size:n.size};c.put(u)}i.oncomplete=()=>{this.cachedTrackIds.add(r),console.log(`[AudioCache] Cached: ${r} (${(n.size/1024/1024).toFixed(2)}MB)`),a(!0)},i.onerror=()=>a(!1)}catch{a(!1)}})}async prefetchTrack(r,n="normal"){const s=r.youtube_id;if(s){if(this.cachedTrackIds.has(s)){console.log(`[AudioCache] Already cached (fast): ${r.title}`);return}if(!this.prefetchingInProgress.has(s)){if(await this.isCached(s)){console.log(`[AudioCache] Already cached: ${r.title}`);return}this.prefetchingInProgress.add(s),console.log(`[AudioCache] Prefetching (${n}): ${r.title}`);try{const a=await fetch(`/api/audio/${s}/player/`,{headers:{Authorization:`Token ${localStorage.getItem("token")}`}});if(!a.ok)throw new Error("Failed to get stream URL");const o=(await a.json()).stream_url;if(!o)throw new Error("No stream URL returned");const c=await fetch(o);if(!c.ok)throw new Error("Failed to fetch audio");const f=await c.blob();await this.cacheAudio(s,f,{title:r.title,artist:r.channel_name,duration:r.duration})}catch(a){console.error(`[AudioCache] Failed to prefetch ${r.title}:`,a)}finally{this.prefetchingInProgress.delete(s),this.prefetchQueue.delete(s)}}}}async prefetchUpcoming(r,n,s=!1){if(r.length===0)return;const a=[];for(let i=1;i<=kr.prefetchCount;i++){const o=n+i;o<r.length&&a.push(r[o])}if(s&&r.length>5){const i=new Set;for(;i.size<Math.min(2,r.length-n-1);){const o=Math.floor(Math.random()*r.length);o!==n&&!a.find(c=>c.id===r[o].id)&&i.add(o)}i.forEach(o=>a.push(r[o]))}for(let i=0;i<a.length;i++){const o=i===0?"high":i<3?"normal":"low";this.prefetchTrack(a[i],o)}}async recordPlay(r,n,s){return this.db||await this.init(),new Promise(a=>{try{const o=this.db.transaction(ze.ANALYTICS,"readwrite").objectStore(ze.ANALYTICS),c=o.get(r);c.onsuccess=()=>{const d=c.result||{id:r,playCount:0,lastPlayed:0,skipCount:0,completionRate:0,listeningTime:0};d.playCount+=1,d.lastPlayed=Date.now(),d.listeningTime+=s,n||(d.skipCount+=1);const u=d.playCount,p=u-d.skipCount;d.completionRate=p/u,o.put(d),a()},c.onerror=()=>a()}catch{a()}})}async getFrequentlyPlayed(r=10){return this.db||await this.init(),new Promise(n=>{try{const o=this.db.transaction(ze.ANALYTICS,"readonly").objectStore(ze.ANALYTICS).index("playCount").openCursor(null,"prev"),c=[];o.onsuccess=()=>{const f=o.result;if(f&&c.length<r){const d=f.value;d.completionRate>.5&&c.push(d.id),f.continue()}else n(c)},o.onerror=()=>n([])}catch{n([])}})}async ensureCacheSpace(r){if(!this.db)return;const n=await this.getCacheStats();if(n.totalSize+r>kr.maxCacheSize){const s=n.totalSize+r-kr.maxCacheSize+10485760;await this.evictOldest(s)}n.count>=kr.maxCachedTracks&&await this.evictOldest(0,5)}async evictOldest(r=0,n=0){if(this.db)return new Promise(s=>{try{const c=this.db.transaction(ze.AUDIO_BLOBS,"readwrite").objectStore(ze.AUDIO_BLOBS).index("lastAccessed").openCursor();let f=0,d=0;c.onsuccess=()=>{const u=c.result;if(u){const p=u.value;(Date.now()-p.cachedAt>kr.staleTime||f<r||d<n)&&(console.log(`[AudioCache] Evicting: ${p.id} (${(p.size/1024/1024).toFixed(2)}MB)`),u.delete(),f+=p.size,d++),u.continue()}else console.log(`[AudioCache] Cleanup complete: evicted ${d} tracks, freed ${(f/1024/1024).toFixed(2)}MB`),s()},c.onerror=()=>s()}catch{s()}})}async getCacheStats(){return this.db||await this.init(),new Promise(r=>{try{const a=this.db.transaction(ze.AUDIO_BLOBS,"readonly").objectStore(ze.AUDIO_BLOBS).getAll();a.onsuccess=()=>{const i=a.result,o=i.reduce((f,d)=>f+d.size,0),c=i.length>0?Math.min(...i.map(f=>f.cachedAt)):Date.now();r({count:i.length,totalSize:o,oldestEntry:c})},a.onerror=()=>r({count:0,totalSize:0,oldestEntry:Date.now()})}catch{r({count:0,totalSize:0,oldestEntry:Date.now()})}})}async clearCache(){return this.db||await this.init(),new Promise(r=>{try{const n=this.db.transaction([ze.AUDIO_BLOBS,ze.METADATA],"readwrite");n.objectStore(ze.AUDIO_BLOBS).clear(),n.objectStore(ze.METADATA).clear(),n.oncomplete=()=>{console.log("[AudioCache] Cache cleared"),r()},n.onerror=()=>r()}catch{r()}})}async getServiceWorkerCachedUrl(r){try{if(!("caches"in window))return console.log("[AudioCache] Cache API not available"),null;const n=`/api/audio/${r}/download/`,a=await(await caches.open("soundwave-audio-v1")).match(n);if(a){console.log("[AudioCache] Found in Service Worker cache:",r);const i=await a.blob();return URL.createObjectURL(i)}return null}catch(n){return console.error("[AudioCache] Error checking Service Worker cache:",n),null}}async getAnyCachedUrl(r){const n=this.cachedTrackIds.has(r),s=this.swCachedTrackIds.has(r);if(!n&&!s)return null;if(n){const o=await this.getCachedUrl(r);if(o)return{url:o,source:"indexeddb"}}if(s){const o=await this.getServiceWorkerCachedUrl(r);if(o)return{url:o,source:"serviceworker"}}const a=await this.getCachedUrl(r);if(a)return this.cachedTrackIds.add(r),{url:a,source:"indexeddb"};const i=await this.getServiceWorkerCachedUrl(r);return i?(this.swCachedTrackIds.add(r),{url:i,source:"serviceworker"}):null}async isAvailableOffline(r){if(this.cachedTrackIds.has(r)||this.swCachedTrackIds.has(r)||await this.isCached(r))return!0;try{if("caches"in window)return!!await(await caches.open("soundwave-audio-v1")).match(`/api/audio/${r}/download/`)}catch{}return!1}scheduleCleanup(){this.cleanupScheduled||(this.cleanupScheduled=!0,setInterval(async()=>{console.log("[AudioCache] Running scheduled cleanup..."),await this.evictOldest(0,0)},kr.cleanupInterval))}async refreshServiceWorkerIndex(){await this.buildServiceWorkerCacheIndex()}addToServiceWorkerIndex(r){this.swCachedTrackIds.add(r)}}const ft=new s0,a0=kr,Au=l.createContext(void 0),ba=()=>{const t=l.useContext(Au);if(!t)throw new Error("usePWA must be used within PWAProvider");return t},i0=({children:t})=>{const[r,n]=l.useState(navigator.onLine),[s,a]=l.useState(!1),[i,o]=l.useState(We.getIsInstalled()),[c,f]=l.useState(!1),[d,u]=l.useState(null);l.useEffect(()=>{We.registerServiceWorker();const w=()=>n(!0),C=()=>n(!1),A=()=>a(!0),P=()=>{o(!0),a(!1)},D=()=>f(!0);return We.on("online",w),We.on("offline",C),We.on("canInstall",A),We.on("installed",P),We.on("updateAvailable",D),(async()=>{const _=await We.getCacheSize();u(_)})(),a(We.canInstall()),()=>{We.off("online",w),We.off("offline",C),We.off("canInstall",A),We.off("installed",P),We.off("updateAvailable",D)}},[]);const j={isOnline:r,canInstall:s,isInstalled:i,isUpdateAvailable:c,cacheSize:d,showInstallPrompt:async()=>await We.showInstallPrompt(),updateApp:async()=>{await We.updateServiceWorker()},clearCache:async()=>{const w=await We.clearCache();if(w){const C=await We.getCacheSize();u(C)}return w},cacheAudio:async w=>{const C=await We.cacheAudio(w);if(C){const A=await We.getCacheSize();u(A)}return C},cachePlaylist:async(w,C,A)=>{const P=await We.cachePlaylist(w,C,A);if(P.success){const D=await We.getCacheSize();u(D),await ft.refreshServiceWorkerIndex(),console.log("[PWA] Refreshed cache index after playlist cache")}return P},removePlaylistCache:async(w,C)=>{const A=await We.removePlaylistCache(w,C);if(A){const P=await We.getCacheSize();u(P),await ft.refreshServiceWorkerIndex()}return A},requestNotifications:async()=>await We.requestNotificationPermission()};return e.jsx(Au.Provider,{value:j,children:t})},o0="soundwave-offline",l0=2,Re={AUDIO_QUEUE:"audioQueue",FAVORITES:"favorites",PLAYLISTS:"playlists",SETTINGS:"settings",PENDING_UPLOADS:"pendingUploads",LYRICS:"lyrics"};class c0{db=null;async init(){return new Promise((r,n)=>{const s=indexedDB.open(o0,l0);s.onerror=()=>n(s.error),s.onsuccess=()=>{this.db=s.result,r()},s.onupgradeneeded=a=>{const i=a.target.result;i.objectStoreNames.contains(Re.AUDIO_QUEUE)||i.createObjectStore(Re.AUDIO_QUEUE,{keyPath:"id"}),i.objectStoreNames.contains(Re.FAVORITES)||i.createObjectStore(Re.FAVORITES,{keyPath:"id"}).createIndex("timestamp","timestamp",{unique:!1}),i.objectStoreNames.contains(Re.PLAYLISTS)||i.createObjectStore(Re.PLAYLISTS,{keyPath:"id"}),i.objectStoreNames.contains(Re.SETTINGS)||i.createObjectStore(Re.SETTINGS,{keyPath:"key"}),i.objectStoreNames.contains(Re.PENDING_UPLOADS)||i.createObjectStore(Re.PENDING_UPLOADS,{keyPath:"id",autoIncrement:!0}).createIndex("timestamp","timestamp",{unique:!1}),i.objectStoreNames.contains(Re.LYRICS)||i.createObjectStore(Re.LYRICS,{keyPath:"youtube_id"})}})}async get(r,n){try{return this.db||await this.init(),this.db.objectStoreNames.contains(r)?new Promise((s,a)=>{const c=this.db.transaction(r,"readonly").objectStore(r).get(n);c.onsuccess=()=>s(c.result),c.onerror=()=>a(c.error)}):(console.log(`[OfflineStorage] Store ${r} does not exist`),null)}catch(s){return console.error(`[OfflineStorage] Error getting from ${r}:`,s),null}}async getAll(r){try{return this.db||await this.init(),this.db.objectStoreNames.contains(r)?new Promise((n,s)=>{const o=this.db.transaction(r,"readonly").objectStore(r).getAll();o.onsuccess=()=>n(o.result),o.onerror=()=>s(o.error)}):(console.log(`[OfflineStorage] Store ${r} does not exist`),[])}catch(n){return console.error(`[OfflineStorage] Error getting all from ${r}:`,n),[]}}async put(r,n){try{if(this.db||await this.init(),!this.db.objectStoreNames.contains(r)){console.log(`[OfflineStorage] Store ${r} does not exist, skipping put`);return}return new Promise((s,a)=>{const c=this.db.transaction(r,"readwrite").objectStore(r).put(n);c.onsuccess=()=>s(),c.onerror=()=>a(c.error)})}catch(s){console.error(`[OfflineStorage] Error putting to ${r}:`,s)}}async delete(r,n){return this.db||await this.init(),new Promise((s,a)=>{const c=this.db.transaction(r,"readwrite").objectStore(r).delete(n);c.onsuccess=()=>s(),c.onerror=()=>a(c.error)})}async clear(r){return this.db||await this.init(),new Promise((n,s)=>{const o=this.db.transaction(r,"readwrite").objectStore(r).clear();o.onsuccess=()=>n(),o.onerror=()=>s(o.error)})}async saveAudioQueue(r){await this.clear(Re.AUDIO_QUEUE);for(const n of r)await this.put(Re.AUDIO_QUEUE,n)}async getAudioQueue(){return await this.getAll(Re.AUDIO_QUEUE)}async addFavorite(r){await this.put(Re.FAVORITES,{...r,timestamp:Date.now()})}async removeFavorite(r){await this.delete(Re.FAVORITES,r)}async getFavorites(){return await this.getAll(Re.FAVORITES)}async addPendingUpload(r){await this.put(Re.PENDING_UPLOADS,{...r,timestamp:Date.now()})}async getPendingUploads(){return await this.getAll(Re.PENDING_UPLOADS)}async removePendingUpload(r){await this.delete(Re.PENDING_UPLOADS,r)}async saveSetting(r,n){await this.put(Re.SETTINGS,{key:r,value:n})}async getSetting(r){return(await this.get(Re.SETTINGS,r))?.value}async savePlaylist(r){await this.put(Re.PLAYLISTS,{...r,offline:!0,lastSync:Date.now()})}async getPlaylist(r){return await this.get(Re.PLAYLISTS,r)}async getPlaylistByPlaylistId(r){return(await this.getAll(Re.PLAYLISTS)).find(s=>s.playlist_id===r)||null}async getPlaylists(){return await this.getAll(Re.PLAYLISTS)}async getOfflinePlaylists(){return(await this.getAll(Re.PLAYLISTS)).filter(n=>n.offline)}async removePlaylist(r){await this.delete(Re.PLAYLISTS,r)}async updatePlaylistSyncStatus(r,n){const s=await this.getPlaylist(r);s&&(s.syncStatus=n,s.lastSync=Date.now(),await this.put(Re.PLAYLISTS,s))}async clearAllData(){await this.clear(Re.AUDIO_QUEUE),await this.clear(Re.FAVORITES),await this.clear(Re.PLAYLISTS),await this.clear(Re.PENDING_UPLOADS),await this.clear(Re.LYRICS)}async saveLyrics(r,n){await this.put(Re.LYRICS,{youtube_id:r,...n,cachedAt:Date.now()})}async getLyrics(r){return await this.get(Re.LYRICS,r)}async removeLyrics(r){await this.delete(Re.LYRICS,r)}}const dt=new c0;dt.init().catch(t=>{console.error("Failed to initialize offline storage:",t)});var Qn={},Bl;function d0(){if(Bl)return Qn;Bl=1;var t=te();Object.defineProperty(Qn,"__esModule",{value:!0}),Qn.default=void 0;var r=t(ne()),n=re();return Qn.default=(0,r.default)((0,n.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M10 17l-3.5-3.5 1.41-1.41L10 14.17 15.18 9l1.41 1.41z"}),"CloudDone"),Qn}var u0=d0();const Pu=ee(u0);var Kn={},ql;function h0(){if(ql)return Kn;ql=1;var t=te();Object.defineProperty(Kn,"__esModule",{value:!0}),Kn.default=void 0;var r=t(ne()),n=re();return Kn.default=(0,r.default)((0,n.jsx)("path",{d:"M22.99 9C19.15 5.16 13.8 3.76 8.84 4.78l2.52 2.52c3.47-.17 6.99 1.05 9.63 3.7zm-4 4c-1.29-1.29-2.84-2.13-4.49-2.56l3.53 3.53zM2 3.05 5.07 6.1C3.6 6.82 2.22 7.78 1 9l1.99 2c1.24-1.24 2.67-2.16 4.2-2.77l2.24 2.24C7.81 10.89 6.27 11.73 5 13v.01L6.99 15c1.36-1.36 3.14-2.04 4.92-2.06L18.98 20l1.27-1.26L3.29 1.79zM9 17l3 3 3-3c-1.65-1.66-4.34-1.66-6 0"}),"WifiOff"),Kn}var f0=h0();const x0=ee(f0);function p0({playlist:t,isOffline:r=!1,isOnline:n=!0,isSyncing:s=!1,onSync:a,onDelete:i,onClick:o}){const c=t.item_count>0?Math.round(t.downloaded_count/t.item_count*100):0,f=d=>{if(!d)return"Never synced";const u=new Date(d),g=new Date().getTime()-u.getTime(),y=Math.floor(g/6e4),m=Math.floor(g/36e5),b=Math.floor(g/864e5);return y<1?"Just now":y<60?`${y}m ago`:m<24?`${m}h ago`:`${b}d ago`};return e.jsxs(h,{onClick:o,sx:{width:"100%",minWidth:0,maxWidth:280,borderRadius:3,overflow:"hidden",bgcolor:"background.paper",cursor:"pointer",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",position:"relative","&:hover":{transform:"translateY(-8px) scale(1.02)",boxShadow:d=>`0 20px 40px ${d.palette.mode==="dark"?"rgba(0,0,0,0.4)":"rgba(0,0,0,0.15)"}`,"& .playlist-overlay":{opacity:1},"& .playlist-play-btn":{opacity:1,transform:"scale(1)"}}},children:[e.jsxs(h,{sx:{height:0,paddingBottom:"100%",width:"100%",position:"relative",backgroundImage:t.thumbnail_url?`url(${t.thumbnail_url})`:"none",backgroundSize:"cover",backgroundPosition:"center",bgcolor:"grey.900"},children:[!t.thumbnail_url&&e.jsx(h,{sx:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"},children:e.jsx(ra,{sx:{fontSize:64,color:"white",opacity:.8}})}),e.jsx(h,{className:"playlist-overlay",sx:{position:"absolute",inset:0,background:"linear-gradient(to top, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0.3) 50%, rgba(0,0,0,0.1) 100%)",opacity:0,transition:"opacity 0.3s ease"}}),e.jsx(h,{className:"playlist-play-btn",sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%) scale(0.8)",opacity:0,transition:"all 0.3s ease"},children:e.jsx(h,{sx:{width:56,height:56,borderRadius:"50%",bgcolor:"primary.main",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 20px rgba(0,0,0,0.4)"},children:e.jsx(St,{sx:{fontSize:32,color:"white"}})})}),e.jsxs(h,{sx:{position:"absolute",bottom:8,right:8,bgcolor:"rgba(0,0,0,0.75)",backdropFilter:"blur(4px)",borderRadius:1.5,px:1,py:.5,display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Tt,{sx:{fontSize:14,color:"white"}}),e.jsxs(x,{variant:"caption",sx:{color:"white",fontWeight:600},children:[t.downloaded_count,"/",t.item_count]})]}),r&&e.jsx(de,{icon:e.jsx(Pu,{sx:{fontSize:14}}),label:"Offline",size:"small",sx:{position:"absolute",top:8,left:8,height:24,fontSize:"0.7rem",fontWeight:600,bgcolor:"success.main",color:"white","& .MuiChip-icon":{color:"white"}}}),!n&&!r&&e.jsx(de,{icon:e.jsx(x0,{sx:{fontSize:14}}),label:"Unavailable",size:"small",sx:{position:"absolute",top:8,left:8,height:24,fontSize:"0.7rem",fontWeight:600,bgcolor:"rgba(0, 0, 0, 0.7)",color:"warning.main","& .MuiChip-icon":{color:"warning.main"}}})]}),e.jsxs(h,{sx:{p:2},children:[e.jsx(x,{variant:"subtitle2",fontWeight:600,noWrap:!0,sx:{mb:.5,lineHeight:1.3},children:t.title}),e.jsx(x,{variant:"caption",color:"text.secondary",noWrap:!0,sx:{display:"block",mb:1.5},children:t.channel_name}),e.jsxs(h,{sx:{mb:1.5},children:[e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:.5},children:[e.jsx(x,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.65rem"},children:f(t.last_refresh)}),e.jsxs(x,{variant:"caption",color:"primary.main",fontWeight:600,sx:{fontSize:"0.7rem"},children:[c,"%"]})]}),e.jsx(rt,{variant:"determinate",value:c,sx:{height:4,borderRadius:2,bgcolor:"rgba(255,255,255,0.1)","& .MuiLinearProgress-bar":{borderRadius:2,background:c===100?"linear-gradient(90deg, #00C853, #69F0AE)":"linear-gradient(90deg, #667eea, #764ba2)"}}})]}),e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(be,{title:s?"Syncing...":"Sync playlist",children:e.jsx("span",{children:e.jsx(J,{size:"small",color:"primary",onClick:d=>{d.stopPropagation(),a?.()},disabled:s,sx:{bgcolor:"rgba(102, 126, 234, 0.1)","&:hover":{bgcolor:"rgba(102, 126, 234, 0.2)"}},children:s?e.jsx(Ae,{size:18,color:"inherit"}):e.jsx(_u,{sx:{fontSize:18}})})})}),e.jsx(be,{title:"Remove playlist",children:e.jsx(J,{size:"small",color:"error",onClick:d=>{d.stopPropagation(),i?.()},sx:{bgcolor:"rgba(244, 67, 54, 0.1)","&:hover":{bgcolor:"rgba(244, 67, 54, 0.2)"}},children:e.jsx(fi,{sx:{fontSize:18}})})})]})]})]})}function m0(){const t=At(),{isOnline:r}=ba(),{getExtraSetting:n,updateExtraSetting:s}=Sr(),[a,i]=l.useState([]),[o,c]=l.useState(!0),[f,d]=l.useState(!1),[u,p]=l.useState(""),[g,y]=l.useState(""),[m,b]=l.useState(new Set),[S,v]=l.useState(new Set),[j,w]=l.useState({open:!1,message:"",severity:"info"}),C=l.useCallback(I=>I.playlist_id,[]),{sortedItems:A,handleDragEnd:P,resetOrder:D,hasCustomOrder:R}=Iu({items:a,storageKey:"soundwave-playlist-order",getItemId:C,getExtraSetting:n,updateExtraSetting:s}),_=tu(Xr(ci,{activationConstraint:{distance:8}}),Xr(co,{activationConstraint:{delay:250,tolerance:5}}),Xr(li,{coordinateGetter:Su})),z=async()=>{try{if(!r){console.log("[Offline] Loading playlists from cache");const k=await dt.getOfflinePlaylists();if(k.length>0){const O=k.map(E=>({id:E.id,playlist_id:E.playlist_id,title:E.title,channel_name:E.channel_name||"Offline",thumbnail_url:E.thumbnail_url,subscribed:!0,item_count:E.item_count||E.items?.length||0,downloaded_count:E.downloaded_count||E.items?.length||0,last_refresh:null,sync_status:"success",status_display:"Offline",error_message:"",active:!0,progress_percent:100}));i(O),b(new Set(O.map(E=>E.id)))}else i([]);c(!1);return}const I=await Nd();i(I),await W()}catch(I){console.error("Failed to load playlists:",I),i([])}finally{c(!1)}},W=async()=>{try{const I=await dt.getOfflinePlaylists(),k=new Set(I.map(O=>O.id));b(k)}catch(I){console.error("Failed to load offline status:",I)}};l.useEffect(()=>{z()},[r]);const B=async()=>{y(""),c(!0);try{await Nt.create({url:u}),p(""),d(!1),alert(" Playlist subscription started! Fetching metadata and downloading audio..."),await z(),c(!1);const I=setInterval(async()=>{await z()},3e3);setTimeout(()=>clearInterval(I),3e4)}catch(I){c(!1),y(I.response?.data?.detail||"Failed to subscribe to playlist")}},H=async I=>{v(k=>new Set(k).add(I));try{const k=await Nt.download(I);console.log("[Playlist] Download started:",k.data),w({open:!0,message:" Sync started! Checking for new tracks...",severity:"info"});let O=0;const E=15,Z=setInterval(async()=>{O++,await z();const G=a.find(M=>M.playlist_id===I);G&&G.sync_status!=="syncing"&&(clearInterval(Z),v(M=>{const T=new Set(M);return T.delete(I),T}),G.sync_status==="success"?w({open:!0,message:` Sync complete! ${G.downloaded_count}/${G.item_count} tracks available`,severity:"success"}):G.sync_status==="failed"&&w({open:!0,message:` Sync failed: ${G.error_message||"Unknown error"}`,severity:"error"})),O>=E&&(clearInterval(Z),v(M=>{const T=new Set(M);return T.delete(I),T}))},2e3)}catch(k){console.error("Failed to start download:",k),v(O=>{const E=new Set(O);return E.delete(I),E}),w({open:!0,message:` Failed to start sync: ${k.response?.data?.detail||k.message||"Unknown error"}`,severity:"error"})}},se=async I=>{if(confirm("Are you sure you want to remove this playlist?"))try{await Nt.delete(I),z()}catch(k){console.error("Failed to delete playlist:",k)}};return e.jsxs(h,{children:[e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,px:.5},children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(x,{variant:"h6",sx:{fontWeight:700,letterSpacing:"-0.02em"},children:"YouTube Playlists"}),R&&e.jsx(be,{title:"Reset to default order",children:e.jsx(J,{size:"small",onClick:D,sx:{opacity:.7},children:e.jsx(ed,{fontSize:"small"})})})]}),e.jsx(q,{variant:"contained",size:"small",startIcon:e.jsx(rr,{}),onClick:()=>d(!0),sx:{borderRadius:"9999px",textTransform:"none",fontWeight:600},children:"Add Playlist"})]}),e.jsx(yu,{sensors:_,collisionDetection:au,onDragEnd:P,children:e.jsx(ju,{items:A.map(I=>I.playlist_id),strategy:hi,children:e.jsx(h,{sx:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:{xs:1.5,sm:2,md:3},pb:2,"@media (min-width: 900px)":{gridTemplateColumns:"repeat(3, 1fr)"},"@media (min-width: 1200px)":{gridTemplateColumns:"repeat(4, 1fr)"}},children:A.map(I=>e.jsx(Ru,{id:I.playlist_id,children:e.jsx(p0,{playlist:I,isOffline:m.has(I.id),isOnline:r,isSyncing:S.has(I.playlist_id)||I.sync_status==="syncing",onSync:()=>H(I.playlist_id),onDelete:()=>se(I.playlist_id),onClick:()=>t(`/playlists/${I.playlist_id}`)})},I.playlist_id))})})}),!o&&a.length===0&&e.jsxs(h,{sx:{textAlign:"center",py:8,color:"text.secondary"},children:[e.jsx(rd,{sx:{fontSize:64,mb:2,opacity:.3}}),e.jsx(x,{variant:"h6",gutterBottom:!0,children:"No playlists added"}),e.jsx(x,{variant:"body2",sx:{mb:3},children:"Add YouTube playlists to automatically download all their videos"}),e.jsx(q,{variant:"contained",startIcon:e.jsx(rr,{}),onClick:()=>d(!0),children:"Add Playlist"})]}),e.jsxs(Qe,{open:f,onClose:()=>d(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(Xe,{children:"Add YouTube Playlist"}),e.jsxs(Ke,{children:[g&&e.jsx(ge,{severity:"error",sx:{mb:2},children:g}),e.jsx(je,{autoFocus:!0,margin:"dense",label:"Playlist URL",placeholder:"https://www.youtube.com/playlist?list=...",fullWidth:!0,value:u,onChange:I=>p(I.target.value),helperText:"Enter a YouTube playlist URL"})]}),e.jsxs(tt,{children:[e.jsx(q,{onClick:()=>d(!1),children:"Cancel"}),e.jsx(q,{onClick:B,variant:"contained",disabled:!u,children:"Add Playlist"})]})]}),e.jsx(ct,{open:j.open,autoHideDuration:5e3,onClose:()=>w(I=>({...I,open:!1})),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(ge,{onClose:()=>w(I=>({...I,open:!1})),severity:j.severity,sx:{width:"100%"},children:j.message})}),e.jsx(sn,{})]})}function g0({setCurrentAudio:t}){const{playlistId:r}=Xi(),n=At(),{isOnline:s,cachePlaylist:a,removePlaylistCache:i,cacheSize:o}=ba(),{getTrackRef:c,shouldHighlight:f}=pa(),[d,u]=l.useState(null),[p,g]=l.useState(!0),[y,m]=l.useState(""),[b,S]=l.useState(!1),[v,j]=l.useState(""),[w,C]=l.useState(!1),[A,P]=l.useState(!1),[D,R]=l.useState(null),[_,z]=l.useState(new Set),W=l.useCallback(async()=>{if(!d?.items)return;const L=new Set;for(const N of d.items)N.audio.youtube_id&&await ft.isAvailableOffline(N.audio.youtube_id)&&L.add(N.audio.youtube_id);z(L)},[d?.items]);l.useEffect(()=>{r&&(H(),B())},[r]),l.useEffect(()=>{d?.items&&W()},[d?.items,w,W]);const B=async()=>{if(r)try{const L=await dt.getPlaylistByPlaylistId(r);C(L?.offline||!1)}catch(L){console.error("Failed to check offline status:",L)}},H=async()=>{try{if(g(!0),!s){const N=await dt.getPlaylistByPlaylistId(r);if(N&&N.items){console.log("[Offline] Loading playlist from cache:",N.title),u({...N,sync_status:"success",status_display:"Offline",progress_percent:100}),C(!0),m("");return}else{m("Playlist not available offline");return}}const L=await Nt.getWithItems(r);u(L.data),m("")}catch(L){console.error("Failed to load playlist:",L);try{const N=await dt.getPlaylistByPlaylistId(r);if(N&&N.items){console.log("[Fallback] Loading playlist from cache:",N.title),u({...N,sync_status:"success",status_display:"Cached",progress_percent:100}),C(!0),m("");return}}catch(N){console.error("Failed to load from cache:",N)}m(L.response?.data?.detail||"Failed to load playlist")}finally{g(!1)}},se=async()=>{if(!d?.items)return;const L=d.items.filter(N=>N.audio.file_path&&N.audio.youtube_id);if(L.length===0){j("No downloaded tracks to save"),S(!0);return}j(`Downloading ${L.length} tracks to your device`),S(!0);for(const N of L)try{const X=await wt.downloadFile(N.audio.youtube_id),ue=window.URL.createObjectURL(X),$=document.createElement("a");$.href=ue,$.download=N.audio.title||"audio",$.style.display="none",document.body.appendChild($),$.click(),document.body.removeChild($),window.URL.revokeObjectURL(ue),await new Promise(ie=>setTimeout(ie,500))}catch(X){console.error(`Failed to download ${N.audio.title}:`,X)}},I=L=>{u(N=>N?.items?{...N,items:N.items.map(X=>X.audio.id===L.id?{...X,audio:L}:X)}:N)},k=async()=>{if(!d?.items||!s){j(s?"No tracks to cache":"Must be online to download for offline use"),S(!0);return}const L=d.items.filter(N=>N.audio.file_path);if(L.length===0){j("No tracks downloaded yet. Download tracks first."),S(!0);return}P(!0),R({current:0,total:L.length+1,percent:0,currentItem:"Starting...",status:"downloading"});try{const N=L.map(ue=>`/api/audio/${ue.audio.youtube_id}/download/`),X=await a(d.playlist_id,N,ue=>{R(ue)});if(X.success){await dt.savePlaylist({id:d.id,playlist_id:d.playlist_id,title:d.title,description:d.description,channel_name:d.channel_name,thumbnail_url:d.thumbnail_url,item_count:d.item_count,downloaded_count:L.length,items:L.map(ue=>({id:ue.id,position:ue.position,audio:ue.audio})),offline:!0,lastSync:Date.now()});for(const ue of L)if(ue.audio.youtube_id)try{const $=localStorage.getItem("token"),ie=await fetch(`/api/audio/${ue.audio.youtube_id}/lyrics/`,{headers:{Authorization:`Token ${$}`}});if(ie.ok){const le=await ie.json();await dt.saveLyrics(ue.audio.youtube_id,le),console.log("[Offline] Cached lyrics for:",ue.audio.title)}}catch{console.log("[Offline] Could not cache lyrics for:",ue.audio.title)}C(!0),await W(),X.failed>0?j(` ${X.cached} tracks cached, ${X.failed} failed`):j(` ${X.cached} tracks available offline!`)}else j("Failed to cache playlist")}catch(N){console.error("Failed to cache offline:",N),j("Offline caching failed")}finally{P(!1),R(null),S(!0)}},O=async()=>{if(d?.items)try{const L=d.items.filter(N=>N.audio.file_path).map(N=>`/api/audio/${N.audio.youtube_id}/download/`);await i(d.playlist_id,L),await dt.removePlaylist(d.id),C(!1),z(new Set),j("Offline data removed"),S(!0)}catch(L){console.error("Failed to remove offline data:",L),j("Failed to remove offline data"),S(!0)}},E=async(L,N)=>{try{j(`Downloading "${N}" to your device`),S(!0);const X=await wt.downloadFile(L),ue=window.URL.createObjectURL(X),$=document.createElement("a");$.href=ue,$.download=N||"audio",$.style.display="none",document.body.appendChild($),$.click(),document.body.removeChild($),window.URL.revokeObjectURL(ue)}catch(X){console.error("Download failed:",X),j("Download failed"),S(!0)}},Z=()=>{if(!d?.items)return;const L=d.items.filter(N=>N.audio.file_path).map(N=>N.audio);L.length>0?(t(L[0],L),j(`Playing ${L.length} tracks`),S(!0)):(j("No downloaded tracks to play"),S(!0))},G=()=>{if(!d?.items)return;const L=d.items.filter(N=>N.audio.file_path).map(N=>N.audio);if(L.length>0){const N=[...L];for(let X=N.length-1;X>0;X--){const ue=Math.floor(Math.random()*(X+1));[N[X],N[ue]]=[N[ue],N[X]]}t(N[0],N),j(`Shuffled ${N.length} tracks`),S(!0)}else j("No downloaded tracks to shuffle"),S(!0)},M=L=>{const N=Math.floor(L/60),X=L%60;return`${N}:${X.toString().padStart(2,"0")}`},T=L=>new Date(L).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),ae=L=>{switch(L){case"syncing":return"primary";case"success":return"success";case"failed":return"error";case"stale":return"warning";default:return"default"}};return p?e.jsx(h,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh"},children:e.jsx(Ae,{})}):y||!d?e.jsxs(h,{children:[e.jsx(J,{onClick:()=>n("/playlists"),sx:{mb:2},children:e.jsx(Zr,{})}),e.jsx(ge,{severity:"error",children:y||"Playlist not found"})]}):e.jsxs(h,{children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:2,mb:3,flexWrap:"wrap"},children:[e.jsx(J,{onClick:()=>n("/playlists"),sx:{bgcolor:"rgba(255, 255, 255, 0.05)","&:hover":{bgcolor:"rgba(255, 255, 255, 0.1)"}},children:e.jsx(Zr,{})}),e.jsxs(h,{sx:{flex:1,minWidth:200},children:[e.jsx(x,{variant:"h5",sx:{fontWeight:700,letterSpacing:"-0.02em",mb:.5},children:d.title}),e.jsx(x,{variant:"body2",color:"text.secondary",children:d.channel_name})]}),e.jsx(de,{label:d.status_display,color:ae(d.sync_status),size:"small"})]}),!s&&e.jsx(Ce,{sx:{mb:3,bgcolor:"rgba(255, 193, 7, 0.1)",border:"1px solid rgba(255, 193, 7, 0.3)"},children:e.jsxs(h,{sx:{p:2,display:"flex",alignItems:"center",gap:2},children:[e.jsx(dh,{sx:{color:"warning.main"}}),e.jsxs(h,{sx:{flex:1},children:[e.jsx(x,{variant:"subtitle2",sx:{fontWeight:600,color:"warning.main"},children:"Offline Mode"}),e.jsx(x,{variant:"caption",color:"text.secondary",children:w?"This playlist is available offline":"You are offline. Cache playlists when online for offline access."})]})]})}),e.jsxs(h,{sx:{display:"flex",gap:1.5,mb:3,flexWrap:"wrap"},children:[e.jsx(q,{variant:"contained",startIcon:e.jsx(nr,{}),onClick:Z,disabled:!d.downloaded_count,sx:{minWidth:{xs:"48px",sm:"120px"},bgcolor:"primary.main",color:"background.dark",fontWeight:600,"&:hover":{bgcolor:"primary.dark"},"&:disabled":{bgcolor:"rgba(255, 255, 255, 0.1)"}},children:e.jsx(h,{sx:{display:{xs:"none",sm:"block"}},children:"Play All"})}),e.jsx(q,{variant:"outlined",startIcon:e.jsx(Js,{}),onClick:G,disabled:!d.downloaded_count,sx:{minWidth:{xs:"48px",sm:"120px"},borderColor:"primary.main",color:"primary.main",fontWeight:600,"&:hover":{borderColor:"primary.dark",bgcolor:"rgba(19, 236, 106, 0.05)"},"&:disabled":{borderColor:"rgba(255, 255, 255, 0.1)",color:"rgba(255, 255, 255, 0.3)"}},children:e.jsx(h,{sx:{display:{xs:"none",sm:"block"}},children:"Shuffle"})}),e.jsx(q,{variant:"outlined",startIcon:e.jsx(vr,{}),onClick:se,disabled:!d.downloaded_count,sx:{minWidth:{xs:"48px",sm:"150px"},borderColor:"primary.main",color:"primary.main",fontWeight:600,"&:hover":{borderColor:"primary.dark",bgcolor:"rgba(19, 236, 106, 0.05)"},"&:disabled":{borderColor:"rgba(255, 255, 255, 0.1)",color:"rgba(255, 255, 255, 0.3)"}},title:"Download all tracks to your device",children:e.jsx(h,{sx:{display:{xs:"none",sm:"block"}},children:"Save All"})})]}),e.jsx(Ce,{sx:{mb:3,bgcolor:w?"rgba(76, 175, 80, 0.1)":"rgba(33, 150, 243, 0.1)",border:`1px solid ${w?"rgba(76, 175, 80, 0.3)":"rgba(33, 150, 243, 0.3)"}`},children:e.jsxs(h,{sx:{p:2},children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[w?e.jsx(Xs,{sx:{color:"success.main"}}):e.jsx(Qa,{sx:{color:"info.main"}}),e.jsxs(h,{sx:{flex:1},children:[e.jsx(x,{variant:"subtitle2",sx:{fontWeight:600,mb:.5},children:w?" Offline Ready":" Cache for Offline"}),e.jsx(x,{variant:"caption",color:"text.secondary",children:w?`${d.downloaded_count} tracks cached and available without internet`:"Download this playlist to listen without an internet connection"})]})]}),e.jsxs(h,{sx:{display:"flex",gap:1.5,flexWrap:"wrap"},children:[w?e.jsxs(e.Fragment,{children:[e.jsx(be,{title:"Remove offline cache to free up storage space",children:e.jsx(q,{variant:"outlined",startIcon:e.jsx(uh,{}),onClick:O,size:"small",sx:{borderColor:"error.main",color:"error.main",fontWeight:600,"&:hover":{borderColor:"error.dark",bgcolor:"rgba(244, 67, 54, 0.05)"}},children:"Remove Offline"})}),e.jsx(de,{icon:e.jsx(Xs,{}),label:"Cached",color:"success",size:"small",sx:{fontWeight:600}})]}):e.jsx(q,{variant:"contained",startIcon:e.jsx(vr,{}),onClick:k,disabled:!s||A||!d.downloaded_count,size:"small",sx:{bgcolor:"info.main",color:"white",fontWeight:600,"&:hover":{bgcolor:"info.dark"},"&:disabled":{bgcolor:"rgba(255, 255, 255, 0.1)"}},children:A?"Caching...":"Make Available Offline"}),o&&e.jsxs(h,{sx:{ml:"auto",display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[e.jsx(x,{variant:"caption",color:"text.secondary",children:"Storage Used"}),e.jsxs(x,{variant:"caption",sx:{fontWeight:600},children:[(o.usage/1024/1024).toFixed(1)," MB / ",(o.quota/1024/1024/1024).toFixed(1)," GB"]})]})]})]})}),d.downloaded_count<d.item_count&&e.jsxs(h,{sx:{mb:3},children:[e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsx(x,{variant:"caption",color:"text.secondary",children:"Download Progress"}),e.jsxs(x,{variant:"caption",color:"text.secondary",children:[d.downloaded_count," / ",d.item_count," tracks"]})]}),e.jsx(rt,{variant:"determinate",value:d.progress_percent,sx:{height:6,borderRadius:1}})]}),e.jsxs(h,{sx:{display:"flex",gap:3,mb:3,flexWrap:"wrap"},children:[e.jsxs(h,{children:[e.jsx(x,{variant:"caption",color:"text.secondary",children:"Total Tracks"}),e.jsx(x,{variant:"h6",sx:{fontWeight:600},children:d.item_count})]}),e.jsxs(h,{children:[e.jsx(x,{variant:"caption",color:"text.secondary",children:"Downloaded"}),e.jsx(x,{variant:"h6",sx:{fontWeight:600,color:"primary.main"},children:d.downloaded_count})]}),d.last_refresh&&e.jsxs(h,{children:[e.jsx(x,{variant:"caption",color:"text.secondary",children:"Last Updated"}),e.jsx(x,{variant:"body2",sx:{fontWeight:500},children:T(d.last_refresh)})]})]}),e.jsx(Or,{children:e.jsxs(Fr,{size:"small",children:[e.jsx(Lr,{children:e.jsxs(ut,{children:[e.jsx(Q,{width:60,sx:{fontWeight:600,fontSize:{xs:"0.7rem",sm:"0.75rem"}},children:"#"}),e.jsx(Q,{sx:{fontWeight:600,fontSize:{xs:"0.7rem",sm:"0.75rem"}},children:"Title"}),e.jsx(Q,{sx:{fontWeight:600,fontSize:{xs:"0.7rem",sm:"0.75rem"},display:{xs:"none",md:"table-cell"}},children:"Channel"}),e.jsx(Q,{align:"right",sx:{fontWeight:600,fontSize:{xs:"0.7rem",sm:"0.75rem"}},children:"Duration"}),e.jsx(Q,{align:"center",width:120,sx:{fontWeight:600,fontSize:{xs:"0.7rem",sm:"0.75rem"}},children:"Actions"})]})}),e.jsx(Wr,{children:d.items&&d.items.length>0?d.items.map((L,N)=>{const X=(d.items||[]).filter(ue=>ue.audio.file_path).map(ue=>ue.audio);return e.jsxs(ut,{ref:c(L.audio.youtube_id),sx:{cursor:"pointer",transition:"background-color 0.3s ease","&:hover":{bgcolor:"rgba(19, 236, 106, 0.05)"},opacity:L.audio.file_path?1:.5,...f(L.audio.youtube_id)&&{bgcolor:"rgba(19, 236, 106, 0.1)"}},onClick:()=>L.audio.file_path&&t(L.audio,X),children:[e.jsx(Q,{sx:{color:"text.secondary",fontSize:{xs:"0.7rem",sm:"0.75rem"}},children:N+1}),e.jsx(Q,{children:e.jsxs(h,{children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(x,{variant:"body2",noWrap:!0,sx:{maxWidth:{xs:180,sm:280,md:380},fontWeight:500,fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:L.audio.title}),L.audio.youtube_id&&_.has(L.audio.youtube_id)&&e.jsx(be,{title:"Available offline",children:e.jsx(hh,{sx:{fontSize:14,color:"success.main",flexShrink:0}})})]}),!L.audio.file_path&&e.jsx(de,{label:"Not Downloaded",size:"small",color:"warning",sx:{mt:.5,height:18,fontSize:"0.65rem"}})]})}),e.jsx(Q,{sx:{display:{xs:"none",md:"table-cell"}},children:e.jsx(x,{variant:"body2",color:"text.secondary",noWrap:!0,sx:{maxWidth:150,fontSize:"0.75rem"},children:L.audio.channel_name})}),e.jsx(Q,{align:"right",sx:{color:"text.secondary",fontSize:{xs:"0.7rem",sm:"0.75rem"}},children:M(L.audio.duration)}),e.jsx(Q,{align:"center",onClick:ue=>ue.stopPropagation(),children:e.jsxs(h,{sx:{display:"flex",gap:.5,justifyContent:"center"},children:[e.jsx(J,{size:"small",onClick:()=>L.audio.file_path&&t(L.audio,X),disabled:!L.audio.file_path,sx:{color:"primary.main","&:disabled":{color:"rgba(255, 255, 255, 0.3)"}},title:"Play",children:e.jsx(nr,{})}),L.audio.file_path&&L.audio.youtube_id&&e.jsx(J,{size:"small",onClick:()=>E(L.audio.youtube_id,L.audio.title),sx:{color:"primary.main"},title:"Download to device",children:e.jsx(Ti,{})}),e.jsx(zr,{track:L.audio,onTrackUpdate:I})]})})]},L.id)}):e.jsx(ut,{children:e.jsx(Q,{colSpan:5,align:"center",sx:{py:4},children:e.jsx(x,{variant:"body2",color:"text.secondary",children:"No tracks found in this playlist"})})})})]})}),e.jsx(ct,{open:A,autoHideDuration:2e3,onClose:()=>{},anchorOrigin:{vertical:"bottom",horizontal:"center"},sx:{mb:8},children:e.jsx(ge,{severity:"info",icon:e.jsx(vr,{}),sx:{width:"100%",minWidth:300,alignItems:"center"},children:e.jsxs(h,{children:[e.jsx(x,{variant:"body2",fontWeight:600,children:"Caching for Offline"}),D&&e.jsxs(h,{sx:{mt:.5},children:[e.jsxs(x,{variant:"caption",color:"text.secondary",children:[D.currentItem," (",D.current,"/",D.total,")"]}),e.jsx(rt,{variant:"determinate",value:D.percent,sx:{height:4,borderRadius:1,mt:.5}})]})]})})}),e.jsx(ct,{open:b,autoHideDuration:3e3,onClose:()=>S(!1),message:v,anchorOrigin:{vertical:"bottom",horizontal:"center"}})]})}const Aa=[{label:"Most Played (Top 50)",rules:[{field:"play_count",operator:"greater_than",value:"0"}],order_by:"-play_count",limit:50},{label:"Recently Added (Last 30 days)",rules:[{field:"downloaded_date",operator:"in_last_days",value:"30"}],order_by:"-downloaded_date",limit:null},{label:"Favorites",rules:[{field:"is_favorite",operator:"is_true",value:""}],order_by:"-downloaded_date",limit:null},{label:"By Genre...",rules:[{field:"genre",operator:"contains",value:""}],order_by:"title",limit:null},{label:"By Artist...",rules:[{field:"artist",operator:"contains",value:""}],order_by:"title",limit:null},{label:"Short Tracks (Under 3 min)",rules:[{field:"duration",operator:"less_than",value:"180"}],order_by:"duration",limit:null},{label:"Custom Rules...",rules:[],order_by:"-downloaded_date",limit:null}],y0={local_fire_department:e.jsx(Zs,{}),new_releases:e.jsx(xh,{}),history:e.jsx(od,{}),explore:e.jsx(fh,{}),bolt:e.jsx(nd,{}),album:e.jsx(id,{}),auto_awesome:e.jsx(cr,{}),tune:e.jsx(Gr,{})};function b0({setCurrentAudio:t}){const r=At(),[n,s]=l.useState([]),[a,i]=l.useState(!0),[o,c]=l.useState(!1),[f,d]=l.useState(""),[u,p]=l.useState(""),[g,y]=l.useState(0),[m,b]=l.useState(""),[S,v]=l.useState(null),[j,w]=l.useState([]),[C,A]=l.useState({open:!1,message:"",severity:"info"}),P=l.useCallback(async()=>{try{i(!0);const k=await er.list();s(k.data.data||[])}catch(k){console.error("Failed to load smart playlists:",k),A({open:!0,message:"Failed to load smart playlists",severity:"error"})}finally{i(!1)}},[]),D=l.useCallback(async()=>{try{const k=await er.getChoices();v(k.data)}catch(k){console.error("Failed to load choices:",k)}},[]);l.useEffect(()=>{P(),D()},[P,D]);const R=()=>{d(""),p(""),y(0),b(""),w([{field:"genre",operator:"contains",value:""}])},_=()=>{R(),c(!0)},z=async()=>{if(!f.trim()){A({open:!0,message:"Please enter a name",severity:"error"});return}const k=Aa[g];let O=[...k.rules];k.label.includes("...")&&m.trim()&&(O=O.map(E=>({...E,value:m.trim()}))),g===Aa.length-1&&(O=j.filter(E=>E.value.trim()||E.operator==="is_true"||E.operator==="is_false")),O.length===0&&A({open:!0,message:"No rules set - playlist will include all tracks. Add rules after creation to filter.",severity:"info"});try{const E=await er.create({name:f,description:u,order_by:k.order_by,limit:k.limit,rules:O});R(),c(!1),A({open:!0,message:"Smart playlist created!",severity:"success"}),P(),E.data?.id&&r(`/smart-playlist/${E.data.id}`)}catch(E){console.error("Failed to create smart playlist:",E),A({open:!0,message:E.response?.data?.name?.[0]||"Failed to create smart playlist",severity:"error"})}},W=async(k,O)=>{if(O.stopPropagation(),k.is_system){A({open:!0,message:"Cannot delete system playlists",severity:"error"});return}if(confirm(`Delete "${k.name}"?`))try{await er.delete(k.id),A({open:!0,message:"Smart playlist deleted",severity:"success"}),P()}catch(E){console.error("Failed to delete smart playlist:",E),A({open:!0,message:"Failed to delete smart playlist",severity:"error"})}},B=async(k,O,E)=>{E.stopPropagation();try{const G=(await er.getTracks(k.id,{page_size:100})).data.data;if(G.length===0){A({open:!0,message:"No tracks in this playlist",severity:"info"});return}let M=[...G];if(O)for(let T=M.length-1;T>0;T--){const ae=Math.floor(Math.random()*(T+1));[M[T],M[ae]]=[M[ae],M[T]]}t(M[0],M),A({open:!0,message:`Playing ${G.length} tracks${O?" (shuffled)":""}`,severity:"success"})}catch(Z){console.error("Failed to play playlist:",Z),A({open:!0,message:"Failed to load tracks",severity:"error"})}},H=k=>y0[k]||e.jsx(cr,{}),se=n.filter(k=>k.is_system),I=n.filter(k=>!k.is_system);return a?e.jsx(h,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh"},children:e.jsx(Ae,{})}):e.jsxs(h,{sx:{p:{xs:2,sm:3}},children:[e.jsx(sn,{}),e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(cr,{sx:{fontSize:32,color:"primary.main"}}),e.jsx(x,{variant:"h4",fontWeight:"bold",children:"Smart Playlists"})]}),e.jsx(q,{variant:"contained",startIcon:e.jsx(rr,{}),onClick:_,children:"Create"})]}),e.jsx(x,{variant:"body1",color:"text.secondary",sx:{mb:4},children:"Dynamic playlists that automatically update based on rules. Your library changes, they update instantly."}),se.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(x,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(nd,{sx:{color:"warning.main"}}),"Auto Playlists"]}),e.jsx(K,{container:!0,spacing:2,sx:{mb:4},children:se.map(k=>e.jsx(K,{item:!0,xs:12,sm:6,md:4,lg:3,children:e.jsx(Ks,{in:!0,timeout:300,children:e.jsx(Ce,{sx:{height:"100%",background:`linear-gradient(135deg, ${k.color}22 0%, transparent 50%)`,borderLeft:`4px solid ${k.color}`,transition:"transform 0.2s, box-shadow 0.2s","&:hover":{transform:"translateY(-4px)",boxShadow:4}},children:e.jsx(yo,{onClick:()=>r(`/smart-playlist/${k.id}`),children:e.jsxs(Ie,{children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(h,{sx:{color:k.color},children:H(k.icon)}),e.jsx(x,{variant:"h6",noWrap:!0,sx:{flex:1},children:k.name})]}),e.jsx(x,{variant:"body2",color:"text.secondary",sx:{mb:1,minHeight:40},children:k.description}),e.jsxs(h,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx(de,{label:`${k.track_count} tracks`,size:"small",sx:{bgcolor:`${k.color}22`,color:k.color}}),e.jsxs(h,{sx:{display:"flex",gap:.5},children:[e.jsx(be,{title:"Play",children:e.jsx(J,{size:"small",onClick:O=>B(k,!1,O),sx:{color:k.color},children:e.jsx(nr,{})})}),e.jsx(be,{title:"Shuffle",children:e.jsx(J,{size:"small",onClick:O=>B(k,!0,O),sx:{color:k.color},children:e.jsx(Js,{})})})]})]})]})})})})},k.id))})]}),e.jsxs(x,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(Gr,{sx:{color:"primary.main"}}),"Custom Smart Playlists"]}),I.length===0?e.jsxs(pt,{sx:{p:4,textAlign:"center",bgcolor:"background.default"},children:[e.jsx(cr,{sx:{fontSize:64,color:"text.secondary",opacity:.5,mb:2}}),e.jsx(x,{variant:"h6",color:"text.secondary",children:"No custom smart playlists yet"}),e.jsx(x,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Create your own rules-based playlists"}),e.jsx(q,{variant:"outlined",startIcon:e.jsx(rr,{}),onClick:_,children:"Create Smart Playlist"})]}):e.jsx(K,{container:!0,spacing:2,children:I.map(k=>e.jsx(K,{item:!0,xs:12,sm:6,md:4,lg:3,children:e.jsx(Ks,{in:!0,timeout:300,children:e.jsx(Ce,{sx:{height:"100%",background:`linear-gradient(135deg, ${k.color}22 0%, transparent 50%)`,borderLeft:`4px solid ${k.color}`,transition:"transform 0.2s, box-shadow 0.2s","&:hover":{transform:"translateY(-4px)",boxShadow:4}},children:e.jsx(yo,{onClick:()=>r(`/smart-playlist/${k.id}`),children:e.jsxs(Ie,{children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(h,{sx:{color:k.color},children:H(k.icon)}),e.jsx(x,{variant:"h6",noWrap:!0,sx:{flex:1},children:k.name})]}),e.jsx(x,{variant:"body2",color:"text.secondary",sx:{mb:1,minHeight:40},children:k.description||"No description"}),e.jsxs(h,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx(de,{label:`${k.track_count} tracks`,size:"small",sx:{bgcolor:`${k.color}22`,color:k.color}}),e.jsxs(h,{sx:{display:"flex",gap:.5},children:[e.jsx(be,{title:"Play",children:e.jsx(J,{size:"small",onClick:O=>B(k,!1,O),sx:{color:k.color},children:e.jsx(nr,{})})}),e.jsx(be,{title:"Shuffle",children:e.jsx(J,{size:"small",onClick:O=>B(k,!0,O),sx:{color:k.color},children:e.jsx(Js,{})})}),e.jsx(be,{title:"Delete",children:e.jsx(J,{size:"small",onClick:O=>W(k,O),sx:{color:"error.main"},children:e.jsx(Dr,{})})})]})]})]})})})})},k.id))}),e.jsxs(Qe,{open:o,onClose:()=>c(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(Xe,{children:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(cr,{color:"primary"}),"Create Smart Playlist"]})}),e.jsxs(Ke,{children:[e.jsx(je,{autoFocus:!0,margin:"dense",label:"Name",fullWidth:!0,value:f,onChange:k=>d(k.target.value),sx:{mb:2}}),e.jsx(je,{margin:"dense",label:"Description (optional)",fullWidth:!0,multiline:!0,rows:2,value:u,onChange:k=>p(k.target.value),sx:{mb:3}}),e.jsx(De,{sx:{mb:2}}),e.jsxs(x,{variant:"subtitle2",sx:{mb:1,display:"flex",alignItems:"center",gap:1},children:[e.jsx(Gr,{fontSize:"small"}),"Choose what tracks to include:"]}),e.jsx(sd,{value:g,onChange:k=>{y(Number(k.target.value)),b("")},children:Aa.map((k,O)=>e.jsxs(h,{children:[e.jsx($e,{value:O,control:e.jsx(zi,{size:"small"}),label:k.label,sx:{ml:0}}),g===O&&k.label.includes("...")&&e.jsx(je,{size:"small",placeholder:k.label.includes("Genre")?"e.g., Rock, Pop, Jazz":"e.g., Artist name",value:m,onChange:E=>b(E.target.value),sx:{ml:4,mb:1,width:"calc(100% - 32px)"}})]},O))}),g===Aa.length-1&&S&&e.jsxs(h,{sx:{ml:4,mt:1},children:[j.map((k,O)=>e.jsxs(h,{sx:{display:"flex",gap:1,mb:1,alignItems:"center"},children:[e.jsxs(jt,{size:"small",sx:{minWidth:120},children:[e.jsx(zt,{children:"Field"}),e.jsx(_t,{value:k.field,label:"Field",onChange:E=>{const Z=[...j];Z[O].field=E.target.value,w(Z)},children:S.fields.map(E=>e.jsx(ve,{value:E.value,children:E.label},E.value))})]}),e.jsxs(jt,{size:"small",sx:{minWidth:130},children:[e.jsx(zt,{children:"Operator"}),e.jsx(_t,{value:k.operator,label:"Operator",onChange:E=>{const Z=[...j];Z[O].operator=E.target.value,w(Z)},children:S.operators.map(E=>e.jsx(ve,{value:E.value,children:E.label},E.value))})]}),!["is_true","is_false","is_set","is_not_set"].includes(k.operator)&&e.jsx(je,{size:"small",placeholder:"Value",value:k.value,onChange:E=>{const Z=[...j];Z[O].value=E.target.value,w(Z)},sx:{flex:1}}),e.jsx(J,{size:"small",onClick:()=>{const E=j.filter((Z,G)=>G!==O);w(E.length?E:[{field:"genre",operator:"contains",value:""}])},disabled:j.length===1,children:e.jsx(ad,{})})]},O)),e.jsx(q,{size:"small",startIcon:e.jsx(rr,{}),onClick:()=>w([...j,{field:"genre",operator:"contains",value:""}]),children:"Add Rule"})]}),e.jsx(ge,{severity:"info",sx:{mt:2},children:"Smart playlists automatically update when your library changes. You can refine rules after creation."})]}),e.jsxs(tt,{children:[e.jsx(q,{onClick:()=>c(!1),children:"Cancel"}),e.jsx(q,{onClick:z,variant:"contained",children:"Create"})]})]}),e.jsx(ct,{open:C.open,autoHideDuration:4e3,onClose:()=>A({...C,open:!1}),children:e.jsx(ge,{severity:C.severity,onClose:()=>A({...C,open:!1}),children:C.message})})]})}function v0({setCurrentAudio:t}){const{playlistId:r}=Xi(),n=At(),{getTrackRef:s,shouldHighlight:a}=pa(),[i,o]=l.useState(null),[c,f]=l.useState([]),[d,u]=l.useState(!0),[p,g]=l.useState(""),[y,m]=l.useState(!1),[b,S]=l.useState(""),[v,j]=l.useState(!1),[w,C]=l.useState(null),[A,P]=l.useState([]),[D,R]=l.useState("all"),[_,z]=l.useState("-downloaded_date"),[W,B]=l.useState(""),[H,se]=l.useState(null),[I,k]=l.useState(!1);l.useEffect(()=>{r&&(O(),E())},[r]);const O=async()=>{try{u(!0);const $=await er.getTracks(parseInt(r));o($.data.playlist),f($.data.data||[]),g("")}catch($){console.error("Failed to load smart playlist:",$),g($.response?.data?.detail||"Failed to load playlist")}finally{u(!1)}},E=async()=>{try{const $=await er.getChoices();C($.data)}catch($){console.error("Failed to load choices:",$)}},Z=($=0,ie=!1)=>{if(c.length===0)return;let le=[...c];if(ie){for(let He=le.length-1;He>0;He--){const Be=Math.floor(Math.random()*(He+1));[le[He],le[Be]]=[le[Be],le[He]]}$=0}t(le[$],le)},G=$=>{f(ie=>ie.map(le=>le.youtube_id===$.youtube_id?$:le))},M=async()=>{if(i)try{const ie=(await er.get(i.id)).data;P(ie.rules||[]),R(ie.match_mode),z(ie.order_by),B(ie.limit||""),j(!0)}catch($){console.error("Failed to load playlist details:",$)}},T=()=>{P([...A,{field:"genre",operator:"contains",value:"",order:A.length}])},ae=$=>{P(A.filter((ie,le)=>le!==$))},L=($,ie,le)=>{P(A.map((He,Be)=>Be===$?{...He,[ie]:le}:He))},N=async()=>{k(!0);try{const $=await er.preview({rules:A.map(ie=>({field:ie.field,operator:ie.operator,value:ie.value,value_2:ie.value_2})),match_mode:D,order_by:_,limit:W?parseInt(W.toString()):null});se($.data.total_count)}catch($){console.error("Failed to preview:",$)}finally{k(!1)}},X=async()=>{if(i)try{await er.update(i.id,{rules:A.map($=>({field:$.field,operator:$.operator,value:$.value,value_2:$.value_2})),match_mode:D,order_by:_,limit:W?parseInt(W.toString()):null}),j(!1),S("Rules updated!"),m(!0),O()}catch($){console.error("Failed to save rules:",$),S($.response?.data?.error||"Failed to save rules"),m(!0)}},ue=$=>{if(!w)return[];const ie=w.field_types[$];return w.operator_groups[ie]||[]};return d?e.jsx(h,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh"},children:e.jsx(Ae,{})}):p?e.jsxs(h,{sx:{p:3},children:[e.jsx(ge,{severity:"error",children:p}),e.jsx(q,{startIcon:e.jsx(Zr,{}),onClick:()=>n("/smart-playlists"),sx:{mt:2},children:"Back to Smart Playlists"})]}):i?e.jsxs(h,{sx:{p:{xs:2,sm:3}},children:[e.jsxs(h,{sx:{mb:3},children:[e.jsx(q,{startIcon:e.jsx(Zr,{}),onClick:()=>n("/smart-playlists"),sx:{mb:2},children:"Back to Smart Playlists"}),e.jsx(Ce,{sx:{background:`linear-gradient(135deg, ${i.color}33 0%, transparent 50%)`,borderLeft:`4px solid ${i.color}`},children:e.jsx(Ie,{children:e.jsxs(h,{sx:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",flexWrap:"wrap",gap:2},children:[e.jsxs(h,{children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(cr,{sx:{color:i.color,fontSize:32}}),e.jsx(x,{variant:"h4",fontWeight:"bold",children:i.name}),i.is_system&&e.jsx(de,{label:"Auto",size:"small",color:"warning"})]}),e.jsx(x,{variant:"body1",color:"text.secondary",sx:{mb:2},children:i.description}),e.jsx(h,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:e.jsx(de,{label:`${c.length} tracks`,sx:{bgcolor:`${i.color}22`,color:i.color}})})]}),e.jsxs(h,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[e.jsx(q,{variant:"contained",startIcon:e.jsx(nr,{}),onClick:()=>Z(0,!1),disabled:c.length===0,sx:{bgcolor:i.color,"&:hover":{bgcolor:i.color,filter:"brightness(0.9)"}},children:"Play All"}),e.jsx(q,{variant:"outlined",startIcon:e.jsx(Js,{}),onClick:()=>Z(0,!0),disabled:c.length===0,sx:{borderColor:i.color,color:i.color},children:"Shuffle"}),!i.is_system&&e.jsx(q,{variant:"outlined",startIcon:e.jsx(Gr,{}),onClick:M,children:"Edit Rules"})]})]})})})]}),c.length===0?e.jsxs(pt,{sx:{p:4,textAlign:"center"},children:[e.jsx(cr,{sx:{fontSize:64,color:"text.secondary",opacity:.5,mb:2}}),e.jsx(x,{variant:"h6",color:"text.secondary",children:"No tracks match the rules"}),!i.is_system&&e.jsx(q,{variant:"outlined",startIcon:e.jsx(Gr,{}),onClick:M,sx:{mt:2},children:"Edit Rules"})]}):e.jsx(Or,{component:pt,children:e.jsxs(Fr,{size:"small",children:[e.jsx(Lr,{children:e.jsxs(ut,{children:[e.jsx(Q,{width:50,children:"#"}),e.jsx(Q,{children:"Title"}),e.jsx(Q,{sx:{display:{xs:"none",md:"table-cell"}},children:"Artist"}),e.jsx(Q,{sx:{display:{xs:"none",sm:"table-cell"}},children:"Channel"}),e.jsx(Q,{align:"right",sx:{display:{xs:"none",lg:"table-cell"}},children:"Plays"}),e.jsx(Q,{align:"right",width:100,children:"Actions"})]})}),e.jsx(Wr,{children:c.map(($,ie)=>e.jsxs(ut,{ref:s($.youtube_id),hover:!0,sx:{cursor:"pointer",...a($.youtube_id)&&{bgcolor:"rgba(19, 236, 106, 0.1)"}},onClick:()=>Z(ie,!1),children:[e.jsx(Q,{children:ie+1}),e.jsx(Q,{children:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1},children:[$.thumbnail_url&&e.jsx(h,{component:"img",src:$.thumbnail_url,alt:$.title,sx:{width:40,height:40,borderRadius:1,objectFit:"cover"}}),e.jsxs(h,{sx:{overflow:"hidden"},children:[e.jsx(x,{variant:"body2",noWrap:!0,children:$.title}),e.jsx(x,{variant:"caption",color:"text.secondary",sx:{display:{sm:"none"}},children:$.artist||$.channel_name})]})]})}),e.jsx(Q,{sx:{display:{xs:"none",md:"table-cell"}},children:e.jsx(x,{variant:"body2",noWrap:!0,children:$.artist||"-"})}),e.jsx(Q,{sx:{display:{xs:"none",sm:"table-cell"}},children:e.jsx(x,{variant:"body2",noWrap:!0,children:$.channel_name})}),e.jsx(Q,{align:"right",sx:{display:{xs:"none",lg:"table-cell"}},children:$.play_count}),e.jsx(Q,{align:"right",onClick:le=>le.stopPropagation(),children:e.jsx(zr,{track:$,onTrackUpdate:G})})]},$.id))})]})}),e.jsxs(Qe,{open:v,onClose:()=>j(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(Xe,{children:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Gr,{}),"Edit Smart Playlist Rules"]})}),e.jsxs(Ke,{dividers:!0,children:[e.jsx(h,{sx:{mb:3},children:e.jsxs(jt,{fullWidth:!0,size:"small",children:[e.jsx(zt,{children:"Match Mode"}),e.jsxs(_t,{value:D,onChange:$=>R($.target.value),label:"Match Mode",children:[e.jsx(ve,{value:"all",children:"Match ALL rules (AND)"}),e.jsx(ve,{value:"any",children:"Match ANY rule (OR)"})]})]})}),e.jsx(x,{variant:"subtitle2",sx:{mb:1},children:"Rules"}),A.length===0?e.jsx(ge,{severity:"info",sx:{mb:2},children:"No rules defined. All tracks will be included."}):e.jsx(pt,{variant:"outlined",sx:{p:2,mb:2},children:A.map(($,ie)=>e.jsxs(h,{sx:{display:"flex",gap:1,mb:1,alignItems:"center",flexWrap:"wrap"},children:[e.jsxs(jt,{size:"small",sx:{minWidth:140},children:[e.jsx(zt,{children:"Field"}),e.jsx(_t,{value:$.field,onChange:le=>L(ie,"field",le.target.value),label:"Field",children:w?.fields.map(le=>e.jsx(ve,{value:le.value,children:le.label},le.value))})]}),e.jsxs(jt,{size:"small",sx:{minWidth:160},children:[e.jsx(zt,{children:"Operator"}),e.jsx(_t,{value:$.operator,onChange:le=>L(ie,"operator",le.target.value),label:"Operator",children:w?.operators.filter(le=>ue($.field).includes(le.value)).map(le=>e.jsx(ve,{value:le.value,children:le.label},le.value))})]}),!["is_true","is_false","is_set","is_not_set"].includes($.operator)&&e.jsx(je,{size:"small",label:"Value",value:$.value,onChange:le=>L(ie,"value",le.target.value),sx:{minWidth:120}}),$.operator==="between"&&e.jsx(je,{size:"small",label:"To",value:$.value_2||"",onChange:le=>L(ie,"value_2",le.target.value),sx:{width:80}}),e.jsx(J,{size:"small",onClick:()=>ae(ie),color:"error",children:e.jsx(ad,{})})]},ie))}),e.jsx(q,{startIcon:e.jsx(rr,{}),onClick:T,size:"small",children:"Add Rule"}),e.jsx(De,{sx:{my:3}}),e.jsxs(K,{container:!0,spacing:2,children:[e.jsx(K,{item:!0,xs:12,sm:6,children:e.jsxs(jt,{fullWidth:!0,size:"small",children:[e.jsx(zt,{children:"Order By"}),e.jsx(_t,{value:_,onChange:$=>z($.target.value),label:"Order By",children:w?.order_by_options.map($=>e.jsx(ve,{value:$.value,children:$.label},$.value))})]})}),e.jsx(K,{item:!0,xs:12,sm:6,children:e.jsx(je,{fullWidth:!0,size:"small",label:"Limit (empty = unlimited)",type:"number",value:W,onChange:$=>B($.target.value?parseInt($.target.value):""),InputProps:{inputProps:{min:1}}})})]}),e.jsxs(h,{sx:{mt:3,display:"flex",alignItems:"center",gap:2},children:[e.jsx(q,{variant:"outlined",startIcon:I?e.jsx(Ae,{size:16}):e.jsx(ph,{}),onClick:N,disabled:I,children:"Preview"}),H!==null&&e.jsxs(x,{variant:"body2",color:"text.secondary",children:[H," tracks would match"]})]})]}),e.jsxs(tt,{children:[e.jsx(q,{onClick:()=>j(!1),children:"Cancel"}),e.jsx(q,{onClick:X,variant:"contained",children:"Save Rules"})]})]}),e.jsx(ct,{open:y,autoHideDuration:4e3,onClose:()=>m(!1),children:e.jsx(ge,{severity:"success",onClose:()=>m(!1),children:b})})]}):null}var Jn={},Nl;function j0(){if(Nl)return Jn;Nl=1;var t=te();Object.defineProperty(Jn,"__esModule",{value:!0}),Jn.default=void 0;var r=t(ne()),n=re();return Jn.default=(0,r.default)((0,n.jsx)("path",{d:"M12 1 3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11z"}),"Security"),Jn}var w0=j0();const Ul=ee(w0);var Xn={},Hl;function S0(){if(Hl)return Xn;Hl=1;var t=te();Object.defineProperty(Xn,"__esModule",{value:!0}),Xn.default=void 0;var r=t(ne()),n=re();return Xn.default=(0,r.default)((0,n.jsx)("path",{d:"M12 2C6.49 2 2 6.49 2 12s4.49 10 10 10c1.38 0 2.5-1.12 2.5-2.5 0-.61-.23-1.2-.64-1.67-.08-.1-.13-.21-.13-.33 0-.28.22-.5.5-.5H16c3.31 0 6-2.69 6-6 0-4.96-4.49-9-10-9m5.5 11c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5m-3-4c-.83 0-1.5-.67-1.5-1.5S13.67 6 14.5 6s1.5.67 1.5 1.5S15.33 9 14.5 9M5 11.5c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5S7.33 13 6.5 13 5 12.33 5 11.5m6-4c0 .83-.67 1.5-1.5 1.5S8 8.33 8 7.5 8.67 6 9.5 6s1.5.67 1.5 1.5"}),"Palette"),Xn}var C0=S0();const k0=ee(C0);var Zn={},Vl;function _0(){if(Vl)return Zn;Vl=1;var t=te();Object.defineProperty(Zn,"__esModule",{value:!0}),Zn.default=void 0;var r=t(ne()),n=re();return Zn.default=(0,r.default)((0,n.jsx)("path",{d:"m20.38 8.57-1.23 1.85a8 8 0 0 1-.22 7.58H5.07A8 8 0 0 1 15.58 6.85l1.85-1.23A10 10 0 0 0 3.35 19a2 2 0 0 0 1.72 1h13.85a2 2 0 0 0 1.74-1 10 10 0 0 0-.27-10.44zm-9.79 6.84a2 2 0 0 0 2.83 0l5.66-8.49-8.49 5.66a2 2 0 0 0 0 2.83"}),"Speed"),Zn}var R0=_0();const Yl=ee(R0);var es={},Gl;function I0(){if(Gl)return es;Gl=1;var t=te();Object.defineProperty(es,"__esModule",{value:!0}),es.default=void 0;var r=t(ne()),n=re();return es.default=(0,r.default)((0,n.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore"),es}var A0=I0();const P0=ee(A0);var ts={},Ql;function D0(){if(Ql)return ts;Ql=1;var t=te();Object.defineProperty(ts,"__esModule",{value:!0}),ts.default=void 0;var r=t(ne()),n=re();return ts.default=(0,r.default)((0,n.jsx)("path",{d:"M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3m-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3m0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5m8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5"}),"Group"),ts}var M0=D0();const Kl=ee(M0);var rs={},Jl;function E0(){if(Jl)return rs;Jl=1;var t=te();Object.defineProperty(rs,"__esModule",{value:!0}),rs.default=void 0;var r=t(ne()),n=re();return rs.default=(0,r.default)((0,n.jsx)("path",{d:"M10 20h4V4h-4zm-6 0h4v-8H4zM16 9v11h4V9z"}),"Equalizer"),rs}var T0=E0();const ho=ee(T0);var ns={},Xl;function z0(){if(Xl)return ns;Xl=1;var t=te();Object.defineProperty(ns,"__esModule",{value:!0}),ns.default=void 0;var r=t(ne()),n=re();return ns.default=(0,r.default)((0,n.jsx)("path",{d:"m4 18 8.5-6L4 6zm9-12v12l8.5-6z"}),"FastForward"),ns}var O0=z0();const F0=ee(O0);var ss={},Zl;function L0(){if(Zl)return ss;Zl=1;var t=te();Object.defineProperty(ss,"__esModule",{value:!0}),ss.default=void 0;var r=t(ne()),n=re();return ss.default=(0,r.default)((0,n.jsx)("path",{d:"m19 8-4 4h3c0 3.31-2.69 6-6 6-1.01 0-1.97-.25-2.8-.7l-1.46 1.46C8.97 19.54 10.43 20 12 20c4.42 0 8-3.58 8-8h3zM6 12c0-3.31 2.69-6 6-6 1.01 0 1.97.25 2.8.7l1.46-1.46C15.03 4.46 13.57 4 12 4c-4.42 0-8 3.58-8 8H1l4 4 4-4z"}),"Cached"),ss}var W0=L0();const Du=ee(W0);var as={},ec;function $0(){if(ec)return as;ec=1;var t=te();Object.defineProperty(as,"__esModule",{value:!0}),as.default=void 0;var r=t(ne()),n=re();return as.default=(0,r.default)((0,n.jsx)("path",{d:"M15 16h4v2h-4zm0-8h7v2h-7zm0 4h6v2h-6zM3 18c0 1.1.9 2 2 2h6c1.1 0 2-.9 2-2V8H3zM14 5h-3l-1-1H6L5 5H2v2h12z"}),"DeleteSweep"),as}var B0=$0();const q0=ee(B0),va={fontFamily:'"Roboto", "Helvetica", "Arial", sans-serif',fontSize:13,h1:{fontWeight:600,fontSize:"1.8rem"},h2:{fontWeight:600,fontSize:"1.6rem"},h3:{fontWeight:600,fontSize:"1.4rem"},h4:{fontWeight:600,fontSize:"1.2rem"},h5:{fontWeight:500,fontSize:"1.1rem"},h6:{fontWeight:500,fontSize:"1rem"},body1:{fontSize:"0.875rem"},body2:{fontSize:"0.8125rem"},button:{fontSize:"0.8125rem"},caption:{fontSize:"0.75rem"}},ja={borderRadius:12},wa={MuiButton:{styleOverrides:{root:{textTransform:"none",fontWeight:500,padding:"8px 16px",minHeight:"36px",fontSize:"0.875rem",borderRadius:"9999px",transition:"all 0.3s ease"},sizeSmall:{padding:"6px 12px",minHeight:"32px",fontSize:"0.8125rem"},sizeLarge:{padding:"10px 20px",minHeight:"40px"}}},MuiCard:{styleOverrides:{root:{backgroundImage:"none",borderRadius:"16px",transition:"transform 0.3s ease, box-shadow 0.3s ease","&:hover":{transform:"translateY(-2px)"}}}},MuiCardContent:{styleOverrides:{root:{padding:"12px","&:last-child":{paddingBottom:"12px"}}}},MuiIconButton:{styleOverrides:{root:{padding:"6px"},sizeSmall:{padding:"4px"}}},MuiChip:{styleOverrides:{root:{height:"24px",fontSize:"0.75rem"}}},MuiTableCell:{styleOverrides:{root:{padding:"8px 12px",fontSize:"0.8125rem"},head:{fontWeight:600,fontSize:"0.8125rem"}}},MuiListItem:{styleOverrides:{root:{paddingTop:"4px",paddingBottom:"4px"}}},MuiListItemButton:{styleOverrides:{root:{paddingTop:"6px",paddingBottom:"6px"}}},MuiAlert:{styleOverrides:{root:{padding:"6px 12px",fontSize:"0.8125rem"}}},MuiTextField:{styleOverrides:{root:{"& .MuiInputBase-root":{fontSize:"0.875rem"}}}},MuiAccordionSummary:{styleOverrides:{root:{minHeight:"42px","&.Mui-expanded":{minHeight:"42px"}},content:{margin:"8px 0","&.Mui-expanded":{margin:"8px 0"}}}},MuiAccordionDetails:{styleOverrides:{root:{padding:"8px 16px 16px"}}}},N0=ca({palette:{mode:"dark",primary:{main:"#22d3ee",light:"#67e8f9",dark:"#06b6d4",contrastText:"#ffffff"},secondary:{main:"#fbbf24",light:"#fcd34d",dark:"#f59e0b",contrastText:"#000000"},background:{default:"#0f172a",paper:"#1e293b"},text:{primary:"#f8fafc",secondary:"#94a3b8"},success:{main:"#10b981"},error:{main:"#ef4444"},warning:{main:"#fbbf24"},info:{main:"#22d3ee"}},typography:va,shape:ja,components:wa}),U0=ca({palette:{mode:"dark",primary:{main:"#13ec6a",light:"#4fff92",dark:"#0db855"},secondary:{main:"#00BCD4",light:"#4DD0E1",dark:"#0097A7"},background:{default:"#0D1B2A",paper:"#1B263B"},text:{primary:"#E0F7FA",secondary:"#B3E5FC"},success:{main:"#13ec6a"},error:{main:"#FF5252"},warning:{main:"#FFD740"},info:{main:"#13ec6a"}},typography:va,shape:ja,components:wa}),H0=ca({palette:{mode:"light",primary:{main:"#13ec6a",light:"#4fff92",dark:"#0db855"},secondary:{main:"#13ec6a",light:"#4fff92",dark:"#0db855"},background:{default:"#f6f8f7",paper:"#FFFFFF"},text:{primary:"#0f172a",secondary:"#64748b"},success:{main:"#13ec6a"},error:{main:"#D32F2F"},warning:{main:"#F57C00"},info:{main:"#13ec6a"}},typography:va,shape:ja,components:{...wa,MuiCard:{styleOverrides:{root:{backgroundImage:"none",boxShadow:"0 2px 8px rgba(0,0,0,0.05)"}}}}}),V0=ca({palette:{mode:"dark",primary:{main:"#13ec6a",light:"#4fff92",dark:"#0db855"},secondary:{main:"#13ec6a",light:"#4fff92",dark:"#0db855"},background:{default:"#102217",paper:"#162e21"},text:{primary:"#ffffff",secondary:"rgba(255, 255, 255, 0.6)"},success:{main:"#13ec6a"},error:{main:"#EF5350"},warning:{main:"#FFA726"},info:{main:"#13ec6a"}},typography:va,shape:ja,components:wa}),Y0=ca({palette:{mode:"light",primary:{main:"#06b6d4",light:"#22d3ee",dark:"#0891b2",contrastText:"#ffffff"},secondary:{main:"#0ea5e9",light:"#38bdf8",dark:"#0284c7",contrastText:"#ffffff"},background:{default:"#ecfeff",paper:"#ffffff"},text:{primary:"#0c4a6e",secondary:"#0369a1"},success:{main:"#10b981"},error:{main:"#ef4444"},warning:{main:"#f59e0b"},info:{main:"#06b6d4"}},typography:va,shape:ja,components:wa}),tc={dark:N0,blue:U0,white:H0,green:V0,lightBlue:Y0},rc={dark:"Dark",blue:"Ocean Blue",white:"Light",green:"Forest Green",lightBlue:"Light Blue"},G0=t=>tc[t]||tc.dark,Q0=t=>{localStorage.setItem("themeMode",t)},K0=()=>localStorage.getItem("themeMode")||"dark";var is={},nc;function J0(){if(nc)return is;nc=1;var t=te();Object.defineProperty(is,"__esModule",{value:!0}),is.default=void 0;var r=t(ne()),n=re();return is.default=(0,r.default)((0,n.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8z"}),"CheckCircle"),is}var X0=J0();const oa=ee(X0),Z0={dark:{primary:"#22d3ee",secondary:"#fbbf24",bg1:"#0f172a",bg2:"#1e293b",text:"#f8fafc"},blue:{primary:"#2196F3",secondary:"#00BCD4",bg1:"#0D1B2A",bg2:"#1B263B",text:"#E0F7FA"},white:{primary:"#1976D2",secondary:"#9C27B0",bg1:"#F5F7FA",bg2:"#FFFFFF",text:"#1A202C"},green:{primary:"#4CAF50",secondary:"#00E676",bg1:"#0D1F12",bg2:"#1A2F23",text:"#E8F5E9"},lightBlue:{primary:"#06b6d4",secondary:"#0ea5e9",bg1:"#ecfeff",bg2:"#ffffff",text:"#0c4a6e"}};function ey({name:t,mode:r,isSelected:n,onClick:s}){const a=Z0[r];return e.jsxs(h,{onClick:s,sx:{position:"relative",height:100,borderRadius:2,cursor:"pointer",border:3,borderColor:n?a.primary:"divider",transition:"all 0.3s ease",overflow:"hidden","&:hover":{transform:"scale(1.05)",boxShadow:`0 4px 20px ${a.primary}40`}},children:[e.jsx(h,{sx:{position:"absolute",inset:0,background:`linear-gradient(135deg, ${a.bg1} 0%, ${a.bg2} 100%)`}}),e.jsxs(h,{sx:{position:"absolute",top:8,left:8,right:8,bottom:8,display:"flex",flexDirection:"column",gap:.5},children:[e.jsx(h,{sx:{height:8,borderRadius:.5,bgcolor:a.primary,width:"60%"}}),e.jsx(h,{sx:{height:4,borderRadius:.5,bgcolor:a.text,opacity:.7,width:"80%"}}),e.jsx(h,{sx:{height:4,borderRadius:.5,bgcolor:a.text,opacity:.5,width:"60%"}}),e.jsx(h,{sx:{height:4,borderRadius:.5,bgcolor:a.secondary,opacity:.7,width:"40%",mt:.5}})]}),e.jsxs(h,{sx:{position:"absolute",bottom:4,left:8,right:8,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx(x,{sx:{color:a.text,fontSize:"0.75rem",fontWeight:600,textShadow:r==="white"?"none":"0 1px 2px rgba(0,0,0,0.5)"},children:t}),n&&e.jsx(oa,{sx:{fontSize:16,color:a.primary}})]})]})}const Rr=[{id:"rounded-bars",name:"Rounded Bars ",style:"bars-rounded",colorScheme:"theme",description:"Soft rounded bars with smooth animations (Your favorite!)",preview:{primaryColor:"#7E57C2",secondaryColor:"#5C6BC0"}},{id:"radial-metallic",name:"Radial Metallic ",style:"radial-bars",colorScheme:"theme",description:"Modern radial bars with metallic grey tones and theme accent",preview:{primaryColor:"#8B9DC3",secondaryColor:"#5D6D7E",accentColor:"#ABB2BF"}},{id:"classic-bars",name:"Classic Bars",style:"classic-bars",colorScheme:"rainbow",description:"Traditional frequency spectrum with rainbow-colored vertical bars",preview:{primaryColor:"#FF0000",secondaryColor:"#00FF00",accentColor:"#0000FF"}},{id:"circular-spectrum",name:"Circular Spectrum",style:"circular-spectrum",colorScheme:"neon",description:"Bars arranged in a circle radiating outward",preview:{primaryColor:"#FF00FF",secondaryColor:"#00FFFF",accentColor:"#00FF00"}},{id:"waveform",name:"Waveform",style:"waveform",colorScheme:"ocean",description:"Real-time audio waveform display (oscilloscope style)",preview:{primaryColor:"#00CED1",secondaryColor:"#006994",accentColor:"#40E0D0"}},{id:"symmetric-bars",name:"Symmetric Bars",style:"symmetric-bars",colorScheme:"sunset",description:"Mirrored bars extending from center (top & bottom)",preview:{primaryColor:"#FF6B6B",secondaryColor:"#FFE66D",accentColor:"#FF8E53"}},{id:"particles",name:"Particles",style:"particles",colorScheme:"aurora",description:"Random particles that appear based on audio intensity",preview:{primaryColor:"#00FF87",secondaryColor:"#7B68EE",accentColor:"#FF69B4"}},{id:"frequency-rings",name:"Frequency Rings",style:"frequency-rings",colorScheme:"neon",description:"Concentric circles that grow based on frequency data",preview:{primaryColor:"#FF00FF",secondaryColor:"#00FFFF",accentColor:"#FFFF00"}},{id:"line-spectrum",name:"Line Spectrum",style:"line-spectrum",colorScheme:"purple-blue-green",description:"Smooth line graph with gradient colors (purple  blue  green)",preview:{primaryColor:"#9400D3",secondaryColor:"#0000FF",accentColor:"#00FF00"}},{id:"radial-bars",name:"Radial Bars",style:"radial-bars",colorScheme:"fire",description:"Bars radiating from a central circle outward",preview:{primaryColor:"#FF4500",secondaryColor:"#FFD700",accentColor:"#FF6347"}},{id:"block-grid",name:"Block Grid",style:"block-grid",colorScheme:"rainbow",description:"168 pixel-art style grid like an equalizer LED display",preview:{primaryColor:"#00FF00",secondaryColor:"#FFFF00",accentColor:"#FF0000"}},{id:"spiral",name:"Spiral",style:"spiral",colorScheme:"aurora",description:"Dynamic spiral pattern that expands based on audio",preview:{primaryColor:"#00FF87",secondaryColor:"#FF69B4",accentColor:"#7B68EE"}}],ty={theme:[],rainbow:["#FF0000","#FF7F00","#FFFF00","#00FF00","#0000FF","#4B0082","#9400D3"],fire:["#FFD700","#FFA500","#FF4500","#FF0000","#DC143C"],ocean:["#00CED1","#20B2AA","#006994","#00008B","#191970"],neon:["#FF00FF","#00FFFF","#00FF00","#FF00FF"],sunset:["#FF6B6B","#FFE66D","#FF8E53","#FF6347","#CD5C5C"],aurora:["#00FF87","#7B68EE","#FF69B4","#00BFFF","#98FB98"],monochrome:["#FFFFFF","#CCCCCC","#999999","#666666","#333333"],"purple-blue-green":["#9400D3","#4B0082","#0000FF","#00BFFF","#00FF00"]};function Pa(t,r){const n=parseInt(t.slice(1,3),16),s=parseInt(t.slice(3,5),16),a=parseInt(t.slice(5,7),16);return`rgba(${n}, ${s}, ${a}, ${r})`}function sc(t,r){const n=parseInt(t.slice(1,3),16),s=parseInt(t.slice(3,5),16),a=parseInt(t.slice(5,7),16),i=Math.min(255,Math.round(n+(255-n)*r)),o=Math.min(255,Math.round(s+(255-s)*r)),c=Math.min(255,Math.round(a+(255-a)*r));return`#${i.toString(16).padStart(2,"0")}${o.toString(16).padStart(2,"0")}${c.toString(16).padStart(2,"0")}`}function Da(t,r){const n=parseInt(t.slice(1,3),16),s=parseInt(t.slice(3,5),16),a=parseInt(t.slice(5,7),16),i=Math.max(0,Math.round(n*(1-r))),o=Math.max(0,Math.round(s*(1-r))),c=Math.max(0,Math.round(a*(1-r)));return`#${i.toString(16).padStart(2,"0")}${o.toString(16).padStart(2,"0")}${c.toString(16).padStart(2,"0")}`}function ry(t,r=!1,n){const s=Tu(t);let a,i;s.colorScheme==="theme"&&n?(a=n,i=Da(n,.2),console.log("[Lyrics] Using MUI theme color:",n,"for theme:",t)):(a=s.preview.primaryColor,i=s.preview.secondaryColor,console.log("[Lyrics] Using visualizer theme colors:",a,"for theme:",t,"colorScheme:",s.colorScheme));let o=s.preview.accentColor||sc(a,.3);r&&(a=Da(a,.2),i=Da(i,.2),o=Da(o,.2));const c=r?a:sc(a,.15);return{primary:a,secondary:i,gradientStart:c,gradientMid:o,gradientEnd:i,glow:r?Pa(a,.4):Pa(a,.6),background:Pa(a,r?.15:.2),backgroundHover:Pa(a,r?.22:.3),hoverBackground:r?"rgba(0, 0, 0, 0.06)":"rgba(255, 255, 255, 0.08)",textColor:r?"rgba(0, 0, 0, 0.55)":"rgba(255, 255, 255, 0.45)",pastTextColor:r?"rgba(0, 0, 0, 0.3)":"rgba(255, 255, 255, 0.25)",upcomingTextColor:r?"rgba(0, 0, 0, 0.8)":"rgba(255, 255, 255, 0.75)"}}function Mu(t,r,n){if(t==="theme"&&n)return Array(r).fill(n);const s=ty[t];return s.length?Array.from({length:r},(a,i)=>{const o=i/(r-1),c=Math.floor(o*(s.length-1)),f=Math.min(c+1,s.length-1),d=o*(s.length-1)-c;return ny(s[c],s[f],d)}):Array(r).fill(n||"#5C6BC0")}function ny(t,r,n){const s=parseInt(t.slice(1,3),16),a=parseInt(t.slice(3,5),16),i=parseInt(t.slice(5,7),16),o=parseInt(r.slice(1,3),16),c=parseInt(r.slice(3,5),16),f=parseInt(r.slice(5,7),16),d=Math.round(s+(o-s)*n),u=Math.round(a+(c-a)*n),p=Math.round(i+(f-i)*n);return`#${d.toString(16).padStart(2,"0")}${u.toString(16).padStart(2,"0")}${p.toString(16).padStart(2,"0")}`}const Eu="rounded-bars";function Tu(t){return Rr.find(r=>r.id===t)||Rr[0]}function sy({theme:t,isSelected:r,onClick:n}){const s=Ot(),[a,i]=l.useState(Array(8).fill(.3));l.useEffect(()=>{const f=setInterval(()=>{i(Array.from({length:8},()=>.2+Math.random()*.8))},200);return()=>clearInterval(f)},[]);const o=l.useMemo(()=>Mu(t.colorScheme,8,s.palette.primary.main),[t.colorScheme,s.palette.primary.main]),c=()=>{switch(t.style){case"bars-rounded":return e.jsx(h,{sx:{display:"flex",alignItems:"flex-end",height:"100%",gap:"2px",p:.5},children:a.map((d,u)=>e.jsx(h,{sx:{flex:1,height:`${d*100}%`,bgcolor:o[u],borderRadius:"4px",transition:"height 0.15s ease",opacity:.8}},u))});case"classic-bars":return e.jsx(h,{sx:{display:"flex",alignItems:"flex-end",height:"100%",gap:"2px",p:.5},children:a.map((d,u)=>e.jsx(h,{sx:{flex:1,height:`${d*100}%`,bgcolor:o[u],borderRadius:"2px 2px 0 0",transition:"height 0.15s ease",opacity:.9}},u))});case"circular-spectrum":return e.jsx(h,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:e.jsxs("svg",{width:"50",height:"50",viewBox:"0 0 50 50",children:[a.map((d,u)=>{const p=u/a.length*Math.PI*2-Math.PI/2,g=8+d*12,y=25+Math.cos(p)*8,m=25+Math.sin(p)*8,b=25+Math.cos(p)*(8+g),S=25+Math.sin(p)*(8+g);return e.jsx("line",{x1:y,y1:m,x2:b,y2:S,stroke:o[u],strokeWidth:"3",strokeLinecap:"round",style:{transition:"all 0.15s ease"}},u)}),e.jsx("circle",{cx:"25",cy:"25",r:"6",fill:o[0],opacity:"0.4"})]})});case"waveform":return e.jsx(h,{sx:{position:"relative",height:"100%",overflow:"hidden"},children:e.jsxs("svg",{width:"100%",height:"100%",viewBox:"0 0 100 40",preserveAspectRatio:"none",children:[e.jsx("defs",{children:e.jsx("linearGradient",{id:`waveform-gradient-${t.id}`,x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:o.map((d,u)=>e.jsx("stop",{offset:`${u/(o.length-1)*100}%`,stopColor:d},u))})}),e.jsx("path",{d:`M 0 20 ${a.map((d,u)=>`Q ${(u+.5)*(100/a.length)} ${20+(d-.5)*25} ${(u+1)*(100/a.length)} 20`).join(" ")}`,fill:"none",stroke:`url(#waveform-gradient-${t.id})`,strokeWidth:"2"})]})});case"symmetric-bars":return e.jsx(h,{sx:{display:"flex",alignItems:"center",height:"100%",gap:"2px",p:.5},children:a.map((d,u)=>e.jsx(h,{sx:{flex:1,height:`${d*80}%`,bgcolor:o[u],borderRadius:"2px",transition:"height 0.15s ease",opacity:.8}},u))});case"particles":return e.jsx(h,{sx:{position:"relative",height:"100%",overflow:"hidden"},children:a.map((d,u)=>e.jsx(h,{sx:{position:"absolute",width:4+d*6,height:4+d*6,bgcolor:o[u],borderRadius:"50%",left:`${u/a.length*100}%`,bottom:`${d*60}%`,transition:"all 0.15s ease",opacity:.8,boxShadow:`0 0 ${d*10}px ${o[u]}`}},u))});case"frequency-rings":return e.jsx(h,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:e.jsx("svg",{width:"50",height:"50",viewBox:"0 0 50 50",children:a.slice(0,4).map((d,u)=>{const p=(u+1)*5*(.8+d*.4);return e.jsx("circle",{cx:"25",cy:"25",r:p,fill:"none",stroke:o[u*2],strokeWidth:"2",opacity:.5+d*.5,style:{transition:"all 0.15s ease"}},u)})})});case"line-spectrum":return e.jsx(h,{sx:{position:"relative",height:"100%",overflow:"hidden"},children:e.jsxs("svg",{width:"100%",height:"100%",viewBox:"0 0 100 40",preserveAspectRatio:"none",children:[e.jsx("defs",{children:e.jsx("linearGradient",{id:`line-gradient-${t.id}`,x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:o.map((d,u)=>e.jsx("stop",{offset:`${u/(o.length-1)*100}%`,stopColor:d},u))})}),e.jsx("path",{d:`M 0 ${40-a[0]*35} ${a.map((d,u)=>`L ${(u+1)*(100/a.length)} ${40-d*35}`).join(" ")}`,fill:"none",stroke:`url(#line-gradient-${t.id})`,strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"})]})});case"radial-bars":return e.jsx(h,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:e.jsxs("svg",{width:"50",height:"50",viewBox:"0 0 50 50",children:[Array.from({length:16}).map((d,u)=>{const p=u%a.length,g=a[p],y=u/16*Math.PI*2-Math.PI/2,m=5+g*12,b=25+Math.cos(y)*6,S=25+Math.sin(y)*6,v=25+Math.cos(y)*(6+m),j=25+Math.sin(y)*(6+m);return e.jsx("line",{x1:b,y1:S,x2:v,y2:j,stroke:o[p],strokeWidth:"2",strokeLinecap:"round",style:{transition:"all 0.15s ease"}},u)}),e.jsx("circle",{cx:"25",cy:"25",r:"5",fill:o[0],opacity:"0.5"})]})});case"block-grid":return e.jsx(h,{sx:{display:"flex",alignItems:"flex-end",height:"100%",gap:"1px",p:.5},children:a.map((d,u)=>{const p=Math.floor(d*4);return e.jsx(h,{sx:{flex:1,display:"flex",flexDirection:"column-reverse",gap:"1px"},children:Array.from({length:4}).map((g,y)=>{const m=y<p,b=y<2?"#00FF00":y<3?"#FFFF00":"#FF0000";return e.jsx(h,{sx:{height:8,bgcolor:m?b:"#333",opacity:m?.9:.3,borderRadius:"1px",transition:"all 0.1s ease"}},y)})},u)})});case"spiral":const f=a.reduce((d,u)=>d+u,0)/a.length;return e.jsx(h,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:e.jsxs("svg",{width:"50",height:"50",viewBox:"0 0 50 50",children:[e.jsx("defs",{children:e.jsx("linearGradient",{id:`spiral-gradient-${t.id}`,x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:o.map((d,u)=>e.jsx("stop",{offset:`${u/(o.length-1)*100}%`,stopColor:d},u))})}),e.jsx("path",{d:`M 25 25 ${Array.from({length:50}).map((d,u)=>{const p=u/50,g=p*6*Math.PI,y=p*20*(.8+f*.4),m=25+Math.cos(g)*y,b=25+Math.sin(g)*y;return`L ${m} ${b}`}).join(" ")}`,fill:"none",stroke:`url(#spiral-gradient-${t.id})`,strokeWidth:"2",strokeLinecap:"round"}),e.jsx("circle",{cx:"25",cy:"25",r:3+f*3,fill:o[0],opacity:"0.8"})]})});default:return e.jsx(h,{sx:{display:"flex",alignItems:"flex-end",height:"100%",gap:"2px",p:.5},children:a.map((d,u)=>e.jsx(h,{sx:{flex:1,height:`${d*100}%`,bgcolor:o[u],borderRadius:"4px",transition:"height 0.15s ease",opacity:.8}},u))})}};return e.jsxs(h,{onClick:n,sx:{width:"100%",cursor:"pointer",borderRadius:2,overflow:"hidden",border:"2px solid",borderColor:r?"primary.main":"transparent",bgcolor:"background.default",transition:"all 0.2s ease",position:"relative","&:hover":{borderColor:r?"primary.main":"action.hover",transform:"scale(1.02)"}},children:[r&&e.jsx(oa,{sx:{position:"absolute",top:4,right:4,zIndex:2,color:"primary.main",fontSize:18,bgcolor:"background.paper",borderRadius:"50%"}}),e.jsx(h,{sx:{height:60,bgcolor:"rgba(0, 0, 0, 0.3)",position:"relative"},children:c()}),e.jsx(h,{sx:{p:1,textAlign:"center"},children:e.jsx(x,{variant:"caption",sx:{fontWeight:r?600:400,color:r?"primary.main":"text.secondary",display:"block",lineHeight:1.2},children:t.name})})]})}const zu=l.createContext(void 0),ay=()=>{const t=l.useContext(zu);if(!t)throw new Error("useQuickSync must be used within QuickSyncProvider");return t},iy=({children:t})=>{const[r,n]=l.useState(null),[s,a]=l.useState(null),[i,o]=l.useState(!0),c=async()=>{try{const p=await U.get("/audio/quick-sync/status/");n(p.data.status),a(p.data.preferences)}catch(p){p?.response?.status===401||p?.response?.status===403?(n(null),a(null)):console.error("Error fetching Quick Sync status:",p)}finally{o(!1)}},f=async p=>{try{const g=await U.post("/audio/quick-sync/preferences/",p);a(g.data.preferences),n(g.data.status)}catch(g){throw console.error("Error updating Quick Sync preferences:",g),g}},d=async()=>{try{o(!0);const p=await U.post("/audio/quick-sync/test/");await c()}catch(p){throw console.error("Error running speed test:",p),p}finally{o(!1)}},u=async()=>{o(!0),await c()};return l.useEffect(()=>{if(!localStorage.getItem("token")){o(!1);return}c();const g=setInterval(c,300*1e3);return()=>clearInterval(g)},[]),e.jsx(zu.Provider,{value:{status:r,preferences:s,loading:i,updatePreferences:f,runSpeedTest:d,refreshStatus:u},children:t})},oy=()=>{const{status:t,preferences:r,loading:n,updatePreferences:s,runSpeedTest:a,refreshStatus:i}=ay(),[o,c]=l.useState(!1),[f,d]=l.useState(null),u=async m=>{try{await s({mode:m}),d({type:"success",text:"Quality mode updated successfully"}),setTimeout(()=>d(null),3e3)}catch{d({type:"error",text:"Failed to update quality mode"})}},p=async(m,b)=>{try{await s({[m]:b}),d({type:"success",text:"Preferences updated successfully"}),setTimeout(()=>d(null),3e3)}catch{d({type:"error",text:"Failed to update preferences"})}},g=async()=>{c(!0);try{await a(),d({type:"success",text:"Speed test completed"}),setTimeout(()=>d(null),3e3)}catch{d({type:"error",text:"Speed test failed"})}finally{c(!1)}},y=m=>{switch(m){case"excellent":return e.jsx(Mr,{color:"success"});case"good":return e.jsx(Mr,{color:"primary"});case"fair":return e.jsx(gh,{color:"warning"});case"poor":return e.jsx(ld,{color:"error"});default:return e.jsx(Yr,{})}};return n?e.jsx(h,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsx(Ae,{})}):e.jsxs(h,{children:[e.jsxs(h,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsx(x,{variant:"subtitle1",fontWeight:600,children:"Quick Sync - Adaptive Streaming"}),e.jsx(J,{size:"small",onClick:i,disabled:n,children:e.jsx($r,{})})]}),f&&e.jsx(ge,{severity:f.type,sx:{mb:2},onClose:()=>d(null),children:f.text}),e.jsxs(pt,{sx:{p:2,mb:2},children:[e.jsx(x,{variant:"body2",gutterBottom:!0,fontWeight:"bold",mb:1.5,children:"Current Status"}),t&&e.jsxs(K,{container:!0,spacing:2,children:[e.jsxs(K,{item:!0,xs:12,md:4,children:[e.jsxs(h,{display:"flex",alignItems:"center",mb:1,children:[e.jsx(bo,{sx:{mr:.5,fontSize:"1.1rem"}}),e.jsx(x,{variant:"caption",fontWeight:"bold",children:"Network Speed"}),e.jsx(h,{ml:"auto",children:y(t.network.status)})]}),e.jsxs(x,{variant:"h6",color:"primary",mb:.75,children:[t.network.speed_mbps.toFixed(2)," Mbps"]}),e.jsx(de,{label:t.network.status.toUpperCase(),size:"small",color:t.network.status==="excellent"||t.network.status==="good"?"success":t.network.status==="fair"?"warning":"error"})]}),e.jsxs(K,{item:!0,xs:12,md:4,children:[e.jsxs(h,{display:"flex",alignItems:"center",mb:1,children:[e.jsx(mh,{sx:{mr:.5,fontSize:"1.1rem"}}),e.jsx(x,{variant:"caption",fontWeight:"bold",children:"System Resources"})]}),e.jsxs(h,{mb:1.5,children:[e.jsxs(h,{display:"flex",justifyContent:"space-between",mb:.5,children:[e.jsx(x,{variant:"caption",children:"CPU Usage"}),e.jsxs(x,{variant:"caption",children:[t.system.cpu_percent.toFixed(0),"%"]})]}),e.jsx(rt,{variant:"determinate",value:t.system.cpu_percent,color:t.system.cpu_percent>80?"error":"primary"})]}),e.jsxs(h,{children:[e.jsxs(h,{display:"flex",justifyContent:"space-between",mb:.5,children:[e.jsx(x,{variant:"caption",children:"Memory Usage"}),e.jsxs(x,{variant:"caption",children:[t.system.memory_percent.toFixed(0),"%"]})]}),e.jsx(rt,{variant:"determinate",value:t.system.memory_percent,color:t.system.memory_percent>85?"error":"primary"})]})]}),e.jsxs(K,{item:!0,xs:12,md:4,children:[e.jsxs(h,{display:"flex",alignItems:"center",mb:1,children:[e.jsx(Qa,{sx:{mr:.5,fontSize:"1.1rem"}}),e.jsx(x,{variant:"caption",fontWeight:"bold",children:"Active Quality"})]}),e.jsx(x,{variant:"h6",color:"primary",mb:.75,children:t.quality.level.toUpperCase()}),e.jsxs(x,{variant:"body2",color:"text.secondary",mb:1,children:[t.quality.bitrate," kbps"]}),t.quality.auto_selected&&e.jsx(de,{label:"Auto-Selected",size:"small",color:"info"})]})]}),e.jsx(h,{mt:3,children:e.jsx(q,{variant:"outlined",startIcon:o?e.jsx(Ae,{size:20}):e.jsx(bo,{}),onClick:g,disabled:o,fullWidth:!0,children:o?"Testing Connection...":"Run Speed Test"})})]}),e.jsxs(pt,{sx:{p:3,mb:3},children:[e.jsx(x,{variant:"subtitle1",gutterBottom:!0,fontWeight:"bold",children:"Quality Settings"}),e.jsxs(jt,{fullWidth:!0,sx:{mb:3},children:[e.jsx(zt,{children:"Quality Mode"}),e.jsxs(_t,{value:r?.mode||"auto",onChange:m=>u(m.target.value),label:"Quality Mode",children:[e.jsx(ve,{value:"auto",children:e.jsxs(h,{children:[e.jsx(x,{children:"Auto (Recommended)"}),e.jsx(x,{variant:"caption",color:"text.secondary",children:"Adapts to your connection and system"})]})}),e.jsx(ve,{value:"ultra",children:e.jsxs(h,{children:[e.jsx(x,{children:"Ultra (320 kbps)"}),e.jsx(x,{variant:"caption",color:"text.secondary",children:"Maximum fidelity - requires 5+ Mbps"})]})}),e.jsx(ve,{value:"high",children:e.jsxs(h,{children:[e.jsx(x,{children:"High (256 kbps)"}),e.jsx(x,{variant:"caption",color:"text.secondary",children:"Best experience - requires 2+ Mbps"})]})}),e.jsx(ve,{value:"medium",children:e.jsxs(h,{children:[e.jsx(x,{children:"Medium (128 kbps)"}),e.jsx(x,{variant:"caption",color:"text.secondary",children:"Balanced - requires 1+ Mbps"})]})}),e.jsx(ve,{value:"low",children:e.jsxs(h,{children:[e.jsx(x,{children:"Low (64 kbps)"}),e.jsx(x,{variant:"caption",color:"text.secondary",children:"Saves bandwidth - requires 0.5+ Mbps"})]})})]})]}),e.jsx($e,{control:e.jsx(et,{checked:r?.prefer_quality||!1,onChange:m=>p("prefer_quality",m.target.checked)}),label:e.jsxs(h,{display:"flex",alignItems:"center",children:[e.jsx(x,{children:"Prefer Higher Quality"}),e.jsx(be,{title:"When system resources allow, automatically upgrade to higher quality",children:e.jsx(Yr,{fontSize:"small",sx:{ml:1,color:"text.secondary"}})})]})}),e.jsx($e,{control:e.jsx(et,{checked:r?.adapt_to_system||!1,onChange:m=>p("adapt_to_system",m.target.checked)}),label:e.jsxs(h,{display:"flex",alignItems:"center",children:[e.jsx(x,{children:"Adapt to System Load"}),e.jsx(be,{title:"Automatically adjust quality based on CPU and memory usage",children:e.jsx(Yr,{fontSize:"small",sx:{ml:1,color:"text.secondary"}})})]})}),e.jsx($e,{control:e.jsx(et,{checked:r?.auto_download_quality||!1,onChange:m=>p("auto_download_quality",m.target.checked)}),label:e.jsxs(h,{display:"flex",alignItems:"center",children:[e.jsx(x,{children:"Apply to Downloads"}),e.jsx(be,{title:"Use Quick Sync quality settings when downloading audio",children:e.jsx(Yr,{fontSize:"small",sx:{ml:1,color:"text.secondary"}})})]})})]}),t&&e.jsxs(pt,{sx:{p:3},children:[e.jsx(x,{variant:"subtitle1",gutterBottom:!0,fontWeight:"bold",children:"Buffer Settings"}),e.jsxs(K,{container:!0,spacing:2,children:[e.jsxs(K,{item:!0,xs:6,children:[e.jsx(x,{variant:"body2",color:"text.secondary",children:"Buffer Size"}),e.jsxs(x,{variant:"h6",children:[t.buffer.buffer_size,"s"]})]}),e.jsxs(K,{item:!0,xs:6,children:[e.jsx(x,{variant:"body2",color:"text.secondary",children:"Max Buffer"}),e.jsxs(x,{variant:"h6",children:[t.buffer.max_buffer_size,"s"]})]}),e.jsxs(K,{item:!0,xs:6,children:[e.jsx(x,{variant:"body2",color:"text.secondary",children:"Preload"}),e.jsx(x,{variant:"h6",children:t.buffer.preload})]}),e.jsxs(K,{item:!0,xs:6,children:[e.jsx(x,{variant:"body2",color:"text.secondary",children:"Rebuffer Threshold"}),e.jsxs(x,{variant:"h6",children:[t.buffer.rebuffer_threshold.toFixed(1),"s"]})]})]})]})]})},ly=()=>{const{isOnline:t,canInstall:r,isInstalled:n,isUpdateAvailable:s,cacheSize:a,showInstallPrompt:i,updateApp:o,clearCache:c,requestNotifications:f}=ba(),[d,u]=Ee.useState("Notification"in window&&Notification.permission==="granted"),[p,g]=Ee.useState(!1),[y,m]=Ee.useState(null),b=async()=>{const A=await i();m(A?{message:"App installed successfully!",severity:"success"}:{message:"Installation cancelled or not available",severity:"info"})},S=async()=>{await o()},v=async()=>{g(!0);try{const A=await c();m(A?{message:"Cache cleared successfully",severity:"success"}:{message:"Failed to clear cache",severity:"error"})}catch{m({message:"Error clearing cache",severity:"error"})}finally{g(!1)}},j=async()=>{if(!d){const A=await f();u(A==="granted"),m(A==="granted"?{message:"Notifications enabled",severity:"success"}:{message:"Notifications permission denied",severity:"error"})}},w=A=>{if(A===0)return"0 Bytes";const P=1024,D=["Bytes","KB","MB","GB"],R=Math.floor(Math.log(A)/Math.log(P));return Math.round(A/Math.pow(P,R)*100)/100+" "+D[R]},C=a?Math.round(a.usage/a.quota*100):0;return e.jsx(Ce,{children:e.jsxs(Ie,{children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1,mb:1.5},children:[e.jsx(vr,{color:"primary",sx:{fontSize:"1.25rem"}}),e.jsx(x,{variant:"subtitle1",fontWeight:600,children:"Progressive Web App (PWA)"})]}),y&&e.jsx(ge,{severity:y.severity,onClose:()=>m(null),sx:{mb:1.5},children:y.message}),e.jsxs(h,{sx:{mb:2},children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:.75},children:[e.jsx(x,{variant:"subtitle2",color:"textSecondary",children:"Connection Status"}),e.jsx(de,{icon:t?e.jsx(Xs,{}):e.jsx(jr,{}),label:t?"Online":"Offline",color:t?"success":"warning",size:"small"})]}),!t&&e.jsx(ge,{severity:"info",icon:e.jsx(Yr,{}),sx:{mt:1},children:"You're working offline. Cached content is still available."})]}),e.jsx(De,{sx:{my:2}}),e.jsxs(h,{sx:{mb:2},children:[e.jsx(x,{variant:"caption",color:"textSecondary",gutterBottom:!0,display:"block",fontWeight:600,children:"Installation"}),n?e.jsx(ge,{severity:"success",icon:e.jsx(Oi,{}),children:"App is installed and ready to use"}):r?e.jsxs(h,{children:[e.jsx(x,{variant:"caption",color:"textSecondary",sx:{mb:.75,display:"block"},children:"Install SoundWave for:"}),e.jsxs(Ge,{dense:!0,sx:{py:0},children:[e.jsx(Oe,{sx:{py:.25},children:e.jsx(Se,{primary:e.jsx(x,{variant:"caption",children:" Faster startup and better performance"})})}),e.jsx(Oe,{sx:{py:.25},children:e.jsx(Se,{primary:e.jsx(x,{variant:"caption",children:" Offline access to cached content"})})}),e.jsx(Oe,{sx:{py:.25},children:e.jsx(Se,{primary:e.jsx(x,{variant:"caption",children:" Native app-like experience"})})}),e.jsx(Oe,{sx:{py:.25},children:e.jsx(Se,{primary:e.jsx(x,{variant:"caption",children:" Desktop shortcut access"})})})]}),e.jsx(q,{variant:"contained",size:"small",startIcon:e.jsx(Oi,{}),onClick:b,fullWidth:!0,children:"Install App"})]}):e.jsx(ge,{severity:"info",children:"Installation not available. You may already be using the installed app or your browser doesn't support PWA installation."})]}),e.jsx(De,{sx:{my:2}}),s&&e.jsxs(e.Fragment,{children:[e.jsx(h,{sx:{mb:3},children:e.jsx(ge,{severity:"info",icon:e.jsx(cd,{}),action:e.jsx(q,{color:"inherit",size:"small",onClick:S,children:"Update"}),children:"New version available! Update now to get the latest features."})}),e.jsx(De,{sx:{my:2}})]}),e.jsxs(h,{sx:{mb:3},children:[e.jsx(x,{variant:"subtitle2",color:"textSecondary",gutterBottom:!0,children:"Cache Storage"}),a&&e.jsxs(e.Fragment,{children:[e.jsxs(h,{sx:{mb:2},children:[e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsxs(x,{variant:"body2",color:"textSecondary",children:[w(a.usage)," / ",w(a.quota)]}),e.jsxs(x,{variant:"body2",color:"textSecondary",children:[C,"%"]})]}),e.jsx(rt,{variant:"determinate",value:Math.min(C,100),sx:{height:8,borderRadius:1}})]}),e.jsx(x,{variant:"caption",color:"textSecondary",display:"block",sx:{mb:2},children:"Cached data allows offline access to previously viewed content and improves loading times."})]}),e.jsx(q,{variant:"outlined",startIcon:e.jsx(td,{}),onClick:v,disabled:p,fullWidth:!0,children:p?"Clearing Cache...":"Clear Cache"})]}),e.jsx(De,{sx:{my:2}}),e.jsxs(h,{children:[e.jsx(x,{variant:"subtitle2",color:"textSecondary",gutterBottom:!0,children:"Notifications"}),e.jsx($e,{control:e.jsx(et,{checked:d,onChange:j,disabled:d}),label:e.jsxs(h,{children:[e.jsx(x,{variant:"body2",children:"Enable push notifications"}),e.jsx(x,{variant:"caption",color:"textSecondary",children:"Get notified about downloads, updates, and more"})]})})]}),e.jsx(De,{sx:{my:2}}),e.jsxs(h,{children:[e.jsx(x,{variant:"subtitle2",color:"textSecondary",gutterBottom:!0,children:"PWA Features"}),e.jsxs(Ge,{dense:!0,children:[e.jsxs(Oe,{children:[e.jsx(Se,{primary:"Offline Mode",secondary:"Access cached content without internet"}),e.jsx(Ir,{children:e.jsx(de,{label:"Active",color:"success",size:"small"})})]}),e.jsxs(Oe,{children:[e.jsx(Se,{primary:"Background Sync",secondary:"Sync data when connection is restored"}),e.jsx(Ir,{children:e.jsx(de,{label:"Active",color:"success",size:"small"})})]}),e.jsxs(Oe,{children:[e.jsx(Se,{primary:"Audio Caching",secondary:"Cache audio files for offline playback"}),e.jsx(Ir,{children:e.jsx(de,{label:"Active",color:"success",size:"small"})})]})]})]})]})})};var os={},ac;function cy(){if(ac)return os;ac=1;var t=te();Object.defineProperty(os,"__esModule",{value:!0}),os.default=void 0;var r=t(ne()),n=re();return os.default=(0,r.default)((0,n.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 4c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6m0 14c-2.03 0-4.43-.82-6.14-2.88C7.55 15.8 9.68 15 12 15s4.45.8 6.14 2.12C16.43 19.18 14.03 20 12 20"}),"AccountCircle"),os}var dy=cy();const ic=ee(dy);var ls={},oc;function uy(){if(oc)return ls;oc=1;var t=te();Object.defineProperty(ls,"__esModule",{value:!0}),ls.default=void 0;var r=t(ne()),n=re();return ls.default=(0,r.default)((0,n.jsx)("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2m-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2m3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1z"}),"Lock"),ls}var hy=uy();const fy=ee(hy);function xy(){const[t,r]=l.useState(null),[n,s]=l.useState(!1),[a,i]=l.useState(""),[o,c]=l.useState(""),[f,d]=l.useState(""),[u,p]=l.useState(""),[g,y]=l.useState(""),[m,b]=l.useState(""),[S,v]=l.useState(""),[j,w]=l.useState(""),[C,A]=l.useState("");l.useEffect(()=>{localStorage.getItem("token")&&P()},[]);const P=async()=>{const _=localStorage.getItem("token");if(_)try{const z=await Ne.get("/api/user/account/",{headers:{Authorization:`Token ${_}`}});r(z.data),d(z.data.username),p(z.data.first_name||""),y(z.data.last_name||""),b(z.data.email)}catch{i("Failed to load user data")}},D=async()=>{const _=f!==t?.username,z=u!==(t?.first_name||""),W=g!==(t?.last_name||""),B=m!==t?.email;if(!_&&!z&&!W&&!B){i("No changes detected");return}if((_||B)&&!S){i("Current password required to change username or email");return}if(_){if(f.length<3){i("Username must be at least 3 characters long");return}if(!/^[a-zA-Z0-9_]+$/.test(f)){i("Username can only contain letters, numbers, and underscores");return}}s(!0),i(""),c("");try{const H={};_&&(H.username=f),z&&(H.first_name=u),W&&(H.last_name=g),B&&(H.email=m),(_||B)&&S.trim()&&(H.current_password=S);const se=await Ne.patch("/api/user/profile/",H,{headers:{Authorization:`Token ${localStorage.getItem("token")}`,"Content-Type":"application/json"}});se.data.user&&(r(se.data.user),d(se.data.user.username),p(se.data.user.first_name||""),y(se.data.user.last_name||""),b(se.data.user.email)),c("Profile updated successfully!"),v(""),setTimeout(()=>c(""),3e3)}catch(H){i(H.response?.data?.error||"Failed to update profile")}finally{s(!1)}},R=async()=>{if(!S||!j||!C){i("Please fill in all password fields");return}if(j!==C){i("New passwords do not match");return}if(j.length<8){i("Password must be at least 8 characters long");return}s(!0),i(""),c("");try{await Ne.post("/api/user/change-password/",{current_password:S,new_password:j},{headers:{Authorization:`Token ${localStorage.getItem("token")}`,"Content-Type":"application/json"}}),c("Password changed successfully!"),v(""),w(""),A(""),setTimeout(()=>c(""),3e3)}catch(_){i(_.response?.data?.error||"Failed to change password")}finally{s(!1)}};return e.jsxs(pt,{sx:{p:3},children:[e.jsxs(h,{display:"flex",alignItems:"center",mb:3,children:[e.jsx(ic,{sx:{mr:1,fontSize:32,color:"primary.main"}}),e.jsx(x,{variant:"h6",children:"Profile Information"})]}),a&&e.jsx(ge,{severity:"error",sx:{mb:2},onClose:()=>i(""),children:a}),o&&e.jsx(ge,{severity:"success",sx:{mb:2},onClose:()=>c(""),children:o}),t&&e.jsxs(e.Fragment,{children:[e.jsxs(K,{container:!0,spacing:2,sx:{mb:3},children:[e.jsxs(K,{item:!0,xs:12,sm:6,children:[e.jsx(x,{variant:"subtitle2",color:"text.secondary",children:"Username"}),e.jsx(x,{variant:"body1",fontWeight:600,children:t.username})]}),e.jsxs(K,{item:!0,xs:12,sm:6,children:[e.jsx(x,{variant:"subtitle2",color:"text.secondary",children:"Member Since"}),e.jsx(x,{variant:"body1",children:new Date(t.date_joined).toLocaleDateString()})]}),e.jsxs(K,{item:!0,xs:12,sm:6,children:[e.jsx(x,{variant:"subtitle2",color:"text.secondary",children:"Storage"}),e.jsxs(x,{variant:"body1",children:[(t.storage_used_gb||0).toFixed(2)," / ",t.storage_quota_gb||0," GB"]})]}),e.jsxs(K,{item:!0,xs:12,sm:6,children:[e.jsx(x,{variant:"subtitle2",color:"text.secondary",children:"Limits"}),e.jsxs(x,{variant:"body1",children:[t.max_channels||0," channels, ",t.max_playlists||0," playlists"]})]})]}),e.jsx(De,{sx:{my:3}}),e.jsxs(h,{mb:3,children:[e.jsxs(h,{display:"flex",alignItems:"center",mb:2,children:[e.jsx(ic,{sx:{mr:1,color:"primary.main"}}),e.jsx(x,{variant:"h6",children:"Update Profile"})]}),e.jsxs(K,{container:!0,spacing:2,children:[e.jsx(K,{item:!0,xs:12,children:e.jsx(je,{label:"Username (Login ID)",value:f,onChange:_=>d(_.target.value),fullWidth:!0,helperText:"Used for login - requires password to change"})}),e.jsx(K,{item:!0,xs:12,sm:6,children:e.jsx(je,{label:"First Name",value:u,onChange:_=>p(_.target.value),fullWidth:!0})}),e.jsx(K,{item:!0,xs:12,sm:6,children:e.jsx(je,{label:"Last Name",value:g,onChange:_=>y(_.target.value),fullWidth:!0})}),e.jsx(K,{item:!0,xs:12,children:e.jsx(je,{label:"Email Address",type:"email",value:m,onChange:_=>b(_.target.value),fullWidth:!0})}),e.jsx(K,{item:!0,xs:12,children:e.jsx(je,{label:"Current Password",type:"password",value:S,onChange:_=>v(_.target.value),fullWidth:!0,helperText:"Required for username or email changes"})}),e.jsx(K,{item:!0,xs:12,children:e.jsx(q,{variant:"contained",onClick:D,disabled:n,fullWidth:!0,children:"Update Profile"})})]})]}),e.jsx(De,{sx:{my:3}}),e.jsxs(h,{children:[e.jsxs(h,{display:"flex",alignItems:"center",mb:2,children:[e.jsx(fy,{sx:{mr:1,color:"primary.main"}}),e.jsx(x,{variant:"h6",children:"Change Password"})]}),e.jsxs(K,{container:!0,spacing:2,children:[e.jsx(K,{item:!0,xs:12,children:e.jsx(je,{label:"Current Password",type:"password",value:S,onChange:_=>v(_.target.value),fullWidth:!0})}),e.jsx(K,{item:!0,xs:12,children:e.jsx(je,{label:"New Password",type:"password",value:j,onChange:_=>w(_.target.value),fullWidth:!0,helperText:"Minimum 8 characters"})}),e.jsx(K,{item:!0,xs:12,children:e.jsx(je,{label:"Confirm New Password",type:"password",value:C,onChange:_=>A(_.target.value),fullWidth:!0})}),e.jsx(K,{item:!0,xs:12,children:e.jsx(q,{variant:"contained",onClick:R,disabled:n,fullWidth:!0,children:"Change Password"})})]})]})]})]})}function py(){const t=At(),{themeMode:r,setThemeMode:n}=Iv(),{settings:s,updateSetting:a}=Sr(),[i,o]=l.useState({enabled:!1,backup_codes_count:0}),[c,f]=l.useState(!1),[d,u]=l.useState(!1),[p,g]=l.useState(null),[y,m]=l.useState(""),[b,S]=l.useState(""),[v,j]=l.useState(""),[w,C]=l.useState(""),[A,P]=l.useState(!1),[D,R]=l.useState(!1),[_,z]=l.useState(null),[W,B]=l.useState(!1);l.useEffect(()=>{k(),I(),H()},[]);const H=async()=>{try{const T=await ft.getCacheStats();z(T)}catch(T){console.error("Failed to load cache stats:",T)}},se=async()=>{B(!0);try{await ft.clearCache(),await H(),C("Audio cache cleared successfully")}catch{j("Failed to clear cache")}finally{B(!1)}},I=async()=>{try{const T=await Ne.get("/api/user/account/",{headers:{Authorization:`Token ${localStorage.getItem("token")}`}});R(T.data.is_admin||T.data.is_superuser)}catch(T){console.error("Failed to check admin status:",T)}},k=async()=>{try{const T=await Cr.twoFactorStatus();o(T.data)}catch(T){console.error("Failed to load 2FA status:",T)}},O=async()=>{try{j("");const T=await Cr.twoFactorSetup();g(T.data),f(!0),P(!1)}catch{j("Failed to setup 2FA")}},E=async()=>{try{j(""),await Cr.twoFactorVerify({code:y}),C("Two-factor authentication enabled successfully!"),f(!1),m(""),k(),setTimeout(()=>C(""),3e3)}catch{j("Invalid verification code")}},Z=async()=>{try{j(""),await Cr.twoFactorDisable({code:b}),C("Two-factor authentication disabled"),u(!1),S(""),k(),setTimeout(()=>C(""),3e3)}catch{j("Invalid verification code")}},G=async()=>{try{j("");const T=await Cr.twoFactorRegenerateCodes();g({...p,backup_codes:T.data.backup_codes}),P(!0),C("Backup codes regenerated successfully!"),k(),setTimeout(()=>C(""),3e3)}catch{j("Failed to regenerate backup codes")}},M=async()=>{try{const T=await Cr.twoFactorDownloadCodes(),ae=window.URL.createObjectURL(new Blob([T.data])),L=document.createElement("a");L.href=ae;const N=T.headers["content-disposition"];let X="backup_codes.pdf";if(N){const ue=N.match(/filename="?(.+)"?/);ue&&(X=ue[1])}L.setAttribute("download",X),document.body.appendChild(L),L.click(),L.remove(),window.URL.revokeObjectURL(ae)}catch{j("Failed to download backup codes")}};return e.jsxs(h,{children:[e.jsx(x,{variant:"h4",sx:{mb:2,fontWeight:600},children:"Settings"}),w&&e.jsx(ge,{severity:"success",sx:{mb:1.5,maxWidth:600},children:w}),v&&e.jsx(ge,{severity:"error",sx:{mb:1.5,maxWidth:600},children:v}),e.jsx(Ce,{sx:{maxWidth:600,bgcolor:"background.paper",mb:1.5},children:e.jsxs(Ie,{children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",mb:1.5},children:[e.jsx(k0,{sx:{mr:1,color:"primary.main",fontSize:"1.25rem"}}),e.jsx(x,{variant:"subtitle1",fontWeight:600,children:"Appearance"})]}),e.jsx(x,{variant:"caption",color:"text.secondary",sx:{mb:2,display:"block"},children:"Customize the look and feel of SoundWave with different color themes."}),e.jsxs(jt,{fullWidth:!0,sx:{mb:1.5},size:"small",children:[e.jsx(zt,{children:"Theme"}),e.jsx(_t,{value:r,label:"Theme",onChange:T=>n(T.target.value),children:Object.entries(rc).map(([T,ae])=>e.jsx(ve,{value:T,children:ae},T))})]}),e.jsx(K,{container:!0,spacing:1.5,children:Object.entries(rc).map(([T,ae])=>e.jsx(K,{item:!0,xs:6,sm:3,children:e.jsx(ey,{name:ae,mode:T,isSelected:r===T,onClick:()=>n(T)})},T))})]})}),e.jsx(Ce,{sx:{maxWidth:600,bgcolor:"background.paper",mb:1.5},children:e.jsxs(Ie,{children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",mb:1.5},children:[e.jsx(ho,{sx:{mr:1,color:"primary.main",fontSize:"1.25rem"}}),e.jsx(x,{variant:"subtitle1",fontWeight:600,children:"Audio Visualizer"})]}),e.jsx(x,{variant:"caption",color:"text.secondary",sx:{mb:2,display:"block"},children:"Choose a visualization style for the audio player. Different themes offer unique animations and color schemes."}),e.jsx($e,{control:e.jsx(et,{size:"small",checked:s.visualizer_enabled,onChange:T=>a("visualizer_enabled",T.target.checked)}),label:e.jsx(x,{variant:"body2",children:"Enable visualizer"}),sx:{mb:2,display:"block"}}),s.visualizer_enabled&&e.jsxs(e.Fragment,{children:[e.jsx($e,{control:e.jsx(et,{size:"small",checked:s.visualizer_glow,onChange:T=>a("visualizer_glow",T.target.checked)}),label:e.jsx(x,{variant:"body2",children:"Enable glow effect"}),sx:{mb:2,display:"block"}}),e.jsx(x,{variant:"body2",fontWeight:500,sx:{mb:1.5},children:"Visualizer Theme"}),e.jsx(K,{container:!0,spacing:1.5,children:Rr.map(T=>e.jsx(K,{item:!0,xs:4,sm:3,children:e.jsx(sy,{theme:T,isSelected:s.visualizer_theme===T.id,onClick:()=>a("visualizer_theme",T.id)})},T.id))})]})]})}),e.jsx(ly,{}),e.jsx(Ce,{sx:{maxWidth:600,bgcolor:"background.paper",mb:1.5},children:e.jsxs(Ie,{children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",mb:1.5},children:[e.jsx(Ul,{sx:{mr:1,color:"primary.main",fontSize:"1.25rem"}}),e.jsx(x,{variant:"subtitle1",fontWeight:600,children:"Two-Factor Authentication"})]}),e.jsx(x,{variant:"caption",color:"text.secondary",sx:{mb:1.5,display:"block"},children:"Add an extra layer of security to your account. You'll need to enter a code from your authenticator app when you sign in."}),e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1.5,mb:1.5},children:[e.jsx(de,{label:i.enabled?"Enabled":"Disabled",color:i.enabled?"success":"default",size:"small"}),i.enabled&&e.jsxs(x,{variant:"caption",color:"text.secondary",children:[i.backup_codes_count," backup codes remaining"]})]}),e.jsx(Fi,{spacing:1.5,children:i.enabled?e.jsxs(e.Fragment,{children:[e.jsx(q,{variant:"outlined",color:"error",onClick:()=>u(!0),children:"Disable Two-Factor Authentication"}),e.jsx(De,{}),e.jsxs(h,{children:[e.jsx(x,{variant:"subtitle2",sx:{mb:1},children:"Backup Codes"}),e.jsxs(Fi,{direction:"row",spacing:1,children:[e.jsx(q,{variant:"outlined",size:"small",startIcon:e.jsx(Tr,{}),onClick:M,children:"Download Backup Codes"}),e.jsx(q,{variant:"outlined",size:"small",startIcon:e.jsx(Us,{}),onClick:G,children:"Regenerate Codes"})]})]})]}):e.jsx(q,{variant:"contained",size:"small",onClick:O,startIcon:e.jsx(Ul,{}),children:"Enable Two-Factor Authentication"})})]})}),e.jsx(Ce,{sx:{maxWidth:600,bgcolor:"background.paper",mb:1.5},children:e.jsxs(Ie,{children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",mb:1.5},children:[e.jsx(Yl,{sx:{mr:1,color:"primary.main",fontSize:"1.25rem"}}),e.jsx(x,{variant:"subtitle1",fontWeight:600,children:"Playback"})]}),e.jsx($e,{control:e.jsx(et,{defaultChecked:!0,size:"small"}),label:e.jsx(x,{variant:"body2",children:"Autoplay"}),sx:{mb:2,display:"block"}}),e.jsxs(h,{sx:{mb:3},children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(si,{sx:{mr:1,color:"text.secondary",fontSize:"1.1rem"}}),e.jsx(x,{variant:"body2",fontWeight:500,children:"Smart Shuffle"})]}),e.jsx(x,{variant:"caption",color:"text.secondary",sx:{mb:1.5,display:"block"},children:"When enabled, shuffle mode will avoid playing recently heard songs, creating a more varied listening experience."}),e.jsx($e,{control:e.jsx(et,{size:"small",checked:s.smart_shuffle_enabled,onChange:T=>a("smart_shuffle_enabled",T.target.checked)}),label:e.jsx(x,{variant:"body2",children:"Enable smart shuffle"}),sx:{mb:1,display:"block"}}),s.smart_shuffle_enabled&&e.jsxs(h,{sx:{pl:2},children:[e.jsxs(x,{variant:"caption",color:"text.secondary",sx:{mb:.5,display:"block"},children:["History size: ",s.smart_shuffle_history_size," tracks"]}),e.jsx(wr,{value:s.smart_shuffle_history_size,onChange:(T,ae)=>a("smart_shuffle_history_size",ae),min:5,max:50,step:5,marks:[{value:5,label:"5"},{value:25,label:"25"},{value:50,label:"50"}],size:"small",sx:{maxWidth:300}}),e.jsx(x,{variant:"caption",color:"text.secondary",sx:{display:"block"},children:"Number of recently played songs to avoid when shuffling"})]})]}),e.jsx(De,{sx:{my:2}}),e.jsxs(h,{sx:{mb:3},children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(F0,{sx:{mr:1,color:"text.secondary",fontSize:"1.1rem"}}),e.jsx(x,{variant:"body2",fontWeight:500,children:"Seek Duration"})]}),e.jsx(x,{variant:"caption",color:"text.secondary",sx:{mb:1.5,display:"block"},children:"Choose how many seconds to skip forward or backward when using seek controls (media keys, headphones, etc.)."}),e.jsx(jt,{size:"small",sx:{minWidth:120},children:e.jsxs(_t,{value:s.seek_duration||3,onChange:T=>a("seek_duration",Number(T.target.value)),children:[e.jsx(ve,{value:3,children:"3 seconds"}),e.jsx(ve,{value:5,children:"5 seconds"}),e.jsx(ve,{value:10,children:"10 seconds"})]})})]}),e.jsx(De,{sx:{my:2}}),e.jsxs(h,{sx:{mb:2},children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(Du,{sx:{mr:1,color:"text.secondary",fontSize:"1.1rem"}}),e.jsx(x,{variant:"body2",fontWeight:500,children:"Intelligent Prefetch & Caching"})]}),e.jsx(x,{variant:"caption",color:"text.secondary",sx:{mb:1.5,display:"block"},children:"Automatically download upcoming tracks for instant playback. Cached tracks play without network delay."}),e.jsx($e,{control:e.jsx(et,{size:"small",checked:s.prefetch_enabled!==!1,onChange:T=>a("prefetch_enabled",T.target.checked)}),label:e.jsx(x,{variant:"body2",children:"Enable intelligent prefetching"}),sx:{mb:1,display:"block"}}),_&&e.jsxs(h,{sx:{mt:2,p:2,bgcolor:"rgba(255,255,255,0.03)",borderRadius:2,border:"1px solid",borderColor:"divider"},children:[e.jsx(x,{variant:"caption",color:"text.secondary",sx:{display:"block",mb:1},children:"Cache Statistics"}),e.jsxs(h,{sx:{display:"flex",gap:3,mb:1.5},children:[e.jsxs(h,{children:[e.jsx(x,{variant:"h6",fontWeight:600,color:"primary.main",children:_.count}),e.jsx(x,{variant:"caption",color:"text.secondary",children:"Cached tracks"})]}),e.jsxs(h,{children:[e.jsxs(x,{variant:"h6",fontWeight:600,color:"primary.main",children:[(_.totalSize/1024/1024).toFixed(1)," MB"]}),e.jsx(x,{variant:"caption",color:"text.secondary",children:"Cache size"})]}),e.jsxs(h,{children:[e.jsxs(x,{variant:"h6",fontWeight:600,color:"text.secondary",children:[(a0.maxCacheSize/1024/1024).toFixed(0)," MB"]}),e.jsx(x,{variant:"caption",color:"text.secondary",children:"Max size"})]})]}),e.jsx(q,{variant:"outlined",size:"small",color:"error",startIcon:e.jsx(q0,{}),onClick:se,disabled:W||_.count===0,sx:{mt:1},children:W?"Clearing...":"Clear Cache"})]})]}),e.jsx(De,{sx:{my:2}}),e.jsx($e,{control:e.jsx(et,{defaultChecked:!0,size:"small"}),label:e.jsx(x,{variant:"body2",children:"Normalize audio"}),sx:{display:"block"}})]})}),e.jsx(Ce,{sx:{maxWidth:600,bgcolor:"background.paper",mb:1.5},children:e.jsxs(Ie,{children:[e.jsx(x,{variant:"subtitle1",fontWeight:600,sx:{mb:1.5},children:"Download Quality"}),e.jsx($e,{control:e.jsx(et,{defaultChecked:!0,size:"small"}),label:e.jsx(x,{variant:"body2",children:"Download in best quality"}),sx:{display:"block"}})]})}),e.jsx(Ce,{sx:{maxWidth:600,bgcolor:"background.paper"},children:e.jsxs(Ie,{children:[e.jsx(x,{variant:"subtitle1",fontWeight:600,sx:{mb:1.5},children:"Lyrics"}),e.jsx(x,{variant:"caption",color:"text.secondary",sx:{mb:1.5,display:"block"},children:"Automatically fetch and cache synchronized lyrics for your audio files using LRCLIB API."}),e.jsx($e,{control:e.jsx(et,{defaultChecked:!0}),label:"Auto-fetch lyrics for new downloads",sx:{mb:2,display:"block"}}),e.jsx($e,{control:e.jsx(et,{defaultChecked:!0}),label:"Show synchronized lyrics in player",sx:{display:"block"}})]})}),e.jsxs(Qe,{open:c,onClose:()=>f(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(Xe,{children:"Enable Two-Factor Authentication"}),e.jsx(Ke,{children:p&&e.jsx(h,{children:A?e.jsxs(e.Fragment,{children:[e.jsx(ge,{severity:"warning",sx:{mb:2},children:"Save these backup codes in a safe place. Each code can only be used once."}),e.jsx(h,{sx:{bgcolor:"background.default",p:2,borderRadius:1,mb:2},children:p.backup_codes.map((T,ae)=>e.jsxs(x,{sx:{fontFamily:"monospace",mb:.5},children:[ae+1,". ",T]},ae))}),e.jsx(q,{fullWidth:!0,variant:"outlined",startIcon:e.jsx(Tr,{}),onClick:()=>{const T=new Blob([p.backup_codes.join(`
`)],{type:"text/plain"}),ae=URL.createObjectURL(T),L=document.createElement("a");L.href=ae,L.download="soundwave-backup-codes.txt",L.click()},sx:{mb:2},children:"Download Backup Codes"}),e.jsx(q,{fullWidth:!0,variant:"text",onClick:()=>P(!1),children:"Back to Setup"})]}):e.jsxs(e.Fragment,{children:[e.jsx(x,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Scan this QR code with your authenticator app (Google Authenticator, Authy, etc.)"}),e.jsx(h,{sx:{display:"flex",justifyContent:"center",mb:2},children:e.jsx("img",{src:p.qr_code,alt:"QR Code",style:{width:200,height:200}})}),e.jsx(x,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"Or enter this code manually:"}),e.jsx(je,{fullWidth:!0,value:p.secret,InputProps:{readOnly:!0},sx:{mb:2}}),e.jsx(x,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"Enter the 6-digit code from your app to verify:"}),e.jsx(je,{fullWidth:!0,placeholder:"000000",value:y,onChange:T=>m(T.target.value),inputProps:{maxLength:6}}),v&&e.jsx(ge,{severity:"error",sx:{mt:2},children:v}),e.jsx(q,{fullWidth:!0,variant:"text",onClick:()=>P(!0),sx:{mt:2},children:"View Backup Codes"})]})})}),e.jsxs(tt,{children:[e.jsx(q,{onClick:()=>f(!1),children:"Cancel"}),!A&&e.jsx(q,{onClick:E,variant:"contained",disabled:y.length!==6,children:"Verify and Enable"})]})]}),e.jsxs(Qe,{open:d,onClose:()=>u(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(Xe,{children:"Disable Two-Factor Authentication"}),e.jsxs(Ke,{children:[e.jsx(ge,{severity:"warning",sx:{mb:2},children:"Disabling two-factor authentication will make your account less secure."}),e.jsx(x,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Enter a verification code from your authenticator app or use a backup code:"}),e.jsx(je,{fullWidth:!0,placeholder:"000000",value:b,onChange:T=>S(T.target.value),inputProps:{maxLength:6}}),v&&e.jsx(ge,{severity:"error",sx:{mt:2},children:v})]}),e.jsxs(tt,{children:[e.jsx(q,{onClick:()=>u(!1),children:"Cancel"}),e.jsx(q,{onClick:Z,variant:"contained",color:"error",disabled:b.length!==6,children:"Disable 2FA"})]})]}),e.jsx(Ce,{sx:{maxWidth:600,bgcolor:"background.paper",mb:2},children:e.jsxs(yh,{defaultExpanded:!0,children:[e.jsx(bh,{expandIcon:e.jsx(P0,{}),children:e.jsxs(h,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Yl,{sx:{mr:1,color:"primary.main"}}),e.jsx(x,{variant:"h6",children:"Quick Sync - Adaptive Streaming"})]})}),e.jsx(vh,{children:e.jsx(oy,{})})]})}),e.jsx(xy,{}),D&&e.jsx(Ce,{sx:{maxWidth:600,bgcolor:"background.paper",mb:2},children:e.jsxs(Ie,{children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(Kl,{sx:{mr:1,color:"primary.main"}}),e.jsx(x,{variant:"h6",children:"User Management"})]}),e.jsx(x,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Manage all users in the system. Create, edit, or delete user accounts and monitor system statistics."}),e.jsx(q,{variant:"contained",startIcon:e.jsx(Kl,{}),onClick:()=>t("/admin/users"),fullWidth:!0,sx:{minHeight:{xs:"44px",sm:"48px"}},children:"Open User Management"})]})})]})}const my="SoundWaveLocalAudio",$t="audioFiles",gy=1;class yy{db=null;async init(){return new Promise((r,n)=>{const s=indexedDB.open(my,gy);s.onerror=()=>n(s.error),s.onsuccess=()=>{this.db=s.result,r()},s.onupgradeneeded=a=>{const i=a.target.result;if(!i.objectStoreNames.contains($t)){const o=i.createObjectStore($t,{keyPath:"id"});o.createIndex("title","title",{unique:!1}),o.createIndex("artist","artist",{unique:!1}),o.createIndex("album","album",{unique:!1}),o.createIndex("addedDate","addedDate",{unique:!1})}}})}async addFiles(r){this.db||await this.init();const n=this.db.transaction([$t],"readwrite"),s=n.objectStore($t);for(const a of r)s.put(a);return new Promise((a,i)=>{n.oncomplete=()=>a(),n.onerror=()=>i(n.error)})}async getAll(){this.db||await this.init();const s=this.db.transaction([$t],"readonly").objectStore($t).getAll();return new Promise((a,i)=>{s.onsuccess=()=>a(s.result),s.onerror=()=>i(s.error)})}async getById(r){this.db||await this.init();const a=this.db.transaction([$t],"readonly").objectStore($t).get(r);return new Promise((i,o)=>{a.onsuccess=()=>i(a.result),a.onerror=()=>o(a.error)})}async delete(r){this.db||await this.init();const n=this.db.transaction([$t],"readwrite");return n.objectStore($t).delete(r),new Promise((a,i)=>{n.oncomplete=()=>a(),n.onerror=()=>i(n.error)})}async updatePlayCount(r){const n=await this.getById(r);n&&(n.playCount=(n.playCount||0)+1,n.lastPlayed=new Date,await this.addFiles([n]))}async clear(){this.db||await this.init();const r=this.db.transaction([$t],"readwrite");return r.objectStore($t).clear(),new Promise((s,a)=>{r.oncomplete=()=>s(),r.onerror=()=>a(r.error)})}}const Nr=new yy;async function by(t){return new Promise(r=>{typeof window.jsmediatags<"u"?window.jsmediatags.read(t,{onSuccess:n=>{const s=n.tags,a={title:s.title||t.name.replace(/\.[^/.]+$/,""),artist:s.artist||"Unknown Artist",album:s.album||"",year:s.year?parseInt(s.year):null,genre:s.genre||""};if(s.picture){const{data:i,format:o}=s.picture,c=btoa(i.reduce((f,d)=>f+String.fromCharCode(d),""));a.coverArt=`data:${o};base64,${c}`}r(a)},onError:()=>{r({title:t.name.replace(/\.[^/.]+$/,""),artist:"Unknown Artist",album:"",year:null,genre:""})}}):r({title:t.name.replace(/\.[^/.]+$/,""),artist:"Unknown Artist",album:"",year:null,genre:""})})}async function vy(t){return new Promise(r=>{const n=new Audio,s=URL.createObjectURL(t);n.addEventListener("loadedmetadata",()=>{r(Math.round(n.duration)),URL.revokeObjectURL(s)}),n.addEventListener("error",()=>{r(0),URL.revokeObjectURL(s)}),n.src=s})}function jy({setCurrentAudio:t}){const[r,n]=l.useState([]),[s,a]=l.useState(!1),[i,o]=l.useState(null);l.useEffect(()=>{c()},[]);const c=async()=>{try{const b=await Nr.getAll();n(b)}catch(b){console.error("Error loading files:",b)}},f=async b=>{const S=[];for(const v of b)try{const j=await by(v),w=await vy(v),C={id:`${Date.now()}-${Math.random()}`,title:j.title||v.name,artist:j.artist||"Unknown Artist",album:j.album||"",year:j.year||null,genre:j.genre||"",duration:w,file:v,fileName:v.name,fileSize:v.size,mimeType:v.type,coverArt:j.coverArt,addedDate:new Date,playCount:0};S.push(C)}catch(j){console.error(`Error processing ${v.name}:`,j)}return S},d=async()=>{try{const b=document.createElement("input");b.type="file",b.multiple=!0,b.accept="audio/*",b.onchange=async S=>{const v=S.target,j=Array.from(v.files||[]);if(j.length===0)return;a(!0),o({message:`Processing ${j.length} files...`,severity:"info"});const w=await f(j);await Nr.addFiles(w),await c(),a(!1),o({message:`Added ${w.length} files successfully!`,severity:"success"})},b.click()}catch(b){console.error("Error selecting files:",b),o({message:"Failed to select files",severity:"error"}),a(!1)}},u=async()=>{try{if(!("showDirectoryPicker"in window)){o({message:"Folder selection not supported in this browser. Use Chrome, Edge, or Opera.",severity:"error"});return}if(!window.isSecureContext){o({message:'Folder selection requires HTTPS or localhost. For local network access, use "Select Files" instead or access via HTTPS.',severity:"info"});return}const S=await window.showDirectoryPicker({mode:"read"});a(!0),o({message:"Scanning folder and subfolders...",severity:"info"});const v=[],j=[".mp3",".m4a",".flac",".wav",".ogg",".opus",".aac",".wma"];async function w(A,P=""){for await(const D of A.values())if(D.kind==="file"){const R=await D.getFile(),_=R.name.toLowerCase().substring(R.name.lastIndexOf("."));j.includes(_)&&v.push(R)}else D.kind==="directory"&&await w(D,`${P}/${D.name}`)}if(await w(S),v.length===0){a(!1),o({message:"No audio files found in the selected folder",severity:"info"});return}o({message:`Processing ${v.length} audio files...`,severity:"info"});const C=await f(v);await Nr.addFiles(C),await c(),a(!1),o({message:`Successfully added ${C.length} files from folder!`,severity:"success"})}catch(b){console.error("Error selecting folder:",b),b.name==="AbortError"?o({message:"Folder selection cancelled",severity:"info"}):o({message:"Failed to read folder",severity:"error"}),a(!1)}},p=async b=>{try{await Nr.updatePlayCount(b.id);const S=b.file?URL.createObjectURL(b.file):"",v={id:parseInt(b.id.split("-")[0])||Date.now(),youtube_id:void 0,title:b.title,channel_name:b.artist,channel_id:"",description:`${b.album}${b.year?` (${b.year})`:""}`,thumbnail_url:b.coverArt||"/placeholder.jpg",duration:b.duration,file_size:b.fileSize,file_path:S,media_url:S,play_count:b.playCount,published_date:b.addedDate.toISOString(),downloaded_date:b.addedDate.toISOString(),view_count:0,like_count:0,audio_format:b.mimeType.split("/")[1]||"mp3",artist:b.artist,album:b.album,cover_art_url:b.coverArt},j=r.map(w=>{const C=w.file?URL.createObjectURL(w.file):"";return{id:parseInt(w.id.split("-")[0])||Date.now(),youtube_id:void 0,title:w.title,channel_name:w.artist,channel_id:"",description:`${w.album}${w.year?` (${w.year})`:""}`,thumbnail_url:w.coverArt||"/placeholder.jpg",duration:w.duration,file_size:w.fileSize,file_path:C,media_url:C,play_count:w.playCount,published_date:w.addedDate.toISOString(),downloaded_date:w.addedDate.toISOString(),view_count:0,like_count:0,audio_format:w.mimeType.split("/")[1]||"mp3",artist:w.artist,album:w.album,cover_art_url:w.coverArt}});t(v,j)}catch(S){console.error("Error playing file:",S),o({message:"Failed to play file",severity:"error"})}},g=async b=>{if(confirm("Remove this file from your library?"))try{await Nr.delete(b),await c(),o({message:"File removed",severity:"success"})}catch(S){console.error("Error deleting file:",S),o({message:"Failed to remove file",severity:"error"})}},y=async()=>{if(confirm("Remove ALL files from your library? This cannot be undone."))try{await Nr.clear(),await c(),o({message:"All files removed",severity:"success"})}catch(b){console.error("Error clearing library:",b),o({message:"Failed to clear library",severity:"error"})}},m=b=>{const S=Math.floor(b/60),v=b%60;return`${S}:${v.toString().padStart(2,"0")}`};return e.jsxs(h,{children:[e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,px:.5,flexWrap:"wrap",gap:2},children:[e.jsx(x,{variant:"h6",sx:{fontWeight:700,letterSpacing:"-0.02em"},children:"My Local Files"}),e.jsxs(h,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[e.jsx(q,{variant:"outlined",size:"small",startIcon:e.jsx($r,{}),onClick:c,sx:{borderRadius:1,textTransform:"none",minWidth:"auto",px:1.5,py:.5,fontSize:"0.813rem"},children:"Refresh"}),r.length>0&&e.jsx(q,{variant:"outlined",size:"small",color:"error",onClick:y,sx:{borderRadius:1,textTransform:"none",minWidth:"auto",px:1.5,py:.5,fontSize:"0.813rem"},children:"Clear All"}),e.jsx(q,{variant:"contained",size:"small",startIcon:e.jsx(rr,{}),onClick:d,disabled:s,sx:{borderRadius:1,textTransform:"none",fontWeight:600,minWidth:"auto",px:2,py:.5,fontSize:"0.813rem"},children:"Select Files"}),e.jsx(be,{title:window.isSecureContext?"Select a folder to scan recursively including all subfolders":'Folder selection requires HTTPS or localhost. Currently viewing over HTTP. Use "Select Files" instead, or access via HTTPS.',arrow:!0,children:e.jsx("span",{children:e.jsxs(q,{variant:"contained",size:"small",startIcon:e.jsx(jh,{}),onClick:u,disabled:s||!window.isSecureContext,color:"secondary",sx:{borderRadius:1,textTransform:"none",fontWeight:600,minWidth:"auto",px:2,py:.5,fontSize:"0.813rem"},children:["Select Folder ",!window.isSecureContext&&""]})})})]})]}),r.length===0&&!s&&e.jsxs(ge,{severity:"info",sx:{mb:3,borderRadius:3},children:[e.jsx(x,{variant:"body2",sx:{fontWeight:600,mb:.5},children:"No local files yet"}),e.jsx(x,{variant:"caption",children:'Click "Select Files" to choose individual audio files (works everywhere), or "Select Folder" to scan an entire folder including subfolders (requires HTTPS or localhost). Files are stored in your browser and play locally without uploading.'})]}),s&&e.jsx(h,{sx:{mb:3},children:e.jsx(rt,{})}),r.length>0&&e.jsx(Or,{component:pt,sx:{bgcolor:"background.paper",borderRadius:3,border:"1px solid",borderColor:"rgba(255, 255, 255, 0.05)","& .MuiTableCell-root":{borderColor:"rgba(255, 255, 255, 0.05)",padding:{xs:"6px 8px",sm:"8px 12px"},fontSize:{xs:"0.7rem",sm:"0.8125rem"}}},children:e.jsxs(Fr,{size:"small",children:[e.jsx(Lr,{children:e.jsxs(ut,{children:[e.jsx(Q,{width:30,sx:{fontWeight:600,fontSize:{xs:"0.7rem",sm:"0.75rem"}},children:"#"}),e.jsx(Q,{sx:{fontWeight:600,fontSize:{xs:"0.7rem",sm:"0.75rem"}},children:"Title"}),e.jsx(Q,{sx:{fontWeight:600,display:{xs:"none",sm:"table-cell"},fontSize:"0.75rem"},children:"Artist"}),e.jsx(Q,{sx:{fontWeight:600,display:{xs:"none",md:"table-cell"},fontSize:"0.75rem"},children:"Album"}),e.jsx(Q,{align:"right",sx:{fontWeight:600,fontSize:{xs:"0.7rem",sm:"0.75rem"}},children:"Duration"}),e.jsx(Q,{align:"center",width:80,sx:{fontWeight:600,fontSize:{xs:"0.7rem",sm:"0.75rem"}},children:"Actions"})]})}),e.jsx(Wr,{children:r.map((b,S)=>e.jsxs(ut,{sx:{cursor:"pointer",transition:"background-color 0.3s ease","&:hover":{bgcolor:"rgba(19, 236, 106, 0.05)"}},onClick:()=>p(b),children:[e.jsx(Q,{sx:{color:"text.secondary",fontSize:{xs:"0.7rem",sm:"0.75rem"}},children:S+1}),e.jsx(Q,{children:e.jsxs(h,{children:[e.jsx(x,{variant:"body2",noWrap:!0,sx:{maxWidth:{xs:150,sm:200,md:300},fontWeight:500,fontSize:{xs:"0.75rem",sm:"0.813rem"},lineHeight:1.3},children:b.title}),e.jsx(x,{variant:"caption",noWrap:!0,sx:{display:{xs:"block",sm:"none"},color:"text.secondary",fontSize:"0.65rem",maxWidth:150},children:b.artist})]})}),e.jsx(Q,{sx:{display:{xs:"none",sm:"table-cell"}},children:e.jsx(x,{variant:"body2",color:"text.secondary",noWrap:!0,sx:{maxWidth:120,fontSize:"0.75rem"},children:b.artist})}),e.jsx(Q,{sx:{display:{xs:"none",md:"table-cell"}},children:e.jsx(x,{variant:"body2",color:"text.secondary",noWrap:!0,sx:{maxWidth:150,fontSize:"0.75rem"},children:b.album||"-"})}),e.jsx(Q,{align:"right",sx:{color:"text.secondary",fontSize:{xs:"0.7rem",sm:"0.75rem"}},children:m(b.duration)}),e.jsxs(Q,{align:"center",onClick:v=>v.stopPropagation(),children:[e.jsx(J,{size:"small",onClick:()=>p(b),sx:{color:"primary.main",padding:{xs:"4px",sm:"6px"},"&:hover":{bgcolor:"rgba(19, 236, 106, 0.1)"}},children:e.jsx(nr,{sx:{fontSize:{xs:"1rem",sm:"1.2rem"}}})}),e.jsx(J,{size:"small",onClick:()=>g(b.id),sx:{color:"error.main",padding:{xs:"4px",sm:"6px"},"&:hover":{bgcolor:"rgba(255, 0, 0, 0.1)"}},children:e.jsx(Dr,{sx:{fontSize:{xs:"1rem",sm:"1.2rem"}}})})]})]},b.id))})]})}),e.jsx(ct,{open:!!i,autoHideDuration:4e3,onClose:()=>o(null),anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(ge,{onClose:()=>o(null),severity:i?.severity,sx:{borderRadius:2},children:i?.message})})]})}const wy=()=>{const[t,r]=l.useState([]),[n,s]=l.useState(null),[a,i]=l.useState(!0),[o,c]=l.useState(""),[f,d]=l.useState(""),[u,p]=l.useState(!1),[g,y]=l.useState(!1),[m,b]=l.useState(null),[S,v]=l.useState(!1),[j,w]=l.useState({username:"",email:"",password:"",password_confirm:"",is_admin:!1,is_active:!0,storage_quota_gb:50,max_channels:50,max_playlists:100,user_notes:""});l.useEffect(()=>{C(),A()},[]);const C=async()=>{try{i(!0);const I=await U.get("/user/admin/users/");r(I.data.results||I.data),c("")}catch(I){c(I.response?.data?.detail||"Failed to load users")}finally{i(!1)}},A=async()=>{try{const I=await U.get("/user/admin/users/system_stats/");s(I.data)}catch(I){console.error("Failed to load system stats:",I)}},P=async()=>{try{await U.post("/user/admin/users/",j),d("User created successfully"),p(!1),H(),C(),A(),setTimeout(()=>d(""),3e3)}catch(I){c(I.response?.data?.detail||"Failed to create user")}},D=async()=>{if(m)try{await U.patch(`/user/admin/users/${m.id}/`,{is_admin:j.is_admin,is_active:j.is_active,storage_quota_gb:j.storage_quota_gb,max_channels:j.max_channels,max_playlists:j.max_playlists,user_notes:j.user_notes}),d("User updated successfully"),y(!1),C(),setTimeout(()=>d(""),3e3)}catch(I){c(I.response?.data?.detail||"Failed to update user")}},R=async I=>{try{await U.post(`/user/admin/users/${I.id}/toggle_active/`),d(`User ${I.is_active?"deactivated":"activated"}`),C(),setTimeout(()=>d(""),3e3)}catch(k){c(k.response?.data?.detail||"Failed to toggle user status")}},_=async I=>{try{await U.post(`/user/admin/users/${I.id}/reset_storage/`),d("Storage reset successfully"),C(),setTimeout(()=>d(""),3e3)}catch(k){c(k.response?.data?.detail||"Failed to reset storage")}},z=async I=>{try{await U.post(`/user/admin/users/${I.id}/reset_2fa/`),d("2FA reset successfully"),C(),setTimeout(()=>d(""),3e3)}catch(k){c(k.response?.data?.detail||"Failed to reset 2FA")}},W=I=>{b(I),w({username:I.username,email:I.email,password:"",password_confirm:"",is_admin:I.is_admin,is_active:I.is_active,storage_quota_gb:I.storage_quota_gb,max_channels:I.max_channels,max_playlists:I.max_playlists,user_notes:""}),y(!0)},B=I=>{b(I),v(!0)},H=()=>{w({username:"",email:"",password:"",password_confirm:"",is_admin:!1,is_active:!0,storage_quota_gb:50,max_channels:50,max_playlists:100,user_notes:""})},se=I=>I>90?"error":I>75?"warning":"success";return e.jsxs(h,{children:[e.jsxs(h,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[e.jsx(x,{variant:"h4",fontWeight:"bold",children:"User Management"}),e.jsxs(h,{children:[e.jsx(J,{onClick:C,sx:{mr:1},children:e.jsx($r,{})}),e.jsx(q,{variant:"contained",startIcon:e.jsx(wh,{}),onClick:()=>p(!0),children:"Create User"})]})]}),o&&e.jsx(ge,{severity:"error",sx:{mb:2},onClose:()=>c(""),children:o}),f&&e.jsx(ge,{severity:"success",sx:{mb:2},onClose:()=>d(""),children:f}),n&&e.jsxs(K,{container:!0,spacing:3,sx:{mb:3},children:[e.jsx(K,{item:!0,xs:12,md:3,children:e.jsx(Ce,{children:e.jsxs(Ie,{children:[e.jsxs(h,{display:"flex",alignItems:"center",mb:1,children:[e.jsx(Sh,{color:"primary",sx:{mr:1}}),e.jsx(x,{variant:"h6",children:"Users"})]}),e.jsx(x,{variant:"h4",children:n.users.total}),e.jsxs(x,{variant:"body2",color:"text.secondary",children:[n.users.active," active, ",n.users.admin," admins"]})]})})}),e.jsx(K,{item:!0,xs:12,md:3,children:e.jsx(Ce,{children:e.jsxs(Ie,{children:[e.jsxs(h,{display:"flex",alignItems:"center",mb:1,children:[e.jsx(Ch,{color:"primary",sx:{mr:1}}),e.jsx(x,{variant:"h6",children:"Content"})]}),e.jsx(x,{variant:"h4",children:n.content.channels}),e.jsxs(x,{variant:"body2",color:"text.secondary",children:[n.content.playlists," playlists, ",n.content.audio_files," audio"]})]})})}),e.jsx(K,{item:!0,xs:12,md:3,children:e.jsx(Ce,{children:e.jsxs(Ie,{children:[e.jsxs(h,{display:"flex",alignItems:"center",mb:1,children:[e.jsx(Qa,{color:"primary",sx:{mr:1}}),e.jsx(x,{variant:"h6",children:"Storage"})]}),e.jsxs(x,{variant:"h4",children:[n.storage.used_gb.toFixed(1)," GB"]}),e.jsxs(x,{variant:"body2",color:"text.secondary",children:["/ ",n.storage.quota_gb," GB allocated"]})]})})})]}),e.jsx(Or,{component:pt,children:e.jsxs(Fr,{children:[e.jsx(Lr,{children:e.jsxs(ut,{children:[e.jsx(Q,{children:"Username"}),e.jsx(Q,{children:"Email"}),e.jsx(Q,{children:"Status"}),e.jsx(Q,{children:"Storage"}),e.jsx(Q,{children:"Content"}),e.jsx(Q,{children:"Joined"}),e.jsx(Q,{children:"Actions"})]})}),e.jsx(Wr,{children:a?e.jsx(ut,{children:e.jsx(Q,{colSpan:7,align:"center",children:e.jsx(rt,{})})}):t.length===0?e.jsx(ut,{children:e.jsx(Q,{colSpan:7,align:"center",children:"No users found"})}):t.map(I=>e.jsxs(ut,{children:[e.jsx(Q,{children:e.jsxs(h,{display:"flex",alignItems:"center",children:[I.username,I.is_admin&&e.jsx(de,{label:"Admin",size:"small",color:"primary",sx:{ml:1}})]})}),e.jsx(Q,{children:I.email}),e.jsx(Q,{children:e.jsx(de,{label:I.is_active?"Active":"Inactive",color:I.is_active?"success":"default",size:"small",icon:I.is_active?e.jsx(Mr,{}):e.jsx(vo,{})})}),e.jsx(Q,{children:e.jsxs(h,{width:120,children:[e.jsxs(x,{variant:"caption",children:[I.storage_used_gb.toFixed(1)," / ",I.storage_quota_gb," GB"]}),e.jsx(rt,{variant:"determinate",value:Math.min(I.storage_percent_used,100),color:se(I.storage_percent_used)})]})}),e.jsxs(Q,{children:[e.jsxs(x,{variant:"body2",children:[I.stats.total_channels," channels"]}),e.jsxs(x,{variant:"caption",color:"text.secondary",children:[I.stats.total_playlists," playlists, ",I.stats.total_audio_files," audio"]})]}),e.jsx(Q,{children:e.jsx(x,{variant:"body2",children:new Date(I.date_joined).toLocaleDateString()})}),e.jsxs(Q,{children:[e.jsx(be,{title:"User Details",children:e.jsx(J,{size:"small",onClick:()=>B(I),children:e.jsx(Yr,{})})}),e.jsx(be,{title:"Edit User",children:e.jsx(J,{size:"small",onClick:()=>W(I),children:e.jsx(dd,{})})}),e.jsx(be,{title:I.is_active?"Deactivate":"Activate",children:e.jsx(J,{size:"small",onClick:()=>R(I),children:I.is_active?e.jsx(vo,{}):e.jsx(Mr,{})})})]})]},I.id))})]})}),e.jsxs(Qe,{open:u,onClose:()=>p(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(Xe,{children:"Create New User"}),e.jsx(Ke,{children:e.jsxs(h,{sx:{pt:2,display:"flex",flexDirection:"column",gap:2},children:[e.jsx(je,{label:"Username",value:j.username,onChange:I=>w({...j,username:I.target.value}),fullWidth:!0,required:!0}),e.jsx(je,{label:"Email",type:"email",value:j.email,onChange:I=>w({...j,email:I.target.value}),fullWidth:!0,required:!0}),e.jsx(je,{label:"Password",type:"password",value:j.password,onChange:I=>w({...j,password:I.target.value}),fullWidth:!0,required:!0}),e.jsx(je,{label:"Confirm Password",type:"password",value:j.password_confirm,onChange:I=>w({...j,password_confirm:I.target.value}),fullWidth:!0,required:!0}),e.jsx(je,{label:"Storage Quota (GB)",type:"number",value:j.storage_quota_gb,onChange:I=>w({...j,storage_quota_gb:parseInt(I.target.value)}),fullWidth:!0}),e.jsx(je,{label:"Max Channels",type:"number",value:j.max_channels,onChange:I=>w({...j,max_channels:parseInt(I.target.value)}),fullWidth:!0}),e.jsx(je,{label:"Max Playlists",type:"number",value:j.max_playlists,onChange:I=>w({...j,max_playlists:parseInt(I.target.value)}),fullWidth:!0}),e.jsx(je,{label:"Notes",multiline:!0,rows:3,value:j.user_notes,onChange:I=>w({...j,user_notes:I.target.value}),fullWidth:!0}),e.jsx($e,{control:e.jsx(et,{checked:j.is_admin,onChange:I=>w({...j,is_admin:I.target.checked})}),label:"Admin User"}),e.jsx($e,{control:e.jsx(et,{checked:j.is_active,onChange:I=>w({...j,is_active:I.target.checked})}),label:"Active"})]})}),e.jsxs(tt,{children:[e.jsx(q,{onClick:()=>p(!1),children:"Cancel"}),e.jsx(q,{onClick:P,variant:"contained",children:"Create User"})]})]}),e.jsxs(Qe,{open:g,onClose:()=>y(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsxs(Xe,{children:["Edit User: ",m?.username]}),e.jsx(Ke,{children:e.jsxs(h,{sx:{pt:2,display:"flex",flexDirection:"column",gap:2},children:[e.jsx(je,{label:"Storage Quota (GB)",type:"number",value:j.storage_quota_gb,onChange:I=>w({...j,storage_quota_gb:parseInt(I.target.value)}),fullWidth:!0}),e.jsx(je,{label:"Max Channels",type:"number",value:j.max_channels,onChange:I=>w({...j,max_channels:parseInt(I.target.value)}),fullWidth:!0}),e.jsx(je,{label:"Max Playlists",type:"number",value:j.max_playlists,onChange:I=>w({...j,max_playlists:parseInt(I.target.value)}),fullWidth:!0}),e.jsx(je,{label:"Notes",multiline:!0,rows:3,value:j.user_notes,onChange:I=>w({...j,user_notes:I.target.value}),fullWidth:!0}),e.jsx($e,{control:e.jsx(et,{checked:j.is_admin,onChange:I=>w({...j,is_admin:I.target.checked})}),label:"Admin User"}),e.jsx($e,{control:e.jsx(et,{checked:j.is_active,onChange:I=>w({...j,is_active:I.target.checked})}),label:"Active"}),m&&e.jsxs(h,{display:"flex",gap:1,children:[e.jsx(q,{variant:"outlined",color:"warning",onClick:()=>_(m),fullWidth:!0,children:"Reset Storage"}),e.jsx(q,{variant:"outlined",color:"warning",onClick:()=>z(m),fullWidth:!0,children:"Reset 2FA"})]})]})}),e.jsxs(tt,{children:[e.jsx(q,{onClick:()=>y(!1),children:"Cancel"}),e.jsx(q,{onClick:D,variant:"contained",children:"Save Changes"})]})]}),e.jsxs(Qe,{open:S,onClose:()=>v(!1),maxWidth:"md",fullWidth:!0,children:[e.jsxs(Xe,{children:["User Details: ",m?.username]}),e.jsx(Ke,{children:m&&e.jsx(h,{sx:{pt:2},children:e.jsxs(K,{container:!0,spacing:2,children:[e.jsxs(K,{item:!0,xs:6,children:[e.jsx(x,{variant:"subtitle2",color:"text.secondary",children:"Email"}),e.jsx(x,{variant:"body1",children:m.email})]}),e.jsxs(K,{item:!0,xs:6,children:[e.jsx(x,{variant:"subtitle2",color:"text.secondary",children:"Status"}),e.jsx(de,{label:m.is_active?"Active":"Inactive",color:m.is_active?"success":"default",size:"small"})]}),e.jsxs(K,{item:!0,xs:6,children:[e.jsx(x,{variant:"subtitle2",color:"text.secondary",children:"Role"}),e.jsx(de,{label:m.is_admin?"Admin":"User",color:m.is_admin?"primary":"default",size:"small"})]}),e.jsxs(K,{item:!0,xs:6,children:[e.jsx(x,{variant:"subtitle2",color:"text.secondary",children:"Storage Usage"}),e.jsxs(x,{variant:"body1",children:[m.storage_used_gb.toFixed(2)," / ",m.storage_quota_gb," GB (",m.storage_percent_used.toFixed(1),"%)"]})]}),e.jsxs(K,{item:!0,xs:6,children:[e.jsx(x,{variant:"subtitle2",color:"text.secondary",children:"Channels"}),e.jsxs(x,{variant:"body1",children:[m.stats.total_channels," / ",m.max_channels]})]}),e.jsxs(K,{item:!0,xs:6,children:[e.jsx(x,{variant:"subtitle2",color:"text.secondary",children:"Playlists"}),e.jsxs(x,{variant:"body1",children:[m.stats.total_playlists," / ",m.max_playlists]})]}),e.jsxs(K,{item:!0,xs:6,children:[e.jsx(x,{variant:"subtitle2",color:"text.secondary",children:"Audio Files"}),e.jsx(x,{variant:"body1",children:m.stats.total_audio_files})]}),e.jsxs(K,{item:!0,xs:6,children:[e.jsx(x,{variant:"subtitle2",color:"text.secondary",children:"Date Joined"}),e.jsx(x,{variant:"body1",children:new Date(m.date_joined).toLocaleString()})]}),e.jsxs(K,{item:!0,xs:6,children:[e.jsx(x,{variant:"subtitle2",color:"text.secondary",children:"Last Login"}),e.jsx(x,{variant:"body1",children:m.last_login?new Date(m.last_login).toLocaleString():"Never"})]})]})})}),e.jsx(tt,{children:e.jsx(q,{onClick:()=>v(!1),children:"Close"})})]})]})};function Sy(){const t=At(),{isOnline:r,cacheSize:n,clearCache:s,removePlaylistCache:a}=ba(),[i,o]=l.useState([]),[c,f]=l.useState(!0),[d,u]=l.useState({open:!1}),[p,g]=l.useState(!1);l.useEffect(()=>{y()},[]);const y=async()=>{try{const j=await dt.getOfflinePlaylists();o(j)}catch(j){console.error("Failed to load cached playlists:",j)}finally{f(!1)}},m=async j=>{try{const w=j.items?.map(C=>`/api/audio/${C.audio.youtube_id}/download/`)||[];await a(j.playlist_id,w),await dt.removePlaylist(j.id),await y(),u({open:!1})}catch(w){console.error("Failed to remove playlist:",w),alert("Failed to remove offline data")}},b=async()=>{try{await s(),await dt.clearAllData(),await y(),g(!1)}catch(j){console.error("Failed to clear all:",j),alert("Failed to clear all offline data")}},S=j=>{if(j===0)return"0 Bytes";const w=1024,C=["Bytes","KB","MB","GB"],A=Math.floor(Math.log(j)/Math.log(w));return Math.round(j/Math.pow(w,A)*100)/100+" "+C[A]},v=j=>new Date(j).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return c?e.jsx(h,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh"},children:e.jsx(Ae,{})}):e.jsxs(h,{sx:{maxWidth:800,mx:"auto",px:2},children:[e.jsxs(h,{sx:{mb:4},children:[e.jsx(x,{variant:"h5",sx:{fontWeight:700,letterSpacing:"-0.02em",mb:1},children:"Offline Storage"}),e.jsx(x,{variant:"body2",color:"text.secondary",children:"Manage playlists cached for offline playback"})]}),!r&&e.jsx(ge,{severity:"warning",icon:e.jsx(jr,{}),sx:{mb:3},children:"You are currently offline. You can only play cached content."}),n&&e.jsx(Ce,{sx:{mb:3},children:e.jsxs(Ie,{children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(Qa,{color:"primary",sx:{fontSize:32}}),e.jsxs(h,{sx:{flex:1},children:[e.jsx(x,{variant:"subtitle1",sx:{fontWeight:600},children:"Storage Used"}),e.jsx(x,{variant:"h5",sx:{fontWeight:700,color:"primary.main"},children:S(n.usage)})]}),e.jsxs(h,{sx:{textAlign:"right"},children:[e.jsx(x,{variant:"caption",color:"text.secondary",children:"Available"}),e.jsx(x,{variant:"body2",sx:{fontWeight:600},children:S(n.quota-n.usage)})]})]}),e.jsx(rt,{variant:"determinate",value:n.usage/n.quota*100,sx:{height:8,borderRadius:1}}),e.jsxs(x,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:[(n.usage/n.quota*100).toFixed(1),"% of ",S(n.quota)," used"]})]})}),e.jsx(Ce,{children:e.jsxs(Ie,{children:[e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Xs,{color:"success"}),e.jsx(x,{variant:"subtitle1",sx:{fontWeight:600},children:"Offline Playlists"}),e.jsx(de,{label:i.length,size:"small",color:"success"})]}),e.jsxs(h,{sx:{display:"flex",gap:1},children:[e.jsx(q,{size:"small",startIcon:e.jsx($r,{}),onClick:y,children:"Refresh"}),i.length>0&&e.jsx(q,{size:"small",color:"error",startIcon:e.jsx(Dr,{}),onClick:()=>g(!0),children:"Clear All"})]})]}),e.jsx(De,{sx:{mb:2}}),i.length===0?e.jsxs(h,{sx:{textAlign:"center",py:4},children:[e.jsx(jr,{sx:{fontSize:48,color:"text.secondary",mb:2,opacity:.3}}),e.jsx(x,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"No playlists cached for offline use"}),e.jsx(q,{variant:"contained",onClick:()=>t("/playlists"),children:"Browse Playlists"})]}):e.jsx(Ge,{disablePadding:!0,children:i.map((j,w)=>e.jsxs(h,{children:[w>0&&e.jsx(De,{}),e.jsxs(Oe,{sx:{py:2,cursor:"pointer","&:hover":{bgcolor:"rgba(255, 255, 255, 0.05)"}},onClick:()=>t(`/playlists/${j.playlist_id}`),children:[e.jsx(Se,{primary:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[e.jsx(x,{variant:"body1",sx:{fontWeight:600},children:j.title}),e.jsx(Mr,{sx:{fontSize:16,color:"success.main"}})]}),secondary:e.jsxs(h,{children:[e.jsx(x,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:j.channel_name}),e.jsxs(h,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsx(de,{label:`${j.downloaded_count} tracks`,size:"small",sx:{height:20,fontSize:"0.7rem"}}),e.jsx(de,{label:`Cached ${v(j.lastSync)}`,size:"small",sx:{height:20,fontSize:"0.7rem"},variant:"outlined"})]})]})}),e.jsx(Ir,{children:e.jsx(J,{edge:"end",color:"error",onClick:C=>{C.stopPropagation(),u({open:!0,playlistId:j.playlist_id,title:j.title})},children:e.jsx(Dr,{})})})]})]},j.id))})]})}),e.jsxs(Qe,{open:d.open,onClose:()=>u({open:!1}),children:[e.jsx(Xe,{children:"Remove Offline Playlist?"}),e.jsx(Ke,{children:e.jsxs(x,{children:['Are you sure you want to remove "',d.title,`" from offline storage? You'll need to re-download it to play offline.`]})}),e.jsxs(tt,{children:[e.jsx(q,{onClick:()=>u({open:!1}),children:"Cancel"}),e.jsx(q,{color:"error",variant:"contained",onClick:()=>{const j=i.find(w=>w.playlist_id===d.playlistId);j&&m(j)},children:"Remove"})]})]}),e.jsxs(Qe,{open:p,onClose:()=>g(!1),children:[e.jsx(Xe,{children:"Clear All Offline Data?"}),e.jsxs(Ke,{children:[e.jsx(x,{sx:{mb:2},children:"This will remove all cached playlists and free up storage space. You'll need to re-download playlists to use them offline."}),e.jsx(ge,{severity:"warning",children:"This action cannot be undone."})]}),e.jsxs(tt,{children:[e.jsx(q,{onClick:()=>g(!1),children:"Cancel"}),e.jsx(q,{color:"error",variant:"contained",onClick:b,children:"Clear All"})]})]})]})}const Vr=t=>{if(t<60)return`${t}s`;if(t<3600)return`${Math.floor(t/60)}m`;const r=Math.floor(t/3600),n=Math.floor(t%3600/60);return n>0?`${r}h ${n}m`:`${r}h`},Ou=t=>t===0?"12 AM":t===12?"12 PM":t>12?`${t-12} PM`:`${t} AM`,gr=({title:t,value:r,subtitle:n,icon:s,color:a="primary.main"})=>{const i=Ot();return e.jsx(Ce,{sx:{height:"100%",background:`linear-gradient(135deg, ${qe(i.palette.background.paper,.9)} 0%, ${qe(i.palette.background.paper,.7)} 100%)`,backdropFilter:"blur(10px)",border:"1px solid",borderColor:qe(i.palette.divider,.1)},children:e.jsx(Ie,{children:e.jsxs(h,{sx:{display:"flex",alignItems:"flex-start",justifyContent:"space-between"},children:[e.jsxs(h,{children:[e.jsx(x,{variant:"overline",color:"text.secondary",sx:{letterSpacing:1},children:t}),e.jsx(x,{variant:"h4",sx:{fontWeight:700,color:a},children:r}),n&&e.jsx(x,{variant:"body2",color:"text.secondary",children:n})]}),e.jsx(h,{sx:{p:1.5,borderRadius:2,bgcolor:qe(i.palette.primary.main,.1),color:a},children:s})]})})})},Cy=({data:t})=>{const r=Ot(),n=Math.max(...t.map(s=>s.play_count),1);return e.jsxs(h,{sx:{mt:2},children:[e.jsx(h,{sx:{display:"flex",alignItems:"flex-end",height:120,gap:.5},children:t.map(s=>e.jsx(be,{title:`${Ou(s.hour)}: ${s.play_count} plays (${Vr(s.total_duration)})`,children:e.jsx(h,{sx:{flex:1,bgcolor:s.play_count>0?"primary.main":qe(r.palette.text.disabled,.2),borderRadius:"4px 4px 0 0",minHeight:4,height:`${s.play_count/n*100}%`,transition:"all 0.3s ease",cursor:"pointer","&:hover":{bgcolor:"primary.light",transform:"scaleY(1.05)"}}})},s.hour))}),e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",mt:1},children:[e.jsx(x,{variant:"caption",color:"text.secondary",children:"12 AM"}),e.jsx(x,{variant:"caption",color:"text.secondary",children:"6 AM"}),e.jsx(x,{variant:"caption",color:"text.secondary",children:"12 PM"}),e.jsx(x,{variant:"caption",color:"text.secondary",children:"6 PM"}),e.jsx(x,{variant:"caption",color:"text.secondary",children:"12 AM"})]})]})};function ky(){const[t,r]=l.useState(null),[n,s]=l.useState(!0),[a,i]=l.useState(30),o=Ot();l.useEffect(()=>{c()},[a]);const c=async()=>{try{s(!0);const u=await dr.insights(a);r(u.data)}catch(u){console.error("Failed to load insights:",u)}finally{s(!1)}};if(n)return e.jsx(h,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:400},children:e.jsx(Ae,{})});if(!t)return e.jsx(h,{sx:{textAlign:"center",py:8},children:e.jsx(x,{variant:"h6",color:"text.secondary",children:"Unable to load analytics data"})});const f=Math.max(...t.top_artists.map(u=>u.play_count),1),d=Math.max(...t.top_channels.map(u=>u.play_count),1);return e.jsxs(h,{sx:{pb:4},children:[e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsxs(h,{children:[e.jsx(x,{variant:"h4",sx:{fontWeight:700,mb:.5},children:"Listening Insights"}),e.jsx(x,{variant:"body1",color:"text.secondary",children:"Your personal listening statistics and habits"})]}),e.jsxs(jt,{size:"small",sx:{minWidth:150},children:[e.jsx(zt,{children:"Time Range"}),e.jsxs(_t,{value:a,label:"Time Range",onChange:u=>i(Number(u.target.value)),children:[e.jsx(ve,{value:7,children:"Last 7 days"}),e.jsx(ve,{value:30,children:"Last 30 days"}),e.jsx(ve,{value:90,children:"Last 3 months"}),e.jsx(ve,{value:365,children:"Last year"})]})]})]}),e.jsxs(K,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(K,{item:!0,xs:6,sm:4,md:3,children:e.jsx(gr,{title:"Total Listening Time",value:Vr(t.total_listening_time),icon:e.jsx(Ka,{}),color:"primary.main"})}),e.jsx(K,{item:!0,xs:6,sm:4,md:3,children:e.jsx(gr,{title:"Tracks Played",value:t.total_tracks_played.toLocaleString(),subtitle:`${t.total_unique_tracks} unique`,icon:e.jsx(Ut,{}),color:"secondary.main"})}),e.jsx(K,{item:!0,xs:6,sm:4,md:3,children:e.jsx(gr,{title:"Unique Artists",value:t.total_unique_artists,icon:e.jsx(Wa,{}),color:"warning.main"})}),e.jsx(K,{item:!0,xs:6,sm:4,md:3,children:e.jsx(gr,{title:"Daily Average",value:Vr(t.avg_daily_listening),icon:e.jsx(ud,{}),color:"info.main"})}),e.jsx(K,{item:!0,xs:6,sm:4,md:3,children:e.jsx(gr,{title:"Current Streak",value:`${t.current_streak} days`,icon:e.jsx(Zs,{}),color:t.current_streak>0?"error.main":"text.disabled"})}),e.jsx(K,{item:!0,xs:6,sm:4,md:3,children:e.jsx(gr,{title:"Longest Streak",value:`${t.longest_streak} days`,icon:e.jsx(jo,{}),color:"success.main"})}),e.jsx(K,{item:!0,xs:6,sm:4,md:3,children:e.jsx(gr,{title:"Peak Hour",value:t.favorite_hour!==null?Ou(t.favorite_hour):"N/A",icon:e.jsx(hd,{}),color:"primary.main"})}),e.jsx(K,{item:!0,xs:6,sm:4,md:3,children:e.jsx(gr,{title:"Favorite Day",value:t.favorite_day||"N/A",icon:e.jsx(jo,{}),color:"secondary.main"})})]}),e.jsxs(K,{container:!0,spacing:3,children:[e.jsx(K,{item:!0,xs:12,md:6,children:e.jsx(Ce,{sx:{height:"100%"},children:e.jsxs(Ie,{children:[e.jsx(x,{variant:"h6",sx:{fontWeight:600,mb:1},children:"Listening Activity by Hour"}),e.jsx(x,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"When you listen to music throughout the day"}),e.jsx(Cy,{data:t.listening_by_hour})]})})}),e.jsx(K,{item:!0,xs:12,md:6,children:e.jsx(Ce,{sx:{height:"100%"},children:e.jsxs(Ie,{children:[e.jsx(x,{variant:"h6",sx:{fontWeight:600,mb:2},children:"Top Artists"}),t.top_artists.length===0?e.jsx(x,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",py:4},children:"No listening data yet"}):e.jsx(Ge,{dense:!0,disablePadding:!0,children:t.top_artists.slice(0,5).map((u,p)=>e.jsxs(Oe,{disableGutters:!0,sx:{py:1},children:[e.jsx(Et,{children:e.jsx(Ue,{sx:{bgcolor:p===0?"primary.main":qe(o.palette.primary.main,.2),color:p===0?"primary.contrastText":"primary.main",fontWeight:700},children:p+1})}),e.jsx(Se,{primary:u.artist,secondary:`${u.play_count} plays  ${Vr(u.total_duration)}`,primaryTypographyProps:{fontWeight:500}}),e.jsx(h,{sx:{width:80},children:e.jsx(rt,{variant:"determinate",value:u.play_count/f*100,sx:{height:6,borderRadius:3}})})]},u.artist))})]})})}),e.jsx(K,{item:!0,xs:12,md:6,children:e.jsx(Ce,{sx:{height:"100%"},children:e.jsxs(Ie,{children:[e.jsx(x,{variant:"h6",sx:{fontWeight:600,mb:2},children:"Top Channels"}),t.top_channels.length===0?e.jsx(x,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",py:4},children:"No listening data yet"}):e.jsx(Ge,{dense:!0,disablePadding:!0,children:t.top_channels.slice(0,5).map((u,p)=>e.jsxs(Oe,{disableGutters:!0,sx:{py:1},children:[e.jsx(Et,{children:e.jsx(Ue,{sx:{bgcolor:qe(o.palette.error.main,.1),color:"error.main"},children:e.jsx(La,{})})}),e.jsx(Se,{primary:u.channel_name,secondary:`${u.play_count} plays  ${Vr(u.total_duration)}`,primaryTypographyProps:{fontWeight:500,sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}}),e.jsx(h,{sx:{width:80},children:e.jsx(rt,{variant:"determinate",value:u.play_count/d*100,color:"error",sx:{height:6,borderRadius:3}})})]},u.channel_name))})]})})}),e.jsx(K,{item:!0,xs:12,md:6,children:e.jsx(Ce,{sx:{height:"100%"},children:e.jsxs(Ie,{children:[e.jsx(x,{variant:"h6",sx:{fontWeight:600,mb:2},children:"Most Played Tracks"}),t.top_tracks.length===0?e.jsx(x,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",py:4},children:"No listening data yet"}):e.jsx(Ge,{dense:!0,disablePadding:!0,children:t.top_tracks.slice(0,5).map((u,p)=>e.jsxs(Oe,{disableGutters:!0,sx:{py:1},children:[e.jsx(Et,{children:e.jsx(Ue,{variant:"rounded",src:u.thumbnail_url,sx:{width:48,height:48},children:e.jsx(Ut,{})})}),e.jsx(Se,{primary:u.title,secondary:u.artist,primaryTypographyProps:{fontWeight:500,sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},secondaryTypographyProps:{sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}}),e.jsx(de,{label:`${u.play_count}`,size:"small",color:"primary",sx:{ml:1}})]},`${u.youtube_id}-${p}`))})]})})}),e.jsx(K,{item:!0,xs:12,children:e.jsx(Ce,{children:e.jsxs(Ie,{children:[e.jsx(x,{variant:"h6",sx:{fontWeight:600,mb:2},children:"Recent Listening History"}),t.recent_history.length===0?e.jsx(x,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",py:4},children:"No recent listening history"}):e.jsx(Ge,{disablePadding:!0,children:t.recent_history.map(u=>e.jsxs(Oe,{sx:{borderRadius:2,mb:1,"&:hover":{bgcolor:qe(o.palette.primary.main,.05)}},children:[e.jsx(Et,{children:e.jsx(Ue,{variant:"rounded",src:u.thumbnail_url,sx:{width:48,height:48},children:e.jsx(Ut,{})})}),e.jsx(Se,{primary:u.title,secondary:e.jsxs(h,{component:"span",sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx("span",{children:u.artist||u.channel_name}),e.jsx("span",{children:""}),e.jsx("span",{children:Vr(u.duration_listened)}),u.completed&&e.jsx(de,{label:"Completed",size:"small",color:"success",sx:{height:18,fontSize:"0.65rem"}})]}),primaryTypographyProps:{fontWeight:500,sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}}),e.jsx(x,{variant:"caption",color:"text.secondary",children:new Date(u.listened_at).toLocaleString()})]},u.id))})]})})}),t.genre_distribution.length>0&&e.jsx(K,{item:!0,xs:12,md:6,children:e.jsx(Ce,{children:e.jsxs(Ie,{children:[e.jsx(x,{variant:"h6",sx:{fontWeight:600,mb:2},children:"Genre Distribution"}),e.jsx(h,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:t.genre_distribution.map(u=>e.jsx(de,{label:`${u.genre} (${u.play_count})`,variant:"outlined",color:"primary"},u.genre))})]})})})]})]})}function Ur(t){const{children:r,value:n,index:s,...a}=t;return e.jsx("div",{hidden:n!==s,...a,children:n===s&&e.jsx(h,{sx:{py:3},children:r})})}function _y(){const[t,r]=l.useState(0),[n,s]=l.useState(!0),[a,i]=l.useState(""),[o,c]=l.useState([]),[f,d]=l.useState(null),[u,p]=l.useState(!1),[g,y]=l.useState("");l.useEffect(()=>{m()},[]);const m=async()=>{try{s(!0);const[C,A]=await Promise.all([dr.achievements({progress:!0}),dr.streak()]);c(C.data),d(A.data),i("")}catch(C){console.error("Failed to load achievements:",C),i("Failed to load achievements data")}finally{s(!1)}},b=async()=>{try{const C=await dr.checkAchievements();C.data.new_achievements?.length>0?(y(` ${C.data.total_new} new achievement(s) unlocked!`),p(!0),m()):(y("No new achievements yet. Keep listening!"),p(!0))}catch(C){console.error("Failed to check achievements:",C),y("Failed to check achievements"),p(!0)}},S={tracks:o.filter(C=>C.type.startsWith("tracks_")),time:o.filter(C=>C.type.startsWith("hours_")),streaks:o.filter(C=>C.type.startsWith("streak_")),variety:o.filter(C=>C.type.startsWith("artists_")||C.type.startsWith("channels_")),special:o.filter(C=>!C.type.startsWith("tracks_")&&!C.type.startsWith("hours_")&&!C.type.startsWith("streak_")&&!C.type.startsWith("artists_")&&!C.type.startsWith("channels_"))},v=o.filter(C=>C.unlocked).length,j=o.length,w=j>0?Math.round(v/j*100):0;return n?e.jsx(h,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:400},children:e.jsx(Ae,{})}):a?e.jsx(h,{sx:{p:3},children:e.jsx(ge,{severity:"error",children:a})}):e.jsxs(h,{children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:3,flexWrap:"wrap",gap:2},children:[e.jsxs(h,{children:[e.jsx(x,{variant:"h4",sx:{fontWeight:700,letterSpacing:"-0.02em"},children:" Achievements"}),e.jsx(x,{variant:"body2",color:"text.secondary",children:"Track your listening milestones and earn badges"})]}),e.jsx(q,{variant:"outlined",startIcon:e.jsx($r,{}),onClick:b,children:"Check for New"})]}),f&&e.jsx(Ce,{sx:{mb:3,bgcolor:f.streak_at_risk?"rgba(255, 152, 0, 0.1)":f.current_streak>0?"rgba(19, 236, 106, 0.1)":"background.paper",border:"1px solid",borderColor:f.streak_at_risk?"warning.main":f.current_streak>0?"primary.main":"divider"},children:e.jsxs(Ie,{children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:2,mb:2,flexWrap:"wrap"},children:[e.jsx(Zs,{sx:{fontSize:48,color:f.current_streak>0?"warning.main":"text.secondary",animation:f.current_streak>=7?"pulse 2s infinite":"none","@keyframes pulse":{"0%, 100%":{transform:"scale(1)"},"50%":{transform:"scale(1.1)"}}}}),e.jsxs(h,{sx:{flex:1,minWidth:200},children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1,flexWrap:"wrap"},children:[e.jsxs(x,{variant:"h4",sx:{fontWeight:700},children:[f.current_streak," Day Streak"]}),f.streak_at_risk&&e.jsx(de,{label:" At Risk!",color:"warning",size:"small"}),f.current_streak>=7&&e.jsx(de,{label:" On Fire!",color:"error",size:"small"})]}),e.jsx(x,{variant:"body2",color:"text.secondary",children:f.listened_today?"Great job! You've listened today. Keep it up!":"Listen to a track today to maintain your streak!"})]}),e.jsxs(h,{sx:{textAlign:"center",px:2,borderLeft:"1px solid",borderColor:"divider"},children:[e.jsx(x,{variant:"caption",color:"text.secondary",children:"Best Streak"}),e.jsx(x,{variant:"h5",sx:{fontWeight:700,color:"success.main"},children:f.longest_streak}),e.jsx(x,{variant:"caption",color:"text.secondary",children:"days"})]})]}),e.jsx(x,{variant:"subtitle2",sx:{mb:1},children:"This Week"}),e.jsx(h,{sx:{display:"flex",gap:1.5,justifyContent:"space-between"},children:f.recent_days.map(C=>e.jsx(be,{title:`${C.day_name}: ${C.tracks_played} tracks played`,arrow:!0,children:e.jsxs(h,{sx:{textAlign:"center",flex:1},children:[e.jsx(x,{variant:"caption",sx:{color:C.has_activity?"primary.main":"text.secondary",fontWeight:C.has_activity?600:400},children:C.day_name}),e.jsx(h,{sx:{width:"100%",aspectRatio:"1",maxWidth:48,borderRadius:1.5,mx:"auto",mt:.5,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:C.has_activity?"primary.main":"rgba(255, 255, 255, 0.05)",color:C.has_activity?"background.dark":"text.secondary",fontWeight:700,fontSize:"0.875rem",transition:"all 0.3s ease",border:"2px solid",borderColor:C.has_activity?"primary.main":"transparent"},children:C.has_activity?C.tracks_played:""})]})},C.date))}),f.next_milestone&&f.current_streak>0&&e.jsxs(h,{sx:{mt:3},children:[e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",mb:.5},children:[e.jsxs(x,{variant:"body2",color:"text.secondary",children:["Next milestone: ",e.jsxs("strong",{children:[f.next_milestone,"-day streak"]})]}),e.jsxs(x,{variant:"body2",color:"primary.main",fontWeight:600,children:[f.days_to_milestone," days to go"]})]}),e.jsx(rt,{variant:"determinate",value:f.current_streak/f.next_milestone*100,sx:{height:8,borderRadius:1}})]})]})}),e.jsx(Ce,{sx:{mb:3},children:e.jsx(Ie,{children:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx($a,{sx:{fontSize:48,color:"warning.main"}}),e.jsxs(h,{sx:{flex:1},children:[e.jsxs(x,{variant:"h6",sx:{fontWeight:600,mb:.5},children:[v," of ",j," Achievements Unlocked"]}),e.jsx(rt,{variant:"determinate",value:w,sx:{height:10,borderRadius:1}})]}),e.jsxs(x,{variant:"h3",sx:{fontWeight:700,color:"primary.main",minWidth:80,textAlign:"right"},children:[w,"%"]})]})})}),e.jsxs(Ji,{value:t,onChange:(C,A)=>r(A),variant:"scrollable",scrollButtons:"auto",sx:{mb:2,borderBottom:1,borderColor:"divider","& .MuiTab-root":{minHeight:48,textTransform:"none",fontWeight:500}},children:[e.jsx(qt,{label:`All (${v}/${j})`,icon:e.jsx($a,{sx:{fontSize:20}}),iconPosition:"start"}),e.jsx(qt,{label:`Tracks (${S.tracks.filter(C=>C.unlocked).length})`,icon:e.jsx(Ut,{sx:{fontSize:20}}),iconPosition:"start"}),e.jsx(qt,{label:`Time (${S.time.filter(C=>C.unlocked).length})`,icon:e.jsx(Ka,{sx:{fontSize:20}}),iconPosition:"start"}),e.jsx(qt,{label:`Streaks (${S.streaks.filter(C=>C.unlocked).length})`,icon:e.jsx(Zs,{sx:{fontSize:20}}),iconPosition:"start"}),e.jsx(qt,{label:`Variety (${S.variety.filter(C=>C.unlocked).length})`,icon:e.jsx(ud,{sx:{fontSize:20}}),iconPosition:"start"}),e.jsx(qt,{label:`Special (${S.special.filter(C=>C.unlocked).length})`,icon:e.jsx(cr,{sx:{fontSize:20}}),iconPosition:"start"})]}),e.jsx(Ur,{value:t,index:0,children:e.jsx(Hr,{achievements:o})}),e.jsx(Ur,{value:t,index:1,children:e.jsx(Hr,{achievements:S.tracks})}),e.jsx(Ur,{value:t,index:2,children:e.jsx(Hr,{achievements:S.time})}),e.jsx(Ur,{value:t,index:3,children:e.jsx(Hr,{achievements:S.streaks})}),e.jsx(Ur,{value:t,index:4,children:e.jsx(Hr,{achievements:S.variety})}),e.jsx(Ur,{value:t,index:5,children:e.jsx(Hr,{achievements:S.special})}),e.jsx(ct,{open:u,autoHideDuration:4e3,onClose:()=>p(!1),message:g})]})}function Hr({achievements:t}){const r=[...t].sort((n,s)=>n.unlocked&&!s.unlocked?-1:!n.unlocked&&s.unlocked?1:s.progress-n.progress);return r.length===0?e.jsx(h,{sx:{textAlign:"center",py:4},children:e.jsx(x,{color:"text.secondary",children:"No achievements in this category"})}):e.jsx(K,{container:!0,spacing:2,children:r.map(n=>e.jsx(K,{item:!0,xs:12,sm:6,md:4,children:e.jsx(Ce,{sx:{height:"100%",bgcolor:n.unlocked?"rgba(19, 236, 106, 0.08)":"background.paper",border:"1px solid",borderColor:n.unlocked?"primary.main":"divider",opacity:n.unlocked?1:.8,transition:"all 0.3s ease","&:hover":{transform:"translateY(-4px)",boxShadow:n.unlocked?"0 8px 24px rgba(19, 236, 106, 0.2)":"0 8px 24px rgba(0, 0, 0, 0.2)"}},children:e.jsxs(Ie,{children:[e.jsxs(h,{sx:{display:"flex",alignItems:"flex-start",gap:1.5,mb:2},children:[e.jsx(h,{sx:{fontSize:40,lineHeight:1,filter:n.unlocked?"none":"grayscale(100%)",opacity:n.unlocked?1:.5},children:n.icon}),e.jsxs(h,{sx:{flex:1,minWidth:0},children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(x,{variant:"subtitle1",sx:{fontWeight:600,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:n.name}),n.unlocked?e.jsx(Mr,{sx:{fontSize:18,color:"success.main",flexShrink:0}}):e.jsx(kh,{sx:{fontSize:16,color:"text.secondary",flexShrink:0}})]}),e.jsx(x,{variant:"body2",color:"text.secondary",sx:{mt:.25},children:n.description})]})]}),e.jsxs(h,{children:[e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",mb:.5},children:[e.jsx(x,{variant:"caption",color:"text.secondary",children:n.unlocked?"Completed!":"Progress"}),e.jsxs(x,{variant:"caption",sx:{fontWeight:600,color:n.unlocked?"success.main":"text.primary"},children:[typeof n.current=="number"&&n.current<1?n.current.toFixed(1):Math.floor(n.current)," / ",n.threshold]})]}),e.jsx(rt,{variant:"determinate",value:n.progress,color:n.unlocked?"success":"primary",sx:{height:8,borderRadius:1,bgcolor:"rgba(255, 255, 255, 0.1)"}})]})]})})},n.type))})}function Ry(){const t=new Date().getFullYear(),[r,n]=l.useState(t),[s,a]=l.useState(null),[i,o]=l.useState(!0),[c,f]=l.useState(""),d=Array.from({length:6},(y,m)=>t-m);l.useEffect(()=>{u()},[r]);const u=async()=>{try{o(!0),f("");const y=await dr.yearlyWrapped(r);a(y.data)}catch(y){console.error("Failed to load yearly wrapped:",y),y.response?.status===404?f(`No listening data found for ${r}`):f("Failed to load yearly wrapped"),a(null)}finally{o(!1)}},p=y=>{if(y<60)return`${y} minutes`;const m=Math.floor(y/60);return m<24?`${m} hours`:`${Math.floor(m/24)} days, ${m%24} hours`},g=y=>y===null?"N/A":y===0?"12 AM":y===12?"12 PM":y>12?`${y-12} PM`:`${y} AM`;return i?e.jsx(h,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:400},children:e.jsx(Ae,{})}):e.jsxs(h,{sx:{pb:4},children:[e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4,flexWrap:"wrap",gap:2},children:[e.jsxs(h,{children:[e.jsxs(x,{variant:"h4",sx:{fontWeight:700},children:[" Your ",r," Wrapped"]}),e.jsx(x,{variant:"body1",color:"text.secondary",children:"A look back at your listening journey"})]}),e.jsxs(jt,{size:"small",sx:{minWidth:120},children:[e.jsx(zt,{children:"Year"}),e.jsx(_t,{value:r,label:"Year",onChange:y=>n(Number(y.target.value)),children:d.map(y=>e.jsx(ve,{value:y,children:y},y))})]})]}),c?e.jsxs(ge,{severity:"info",sx:{mb:3},children:[c,". Start listening to build your wrapped!"]}):s&&e.jsxs(e.Fragment,{children:[e.jsx(Ce,{sx:{mb:4,background:"linear-gradient(135deg, rgba(19, 236, 106, 0.2) 0%, rgba(103, 58, 183, 0.2) 100%)",border:"2px solid",borderColor:"primary.main"},children:e.jsxs(Ie,{sx:{textAlign:"center",py:4},children:[e.jsx(x,{variant:"h5",sx:{mb:1},children:"Your Listening Personality"}),e.jsx(x,{variant:"h3",sx:{fontWeight:700,color:"primary.main"},children:s.listening_personality})]})}),e.jsxs(K,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(K,{item:!0,xs:6,md:3,children:e.jsx(Ma,{icon:e.jsx(Ka,{sx:{fontSize:32}}),label:"Minutes Listened",value:s.total_minutes_listened.toLocaleString(),subtitle:p(s.total_minutes_listened),color:"primary.main"})}),e.jsx(K,{item:!0,xs:6,md:3,children:e.jsx(Ma,{icon:e.jsx(Ut,{sx:{fontSize:32}}),label:"Tracks Played",value:s.total_tracks_played.toLocaleString(),subtitle:`${s.total_unique_tracks} unique`,color:"secondary.main"})}),e.jsx(K,{item:!0,xs:6,md:3,children:e.jsx(Ma,{icon:e.jsx(Wa,{sx:{fontSize:32}}),label:"Artists Discovered",value:s.total_unique_artists.toString(),color:"warning.main"})}),e.jsx(K,{item:!0,xs:6,md:3,children:e.jsx(Ma,{icon:e.jsx(Zs,{sx:{fontSize:32}}),label:"Longest Streak",value:`${s.longest_streak} days`,subtitle:`${s.total_listening_days} days active`,color:"error.main"})})]}),e.jsxs(K,{container:!0,spacing:3,sx:{mb:4},children:[s.top_artist&&e.jsx(K,{item:!0,xs:12,md:6,children:e.jsx(Ce,{sx:{height:"100%"},children:e.jsxs(Ie,{children:[e.jsx(x,{variant:"overline",color:"text.secondary",children:"#1 Artist"}),e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:2,mt:1},children:[e.jsx(Ue,{sx:{width:64,height:64,bgcolor:"warning.main"},children:e.jsx(Wa,{sx:{fontSize:32}})}),e.jsxs(h,{children:[e.jsx(x,{variant:"h5",sx:{fontWeight:700},children:s.top_artist.artist}),e.jsxs(x,{variant:"body2",color:"text.secondary",children:[s.top_artist.play_count," plays  ",s.top_artist.total_minutes," minutes"]})]})]})]})})}),s.top_track&&e.jsx(K,{item:!0,xs:12,md:6,children:e.jsx(Ce,{sx:{height:"100%"},children:e.jsxs(Ie,{children:[e.jsx(x,{variant:"overline",color:"text.secondary",children:"#1 Track"}),e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:2,mt:1},children:[s.top_track.thumbnail_url?e.jsx(Ue,{src:s.top_track.thumbnail_url,variant:"rounded",sx:{width:64,height:64}}):e.jsx(Ue,{sx:{width:64,height:64,bgcolor:"primary.main"},variant:"rounded",children:e.jsx(Ut,{sx:{fontSize:32}})}),e.jsxs(h,{sx:{overflow:"hidden"},children:[e.jsx(x,{variant:"h6",sx:{fontWeight:700},noWrap:!0,children:s.top_track.title}),e.jsx(x,{variant:"body2",color:"text.secondary",noWrap:!0,children:s.top_track.artist}),e.jsxs(x,{variant:"caption",color:"primary.main",children:[s.top_track.play_count," plays"]})]})]})]})})})]}),e.jsxs(K,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(K,{item:!0,xs:12,md:6,children:e.jsx(Ce,{sx:{height:"100%"},children:e.jsxs(Ie,{children:[e.jsx(x,{variant:"h6",sx:{fontWeight:600,mb:2},children:" Top 5 Artists"}),s.top_5_artists.map((y,m)=>e.jsx(h,{sx:{mb:1.5},children:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(x,{variant:"h6",sx:{width:28,fontWeight:700,color:m===0?"warning.main":"text.secondary"},children:m+1}),e.jsxs(h,{sx:{flex:1,minWidth:0},children:[e.jsx(x,{variant:"body1",sx:{fontWeight:500},noWrap:!0,children:y.artist}),e.jsxs(x,{variant:"caption",color:"text.secondary",children:[y.play_count," plays"]})]})]})},y.artist))]})})}),e.jsx(K,{item:!0,xs:12,md:6,children:e.jsx(Ce,{sx:{height:"100%"},children:e.jsxs(Ie,{children:[e.jsx(x,{variant:"h6",sx:{fontWeight:600,mb:2},children:" Top 5 Tracks"}),s.top_5_tracks.map((y,m)=>e.jsx(h,{sx:{mb:1.5},children:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(x,{variant:"h6",sx:{width:28,fontWeight:700,color:m===0?"warning.main":"text.secondary"},children:m+1}),y.thumbnail_url&&e.jsx(Ue,{src:y.thumbnail_url,variant:"rounded",sx:{width:40,height:40}}),e.jsxs(h,{sx:{flex:1,minWidth:0},children:[e.jsx(x,{variant:"body2",sx:{fontWeight:500},noWrap:!0,children:y.title}),e.jsxs(x,{variant:"caption",color:"text.secondary",noWrap:!0,children:[y.artist,"  ",y.play_count," plays"]})]})]})},y.youtube_id))]})})})]}),e.jsx(Ce,{sx:{mb:4},children:e.jsxs(Ie,{children:[e.jsx(x,{variant:"h6",sx:{fontWeight:600,mb:2},children:" Monthly Listening"}),e.jsx(h,{sx:{display:"flex",gap:1,alignItems:"flex-end",height:150},children:s.monthly_minutes.map(y=>{const m=Math.max(...s.monthly_minutes.map(S=>S.minutes),1),b=y.minutes/m*100;return e.jsxs(h,{sx:{flex:1,display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsx(h,{sx:{width:"100%",height:`${b}%`,minHeight:4,bgcolor:y.month===s.peak_month?"primary.main":"rgba(19, 236, 106, 0.3)",borderRadius:"4px 4px 0 0",transition:"all 0.3s ease","&:hover":{bgcolor:"primary.main"}}}),e.jsx(x,{variant:"caption",sx:{mt:.5,fontSize:"0.65rem",color:y.month===s.peak_month?"primary.main":"text.secondary",fontWeight:y.month===s.peak_month?600:400},children:y.month.substring(0,3)})]},y.month_num)})}),e.jsxs(h,{sx:{mt:2,display:"flex",gap:2,justifyContent:"center",flexWrap:"wrap"},children:[e.jsx(de,{icon:e.jsx(Ja,{}),label:`Peak Month: ${s.peak_month}`,color:"primary",variant:"outlined"}),e.jsx(de,{icon:s.peak_hour!==null&&s.peak_hour>=18?e.jsx(_h,{}):e.jsx(Rh,{}),label:`Peak Time: ${g(s.peak_hour)}`,variant:"outlined"}),e.jsx(de,{label:`Favorite Day: ${s.peak_day_of_week}`,variant:"outlined"})]})]})}),e.jsx(Ce,{children:e.jsxs(Ie,{sx:{textAlign:"center"},children:[e.jsx($a,{sx:{fontSize:48,color:"warning.main",mb:1}}),e.jsxs(x,{variant:"h5",sx:{fontWeight:600},children:[s.achievements_unlocked," Achievements Unlocked"]}),e.jsxs(x,{variant:"body2",color:"text.secondary",children:["in ",r]})]})})]})]})}function Ma({icon:t,label:r,value:n,subtitle:s,color:a}){return e.jsx(Ce,{sx:{height:"100%"},children:e.jsxs(Ie,{children:[e.jsx(h,{sx:{color:a,mb:1},children:t}),e.jsx(x,{variant:"overline",color:"text.secondary",sx:{fontSize:"0.7rem"},children:r}),e.jsx(x,{variant:"h4",sx:{fontWeight:700,color:a},children:n}),s&&e.jsx(x,{variant:"caption",color:"text.secondary",children:s})]})})}const Iy=t=>{const r=Math.floor(t/60),n=t%60;return`${r}:${n.toString().padStart(2,"0")}`},Ay=t=>{const r=new Date(t),s=new Date().getTime()-r.getTime(),a=Math.floor(s/6e4),i=Math.floor(s/36e5),o=Math.floor(s/864e5);return a<1?"Just now":a<60?`${a}m ago`:i<24?`${i}h ago`:o<7?`${o}d ago`:r.toLocaleDateString()},Py=l.memo(({entry:t,onPlay:r})=>{const n=Ot();return e.jsxs(Oe,{sx:{borderRadius:2,mb:.5,cursor:"pointer",transition:"background-color 0.15s ease","&:hover":{bgcolor:qe(n.palette.primary.main,.08)}},onClick:()=>r(t),children:[e.jsx(Et,{children:e.jsx(Ue,{src:t.thumbnail_url,variant:"rounded",sx:{width:56,height:56,boxShadow:2},children:e.jsx(Ut,{})})}),e.jsx(Se,{primary:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(x,{variant:"body1",fontWeight:500,noWrap:!0,sx:{maxWidth:"70%"},children:t.title}),t.completed&&e.jsx(de,{label:"",size:"small",color:"success",variant:"outlined",sx:{height:18,fontSize:"0.65rem",minWidth:24}})]}),secondary:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1,mt:.5},children:[e.jsx(x,{variant:"body2",color:"text.secondary",noWrap:!0,children:t.artist||t.channel_name}),e.jsx(x,{variant:"caption",color:"text.disabled",children:""}),e.jsx(x,{variant:"caption",color:"text.secondary",children:Iy(t.duration_listened)})]}),sx:{ml:1}}),e.jsx(Ir,{children:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(be,{title:new Date(t.listened_at).toLocaleString(),children:e.jsx(x,{variant:"caption",color:"text.secondary",children:Ay(t.listened_at)})}),e.jsx(J,{size:"small",color:"primary",onClick:s=>{s.stopPropagation(),r(t)},children:e.jsx(nr,{})})]})})]})}),Dy=l.memo(({label:t,count:r,isExpanded:n,onToggle:s})=>e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1,mb:1,cursor:"pointer",userSelect:"none",py:.5},onClick:s,children:[t==="Today"&&e.jsx(Ih,{color:"primary",fontSize:"small"}),t==="Yesterday"&&e.jsx(Ka,{color:"secondary",fontSize:"small"}),!["Today","Yesterday"].includes(t)&&e.jsx(Ja,{color:"action",fontSize:"small"}),e.jsx(x,{variant:"subtitle1",fontWeight:600,color:"text.primary",children:t}),e.jsx(de,{label:r,size:"small",variant:"outlined",sx:{height:20,fontSize:"0.7rem"}}),e.jsx(h,{sx:{flex:1}}),e.jsx(J,{size:"small",children:n?e.jsx(fd,{}):e.jsx(xd,{})})]}));function My({onTrackSelect:t}){const r=Ot(),[n,s]=l.useState([]),[a,i]=l.useState({}),[o,c]=l.useState(!0),[f,d]=l.useState(!1),[u,p]=l.useState(1),[g,y]=l.useState(1),[m,b]=l.useState(null),[S,v]=l.useState(!1),[j,w]=l.useState(!1),[C,A]=l.useState(new Set),[P,D]=l.useState(!0);l.useEffect(()=>{const k=G=>{const M=G.target;M&&w(M.scrollTop>400)},E=(()=>{let G=document.querySelector("[data-history-page]")?.parentElement;for(;G;){const M=window.getComputedStyle(G);if(M.overflow==="auto"||M.overflowY==="auto"||M.overflow==="scroll"||M.overflowY==="scroll")return G;G=G.parentElement}return null})();if(E)return E.addEventListener("scroll",k,{passive:!0}),()=>E.removeEventListener("scroll",k);const Z=()=>{const G=window.scrollY||document.documentElement.scrollTop;w(G>400)};return window.addEventListener("scroll",Z,{passive:!0}),()=>window.removeEventListener("scroll",Z)},[]);const R=l.useCallback(()=>{const O=(()=>{let E=document.querySelector("[data-history-page]")?.parentElement;for(;E;){const Z=window.getComputedStyle(E);if(Z.overflow==="auto"||Z.overflowY==="auto"||Z.overflow==="scroll"||Z.overflowY==="scroll")return E;E=E.parentElement}return null})();O?O.scrollTo({top:0,behavior:"smooth"}):window.scrollTo({top:0,behavior:"smooth"})},[]),_=l.useCallback(async(k=1,O=!1)=>{try{k===1?c(!0):d(!0),b(null);const E=await dr.history({page:k,page_size:100});s(O?Z=>[...Z,...E.data.results]:E.data.results),p(k),y(E.data.total_pages)}catch(E){b(E.message||"Failed to load history")}finally{c(!1),d(!1)}},[]),z=l.useCallback(async()=>{try{const k=await dr.onThisDay();i(k.data)}catch(k){console.error("Failed to load On This Day data:",k)}},[]);l.useEffect(()=>{_(),z()},[_,z]);const W=l.useMemo(()=>{if(n.length===0)return[];const k={},O=new Date,E=new Date(O.getFullYear(),O.getMonth(),O.getDate()),Z=new Date(E.getTime()-1440*60*1e3),G=new Date(E.getTime()-E.getDay()*24*60*60*1e3),M=new Date(G.getTime()-10080*60*1e3),T=new Date(O.getFullYear(),O.getMonth(),1),ae=new Date(O.getFullYear(),O.getMonth()-1,1);for(const ue of n){const $=new Date(ue.listened_at);let ie;$>=E?ie="Today":$>=Z?ie="Yesterday":$>=G?ie="This Week":$>=M?ie="Last Week":$>=T?ie="This Month":$>=ae?ie="Last Month":ie=$.toLocaleDateString("en-US",{month:"long",year:"numeric"}),k[ie]||(k[ie]=[]),k[ie].push(ue)}const L=["Today","Yesterday","This Week","Last Week","This Month","Last Month"],N=[];for(const ue of L)k[ue]&&(N.push({label:ue,entries:k[ue]}),delete k[ue]);const X=Object.keys(k).sort((ue,$)=>{const ie=new Date(k[ue][0].listened_at);return new Date(k[$][0].listened_at).getTime()-ie.getTime()});for(const ue of X)N.push({label:ue,entries:k[ue]});return N},[n]),B=l.useCallback(k=>{if(t){const O={id:k.audio_id,youtube_id:k.youtube_id,title:k.title,channel_name:k.channel_name,thumbnail_url:k.thumbnail_url,duration:k.duration_listened,file_size:0,play_count:0,is_favorite:!1};t(O)}},[t]),H=l.useCallback(async k=>{try{await dr.clearHistory(k),v(!1),_(),z()}catch(O){console.error("Failed to clear history:",O)}},[_,z]),se=l.useCallback(k=>{A(O=>{const E=new Set(O);return E.has(k)?E.delete(k):E.add(k),E})},[]),I=l.useMemo(()=>Object.keys(a).length>0?e.jsx(Ce,{sx:{mb:3,background:`linear-gradient(135deg, ${qe(r.palette.secondary.main,.1)} 0%, ${qe(r.palette.primary.main,.1)} 100%)`,border:`1px solid ${qe(r.palette.secondary.main,.2)}`},children:e.jsxs(Ie,{children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",userSelect:"none",mb:P?2:0},onClick:()=>D(O=>!O),children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ah,{color:"secondary"}),e.jsx(x,{variant:"h6",fontWeight:600,children:"On This Day"}),e.jsx(de,{label:`${Object.keys(a).length} memories`,size:"small",color:"secondary",variant:"outlined"})]}),e.jsx(J,{size:"small",children:P?e.jsx(fd,{}):e.jsx(xd,{})})]}),e.jsx(Li,{in:P,timeout:200,children:e.jsx(K,{container:!0,spacing:2,children:Object.entries(a).map(([O,E])=>e.jsx(K,{item:!0,xs:12,md:4,children:e.jsxs(pt,{sx:{p:2,bgcolor:qe(r.palette.background.paper,.8),height:"100%"},children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(Ja,{fontSize:"small",color:"primary"}),e.jsx(x,{variant:"subtitle1",fontWeight:600,children:E.label})]}),e.jsx(x,{variant:"caption",color:"text.secondary",display:"block",mb:1,children:new Date(E.date).toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"})}),e.jsx(Ge,{dense:!0,sx:{py:0},children:E.tracks.slice(0,3).map(Z=>e.jsxs(Oe,{sx:{px:0,cursor:"pointer",borderRadius:1,"&:hover":{bgcolor:qe(r.palette.primary.main,.1)}},onClick:()=>B(Z),children:[e.jsx(Et,{sx:{minWidth:48},children:e.jsx(Ue,{src:Z.thumbnail_url,variant:"rounded",sx:{width:40,height:40},children:e.jsx(Ut,{})})}),e.jsx(Se,{primary:Z.title,secondary:Z.artist||Z.channel_name,primaryTypographyProps:{noWrap:!0,fontSize:"0.875rem",fontWeight:500},secondaryTypographyProps:{noWrap:!0,fontSize:"0.75rem"}}),e.jsx(J,{size:"small",color:"primary",onClick:G=>{G.stopPropagation(),B(Z)},children:e.jsx(nr,{fontSize:"small"})})]},Z.id))}),E.tracks.length>3&&e.jsxs(x,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:["+",E.tracks.length-3," more tracks"]})]})},O))})})]})}):null,[a,P,r,B]);return o?e.jsxs(h,{sx:{p:3},children:[e.jsx(wo,{variant:"rectangular",height:200,sx:{mb:3,borderRadius:2}}),[1,2,3,4,5].map(k=>e.jsx(wo,{variant:"rectangular",height:72,sx:{mb:1,borderRadius:2}},k))]}):m?e.jsxs(h,{sx:{p:3},children:[e.jsx(ge,{severity:"error",sx:{mb:2},children:m}),e.jsx(q,{variant:"contained",onClick:()=>_(),children:"Retry"})]}):e.jsxs(h,{"data-history-page":!0,sx:{p:{xs:2,md:3},maxWidth:1200,mx:"auto"},children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:3},children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(od,{sx:{fontSize:32,color:"primary.main"}}),e.jsxs(h,{children:[e.jsx(x,{variant:"h4",fontWeight:700,children:"Listening History"}),e.jsxs(x,{variant:"body2",color:"text.secondary",children:[n.length," tracks in your history"]})]})]}),e.jsxs(h,{sx:{display:"flex",gap:1},children:[e.jsx(be,{title:"Refresh",children:e.jsx(J,{onClick:()=>{_(),z()},children:e.jsx($r,{})})}),e.jsx(q,{variant:"outlined",color:"error",startIcon:e.jsx(Dr,{}),onClick:()=>v(!0),children:"Clear"})]})]}),I,W.length===0?e.jsxs(Ce,{sx:{textAlign:"center",py:8},children:[e.jsx(Ut,{sx:{fontSize:64,color:"text.disabled",mb:2}}),e.jsx(x,{variant:"h6",color:"text.secondary",children:"No listening history yet"}),e.jsx(x,{variant:"body2",color:"text.disabled",children:"Start playing some music to build your history!"})]}):W.map(k=>{const O=!C.has(k.label);return e.jsxs(h,{sx:{mb:3},children:[e.jsx(Dy,{label:k.label,count:k.entries.length,isExpanded:O,onToggle:()=>se(k.label)}),e.jsx(Li,{in:O,timeout:150,unmountOnExit:!0,children:e.jsx(Ce,{variant:"outlined",sx:{borderRadius:2},children:e.jsxs(Ge,{sx:{py:0},children:[k.entries.slice(0,50).map((E,Z)=>e.jsxs(h,{children:[e.jsx(Py,{entry:E,onPlay:B}),Z<Math.min(k.entries.length,50)-1&&e.jsx(De,{variant:"inset"})]},E.id)),k.entries.length>50&&e.jsx(h,{sx:{p:2,textAlign:"center"},children:e.jsxs(x,{variant:"caption",color:"text.secondary",children:["Showing first 50 of ",k.entries.length," tracks"]})})]})})})]},k.label)}),u<g&&e.jsx(h,{sx:{display:"flex",justifyContent:"center",mt:3},children:e.jsx(q,{variant:"outlined",onClick:()=>_(u+1,!0),disabled:f,startIcon:f?e.jsx(Ae,{size:16}):null,children:f?"Loading...":"Load More"})}),e.jsxs(Qe,{open:S,onClose:()=>v(!1),children:[e.jsx(Xe,{children:"Clear Listening History"}),e.jsxs(Ke,{children:[e.jsx(x,{gutterBottom:!0,children:"Choose how much history to clear:"}),e.jsxs(h,{sx:{display:"flex",flexDirection:"column",gap:1,mt:2},children:[e.jsx(q,{variant:"outlined",onClick:()=>H(7),fullWidth:!0,children:"Clear older than 1 week"}),e.jsx(q,{variant:"outlined",onClick:()=>H(30),fullWidth:!0,children:"Clear older than 1 month"}),e.jsx(q,{variant:"outlined",onClick:()=>H(90),fullWidth:!0,children:"Clear older than 3 months"}),e.jsx(De,{sx:{my:1}}),e.jsx(q,{variant:"contained",color:"error",onClick:()=>H(),fullWidth:!0,children:"Clear All History"})]})]}),e.jsx(tt,{children:e.jsx(q,{onClick:()=>v(!1),children:"Cancel"})})]}),e.jsx(Jc,{in:j,children:e.jsx(Xc,{color:"primary",size:"medium",onClick:R,sx:{position:"fixed",bottom:{xs:80,md:24},right:24,zIndex:1e3},"aria-label":"scroll to top",children:e.jsx(Ph,{})})})]})}function Ey({children:t}){const[r,n]=l.useState(!0),[s,a]=l.useState(!1);return l.useEffect(()=>{(async()=>{try{const c=(await U.get("/user/account/")).data;a(c.is_admin||c.is_superuser||c.is_staff)}catch(o){console.error("Error checking admin status:",o),a(!1)}finally{n(!1)}})()},[]),r?e.jsx(h,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:e.jsx(Ae,{})}):s?e.jsx(e.Fragment,{children:t}):e.jsx(gd,{to:"/",replace:!0})}var cs={},lc;function Ty(){if(lc)return cs;lc=1;var t=te();Object.defineProperty(cs,"__esModule",{value:!0}),cs.default=void 0;var r=t(ne()),n=re();return cs.default=(0,r.default)((0,n.jsx)("path",{d:"M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"}),"Home"),cs}var zy=Ty();const Oy=ee(zy);var ds={},cc;function Fy(){if(cc)return ds;cc=1;var t=te();Object.defineProperty(ds,"__esModule",{value:!0}),ds.default=void 0;var r=t(ne()),n=re();return ds.default=(0,r.default)((0,n.jsx)("path",{d:"M20 2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m-2 5h-3v5.5c0 1.38-1.12 2.5-2.5 2.5S10 13.88 10 12.5s1.12-2.5 2.5-2.5c.57 0 1.08.19 1.5.51V5h4zM4 6H2v14c0 1.1.9 2 2 2h14v-2H4z"}),"LibraryMusic"),ds}var Ly=Fy();const Wy=ee(Ly);var us={},dc;function $y(){if(dc)return us;dc=1;var t=te();Object.defineProperty(us,"__esModule",{value:!0}),us.default=void 0;var r=t(ne()),n=re();return us.default=(0,r.default)((0,n.jsx)("path",{d:"M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6"}),"Settings"),us}var By=$y();const qy=ee(By);var hs={},uc;function Ny(){if(uc)return hs;uc=1;var t=te();Object.defineProperty(hs,"__esModule",{value:!0}),hs.default=void 0;var r=t(ne()),n=re();return hs.default=(0,r.default)((0,n.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M14 13v4h-4v-4H7l5-5 5 5z"}),"CloudUpload"),hs}var Uy=Ny();const Fu=ee(Uy);var fs={},hc;function Hy(){if(hc)return fs;hc=1;var t=te();Object.defineProperty(fs,"__esModule",{value:!0}),fs.default=void 0;var r=t(ne()),n=re();return fs.default=(0,r.default)((0,n.jsx)("path",{d:"m19 9 1.25-2.75L23 5l-2.75-1.25L19 1l-1.25 2.75L15 5l2.75 1.25zm-7.5.5L9 4 6.5 9.5 1 12l5.5 2.5L9 20l2.5-5.5L17 12zM19 15l-1.25 2.75L15 19l2.75 1.25L19 23l1.25-2.75L23 19l-2.75-1.25z"}),"AutoAwesome"),fs}var Vy=Hy();const Ya=ee(Vy);var xs={},fc;function Yy(){if(fc)return xs;fc=1;var t=te();Object.defineProperty(xs,"__esModule",{value:!0}),xs.default=void 0;var r=t(ne()),n=re();return xs.default=(0,r.default)([(0,n.jsx)("path",{d:"M21 8c-1.45 0-2.26 1.44-1.93 2.51l-3.55 3.56c-.3-.09-.74-.09-1.04 0l-2.55-2.55C12.27 10.45 11.46 9 10 9c-1.45 0-2.27 1.44-1.93 2.52l-4.56 4.55C2.44 15.74 1 16.55 1 18c0 1.1.9 2 2 2 1.45 0 2.26-1.44 1.93-2.51l4.55-4.56c.3.09.74.09 1.04 0l2.55 2.55C12.73 16.55 13.54 18 15 18c1.45 0 2.27-1.44 1.93-2.52l3.56-3.55c1.07.33 2.51-.48 2.51-1.93 0-1.1-.9-2-2-2"},"0"),(0,n.jsx)("path",{d:"m15 9 .94-2.07L18 6l-2.06-.93L15 3l-.92 2.07L12 6l2.08.93zM3.5 11 4 9l2-.5L4 8l-.5-2L3 8l-2 .5L3 9z"},"1")],"Insights"),xs}var Gy=Yy();const Qy=ee(Gy);var ps={},xc;function Ky(){if(xc)return ps;xc=1;var t=te();Object.defineProperty(ps,"__esModule",{value:!0}),ps.default=void 0;var r=t(ne()),n=re();return ps.default=(0,r.default)((0,n.jsx)("path",{d:"M19 5h-2V3H7v2H5c-1.1 0-2 .9-2 2v1c0 2.55 1.92 4.63 4.39 4.94.63 1.5 1.98 2.63 3.61 2.96V19H7v2h10v-2h-4v-3.1c1.63-.33 2.98-1.46 3.61-2.96C19.08 12.63 21 10.55 21 8V7c0-1.1-.9-2-2-2M5 8V7h2v3.82C5.84 10.4 5 9.3 5 8m14 0c0 1.3-.84 2.4-2 2.82V7h2z"}),"EmojiEvents"),ps}var Jy=Ky();const Xy=ee(Jy);var ms={},pc;function Zy(){if(pc)return ms;pc=1;var t=te();Object.defineProperty(ms,"__esModule",{value:!0}),ms.default=void 0;var r=t(ne()),n=re();return ms.default=(0,r.default)((0,n.jsx)("path",{d:"M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2m-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1M9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1m11 15H4v-2h16zm0-5H4V8h5.08L7 10.83 8.62 12 11 8.76l1-1.36 1 1.36L15.38 12 17 10.83 14.92 8H20z"}),"CardGiftcard"),ms}var eb=Zy();const tb=ee(eb),rb=[{title:"Home",path:"/",icon:e.jsx(Oy,{})},{title:"Search",path:"/search",icon:e.jsx(Pr,{})},{title:"Library",path:"/library",icon:e.jsx(Wy,{})},{title:"Favorites",path:"/favorites",icon:e.jsx(xa,{})},{title:"History",path:"/history",icon:e.jsx(Ns,{})},{title:"Channels",path:"/channels",icon:e.jsx(Kr,{})},{title:"Playlists",path:"/playlists",icon:e.jsx(ra,{})},{title:"Smart Playlists",path:"/smart-playlists",icon:e.jsx(Ya,{})},{title:"Analytics",path:"/analytics",icon:e.jsx(Qy,{})},{title:"Achievements",path:"/achievements",icon:e.jsx(Xy,{})},{title:"Yearly Wrapped",path:"/wrapped",icon:e.jsx(tb,{})},{title:"Local Files",path:"/local-files",icon:e.jsx(Fu,{})},{title:"Offline",path:"/offline",icon:e.jsx(Pu,{}),isPWA:!0}];function nb({mobileOpen:t=!1,onMobileClose:r}){const n=At(),s=md(),a=o=>{n(o),r&&r()},i=e.jsxs(h,{sx:{width:240,bgcolor:"background.default",display:"flex",flexDirection:"column",height:"100%"},children:[e.jsxs(h,{sx:{p:2,display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(h,{component:"img",src:"/img/logo.png",alt:"SoundWave",sx:{width:40,height:40,borderRadius:"50%",objectFit:"cover"}}),e.jsx(h,{sx:{fontWeight:700,fontSize:20,letterSpacing:"-0.02em"},children:"SoundWave"})]}),e.jsx(Ge,{sx:{flexGrow:1,px:1.5,py:2},children:rb.map(o=>e.jsx(Oe,{disablePadding:!0,sx:{mb:1},children:e.jsxs(Zt,{selected:s.pathname===o.path,onClick:()=>a(o.path),sx:{borderRadius:"9999px",py:1.5,px:2,transition:"all 0.3s ease","&.Mui-selected":{bgcolor:"rgba(19, 236, 106, 0.15)",color:"primary.main","&:hover":{bgcolor:"rgba(19, 236, 106, 0.2)"}},"&:not(.Mui-selected)":{color:"text.secondary","&:hover":{bgcolor:"rgba(255, 255, 255, 0.05)",color:"text.primary"}}},children:[e.jsx(Ye,{sx:{color:"inherit",minWidth:36},children:o.icon}),e.jsx(Se,{primary:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:.5},children:[o.title,o.isPWA&&e.jsx(de,{label:"PWA",size:"small",sx:{height:16,fontSize:"0.6rem",fontWeight:700,bgcolor:"success.main",color:"white","& .MuiChip-label":{px:.5}}})]}),primaryTypographyProps:{fontWeight:s.pathname===o.path?600:500,fontSize:"0.875rem"}})]})},o.path))}),e.jsx(h,{sx:{p:1.5,pb:2},children:e.jsxs(Zt,{selected:s.pathname==="/settings",onClick:()=>a("/settings"),sx:{borderRadius:"9999px",py:1.5,px:2,transition:"all 0.3s ease","&.Mui-selected":{bgcolor:"rgba(19, 236, 106, 0.15)",color:"primary.main","&:hover":{bgcolor:"rgba(19, 236, 106, 0.2)"}},"&:not(.Mui-selected)":{color:"text.secondary","&:hover":{bgcolor:"rgba(255, 255, 255, 0.05)",color:"text.primary"}}},children:[e.jsx(Ye,{sx:{color:"inherit",minWidth:36},children:e.jsx(qy,{})}),e.jsx(Se,{primary:"Settings",primaryTypographyProps:{fontWeight:s.pathname==="/settings"?600:500,fontSize:"0.875rem"}})]})})]});return e.jsxs(e.Fragment,{children:[e.jsx(pd,{variant:"temporary",open:t,onClose:r,ModalProps:{keepMounted:!0},sx:{display:{xs:"block",md:"none"},"& .MuiDrawer-paper":{boxSizing:"border-box",width:240,bgcolor:"background.default",borderRight:"1px solid",borderColor:"rgba(255, 255, 255, 0.05)"}},children:i}),e.jsx(h,{sx:{width:240,flexShrink:0,display:{xs:"none",md:"block"},borderRight:"1px solid",borderColor:"rgba(255, 255, 255, 0.05)"},children:i})]})}var gs={},mc;function sb(){if(mc)return gs;mc=1;var t=te();Object.defineProperty(gs,"__esModule",{value:!0}),gs.default=void 0;var r=t(ne()),n=re();return gs.default=(0,r.default)((0,n.jsx)("path",{d:"M3 18h18v-2H3zm0-5h18v-2H3zm0-7v2h18V6z"}),"Menu"),gs}var ab=sb();const ib=ee(ab);var ys={},gc;function ob(){if(gc)return ys;gc=1;var t=te();Object.defineProperty(ys,"__esModule",{value:!0}),ys.default=void 0;var r=t(ne()),n=re();return ys.default=(0,r.default)((0,n.jsx)("path",{d:"m17 7-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4z"}),"Logout"),ys}var lb=ob();const cb=ee(lb);var bs={},yc;function db(){if(yc)return bs;yc=1;var t=te();Object.defineProperty(bs,"__esModule",{value:!0}),bs.default=void 0;var r=t(ne()),n=re();return bs.default=(0,r.default)((0,n.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close"),bs}var ub=db();const Gt=ee(ub);function hb({open:t,onClose:r,currentAvatar:n,onAvatarChange:s}){const[a,i]=l.useState(null),[o,c]=l.useState(!1),[f,d]=l.useState(null),[u,p]=l.useState(null),g=[1,2,3,4,5],y=async v=>{d(null),p(null),i(v);try{const j=await fetch("/api/user/avatar/preset/",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Token ${localStorage.getItem("token")}`},body:JSON.stringify({preset:v})});if(!j.ok)throw new Error("Failed to set preset avatar");const w=await j.json();p("Avatar updated successfully!"),s(`/avatars/preset_${v}.svg`)}catch(j){d(j instanceof Error?j.message:"Failed to set preset avatar")}},m=async v=>{const j=v.target.files?.[0];if(!j)return;if(j.size>20*1024*1024){d("File too large. Maximum size is 20MB");return}if(!["image/jpeg","image/png","image/gif","image/webp"].includes(j.type)){d("Invalid file type. Please upload JPEG, PNG, GIF, or WebP");return}d(null),p(null),c(!0),i(null);const w=new FormData;w.append("avatar",j);try{const C=await fetch("/api/user/avatar/upload/",{method:"POST",headers:{Authorization:`Token ${localStorage.getItem("token")}`},body:w});if(!C.ok){const D=await C.json();throw new Error(D.error||"Failed to upload avatar")}const A=await C.json();p("Avatar uploaded successfully!");const P=A.avatar.split("/").pop();s(`/api/user/avatar/file/${P}/`)}catch(C){d(C instanceof Error?C.message:"Failed to upload avatar")}finally{c(!1)}},b=async()=>{d(null),p(null);try{if(!(await fetch("/api/user/avatar/upload/",{method:"DELETE",headers:{Authorization:`Token ${localStorage.getItem("token")}`}})).ok)throw new Error("Failed to remove avatar");p("Avatar removed successfully!"),i(null),s(null)}catch(v){d(v instanceof Error?v.message:"Failed to remove avatar")}},S=v=>n?.includes(`preset_${v}`);return e.jsxs(Qe,{open:t,onClose:r,maxWidth:"sm",fullWidth:!0,children:[e.jsx(Xe,{children:e.jsxs(h,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsx(x,{variant:"h6",children:"Choose Your Avatar"}),e.jsx(J,{onClick:r,size:"small",children:e.jsx(Gt,{})})]})}),e.jsxs(Ke,{children:[f&&e.jsx(ge,{severity:"error",sx:{mb:2},onClose:()=>d(null),children:f}),u&&e.jsx(ge,{severity:"success",sx:{mb:2},onClose:()=>p(null),children:u}),e.jsx(x,{variant:"subtitle2",gutterBottom:!0,sx:{mt:1},children:"Preset Avatars"}),e.jsx(K,{container:!0,spacing:2,sx:{mb:3},children:g.map(v=>e.jsx(K,{item:!0,xs:4,sm:2.4,children:e.jsxs(h,{sx:{position:"relative",cursor:"pointer","&:hover":{opacity:.8}},onClick:()=>y(v),children:[e.jsx(Ue,{src:`/avatars/preset_${v}.svg`,sx:{width:80,height:80,border:S(v)?"3px solid":"2px solid",borderColor:S(v)?"primary.main":"rgba(255, 255, 255, 0.1)"}}),S(v)&&e.jsx(oa,{sx:{position:"absolute",top:-8,right:-8,color:"primary.main",bgcolor:"background.paper",borderRadius:"50%"}})]})},v))}),e.jsx(x,{variant:"subtitle2",gutterBottom:!0,children:"Custom Avatar"}),e.jsx(h,{sx:{border:"2px dashed",borderColor:"rgba(255, 255, 255, 0.2)",borderRadius:2,p:3,textAlign:"center",bgcolor:"rgba(255, 255, 255, 0.02)"},children:o?e.jsx(Ae,{size:40}):e.jsxs(e.Fragment,{children:[e.jsx("input",{accept:"image/jpeg,image/png,image/gif,image/webp",style:{display:"none"},id:"avatar-upload",type:"file",onChange:m}),e.jsx("label",{htmlFor:"avatar-upload",children:e.jsx(q,{variant:"outlined",component:"span",startIcon:e.jsx(Fu,{}),sx:{mb:1},children:"Upload Image"})}),e.jsx(x,{variant:"caption",display:"block",color:"text.secondary",children:"Max 20MB  JPEG, PNG, GIF, WebP"})]})})]}),e.jsxs(tt,{sx:{px:3,pb:2},children:[n&&e.jsx(q,{onClick:b,startIcon:e.jsx(fi,{}),color:"error",sx:{mr:"auto"},children:"Remove Avatar"}),e.jsx(q,{onClick:r,children:"Close"})]})]})}class fb{swRegistration=null;isSupported=!1;authToken=null;statusPollingInterval=null;statusListeners=new Set;constructor(){this.checkSupport(),this.setupServiceWorker(),this.setupNetworkListeners()}checkSupport(){this.isSupported="serviceWorker"in navigator&&"SyncManager"in window,console.log("[BackgroundDownload] Support:",{serviceWorker:"serviceWorker"in navigator,syncManager:"SyncManager"in window,periodicSync:"PeriodicSyncManager"in window})}async setupServiceWorker(){if("serviceWorker"in navigator)try{if(this.swRegistration=await navigator.serviceWorker.ready,console.log("[BackgroundDownload] Service Worker ready"),"periodicSync"in this.swRegistration)try{(await navigator.permissions.query({name:"periodic-background-sync"})).state==="granted"&&(await this.swRegistration.periodicSync.register("check-download-status",{minInterval:60*1e3}),console.log("[BackgroundDownload] Periodic sync registered"))}catch{console.log("[BackgroundDownload] Periodic sync not available")}navigator.serviceWorker.addEventListener("message",this.handleServiceWorkerMessage.bind(this))}catch(r){console.error("[BackgroundDownload] Setup error:",r)}}setupNetworkListeners(){window.addEventListener("online",()=>{console.log("[BackgroundDownload] Network online, triggering sync"),this.triggerSync()})}handleServiceWorkerMessage(r){const{type:n,...s}=r.data||{};if(n==="GET_AUTH_TOKEN"){const a=this.authToken||localStorage.getItem("token");r.ports?.[0]?.postMessage({token:a})}n==="DOWNLOAD_STATUS_UPDATE"&&this.notifyStatusListeners(s.downloads),n==="PLAY_AUDIO"&&window.dispatchEvent(new CustomEvent("playAudio",{detail:s}))}setAuthToken(r){this.authToken=r,r&&this.swRegistration&&this.sendMessage("UPDATE_AUTH_TOKEN",{authToken:r})}async queueDownload(r,n){const s=this.authToken||localStorage.getItem("token");if(!s)return{success:!1,error:"Not authenticated"};if(navigator.onLine&&!this.isSupported)return this.directDownload(r,s);try{return await this.sendMessage("QUEUE_DOWNLOAD",{url:r,title:n,authToken:s})}catch(a){return console.error("[BackgroundDownload] Queue error:",a),navigator.onLine?this.directDownload(r,s):{success:!1,error:"Failed to queue download"}}}async queueDownloads(r){const n=this.authToken||localStorage.getItem("token");if(!n)return{success:!1,error:"Not authenticated"};if(navigator.onLine&&!this.isSupported)return this.directDownloadBatch(r.map(s=>s.url),n);try{return await this.sendMessage("QUEUE_DOWNLOADS_BATCH",{downloads:r,authToken:n})}catch(s){return console.error("[BackgroundDownload] Batch queue error:",s),navigator.onLine?this.directDownloadBatch(r.map(a=>a.url),n):{success:!1,error:"Failed to queue downloads"}}}async getPendingDownloads(){try{return(await this.sendMessage("GET_PENDING_DOWNLOADS",{})).downloads||[]}catch(r){return console.error("[BackgroundDownload] Get pending error:",r),[]}}async removePendingDownload(r){try{return(await this.sendMessage("REMOVE_PENDING_DOWNLOAD",{id:r})).success}catch(n){return console.error("[BackgroundDownload] Remove error:",n),!1}}async triggerSync(){if(!this.swRegistration)return!1;try{return"sync"in this.swRegistration?(await this.swRegistration.sync.register("sync-downloads"),console.log("[BackgroundDownload] Sync triggered via Background Sync API"),!0):(await this.sendMessage("TRIGGER_DOWNLOAD_SYNC",{})).success}catch(r){return console.error("[BackgroundDownload] Trigger sync error:",r),!1}}startStatusPolling(r=5e3){this.statusPollingInterval||(this.statusPollingInterval=window.setInterval(async()=>{if(navigator.onLine)try{const n=this.authToken||localStorage.getItem("token");if(!n)return;const s=await fetch("/api/download/?filter=pending",{headers:{Authorization:`Token ${n}`}}),a=await fetch("/api/download/?filter=downloading",{headers:{Authorization:`Token ${n}`}});if(s.ok&&a.ok){const i=await s.json(),o=await a.json(),c=[...i.data||[],...o.data||[]];this.notifyStatusListeners(c)}}catch(n){console.error("[BackgroundDownload] Status polling error:",n)}},r))}stopStatusPolling(){this.statusPollingInterval&&(clearInterval(this.statusPollingInterval),this.statusPollingInterval=null)}onStatusUpdate(r){return this.statusListeners.add(r),()=>this.statusListeners.delete(r)}notifyStatusListeners(r){this.statusListeners.forEach(n=>n(r))}async directDownload(r,n){try{const s=await fetch("/api/download/",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Token ${n}`},body:JSON.stringify({urls:[r],auto_start:!0})});return s.ok?{success:!0,id:(await s.json())[0]?.id}:{success:!1,error:await s.text()}}catch(s){return{success:!1,error:String(s)}}}async directDownloadBatch(r,n){try{const s=await fetch("/api/download/",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Token ${n}`},body:JSON.stringify({urls:r,auto_start:!0})});return s.ok?{success:!0,ids:(await s.json()).map(i=>i.id)}:{success:!1,error:await s.text()}}catch(s){return{success:!1,error:String(s)}}}sendMessage(r,n){return new Promise((s,a)=>{if(!navigator.serviceWorker.controller){console.log("[BackgroundDownload] No service worker controller, returning empty"),s({downloads:[],success:!0});return}const i=new MessageChannel,o=setTimeout(()=>{console.log("[BackgroundDownload] Service worker message timeout, returning empty"),s({downloads:[],success:!0})},5e3);i.port1.onmessage=c=>{clearTimeout(o),s(c.data)},navigator.serviceWorker.controller.postMessage({type:r,...n},[i.port2])})}get supported(){return this.isSupported}get online(){return navigator.onLine}}const Yt=new fb;function xb(){const[t,r]=l.useState(navigator.onLine),[n,s]=l.useState([]),[a,i]=l.useState([]),[o,c]=l.useState(!1);l.useEffect(()=>{const m=localStorage.getItem("token");m&&Yt.setAuthToken(m)},[]),l.useEffect(()=>{const m=()=>{r(!0),Yt.triggerSync()},b=()=>{r(!1)};return window.addEventListener("online",m),window.addEventListener("offline",b),()=>{window.removeEventListener("online",m),window.removeEventListener("offline",b)}},[]),l.useEffect(()=>{const m=Yt.onStatusUpdate(b=>{i(b)});return t&&Yt.startStatusPolling(5e3),()=>{m(),Yt.stopStatusPolling()}},[t]),l.useEffect(()=>{f()},[]);const f=async()=>{const m=await Yt.getPendingDownloads();s(m)},d=l.useCallback(async()=>{c(!0);try{await f();const m=localStorage.getItem("token");if(m&&navigator.onLine){const[b,S]=await Promise.all([fetch("/api/download/?filter=pending",{headers:{Authorization:`Token ${m}`}}),fetch("/api/download/?filter=downloading",{headers:{Authorization:`Token ${m}`}})]);if(b.ok&&S.ok){const v=await b.json(),j=await S.json();i([...v.data||[],...j.data||[]])}}}finally{c(!1)}},[]),u=l.useCallback(async(m,b)=>{c(!0);try{const S=await Yt.queueDownload(m,b);return S.success&&await f(),S.success}finally{c(!1)}},[]),p=l.useCallback(async m=>{c(!0);try{const b=await Yt.queueDownloads(m);return b.success&&await f(),b.success}finally{c(!1)}},[]),g=l.useCallback(async m=>{const b=await Yt.removePendingDownload(m);return b&&s(S=>S.filter(v=>v.id!==m)),b},[]),y=l.useCallback(async()=>{c(!0);try{const m=await Yt.triggerSync();return await f(),m}finally{c(!1)}},[]);return{isSupported:Yt.supported,isOnline:t,pendingDownloads:n,activeDownloads:a,isLoading:o,queueDownload:u,queueDownloads:p,removePendingDownload:g,triggerSync:y,refreshStatus:d}}function pb({variant:t="icon"}){const r=Ot(),[n,s]=l.useState(null),{isSupported:a,isOnline:i,pendingDownloads:o,activeDownloads:c,isLoading:f,removePendingDownload:d,triggerSync:u,refreshStatus:p}=xb(),g=!!n,y=o.filter(P=>P.status==="pending").length,m=c.filter(P=>P.status==="downloading").length,b=y+m+c.filter(P=>P.status==="pending").length,S=b>0,v=P=>{s(P.currentTarget),p()},j=()=>{s(null)},w=async()=>{await u(),await p()},C=P=>{switch(P){case"pending":return e.jsx(hd,{color:"action"});case"downloading":return e.jsx(Ae,{size:20});case"completed":return e.jsx(Mr,{color:"success"});case"failed":return e.jsx(ld,{color:"error"});case"submitted":return e.jsx(mi,{color:"info"});default:return e.jsx(vr,{})}},A=P=>{switch(P){case"pending":return"default";case"downloading":return"primary";case"completed":return"success";case"failed":return"error";case"submitted":return"info";default:return"default"}};return e.jsxs(e.Fragment,{children:[t==="icon"?e.jsx(be,{title:i?"Download Status":"Offline - Downloads will sync when online",children:e.jsxs(J,{onClick:v,sx:{color:S?"primary.main":"text.secondary",position:"relative"},children:[e.jsx(Dh,{badgeContent:b,color:"primary",max:99,invisible:b===0,children:i?e.jsx(vr,{}):e.jsx(jr,{})}),m>0&&e.jsx(Ae,{size:36,sx:{position:"absolute",color:qe(r.palette.primary.main,.3)}})]})}):e.jsxs(q,{variant:"outlined",startIcon:i?e.jsx(vr,{}):e.jsx(jr,{}),onClick:v,sx:{position:"relative"},children:["Downloads",b>0&&e.jsx(de,{label:b,size:"small",color:"primary",sx:{ml:1,height:20}})]}),e.jsxs(Mh,{open:g,anchorEl:n,onClose:j,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},PaperProps:{sx:{width:360,maxHeight:480}},children:[e.jsxs(h,{sx:{p:2,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx(x,{variant:"h6",sx:{fontWeight:600},children:"Downloads"}),e.jsxs(h,{sx:{display:"flex",gap:1,alignItems:"center"},children:[!i&&e.jsx(de,{icon:e.jsx(jr,{}),label:"Offline",size:"small",color:"warning"}),e.jsx(be,{title:"Refresh",children:e.jsx(J,{size:"small",onClick:p,disabled:f,children:e.jsx($r,{sx:{fontSize:20}})})}),!i&&o.length>0&&e.jsx(be,{title:"Sync when online",children:e.jsx(J,{size:"small",onClick:w,disabled:f||!i,children:e.jsx(mi,{sx:{fontSize:20}})})})]})]}),e.jsx(De,{}),a&&e.jsx(h,{sx:{px:2,py:1,bgcolor:qe(r.palette.success.main,.1)},children:e.jsx(x,{variant:"caption",color:"success.main",children:" Background downloads enabled - Downloads continue when app is closed"})}),f&&e.jsx(rt,{}),c.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(h,{sx:{px:2,py:1,bgcolor:"action.hover"},children:e.jsxs(x,{variant:"overline",color:"text.secondary",children:["Active Downloads (",c.length,")"]})}),e.jsx(Ge,{dense:!0,disablePadding:!0,children:c.map(P=>e.jsxs(Oe,{children:[e.jsx(Ye,{sx:{minWidth:36},children:C(P.status)}),e.jsx(Se,{primary:P.title||`Download #${P.id}`,secondary:e.jsxs(h,{component:"span",sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(de,{label:P.status,size:"small",color:A(P.status),sx:{height:18,fontSize:"0.65rem"}}),P.error_message&&e.jsx(x,{variant:"caption",color:"error",sx:{ml:1},children:P.error_message})]}),primaryTypographyProps:{noWrap:!0,sx:{maxWidth:220}}})]},`server-${P.id}`))})]}),o.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(h,{sx:{px:2,py:1,bgcolor:"action.hover"},children:e.jsxs(x,{variant:"overline",color:"text.secondary",children:["Queued for Sync (",o.length,")"]})}),e.jsx(Ge,{dense:!0,disablePadding:!0,children:o.map(P=>e.jsxs(Oe,{children:[e.jsx(Ye,{sx:{minWidth:36},children:C(P.status)}),e.jsx(Se,{primary:P.title||P.url,secondary:e.jsxs(h,{component:"span",sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(de,{label:P.status,size:"small",color:A(P.status),sx:{height:18,fontSize:"0.65rem"}}),P.error&&e.jsx(x,{variant:"caption",color:"error",children:P.error})]}),primaryTypographyProps:{noWrap:!0,sx:{maxWidth:200}}}),e.jsx(Ir,{children:e.jsx(J,{edge:"end",size:"small",onClick:()=>d(P.id),children:e.jsx(Dr,{fontSize:"small"})})})]},`local-${P.id}`))})]}),c.length===0&&o.length===0&&e.jsxs(h,{sx:{p:4,textAlign:"center"},children:[e.jsx(vr,{sx:{fontSize:48,color:"text.disabled",mb:1}}),e.jsx(x,{variant:"body2",color:"text.secondary",children:"No active downloads"}),e.jsx(x,{variant:"caption",color:"text.disabled",children:i?"Downloads you start will appear here":"Queue downloads offline and they will sync when online"})]}),!i&&o.filter(P=>P.status==="pending").length>0&&e.jsx(h,{sx:{p:2,borderTop:1,borderColor:"divider"},children:e.jsxs(q,{fullWidth:!0,variant:"contained",startIcon:e.jsx(mi,{}),disabled:!0,children:["Will sync when online (",o.filter(P=>P.status==="pending").length," pending)"]})})]})]})}function mb({onLogout:t,onMenuClick:r}){const[n,s]=l.useState(!1),[a,i]=l.useState(null),[o,c]=l.useState(null);l.useEffect(()=>{localStorage.getItem("token")&&f()},[]);const f=async()=>{const p=localStorage.getItem("token");if(p)try{const g=await fetch("/api/user/account/",{headers:{Authorization:`Token ${p}`}});if(g.ok){const y=await g.json();i(y),c(y.avatar_url)}}catch(g){console.error("Failed to fetch user data:",g)}},d=()=>{const p=new Date().getHours();return p<12?"Good Morning":p<18?"Good Afternoon":"Good Evening"},u=p=>{c(p)};return e.jsxs(Eh,{position:"static",elevation:0,sx:{bgcolor:"transparent",borderBottom:"none"},children:[e.jsxs(Th,{sx:{minHeight:{xs:"64px",md:"80px"},px:{xs:2,md:3}},children:[e.jsx(J,{color:"inherit","aria-label":"open drawer",edge:"start",onClick:r,sx:{mr:2,display:{md:"none"}},children:e.jsx(ib,{})}),e.jsxs(h,{sx:{flexGrow:1,display:"flex",alignItems:"center",gap:{xs:1.5,md:2.5}},children:[e.jsxs(h,{sx:{position:"relative"},children:[e.jsx(Ue,{src:o||void 0,onClick:()=>s(!0),sx:{width:{xs:40,md:64},height:{xs:40,md:64},border:"2px solid",borderColor:"rgba(255, 255, 255, 0.1)",cursor:"pointer",transition:"all 0.3s ease","&:hover":{transform:"scale(1.05)",borderColor:"primary.main"}},children:a?.username?.charAt(0).toUpperCase()}),e.jsx(h,{sx:{position:"absolute",bottom:0,right:0,width:{xs:12,md:20},height:{xs:12,md:20},bgcolor:"primary.main",borderRadius:"50%",border:{xs:"2px solid",md:"4px solid"},borderColor:"background.default"}})]}),e.jsxs(h,{children:[e.jsx(x,{variant:"h5",sx:{fontWeight:700,letterSpacing:"-0.02em",mb:.5,fontSize:{xs:"1.1rem",md:"1.5rem"}},children:d()}),e.jsx(x,{variant:"body2",color:"text.secondary",sx:{fontWeight:500,display:{xs:"none",sm:"block"}},children:a?.first_name||a?.last_name?`${a.first_name||""} ${a.last_name||""}`.trim():a?.username||"Music Lover"})]})]}),e.jsxs(h,{sx:{display:"flex",gap:1.5,alignItems:"center"},children:[e.jsx(pb,{}),e.jsx(be,{title:"Logout",arrow:!0,children:e.jsx(J,{onClick:t,sx:{width:{xs:44,md:48},height:{xs:44,md:48},border:"1px solid",borderColor:"rgba(255, 255, 255, 0.1)",transition:"all 0.3s ease","&:hover":{bgcolor:"rgba(255, 82, 82, 0.1)",borderColor:"rgba(255, 82, 82, 0.5)",color:"#ff5252"}},children:e.jsx(cb,{})})})]})]}),e.jsx(hb,{open:n,onClose:()=>s(!1),currentAvatar:o,onAvatarChange:u})]})}const gb="modulepreload",yb=function(t){return"/"+t},bc={},bb=function(r,n,s){let a=Promise.resolve();if(n&&n.length>0){let f=function(d){return Promise.all(d.map(u=>Promise.resolve(u).then(p=>({status:"fulfilled",value:p}),p=>({status:"rejected",reason:p}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),c=o?.nonce||o?.getAttribute("nonce");a=f(n.map(d=>{if(d=yb(d),d in bc)return;bc[d]=!0;const u=d.endsWith(".css"),p=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${p}`))return;const g=document.createElement("link");if(g.rel=u?"stylesheet":gb,u||(g.as="script"),g.crossOrigin="",g.href=d,c&&g.setAttribute("nonce",c),document.head.appendChild(g),u)return new Promise((y,m)=>{g.addEventListener("load",y),g.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${d}`)))})}))}function i(o){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=o,window.dispatchEvent(c),!c.defaultPrevented)throw o}return a.then(o=>{for(const c of o||[])c.status==="rejected"&&i(c.reason);return r().catch(i)})};var vs={},vc;function vb(){if(vc)return vs;vc=1;var t=te();Object.defineProperty(vs,"__esModule",{value:!0}),vs.default=void 0;var r=t(ne()),n=re();return vs.default=(0,r.default)((0,n.jsx)("path",{d:"M6 6h2v12H6zm3.5 6 8.5 6V6z"}),"SkipPrevious"),vs}var jb=vb();const wb=ee(jb);var js={},jc;function Sb(){if(jc)return js;jc=1;var t=te();Object.defineProperty(js,"__esModule",{value:!0}),js.default=void 0;var r=t(ne()),n=re();return js.default=(0,r.default)((0,n.jsx)("path",{d:"m6 18 8.5-6L6 6zM16 6v12h2V6z"}),"SkipNext"),js}var Cb=Sb();const kb=ee(Cb);var ws={},wc;function _b(){if(wc)return ws;wc=1;var t=te();Object.defineProperty(ws,"__esModule",{value:!0}),ws.default=void 0;var r=t(ne()),n=re();return ws.default=(0,r.default)((0,n.jsx)("path",{d:"M7 7h10v3l4-4-4-4v3H5v6h2zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2z"}),"Repeat"),ws}var Rb=_b();const Ib=ee(Rb);var Ss={},Sc;function Ab(){if(Sc)return Ss;Sc=1;var t=te();Object.defineProperty(Ss,"__esModule",{value:!0}),Ss.default=void 0;var r=t(ne()),n=re();return Ss.default=(0,r.default)((0,n.jsx)("path",{d:"M7 7h10v3l4-4-4-4v3H5v6h2zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2zm-4-2V9h-1l-2 1v1h1.5v4z"}),"RepeatOne"),Ss}var Pb=Ab();const Db=ee(Pb);var Cs={},Cc;function Mb(){if(Cc)return Cs;Cc=1;var t=te();Object.defineProperty(Cs,"__esModule",{value:!0}),Cs.default=void 0;var r=t(ne()),n=re();return Cs.default=(0,r.default)((0,n.jsx)("path",{d:"M3 9v6h4l5 5V4L7 9zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02M14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77"}),"VolumeUp"),Cs}var Eb=Mb();const Tb=ee(Eb);var ks={},kc;function zb(){if(kc)return ks;kc=1;var t=te();Object.defineProperty(ks,"__esModule",{value:!0}),ks.default=void 0;var r=t(ne()),n=re();return ks.default=(0,r.default)((0,n.jsx)("path",{d:"M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63m2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71M4.27 3 3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9zM12 4 9.91 6.09 12 8.18z"}),"VolumeOff"),ks}var Ob=zb();const Fb=ee(Ob);var _s={},_c;function Lb(){if(_c)return _s;_c=1;var t=te();Object.defineProperty(_s,"__esModule",{value:!0}),_s.default=void 0;var r=t(ne()),n=re();return _s.default=(0,r.default)((0,n.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit"),_s}var Wb=Lb();const $b=ee(Wb);var Rs={},Rc;function Bb(){if(Rc)return Rs;Rc=1;var t=te();Object.defineProperty(Rs,"__esModule",{value:!0}),Rs.default=void 0;var r=t(ne()),n=re();return Rs.default=(0,r.default)((0,n.jsx)("path",{d:"M12.34 2.02C6.59 1.82 2 6.42 2 12c0 5.52 4.48 10 10 10 3.71 0 6.93-2.02 8.66-5.02-7.51-.25-12.09-8.43-8.32-14.96"}),"Bedtime"),Rs}var qb=Bb();const Qi=ee(qb),Ic={isActive:!1,mode:"minutes",remainingMinutes:0,remainingSongs:0,fadeOut:!0,fadeDuration:30,isFading:!1,startedAt:null},Lu=l.createContext(null);function Nb({children:t}){const[r,n]=l.useState(Ic),[s,a]=l.useState(!1),i=l.useRef(null),o=l.useRef(null),c=l.useRef(null),f=l.useCallback(()=>{i.current&&(clearInterval(i.current),i.current=null),o.current=null,c.current=null},[]),d=l.useCallback(b=>{f(),a(!1);const S=new Date;if(b.mode==="minutes"){const v=S.getTime()+b.minutes*60*1e3;c.current=v;const j=b.fadeOut?v-b.fadeDuration*1e3:v;n({isActive:!0,mode:"minutes",remainingMinutes:b.minutes,remainingSongs:0,fadeOut:b.fadeOut,fadeDuration:b.fadeDuration,isFading:!1,startedAt:S}),i.current=setInterval(()=>{const w=Date.now(),C=Math.max(0,v-w),A=C/6e4,P=b.fadeOut&&w>=j;if(C<=0){f(),a(!0),n(D=>({...D,isActive:!1,remainingMinutes:0,isFading:!1}));return}P&&!o.current&&(o.current=w),n(D=>({...D,remainingMinutes:A,isFading:P}))},1e3)}else b.mode==="songs"?n({isActive:!0,mode:"songs",remainingMinutes:0,remainingSongs:b.songs,fadeOut:b.fadeOut,fadeDuration:b.fadeDuration,isFading:!1,startedAt:S}):b.mode==="endOfTrack"&&n({isActive:!0,mode:"endOfTrack",remainingMinutes:0,remainingSongs:1,fadeOut:b.fadeOut,fadeDuration:b.fadeDuration,isFading:!1,startedAt:S});console.log("[SleepTimer] Started:",b)},[f]),u=l.useCallback(()=>{f(),a(!1),n(Ic),console.log("[SleepTimer] Stopped")},[f]),p=l.useCallback(()=>{if(!r.isActive)return!1;if(r.mode==="songs"||r.mode==="endOfTrack"){const b=r.remainingSongs-1;if(b<=0)return f(),a(!0),n(S=>({...S,isActive:!1,remainingSongs:0})),console.log("[SleepTimer] Song count reached, stopping"),!0;n(S=>({...S,remainingSongs:b}))}return!1},[r.isActive,r.mode,r.remainingSongs,f]),g=l.useCallback(()=>{if(!r.isFading||!o.current)return 1;const b=(Date.now()-o.current)/1e3,S=Math.min(1,b/r.fadeDuration);return Math.max(0,1-S*S)},[r.isFading,r.fadeDuration]),y=l.useCallback(()=>s?(a(!1),!0):!1,[s]);l.useEffect(()=>()=>{f()},[f]);const m={timerState:r,startTimer:d,stopTimer:u,onSongEnded:p,getFadeVolume:g,shouldStop:y};return e.jsx(Lu.Provider,{value:m,children:t})}function Wu(){const t=l.useContext(Lu);if(!t)throw new Error("useSleepTimer must be used within a SleepTimerProvider");return t}const Ub=[32,64,125,250,500,1e3,2e3,4e3,8e3,16e3],Hb=["32","64","125","250","500","1K","2K","4K","8K","16K"],Ga=-12,Gs=12,Ki=[{id:"flat",name:"Flat",gains:[0,0,0,0,0,0,0,0,0,0]},{id:"bass-boost",name:"Bass Boost",gains:[6,5,4,2,0,0,0,0,0,0]},{id:"treble-boost",name:"Treble Boost",gains:[0,0,0,0,0,0,2,4,5,6]},{id:"rock",name:"Rock",gains:[5,4,2,0,-1,-1,2,3,4,4]},{id:"pop",name:"Pop",gains:[-1,1,3,4,3,0,-1,-1,1,2]},{id:"jazz",name:"Jazz",gains:[3,2,1,2,-1,-1,0,1,2,3]},{id:"classical",name:"Classical",gains:[4,3,2,1,-1,-1,0,2,3,4]},{id:"electronic",name:"Electronic",gains:[5,4,2,0,-2,-1,0,2,4,5]},{id:"hip-hop",name:"Hip-Hop",gains:[6,5,3,1,-1,-1,1,0,2,3]},{id:"acoustic",name:"Acoustic",gains:[3,2,1,1,2,1,2,2,3,2]},{id:"vocal",name:"Vocal Boost",gains:[-2,-1,0,2,4,4,3,1,0,-1]},{id:"loudness",name:"Loudness",gains:[5,4,2,0,-2,-2,0,2,4,5]}],$u=l.createContext(null);function Vb({children:t}){const{getExtraSetting:r,updateExtraSetting:n}=Sr(),[s,a]=l.useState(!0),[i,o]=l.useState("flat"),[c,f]=l.useState(Array(10).fill(0)),[d,u]=l.useState([]),[p,g]=l.useState(!1);l.useEffect(()=>{const I=r("equalizer",null);I&&!p&&(I.enabled!==void 0&&a(I.enabled),I.activePresetId&&o(I.activePresetId),I.gains?.length===10&&f(I.gains),I.customPresets&&u(I.customPresets),g(!0))},[r,p]);const y=l.useRef([]),m=l.useRef(null),b=l.useRef(null),S=l.useRef(null),v=l.useRef(!1),j=[...Ki,...d],w=l.useCallback(async I=>{const k={enabled:s,activePresetId:i,gains:c,customPresets:d,...I};await n("equalizer",k)},[s,i,c,d,n]),C=l.useCallback(I=>{y.current.forEach((k,O)=>{k&&I[O]!==void 0&&(k.gain.value=s?I[O]:0)})},[s]),A=l.useCallback(I=>{y.current=[],Ub.forEach((k,O)=>{const E=I.createBiquadFilter();E.type="peaking",E.frequency.value=k,E.Q.value=1.4,E.gain.value=s?c[O]:0,y.current.push(E)});for(let k=0;k<y.current.length-1;k++)y.current[k].connect(y.current[k+1]);return{input:y.current[0],output:y.current[y.current.length-1]}},[s,c]),P=l.useCallback((I,k,O)=>{m.current=O,b.current=I,S.current=k,y.current.length===0&&A(O),y.current.length>0&&(I.connect(y.current[0]),y.current[y.current.length-1].connect(k),v.current=!0,console.log("[EQ] Connected audio source through equalizer"))},[A]),D=l.useCallback(()=>{if(v.current&&b.current&&y.current.length>0){try{b.current.disconnect(),y.current.forEach(I=>I.disconnect())}catch{}v.current=!1}},[]),R=l.useCallback(I=>{a(I),C(I?c:Array(10).fill(0)),w({enabled:I})},[c,C,w]),_=l.useCallback((I,k)=>{const O=[...c];O[I]=Math.max(Ga,Math.min(Gs,k)),f(O),o("custom"),C(O),w({gains:O,activePresetId:"custom"})},[c,C,w]),z=l.useCallback(I=>{const k=I.map(O=>Math.max(Ga,Math.min(Gs,O)));f(k),C(k),w({gains:k})},[C,w]),W=l.useCallback(I=>{const k=j.find(O=>O.id===I);k&&(o(I),f(k.gains),C(k.gains),w({activePresetId:I,gains:k.gains}))},[j,C,w]),B=l.useCallback(I=>{const k=`custom-${Date.now()}`,O={id:k,name:I,gains:[...c],isCustom:!0},E=[...d,O];u(E),o(k),w({customPresets:E,activePresetId:k})},[c,d,w]),H=l.useCallback(I=>{const k=d.filter(O=>O.id!==I);u(k),i===I&&(o("flat"),f(Array(10).fill(0)),C(Array(10).fill(0))),w({customPresets:k,activePresetId:i===I?"flat":i,gains:i===I?Array(10).fill(0):c})},[d,i,c,C,w]),se=l.useCallback(()=>{W("flat")},[W]);return l.useEffect(()=>{C(s?c:Array(10).fill(0))},[s,c,C]),e.jsx($u.Provider,{value:{enabled:s,activePresetId:i,gains:c,presets:j,customPresets:d,setEnabled:R,setGain:_,setGains:z,selectPreset:W,saveCustomPreset:B,deleteCustomPreset:H,resetToFlat:se,connectAudioSource:P,disconnectAudio:D},children:t})}function Bu(){const t=l.useContext($u);if(!t)throw new Error("useEqualizer must be used within EqualizerProvider");return t}var Ii,Ac;function Yb(){if(Ac)return Ii;Ac=1;var t={linear:function(r,n,s,a){var i=s-n;return i*r/a+n},easeInQuad:function(r,n,s,a){var i=s-n;return i*(r/=a)*r+n},easeOutQuad:function(r,n,s,a){var i=s-n;return-i*(r/=a)*(r-2)+n},easeInOutQuad:function(r,n,s,a){var i=s-n;return(r/=a/2)<1?i/2*r*r+n:-i/2*(--r*(r-2)-1)+n},easeInCubic:function(r,n,s,a){var i=s-n;return i*(r/=a)*r*r+n},easeOutCubic:function(r,n,s,a){var i=s-n;return i*((r=r/a-1)*r*r+1)+n},easeInOutCubic:function(r,n,s,a){var i=s-n;return(r/=a/2)<1?i/2*r*r*r+n:i/2*((r-=2)*r*r+2)+n},easeInQuart:function(r,n,s,a){var i=s-n;return i*(r/=a)*r*r*r+n},easeOutQuart:function(r,n,s,a){var i=s-n;return-i*((r=r/a-1)*r*r*r-1)+n},easeInOutQuart:function(r,n,s,a){var i=s-n;return(r/=a/2)<1?i/2*r*r*r*r+n:-i/2*((r-=2)*r*r*r-2)+n},easeInQuint:function(r,n,s,a){var i=s-n;return i*(r/=a)*r*r*r*r+n},easeOutQuint:function(r,n,s,a){var i=s-n;return i*((r=r/a-1)*r*r*r*r+1)+n},easeInOutQuint:function(r,n,s,a){var i=s-n;return(r/=a/2)<1?i/2*r*r*r*r*r+n:i/2*((r-=2)*r*r*r*r+2)+n},easeInSine:function(r,n,s,a){var i=s-n;return-i*Math.cos(r/a*(Math.PI/2))+i+n},easeOutSine:function(r,n,s,a){var i=s-n;return i*Math.sin(r/a*(Math.PI/2))+n},easeInOutSine:function(r,n,s,a){var i=s-n;return-i/2*(Math.cos(Math.PI*r/a)-1)+n},easeInExpo:function(r,n,s,a){var i=s-n;return r==0?n:i*Math.pow(2,10*(r/a-1))+n},easeOutExpo:function(r,n,s,a){var i=s-n;return r==a?n+i:i*(-Math.pow(2,-10*r/a)+1)+n},easeInOutExpo:function(r,n,s,a){var i=s-n;return r===0?n:r===a?n+i:(r/=a/2)<1?i/2*Math.pow(2,10*(r-1))+n:i/2*(-Math.pow(2,-10*--r)+2)+n},easeInCirc:function(r,n,s,a){var i=s-n;return-i*(Math.sqrt(1-(r/=a)*r)-1)+n},easeOutCirc:function(r,n,s,a){var i=s-n;return i*Math.sqrt(1-(r=r/a-1)*r)+n},easeInOutCirc:function(r,n,s,a){var i=s-n;return(r/=a/2)<1?-i/2*(Math.sqrt(1-r*r)-1)+n:i/2*(Math.sqrt(1-(r-=2)*r)+1)+n},easeInElastic:function(r,n,s,a){var i=s-n,o,c,f;return f=1.70158,c=0,o=i,r===0?n:(r/=a)===1?n+i:(c||(c=a*.3),o<Math.abs(i)?(o=i,f=c/4):f=c/(2*Math.PI)*Math.asin(i/o),-(o*Math.pow(2,10*(r-=1))*Math.sin((r*a-f)*(2*Math.PI)/c))+n)},easeOutElastic:function(r,n,s,a){var i=s-n,o,c,f;return f=1.70158,c=0,o=i,r===0?n:(r/=a)===1?n+i:(c||(c=a*.3),o<Math.abs(i)?(o=i,f=c/4):f=c/(2*Math.PI)*Math.asin(i/o),o*Math.pow(2,-10*r)*Math.sin((r*a-f)*(2*Math.PI)/c)+i+n)},easeInOutElastic:function(r,n,s,a){var i=s-n,o,c,f;return f=1.70158,c=0,o=i,r===0?n:(r/=a/2)===2?n+i:(c||(c=a*(.3*1.5)),o<Math.abs(i)?(o=i,f=c/4):f=c/(2*Math.PI)*Math.asin(i/o),r<1?-.5*(o*Math.pow(2,10*(r-=1))*Math.sin((r*a-f)*(2*Math.PI)/c))+n:o*Math.pow(2,-10*(r-=1))*Math.sin((r*a-f)*(2*Math.PI)/c)*.5+i+n)},easeInBack:function(r,n,s,a,i){var o=s-n;return i===void 0&&(i=1.70158),o*(r/=a)*r*((i+1)*r-i)+n},easeOutBack:function(r,n,s,a,i){var o=s-n;return i===void 0&&(i=1.70158),o*((r=r/a-1)*r*((i+1)*r+i)+1)+n},easeInOutBack:function(r,n,s,a,i){var o=s-n;return i===void 0&&(i=1.70158),(r/=a/2)<1?o/2*(r*r*(((i*=1.525)+1)*r-i))+n:o/2*((r-=2)*r*(((i*=1.525)+1)*r+i)+2)+n},easeInBounce:function(r,n,s,a){var i=s-n,o;return o=t.easeOutBounce(a-r,0,i,a),i-o+n},easeOutBounce:function(r,n,s,a){var i=s-n;return(r/=a)<1/2.75?i*(7.5625*r*r)+n:r<2/2.75?i*(7.5625*(r-=1.5/2.75)*r+.75)+n:r<2.5/2.75?i*(7.5625*(r-=2.25/2.75)*r+.9375)+n:i*(7.5625*(r-=2.625/2.75)*r+.984375)+n},easeInOutBounce:function(r,n,s,a){var i=s-n,o;return r<a/2?(o=t.easeInBounce(r*2,0,i,a),o*.5+n):(o=t.easeOutBounce(r*2-a,0,i,a),o*.5+i*.5+n)}};return Ii=t,Ii}var Gb=Yb();function Qb(t){return t*Math.PI/180}function Mt(t,r){return t+Math.random()*(r-t)}function Kb(t,r){return Math.floor(t+Math.random()*(r-t+1))}var Qs;(function(t){t[t.Circle=0]="Circle",t[t.Square=1]="Square",t[t.Strip=2]="Strip"})(Qs||(Qs={}));var br;(function(t){t[t.Positive=1]="Positive",t[t.Negative=-1]="Negative"})(br||(br={}));const Jb=1e3/60;class Xb{constructor(r,n,s,a){this.getOptions=n;const{colors:i,initialVelocityX:o,initialVelocityY:c}=this.getOptions();this.context=r,this.x=s,this.y=a,this.w=Mt(5,20),this.h=Mt(5,20),this.radius=Mt(5,10),this.vx=typeof o=="number"?Mt(-o,o):Mt(o.min,o.max),this.vy=typeof c=="number"?Mt(-c,0):Mt(c.min,c.max),this.shape=Kb(0,2),this.angle=Qb(Mt(0,360)),this.angularSpin=Mt(-.2,.2),this.color=i[Math.floor(Math.random()*i.length)],this.rotateY=Mt(0,1),this.rotationDirection=Mt(0,1)?br.Positive:br.Negative}update(r){const{gravity:n,wind:s,friction:a,opacity:i,drawShape:o}=this.getOptions(),c=r/Jb;this.x+=this.vx*c,this.y+=this.vy*c,this.vy+=n*c,this.vx+=s*c,this.vx*=a**c,this.vy*=a**c,this.rotateY>=1&&this.rotationDirection===br.Positive?this.rotationDirection=br.Negative:this.rotateY<=-1&&this.rotationDirection===br.Negative&&(this.rotationDirection=br.Positive);const f=.1*this.rotationDirection*c;if(this.rotateY+=f,this.angle+=this.angularSpin,this.context.save(),this.context.translate(this.x,this.y),this.context.rotate(this.angle),this.context.scale(1,this.rotateY),this.context.rotate(this.angle),this.context.beginPath(),this.context.fillStyle=this.color,this.context.strokeStyle=this.color,this.context.globalAlpha=i,this.context.lineCap="round",this.context.lineWidth=2,o&&typeof o=="function")o.call(this,this.context);else switch(this.shape){case Qs.Circle:{this.context.beginPath(),this.context.arc(0,0,this.radius,0,2*Math.PI),this.context.fill();break}case Qs.Square:{this.context.fillRect(-this.w/2,-this.h/2,this.w,this.h);break}case Qs.Strip:{this.context.fillRect(-this.w/6,-this.h/2,this.w/3,this.h);break}}this.context.closePath(),this.context.restore()}}class Zb{constructor(r,n){this.x=0,this.y=0,this.w=0,this.h=0,this.lastNumberOfPieces=0,this.tweenProgress=0,this.tweenFrom=0,this.particles=[],this.particlesGenerated=0,this.removeParticleAt=a=>{this.particles.splice(a,1)},this.getParticle=()=>{const a=Mt(this.x,this.w+this.x),i=Mt(this.y,this.h+this.y);return new Xb(this.context,this.getOptions,a,i)},this.animate=a=>{const{canvas:i,context:o,particlesGenerated:c,lastNumberOfPieces:f}=this,{run:d,recycle:u,numberOfPieces:p,debug:g,tweenFunction:y,tweenDuration:m}=this.getOptions();if(!d)return!1;const b=this.particles.length,S=u?b:c;if(S<p){f!==p&&(this.tweenProgress=0,this.tweenFrom=S,this.lastNumberOfPieces=p),this.tweenProgress=Math.min(m,Math.max(0,this.tweenProgress+a));const v=y(this.tweenProgress,this.tweenFrom,p,m),j=Math.round(v-S);for(let w=0;w<j;w++)this.particles.push(this.getParticle());this.particlesGenerated+=j}g&&(o.font="12px sans-serif",o.fillStyle="#333",o.textAlign="right",o.fillText(`Particles: ${b}`,i.width-10,i.height-20));for(let v=this.particles.length-1;v>=0;v--){const j=this.particles[v];j.update(a),(j.y>i.height||j.y<-100||j.x>i.width+100||j.x<-100)&&(u&&S<=p?this.particles[v]=this.getParticle():this.removeParticleAt(v))}return b>0||S<p},this.canvas=r;const s=this.canvas.getContext("2d");if(!s)throw new Error("Could not get canvas context");this.context=s,this.getOptions=n}}const fo={width:typeof window<"u"?window.innerWidth:300,height:typeof window<"u"?window.innerHeight:200,numberOfPieces:200,friction:.99,wind:0,gravity:.1,initialVelocityX:4,initialVelocityY:10,colors:["#f44336","#e91e63","#9c27b0","#673ab7","#3f51b5","#2196f3","#03a9f4","#00bcd4","#009688","#4CAF50","#8BC34A","#CDDC39","#FFEB3B","#FFC107","#FF9800","#FF5722","#795548"],opacity:1,debug:!1,tweenFunction:Gb.easeInOutQuad,tweenDuration:5e3,recycle:!0,run:!0};class e1{constructor(r,n){this.lastFrameTime=0,this.setOptionsWithDefaults=a=>{const i={confettiSource:{x:0,y:0,w:this.canvas.width,h:0}};this._options={...i,...fo,...a},Object.assign(this,a.confettiSource)},this.update=(a=0)=>{const{options:{run:i,onConfettiComplete:o,frameRate:c},canvas:f,context:d}=this,u=Math.min(a-this.lastFrameTime,50);if(c&&u<1e3/c){this.rafId=requestAnimationFrame(this.update);return}this.lastFrameTime=a-(c?u%c:0),i&&(d.fillStyle="white",d.clearRect(0,0,f.width,f.height)),this.generator.animate(u)?this.rafId=requestAnimationFrame(this.update):(o&&typeof o=="function"&&this.generator.particlesGenerated>0&&o.call(this,this),this._options.run=!1)},this.reset=()=>{this.generator&&this.generator.particlesGenerated>0&&(this.generator.particlesGenerated=0,this.generator.particles=[],this.generator.lastNumberOfPieces=0)},this.stop=()=>{this.options={run:!1},this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=void 0)},this.canvas=r;const s=this.canvas.getContext("2d");if(!s)throw new Error("Could not get canvas context");this.context=s,this.generator=new Zb(this.canvas,()=>this.options),this.options=n,this.update()}get options(){return this._options}set options(r){const n=this._options?.run,s=this._options?.recycle;this.setOptionsWithDefaults(r),this.generator&&(Object.assign(this.generator,this.options.confettiSource),typeof r.recycle=="boolean"&&r.recycle&&s===!1&&(this.generator.lastNumberOfPieces=this.generator.particles.length)),typeof r.run=="boolean"&&r.run&&n===!1&&this.update()}}const t1=Ee.createRef();class xo extends Ee.Component{constructor(r){super(r),this.canvas=Ee.createRef(),this.canvas=r.canvasRef||t1}componentDidMount(){if(this.canvas.current){const r=Ai(this.props)[0];this.confetti=new e1(this.canvas.current,r)}}componentDidUpdate(){const r=Ai(this.props)[0];this.confetti&&(this.confetti.options=r)}componentWillUnmount(){this.confetti&&this.confetti.stop(),this.confetti=void 0}render(){const[r,n]=Ai(this.props),s={zIndex:2,position:"absolute",pointerEvents:"none",top:0,left:0,bottom:0,right:0,...n.style};return e.jsx("canvas",{width:r.width,height:r.height,ref:this.canvas,...n,style:s})}}xo.defaultProps={...fo};xo.displayName="ReactConfetti";function Ai(t){const r={},n={},s={},a=[...Object.keys(fo),"confettiSource","drawShape","onConfettiComplete","frameRate"],i=["canvasRef"];for(const o in t){const c=t[o];a.includes(o)?r[o]=c:i.includes(o)?i[o]=c:s[o]=c}return[r,s,n]}const r1=Ee.forwardRef((t,r)=>e.jsx(xo,{canvasRef:r,...t}));function n1({achievements:t,onClose:r}){const[n,s]=l.useState(0),[a,i]=l.useState(!0),[o,c]=l.useState({width:0,height:0}),f=At();l.useEffect(()=>{c({width:window.innerWidth,height:window.innerHeight});const g=setTimeout(()=>i(!1),5e3);return()=>clearTimeout(g)},[n]);const d=t[n],u=l.useCallback(()=>{n<t.length-1?(s(n+1),i(!0)):r()},[n,t.length,r]),p=()=>{r(),f("/achievements")};return d?e.jsxs(e.Fragment,{children:[a&&e.jsx(r1,{width:o.width,height:o.height,recycle:!1,numberOfPieces:200,gravity:.3,colors:["#13ec6a","#FFD700","#FF6B6B","#4ECDC4","#45B7D1"],style:{position:"fixed",top:0,left:0,zIndex:9999,pointerEvents:"none"}}),e.jsxs(Qe,{open:!0,onClose:r,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{bgcolor:"background.paper",backgroundImage:"linear-gradient(135deg, rgba(19, 236, 106, 0.1) 0%, rgba(103, 58, 183, 0.1) 100%)",border:"2px solid",borderColor:"primary.main",borderRadius:3}},children:[e.jsx(J,{onClick:r,sx:{position:"absolute",right:8,top:8,color:"text.secondary"},children:e.jsx(ea,{})}),e.jsxs(Ke,{sx:{textAlign:"center",py:4},children:[t.length>1&&e.jsxs(x,{variant:"caption",color:"text.secondary",sx:{mb:2,display:"block"},children:["Achievement ",n+1," of ",t.length]}),e.jsx(h,{sx:{fontSize:80,mb:2,animation:"bounce 0.6s ease infinite","@keyframes bounce":{"0%, 100%":{transform:"translateY(0)"},"50%":{transform:"translateY(-10px)"}}},children:d.icon}),e.jsxs(h,{sx:{display:"inline-flex",alignItems:"center",gap:1,bgcolor:"rgba(19, 236, 106, 0.2)",color:"primary.main",px:2,py:.5,borderRadius:2,mb:2},children:[e.jsx($a,{sx:{fontSize:18}}),e.jsx(x,{variant:"caption",sx:{fontWeight:600,letterSpacing:1,textTransform:"uppercase"},children:"Achievement Unlocked!"})]}),e.jsx(x,{variant:"h4",sx:{fontWeight:700,mb:1},children:d.name}),e.jsx(x,{variant:"body1",color:"text.secondary",sx:{mb:3},children:d.description}),d.context&&Object.keys(d.context).length>0&&e.jsx(x,{variant:"body2",color:"primary.main",sx:{mb:3},children:d.context.artist&&`Artist: ${d.context.artist}`}),e.jsxs(h,{sx:{display:"flex",gap:2,justifyContent:"center"},children:[e.jsx(q,{variant:"outlined",onClick:p,children:"View All Achievements"}),e.jsx(q,{variant:"contained",onClick:u,children:n<t.length-1?"Next":"Awesome!"})]})]})]})]}):null}const qu=l.createContext(void 0);function s1({children:t}){const[r,n]=l.useState([]),s=l.useCallback(i=>{i.length>0&&n(i)},[]),a=l.useCallback(()=>{n([])},[]);return e.jsxs(qu.Provider,{value:{showAchievements:s},children:[t,r.length>0&&e.jsx(n1,{achievements:r,onClose:a})]})}function a1(){const t=l.useContext(qu);if(t===void 0)throw new Error("useAchievementNotification must be used within an AchievementNotificationProvider");return t}function i1(t,{onSwipeLeft:r,onSwipeRight:n,onSwipeUp:s,onSwipeDown:a,threshold:i=50}){const o=l.useRef(null);l.useEffect(()=>{const c=t.current;if(!c)return;const f=u=>{o.current={x:u.touches[0].clientX,y:u.touches[0].clientY}},d=u=>{if(!o.current)return;const p={x:u.changedTouches[0].clientX,y:u.changedTouches[0].clientY},g=p.x-o.current.x,y=p.y-o.current.y;Math.abs(g)>Math.abs(y)?Math.abs(g)>i&&(g>0?n?.():r?.()):Math.abs(y)>i&&(y>0?a?.():s?.()),o.current=null};return c.addEventListener("touchstart",f,{passive:!0}),c.addEventListener("touchend",d,{passive:!0}),()=>{c.removeEventListener("touchstart",f),c.removeEventListener("touchend",d)}},[t,r,n,s,a,i])}function o1({data:t,isPlaying:r,themeId:n=Eu,style:s,colorScheme:a,height:i=120,showGlow:o=!0}){const c=Ot(),f=l.useRef(null),d=l.useRef(null),u=l.useRef([]),p=l.useMemo(()=>Tu(n),[n]),g=s||p.style,y=a||p.colorScheme,m=l.useMemo(()=>Mu(y,t.length,c.palette.primary.main),[y,t.length,c.palette.primary.main]),b=l.useCallback((S,v,j)=>{const w=Math.floor(Math.random()*m.length);return{x:S,y:v,vx:(Math.random()-.5)*4*j,vy:-Math.random()*3*j-1,life:1,maxLife:.5+Math.random()*.5,size:2+Math.random()*4*j,color:m[w]}},[m]);return l.useEffect(()=>{const S=f.current;if(!S)return;const v=S.getContext("2d");if(!v)return;const j=window.devicePixelRatio||1,w=S.getBoundingClientRect();S.width=w.width*j,S.height=w.height*j,v.scale(j,j);const C=()=>{const A=w.width,P=w.height;switch(v.clearRect(0,0,A,P),g){case"classic-bars":l1(v,t,m,A,P,o);break;case"bars-rounded":Pc(v,t,m,A,P,o);break;case"circular-spectrum":c1(v,t,m,A,P,o);break;case"waveform":d1(v,t,m,A,P,o);break;case"symmetric-bars":u1(v,t,m,A,P,o);break;case"particles":h1(v,t,m,A,P,u,b,r);break;case"frequency-rings":f1(v,t,m,A,P,o);break;case"line-spectrum":x1(v,t,m,A,P,o);break;case"radial-bars":p1(v,t,m,A,P,o);break;case"block-grid":m1(v,t,m,A,P,o);break;case"spiral":g1(v,t,m,A,P,o);break;default:Pc(v,t,m,A,P,o)}d.current=requestAnimationFrame(C)};return C(),()=>{d.current&&cancelAnimationFrame(d.current)}},[t,m,g,o,r,b]),l.useMemo(()=>g!=="classic-bars"&&g!=="bars-rounded"?null:e.jsx(h,{sx:{height:i,display:"flex",alignItems:"flex-end",justifyContent:"center",gap:.5,width:"100%",px:2},children:t.map((S,v)=>{const j=15+S*80,w=g==="bars-rounded";return e.jsx(h,{sx:{flex:1,maxWidth:12,minWidth:4,bgcolor:m[v],borderRadius:w?"8px":"4px 4px 0 0",height:`${j}%`,opacity:.7+S*.3,transition:"height 0.08s ease-out, opacity 0.15s ease",boxShadow:o&&S>.6?`0 0 12px ${m[v]}80`:"none","&:hover":{transform:"scaleX(1.2)",opacity:1}}},v)})}),[t,m,g,i,o]),e.jsx(h,{sx:{width:"100%",height:i,position:"relative"},children:e.jsx("canvas",{ref:f,style:{width:"100%",height:"100%",display:"block"}})})}function l1(t,r,n,s,a,i){const o=s/r.length*.8,c=s/r.length*.2;r.forEach((f,d)=>{const u=f*a*.9,p=d*(o+c)+c/2,g=a-u;t.fillStyle=n[d],t.globalAlpha=.8+f*.2,i&&f>.5?(t.shadowColor=n[d],t.shadowBlur=20*f):t.shadowBlur=0,t.fillRect(p,g,o,u)}),t.globalAlpha=1,t.shadowBlur=0}function Pc(t,r,n,s,a,i){const o=s/r.length*.7,c=s/r.length*.3;r.forEach((f,d)=>{const u=Math.max(f*a*.85,4),p=d*(o+c)+c/2,g=a-u;t.fillStyle=n[d],t.globalAlpha=.7+f*.3,i&&f>.5?(t.shadowColor=n[d],t.shadowBlur=15*f):t.shadowBlur=0;const y=Math.min(o/2,8);t.beginPath(),t.roundRect(p,g,o,u,[y,y,0,0]),t.fill()}),t.globalAlpha=1,t.shadowBlur=0}function c1(t,r,n,s,a,i){const o=s/2,c=a/2,f=Math.min(s,a)*.2,d=Math.min(s,a)*.45;r.forEach((p,g)=>{const y=g/r.length*Math.PI*2-Math.PI/2,m=p*(d-f)+5,b=o+Math.cos(y)*f,S=c+Math.sin(y)*f,v=o+Math.cos(y)*(f+m),j=c+Math.sin(y)*(f+m);t.strokeStyle=n[g],t.lineWidth=Math.max(3,s/r.length*.6),t.lineCap="round",t.globalAlpha=.7+p*.3,i&&p>.5&&(t.shadowColor=n[g],t.shadowBlur=15*p),t.beginPath(),t.moveTo(b,S),t.lineTo(v,j),t.stroke()}),t.globalAlpha=1,t.shadowBlur=0;const u=r.reduce((p,g)=>p+g,0)/r.length;t.fillStyle=n[0],t.globalAlpha=.3+u*.3,t.beginPath(),t.arc(o,c,f*.7,0,Math.PI*2),t.fill(),t.globalAlpha=1}function d1(t,r,n,s,a,i){const o=a/2,c=s/(r.length-1),f=t.createLinearGradient(0,0,s,0);n.forEach((d,u)=>{f.addColorStop(u/(n.length-1),d)}),t.strokeStyle=f,t.lineWidth=3,t.lineCap="round",t.lineJoin="round",i&&(t.shadowColor=n[Math.floor(n.length/2)],t.shadowBlur=15),t.beginPath();for(let d=0;d<r.length;d++){const u=d*c,p=r[d]*a*.4,g=o+Math.sin(d*.3+Date.now()*.002)*p;if(d===0)t.moveTo(u,g);else{const y=(d-1)*c,m=(y+u)/2;t.quadraticCurveTo(y,t.getTransform().f,m,g)}}t.stroke(),t.shadowBlur=0,t.lineTo(s,o),t.lineTo(0,o),t.closePath(),t.fillStyle=f,t.globalAlpha=.15,t.fill(),t.globalAlpha=1}function u1(t,r,n,s,a,i){const o=s/r.length*.7,c=s/r.length*.3,f=a/2;r.forEach((d,u)=>{const p=d*a*.45,g=u*(o+c)+c/2;t.fillStyle=n[u],t.globalAlpha=.7+d*.3,i&&d>.5&&(t.shadowColor=n[u],t.shadowBlur=15*d),t.fillRect(g,f-p,o,p),t.fillRect(g,f,o,p)}),t.globalAlpha=1,t.shadowBlur=0,t.strokeStyle=n[Math.floor(n.length/2)],t.lineWidth=2,t.globalAlpha=.4,t.beginPath(),t.moveTo(0,f),t.lineTo(s,f),t.stroke(),t.globalAlpha=1}function h1(t,r,n,s,a,i,o,c){i.current=i.current.filter(f=>(f.x+=f.vx,f.y+=f.vy,f.vy+=.03,f.life-=.015,f.life<=0?!1:(t.fillStyle=f.color,t.globalAlpha=f.life/f.maxLife,t.beginPath(),t.arc(f.x,f.y,f.size*(f.life/f.maxLife),0,Math.PI*2),t.fill(),t.shadowColor=f.color,t.shadowBlur=10,!0))),t.globalAlpha=1,t.shadowBlur=0,c&&(r.forEach((f,d)=>{if(f>.25&&Math.random()<f*.4){const u=d/r.length*s+Math.random()*30-15,p=a-f*a*.6;i.current.push(o(u,p,f))}}),i.current.length>300&&(i.current=i.current.slice(-300)))}function f1(t,r,n,s,a,i){const o=s/2,c=a/2,f=Math.min(s,a)*.45,d=Math.min(r.length,8);for(let u=d-1;u>=0;u--){const p=r[Math.floor(u*r.length/d)],y=(u+1)*(f/d)*(.8+p*.4);t.strokeStyle=n[u%n.length],t.lineWidth=3+p*4,t.globalAlpha=.5+p*.5,i&&p>.4&&(t.shadowColor=n[u%n.length],t.shadowBlur=20*p),t.beginPath(),t.arc(o,c,y,0,Math.PI*2),t.stroke(),t.shadowBlur=0}t.globalAlpha=1}function x1(t,r,n,s,a,i){const o=s/(r.length-1),c=t.createLinearGradient(0,0,s,0);n.forEach((f,d)=>{c.addColorStop(d/(n.length-1),f)}),t.strokeStyle=c,t.lineWidth=4,t.lineCap="round",t.lineJoin="round",i&&(t.shadowColor=n[Math.floor(n.length/2)],t.shadowBlur=20),t.beginPath();for(let f=0;f<r.length;f++){const d=f*o,u=a-r[f]*a*.85-10;if(f===0)t.moveTo(d,u);else{const p=(f-1)*o,g=a-r[f-1]*a*.85-10,y=(p+d)/2;t.quadraticCurveTo(p,g,y,(g+u)/2),t.quadraticCurveTo(y,u,d,u)}}t.stroke(),t.shadowBlur=0,t.lineTo(s,a),t.lineTo(0,a),t.closePath(),t.fillStyle=c,t.globalAlpha=.2,t.fill(),t.globalAlpha=1}function p1(t,r,n,s,a,i){const o=s/2,c=a/2,f=Math.min(s,a)*.15,d=Math.min(s,a)*.35,u=r.length*2;for(let y=0;y<u;y++){const m=y%r.length,b=r[m],S=y/u*Math.PI*2-Math.PI/2,v=b*d+5,j=o+Math.cos(S)*f,w=c+Math.sin(S)*f,C=o+Math.cos(S)*(f+v),A=c+Math.sin(S)*(f+v),P=t.createLinearGradient(j,w,C,A);P.addColorStop(0,n[m%n.length]),P.addColorStop(1,n[(m+1)%n.length]),t.strokeStyle=P,t.lineWidth=Math.max(2,2*Math.PI*f/u*.6),t.lineCap="round",t.globalAlpha=.7+b*.3,i&&b>.5&&(t.shadowColor=n[m%n.length],t.shadowBlur=12*b),t.beginPath(),t.moveTo(j,w),t.lineTo(C,A),t.stroke()}t.globalAlpha=1,t.shadowBlur=0;const p=r.reduce((y,m)=>y+m,0)/r.length,g=t.createRadialGradient(o,c,0,o,c,f);g.addColorStop(0,n[0]),g.addColorStop(1,n[n.length-1]),t.fillStyle=g,t.globalAlpha=.4+p*.3,t.beginPath(),t.arc(o,c,f*.9,0,Math.PI*2),t.fill(),t.globalAlpha=1}function m1(t,r,n,s,a,i){const f=s/16*.85,d=a/8*.85,u=s/16*.15,p=a/8*.15,g=r.length/16;for(let y=0;y<16;y++){const m=Math.floor(y*g),b=r[m],S=Math.floor(b*8);for(let v=0;v<8;v++){const j=y*(f+u)+u/2,w=a-(v+1)*(d+p),C=v<S;let A;v<3?A="#00FF00":v<6?A="#FFFF00":A="#FF0000",C?(t.fillStyle=A,t.globalAlpha=.9,i&&(t.shadowColor=A,t.shadowBlur=8)):(t.fillStyle="#333333",t.globalAlpha=.3,t.shadowBlur=0),t.beginPath(),t.roundRect(j,w,f,d,2),t.fill()}}t.globalAlpha=1,t.shadowBlur=0}function g1(t,r,n,s,a,i){const o=s/2,c=a/2,f=Math.min(s,a)*.45,d=r.reduce((m,b)=>m+b,0)/r.length,u=Date.now()*.001,p=t.createLinearGradient(0,0,s,a);n.forEach((m,b)=>{p.addColorStop(b/(n.length-1),m)}),t.strokeStyle=p,t.lineWidth=3,t.lineCap="round",i&&(t.shadowColor=n[Math.floor(n.length/2)],t.shadowBlur=15),t.beginPath();const g=3,y=200;for(let m=0;m<y;m++){const b=m/y,S=b*g*Math.PI*2+u,v=Math.floor(b*r.length),j=1+r[v]*.5,w=b*f*j*(.7+d*.5),C=o+Math.cos(S)*w,A=c+Math.sin(S)*w;m===0?t.moveTo(C,A):t.lineTo(C,A),t.globalAlpha=.3+b*.7}t.stroke(),t.globalAlpha=1,t.shadowBlur=0,t.fillStyle=n[0],t.globalAlpha=.8,t.beginPath(),t.arc(o,c,5+d*10,0,Math.PI*2),t.fill(),t.globalAlpha=1}function y1({audio:t,open:r,onClose:n,onUpdate:s}){const[a,i]=l.useState(!1),[o,c]=l.useState(!1),[f,d]=l.useState([]),[u,p]=l.useState(null),[g,y]=l.useState(null),[m,b]=l.useState(!1),[S,v]=l.useState(t.artist||""),[j,w]=l.useState(t.album||""),[C,A]=l.useState(t.year?.toString()||""),[P,D]=l.useState(t.genre||""),[R,_]=l.useState(t.title),[z,W]=l.useState(t.artist||t.channel_name||"");l.useEffect(()=>{r&&(v(t.artist||""),w(t.album||""),A(t.year?.toString()||""),D(t.genre||""),_(t.title),W(t.artist||t.channel_name||""),d([]),p(null),y(null),b(!1))},[r,t]);const B=async()=>{if(t.youtube_id){c(!0),p(null),d([]);try{const k=await wt.searchMetadata(t.youtube_id,{title:R,artist:z});d(k.data.results||[]),k.data.results.length===0&&p("No matches found. Try adjusting the search terms.")}catch(k){p("Failed to search metadata"),console.error("Metadata search error:",k)}finally{c(!1)}}},H=async()=>{if(t.youtube_id){i(!0),p(null),y(null);try{const k=await wt.autoFetchMetadata(t.youtube_id);if(console.log("[MetadataEditor] Auto-fetch response:",k.data),k.data.audio){const O=k.data.audio;y(` Found: ${O.artist||"Unknown"} - ${O.album||"Unknown"} (${O.year||"?"})`),s?.(O),v(O.artist||""),w(O.album||""),A(O.year?.toString()||""),D(O.genre||"")}else p(k.data.message||"No metadata found")}catch(k){p("Failed to auto-fetch metadata"),console.error("Auto-fetch error:",k)}finally{i(!1)}}},se=async k=>{if(!(!t.youtube_id||!k.musicbrainz_id)){i(!0),p(null),y(null);try{console.log("[MetadataEditor] Applying result:",k);const O=await wt.applyMetadata(t.youtube_id,{musicbrainz_id:k.musicbrainz_id});if(console.log("[MetadataEditor] Apply response:",O.data),O.data.audio){const E=O.data.audio;y(` Applied: ${E.artist||"Unknown"} - ${E.album||"Unknown"} (${E.year||"?"})`),s?.(E),v(E.artist||""),w(E.album||""),A(E.year?.toString()||""),D(E.genre||"")}}catch(O){p("Failed to apply metadata"),console.error("Apply metadata error:",O)}finally{i(!1)}}},I=async()=>{if(t.youtube_id){i(!0),p(null),y(null);try{const k=await wt.applyMetadata(t.youtube_id,{artist:S,album:j,year:C?parseInt(C):null,genre:P,source:"manual"});k.data.audio&&(y("Metadata saved"),s?.(k.data.audio),b(!1))}catch(k){p("Failed to save metadata"),console.error("Save metadata error:",k)}finally{i(!1)}}};return e.jsxs(Qe,{open:r,onClose:n,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(Xe,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ut,{color:"primary"}),e.jsx(x,{variant:"h6",children:"Edit Metadata"})]}),e.jsx(J,{onClick:n,size:"small",children:e.jsx(ea,{})})]}),e.jsxs(Ke,{dividers:!0,children:[a&&e.jsx(rt,{sx:{mb:2}}),u&&e.jsx(ge,{severity:"error",sx:{mb:2},onClose:()=>p(null),children:u}),g&&e.jsx(ge,{severity:"success",sx:{mb:2},onClose:()=>y(null),children:g}),e.jsxs(h,{sx:{mb:3},children:[e.jsx(x,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Track"}),e.jsx(x,{variant:"body1",fontWeight:500,noWrap:!0,children:t.title}),e.jsx(x,{variant:"body2",color:"text.secondary",children:t.channel_name})]}),e.jsxs(h,{sx:{mb:3,p:2,bgcolor:"background.default",borderRadius:1},children:[e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx(x,{variant:"subtitle2",color:"text.secondary",children:"Current Metadata"}),e.jsx(q,{size:"small",startIcon:e.jsx(dd,{}),onClick:()=>b(!m),children:m?"Cancel Edit":"Edit Manually"})]}),m?e.jsxs(h,{sx:{display:"flex",flexDirection:"column",gap:2,mt:2},children:[e.jsx(je,{label:"Artist",value:S,onChange:k=>v(k.target.value),size:"small",fullWidth:!0}),e.jsx(je,{label:"Album",value:j,onChange:k=>w(k.target.value),size:"small",fullWidth:!0}),e.jsxs(h,{sx:{display:"flex",gap:2},children:[e.jsx(je,{label:"Year",value:C,onChange:k=>A(k.target.value),size:"small",type:"number",sx:{width:120}}),e.jsx(je,{label:"Genre",value:P,onChange:k=>D(k.target.value),size:"small",fullWidth:!0})]}),e.jsx(q,{variant:"contained",onClick:I,disabled:a,children:"Save Changes"})]}):e.jsxs(h,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:[t.artist&&e.jsx(de,{icon:e.jsx(Wa,{}),label:t.artist,size:"small"}),t.album&&e.jsx(de,{icon:e.jsx(id,{}),label:t.album,size:"small"}),t.year&&e.jsx(de,{icon:e.jsx(Ja,{}),label:t.year,size:"small"}),t.genre&&e.jsx(de,{icon:e.jsx(Ut,{}),label:t.genre,size:"small"}),!t.artist&&!t.album&&!t.year&&!t.genre&&e.jsx(x,{variant:"body2",color:"text.secondary",children:"No metadata available"}),t.metadata_source&&e.jsxs(x,{variant:"caption",color:"text.secondary",sx:{width:"100%",mt:1},children:["Source: ",t.metadata_source]})]})]}),e.jsx(De,{sx:{my:2}}),e.jsxs(h,{sx:{mb:3},children:[e.jsx(q,{variant:"contained",color:"primary",startIcon:e.jsx(cr,{}),onClick:H,disabled:a||!t.youtube_id,fullWidth:!0,children:"Auto-Fetch Best Match"}),e.jsx(x,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:1,textAlign:"center"},children:"Automatically finds and applies the best matching metadata from MusicBrainz"})]}),e.jsx(De,{sx:{my:2}}),e.jsxs(h,{sx:{mb:2},children:[e.jsx(x,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Search MusicBrainz"}),e.jsxs(h,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(je,{label:"Title",value:R,onChange:k=>_(k.target.value),size:"small",fullWidth:!0}),e.jsx(je,{label:"Artist",value:z,onChange:k=>W(k.target.value),size:"small",fullWidth:!0})]}),e.jsx(q,{variant:"outlined",startIcon:o?e.jsx(Ae,{size:16}):e.jsx(zh,{}),onClick:B,disabled:o||!t.youtube_id,fullWidth:!0,children:o?"Searching...":"Search"})]}),f.length>0&&e.jsx(Ge,{dense:!0,sx:{bgcolor:"background.default",borderRadius:1,maxHeight:300,overflow:"auto"},children:f.map((k,O)=>e.jsxs(Oe,{sx:{borderBottom:"1px solid",borderColor:"divider","&:last-child":{borderBottom:"none"}},children:[e.jsx(Se,{primary:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1,flexWrap:"wrap"},children:[e.jsx(x,{variant:"body2",fontWeight:500,children:k.title||"Unknown Title"}),e.jsx(de,{label:`${Math.round(k.confidence*100)}%`,size:"small",color:k.confidence>=.8?"success":k.confidence>=.5?"warning":"default",sx:{height:20}})]}),secondary:e.jsxs(h,{sx:{display:"flex",flexDirection:"column",gap:.5,mt:.5},children:[k.artist&&e.jsxs(x,{variant:"caption",color:"text.secondary",children:["Artist: ",k.artist]}),k.album&&e.jsxs(x,{variant:"caption",color:"text.secondary",children:["Album: ",k.album," ",k.year&&`(${k.year})`]})]})}),e.jsx(Ir,{children:e.jsx(be,{title:"Apply this metadata",children:e.jsx(J,{edge:"end",onClick:()=>se(k),disabled:a||!k.musicbrainz_id,color:"primary",children:e.jsx(Zc,{})})})})]},O))})]}),e.jsx(tt,{children:e.jsx(q,{onClick:n,children:"Close"})})]})}var Is={},Dc;function b1(){if(Dc)return Is;Dc=1;var t=te();Object.defineProperty(Is,"__esModule",{value:!0}),Is.default=void 0;var r=t(ne()),n=re();return Is.default=(0,r.default)([(0,n.jsx)("path",{d:"M14 9c0-2.04 1.24-3.79 3-4.57V4c0-1.1-.9-2-2-2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h9c1.1 0 2-.9 2-2v-2.42c-1.76-.78-3-2.53-3-4.58m-4 5H6v-2h4zm3-3H6V9h7zm0-3H6V6h7z"},"0"),(0,n.jsx)("path",{d:"M20 6.18c-.31-.11-.65-.18-1-.18-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3V3h2V1h-4z"},"1")],"Lyrics"),Is}var v1=b1();const j1=ee(v1);var As={},Mc;function w1(){if(Mc)return As;Mc=1;var t=te();Object.defineProperty(As,"__esModule",{value:!0}),As.default=void 0;var r=t(ne()),n=re();return As.default=(0,r.default)((0,n.jsx)("path",{d:"M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2M8.5 13.5l2.5 3.01L14.5 12l4.5 6H5z"}),"Image"),As}var S1=w1();const C1=ee(S1);var Ps={},Ec;function k1(){if(Ec)return Ps;Ec=1;var t=te();Object.defineProperty(Ps,"__esModule",{value:!0}),Ps.default=void 0;var r=t(ne()),n=re();return Ps.default=(0,r.default)((0,n.jsx)("path",{d:"M19 4H5c-1.11 0-2 .9-2 2v12c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m-8 11H9.5v-2h-2v2H6V9h1.5v2.5h2V9H11zm7-1c0 .55-.45 1-1 1h-.75v1.5h-1.5V15H14c-.55 0-1-.45-1-1v-4c0-.55.45-1 1-1h3c.55 0 1 .45 1 1zm-3.5-.5h2v-3h-2z"}),"HighQuality"),Ps}var _1=k1();const R1=ee(_1);function I1({open:t,onClose:r,youtubeId:n,title:s}){const[a,i]=l.useState(!0),[o,c]=l.useState(!1),[f,d]=l.useState(""),[u,p]=l.useState(null),[g,y]=l.useState("mp3"),[m,b]=l.useState("high"),[S,v]=l.useState(!0),[j,w]=l.useState(!0),[C,A]=l.useState("");l.useEffect(()=>{t&&n&&P()},[t,n]);const P=async()=>{try{i(!0),d(""),console.log(`[Export] Loading options for ${n}`);const _=await U.get(`/audio/${n}/export/`);console.log("[Export] Response:",_.data),console.log(`[Export] has_lyrics=${_.data.has_lyrics}, has_synced=${_.data.has_synced_lyrics}`),p(_.data),_.data.artwork_sources?.length>0&&A(_.data.artwork_sources[0].url)}catch(_){console.error("[Export] Error:",_),d(_.response?.data?.error||"Failed to load export options")}finally{i(!1)}},D=async()=>{try{c(!0),d("");const _=await U.post(`/audio/${n}/export/`,{format:g,quality:m,embed_lyrics:S,embed_artwork:j,artwork_url:j?C:""},{responseType:"blob"}),z=_.headers["content-disposition"];let W=`${u?.title||"audio"}.${g}`;if(z){const I=z.match(/filename="(.+)"/);I&&(W=I[1])}const B=new Blob([_.data],{type:g==="mp3"?"audio/mpeg":"audio/flac"}),H=window.URL.createObjectURL(B),se=document.createElement("a");se.href=H,se.download=W,document.body.appendChild(se),se.click(),document.body.removeChild(se),window.URL.revokeObjectURL(H),r()}catch(_){console.error("Export failed:",_),d(_.response?.data?.error||"Export failed. Please try again.")}finally{c(!1)}},R=_=>{switch(_){case"high":return"High (320 kbps)";case"medium":return"Medium (192 kbps)";case"low":return"Low (128 kbps)";default:return _}};return e.jsxs(Qe,{open:t,onClose:r,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(Xe,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Tr,{}),"Export Track"]}),e.jsx(Ke,{dividers:!0,children:a?e.jsx(h,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(Ae,{})}):f&&!u?e.jsx(ge,{severity:"error",children:f}):u?e.jsxs(h,{sx:{display:"flex",flexDirection:"column",gap:3},children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(Ue,{src:u.artwork_sources?.[0]?.url,variant:"rounded",sx:{width:64,height:64},children:e.jsx(Tt,{})}),e.jsxs(h,{children:[e.jsx(x,{variant:"subtitle1",fontWeight:600,children:u.title}),e.jsx(x,{variant:"body2",color:"text.secondary",children:u.artist}),u.album&&e.jsx(x,{variant:"caption",color:"text.secondary",children:u.album})]})]}),e.jsx(De,{}),e.jsxs(jt,{component:"fieldset",children:[e.jsxs(Oh,{component:"legend",sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Tt,{fontSize:"small"}),"Output Format"]}),e.jsxs(sd,{value:g,onChange:_=>y(_.target.value),children:[e.jsx($e,{value:"mp3",control:e.jsx(zi,{}),label:e.jsxs(h,{children:[e.jsx(x,{variant:"body2",children:"MP3"}),e.jsx(x,{variant:"caption",color:"text.secondary",children:"Compressed, universal compatibility, embedded synced lyrics (SYLT)"})]})}),e.jsx($e,{value:"flac",control:e.jsx(zi,{}),label:e.jsxs(h,{children:[e.jsx(x,{variant:"body2",children:"FLAC"}),e.jsx(x,{variant:"caption",color:"text.secondary",children:"Lossless quality, larger file, embedded LRC in metadata"})]})})]})]}),g==="mp3"&&e.jsxs(jt,{fullWidth:!0,size:"small",children:[e.jsx(zt,{children:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(R1,{fontSize:"small"}),"Quality"]})}),e.jsxs(_t,{value:m,onChange:_=>b(_.target.value),label:"Quality",children:[e.jsx(ve,{value:"high",children:R("high")}),e.jsx(ve,{value:"medium",children:R("medium")}),e.jsx(ve,{value:"low",children:R("low")})]})]}),e.jsx(De,{}),e.jsxs(h,{children:[e.jsxs(x,{variant:"subtitle2",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(j1,{fontSize:"small"}),"Lyrics"]}),e.jsx($e,{control:e.jsx(Mi,{checked:S,onChange:_=>v(_.target.checked),disabled:!u.has_lyrics}),label:e.jsxs(h,{children:[e.jsx(x,{variant:"body2",children:"Embed lyrics in file"}),e.jsx(Fi,{direction:"row",spacing:1,sx:{mt:.5},children:u.has_synced_lyrics?e.jsx(de,{label:` Synced lyrics will be embedded${g==="mp3"?" (SYLT)":" (LRC)"}`,size:"small",color:"success"}):u.has_lyrics?e.jsx(de,{label:" Plain lyrics will be embedded",size:"small",color:"info"}):e.jsx(de,{label:"No lyrics to embed",size:"small",color:"default",variant:"outlined"})})]})})]}),e.jsxs(h,{children:[e.jsxs(x,{variant:"subtitle2",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(C1,{fontSize:"small"}),"Album Artwork"]}),e.jsx($e,{control:e.jsx(Mi,{checked:j,onChange:_=>w(_.target.checked),disabled:!u.has_artwork}),label:"Embed album artwork"}),j&&u.artwork_sources&&u.artwork_sources.length>0&&e.jsxs(jt,{fullWidth:!0,size:"small",sx:{mt:1},children:[e.jsx(zt,{children:"Artwork Source"}),e.jsx(_t,{value:C,onChange:_=>A(_.target.value),label:"Artwork Source",children:u.artwork_sources.map((_,z)=>e.jsx(ve,{value:_.url,children:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ue,{src:_.url,variant:"rounded",sx:{width:32,height:32}}),_.label]})},z))})]})]}),f&&e.jsx(ge,{severity:"error",sx:{mt:1},children:f})]}):null}),e.jsxs(tt,{children:[e.jsx(q,{onClick:r,disabled:o,children:"Cancel"}),e.jsx(q,{variant:"contained",onClick:D,disabled:a||o||!u,startIcon:o?e.jsx(Ae,{size:20}):e.jsx(Tr,{}),children:o?"Exporting...":`Export as ${g.toUpperCase()}`})]})]})}var Ds={},Tc;function A1(){if(Tc)return Ds;Tc=1;var t=te();Object.defineProperty(Ds,"__esModule",{value:!0}),Ds.default=void 0;var r=t(ne()),n=re();return Ds.default=(0,r.default)((0,n.jsx)("path",{d:"M9 1h6v2H9zm10.03 6.39 1.42-1.42c-.43-.51-.9-.99-1.41-1.41l-1.42 1.42C16.07 4.74 14.12 4 12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9 9-4.03 9-9c0-2.12-.74-4.07-1.97-5.61M13 14h-2V8h2z"}),"Timer"),Ds}var P1=A1();const D1=ee(P1);var Ms={},zc;function M1(){if(zc)return Ms;zc=1;var t=te();Object.defineProperty(Ms,"__esModule",{value:!0}),Ms.default=void 0;var r=t(ne()),n=re();return Ms.default=(0,r.default)((0,n.jsx)("path",{d:"M5.59 7.41 10.18 12l-4.59 4.59L7 18l6-6-6-6zM16 6h2v12h-2z"}),"LastPage"),Ms}var E1=M1();const T1=ee(E1),z1=[5,10,15,30,45,60,90,120],O1=[1,3,5,10,15,20];function F1({open:t,onClose:r}){const{timerState:n,startTimer:s,stopTimer:a}=Wu(),[i,o]=l.useState(n.mode||"minutes"),[c,f]=l.useState(n.remainingMinutes||30),[d,u]=l.useState(n.remainingSongs||5),[p,g]=l.useState(n.fadeOut??!0),[y,m]=l.useState(n.fadeDuration||30),b=(C,A)=>{A&&o(A)},S=()=>{s({mode:i,minutes:c,songs:d,fadeOut:p,fadeDuration:y}),r()},v=()=>{a(),r()},j=C=>{if(C<60)return`${Math.round(C)} min`;const A=Math.floor(C/60),P=Math.round(C%60);return P===0?`${A} hr`:`${A} hr ${P} min`},w=()=>{if(!n.isActive)return"";if(n.mode==="minutes"){const C=n.remainingMinutes;return C<1?`${Math.round(C*60)} seconds remaining`:`${j(C)} remaining`}else return n.mode==="songs"?`${n.remainingSongs} song${n.remainingSongs!==1?"s":""} remaining`:"Stopping after this track"};return e.jsxs(Qe,{open:t,onClose:r,maxWidth:"xs",fullWidth:!0,PaperProps:{sx:{borderRadius:3,bgcolor:"background.paper"}},children:[e.jsxs(Xe,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Qi,{sx:{color:"primary.main"}}),"Sleep Timer",e.jsx(J,{onClick:r,sx:{ml:"auto"},size:"small",children:e.jsx(Gt,{})})]}),e.jsxs(Ke,{children:[n.isActive&&e.jsxs(h,{sx:{mb:3,p:2,borderRadius:2,bgcolor:"primary.main",color:"primary.contrastText",textAlign:"center"},children:[e.jsx(x,{variant:"body2",sx:{opacity:.9,mb:.5},children:"Timer Active"}),e.jsx(x,{variant:"h6",sx:{fontWeight:600},children:w()}),n.isFading&&e.jsx(de,{label:"Fading out...",size:"small",sx:{mt:1,bgcolor:"rgba(255,255,255,0.2)"}})]}),e.jsx(x,{variant:"subtitle2",sx:{mb:1,color:"text.secondary"},children:"Stop playback after"}),e.jsxs(Fh,{value:i,exclusive:!0,onChange:b,fullWidth:!0,sx:{mb:3},children:[e.jsx(gi,{value:"minutes",sx:{flex:1},children:e.jsxs(h,{sx:{display:"flex",flexDirection:"column",alignItems:"center",py:.5},children:[e.jsx(D1,{sx:{mb:.5}}),e.jsx(x,{variant:"caption",children:"Time"})]})}),e.jsx(gi,{value:"songs",sx:{flex:1},children:e.jsxs(h,{sx:{display:"flex",flexDirection:"column",alignItems:"center",py:.5},children:[e.jsx(Tt,{sx:{mb:.5}}),e.jsx(x,{variant:"caption",children:"Songs"})]})}),e.jsx(gi,{value:"endOfTrack",sx:{flex:1},children:e.jsxs(h,{sx:{display:"flex",flexDirection:"column",alignItems:"center",py:.5},children:[e.jsx(T1,{sx:{mb:.5}}),e.jsx(x,{variant:"caption",children:"This Track"})]})})]}),i==="minutes"&&e.jsxs(h,{sx:{mb:3},children:[e.jsx(x,{variant:"body2",sx:{mb:1.5,textAlign:"center",fontWeight:500},children:j(c)}),e.jsx(wr,{value:c,onChange:(C,A)=>f(A),min:5,max:120,step:5,marks:[{value:5,label:"5m"},{value:30,label:"30m"},{value:60,label:"1h"},{value:120,label:"2h"}],sx:{mb:2}}),e.jsx(h,{sx:{display:"flex",gap:1,flexWrap:"wrap",justifyContent:"center"},children:z1.map(C=>e.jsx(de,{label:j(C),size:"small",variant:c===C?"filled":"outlined",color:c===C?"primary":"default",onClick:()=>f(C),sx:{cursor:"pointer"}},C))})]}),i==="songs"&&e.jsxs(h,{sx:{mb:3},children:[e.jsxs(x,{variant:"body2",sx:{mb:1.5,textAlign:"center",fontWeight:500},children:[d," song",d!==1?"s":""]}),e.jsx(wr,{value:d,onChange:(C,A)=>u(A),min:1,max:30,step:1,marks:[{value:1,label:"1"},{value:10,label:"10"},{value:20,label:"20"},{value:30,label:"30"}],sx:{mb:2}}),e.jsx(h,{sx:{display:"flex",gap:1,flexWrap:"wrap",justifyContent:"center"},children:O1.map(C=>e.jsx(de,{label:`${C} song${C!==1?"s":""}`,size:"small",variant:d===C?"filled":"outlined",color:d===C?"primary":"default",onClick:()=>u(C),sx:{cursor:"pointer"}},C))})]}),i==="endOfTrack"&&e.jsx(h,{sx:{mb:3,textAlign:"center"},children:e.jsx(x,{variant:"body2",color:"text.secondary",children:"Playback will stop when the current track ends."})}),e.jsxs(h,{sx:{p:2,borderRadius:2,bgcolor:"rgba(255,255,255,0.03)",border:"1px solid",borderColor:"rgba(255,255,255,0.1)"},children:[e.jsx($e,{control:e.jsx(et,{checked:p,onChange:C=>g(C.target.checked),color:"primary"}),label:e.jsxs(h,{children:[e.jsx(x,{variant:"body2",children:"Fade out before stopping"}),e.jsx(x,{variant:"caption",color:"text.secondary",children:"Gradually reduce volume for a smoother ending"})]})}),p&&i==="minutes"&&e.jsxs(h,{sx:{mt:2,pl:2},children:[e.jsxs(x,{variant:"caption",color:"text.secondary",gutterBottom:!0,children:["Fade duration: ",y," seconds"]}),e.jsx(wr,{value:y,onChange:(C,A)=>m(A),min:10,max:60,step:5,size:"small",marks:[{value:10,label:"10s"},{value:30,label:"30s"},{value:60,label:"60s"}]})]})]})]}),e.jsx(tt,{sx:{px:3,pb:3,gap:1},children:n.isActive?e.jsxs(e.Fragment,{children:[e.jsx(q,{onClick:v,variant:"outlined",color:"error",fullWidth:!0,children:"Cancel Timer"}),e.jsx(q,{onClick:S,variant:"contained",fullWidth:!0,children:"Update Timer"})]}):e.jsx(q,{onClick:S,variant:"contained",fullWidth:!0,startIcon:e.jsx(Qi,{}),children:"Start Sleep Timer"})})]})}const L1=t=>{if(!t||t<=0)return"--:--";const r=Math.floor(t/60),n=Math.floor(t%60);return`${r}:${n.toString().padStart(2,"0")}`};function W1({open:t,onClose:r,queue:n,currentIndex:s,onPlayTrack:a,onRemoveTrack:i,onReorderTrack:o,onClearQueue:c}){const f=Ot(),d=Xa(f.breakpoints.down("md")),[u,p]=l.useState(null),[g,y]=l.useState(null),m=n.slice(s+1),b=n.slice(0,s),S=n[s],v=(D,R)=>{if(R===s){D.preventDefault();return}p(R),D.dataTransfer.effectAllowed="move",D.dataTransfer.setData("text/plain",R.toString())},j=(D,R)=>{D.preventDefault(),R!==s&&y(R)},w=()=>{y(null)},C=(D,R)=>{D.preventDefault();const _=u;p(null),y(null),!(_===null||_===R||R===s)&&o(_,R)},A=()=>{p(null),y(null)},P=(D,R,_=!1)=>{const z=R===s,W=R===u,B=R===g,H=!z;return e.jsxs(Oe,{draggable:H,onDragStart:se=>v(se,R),onDragOver:se=>j(se,R),onDragLeave:w,onDrop:se=>C(se,R),onDragEnd:A,sx:{borderRadius:2,mb:.5,transition:"all 0.2s ease",opacity:W?.5:_?.6:1,bgcolor:z?qe(f.palette.primary.main,.15):B?qe(f.palette.primary.main,.1):"transparent",borderLeft:z?`3px solid ${f.palette.primary.main}`:B?`3px solid ${qe(f.palette.primary.main,.5)}`:"3px solid transparent",cursor:H?"grab":"default","&:hover":{bgcolor:z?qe(f.palette.primary.main,.2):qe(f.palette.action.hover,.1)},"&:active":H?{cursor:"grabbing"}:{}},secondaryAction:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:.5},children:[!z&&e.jsxs(e.Fragment,{children:[e.jsx(be,{title:"Play",children:e.jsx(J,{size:"small",onClick:()=>a(R),sx:{opacity:.7,"&:hover":{opacity:1}},children:e.jsx(nr,{fontSize:"small"})})}),e.jsx(be,{title:"Remove from queue",children:e.jsx(J,{size:"small",onClick:()=>i(R),sx:{opacity:.7,"&:hover":{opacity:1,color:"error.main"}},children:e.jsx(Dr,{fontSize:"small"})})})]}),z&&e.jsx($h,{fontSize:"small",sx:{color:"primary.main",animation:"pulse 1.5s ease-in-out infinite","@keyframes pulse":{"0%, 100%":{opacity:1},"50%":{opacity:.5}}}})]}),children:[H&&e.jsx(Wh,{sx:{mr:1,color:"text.disabled",cursor:"grab","&:hover":{color:"text.secondary"}}}),e.jsx(Et,{children:e.jsx(Ue,{variant:"rounded",src:D.cover_art_url||D.thumbnail_url,sx:{width:48,height:48,bgcolor:"background.paper"},children:e.jsx(Ut,{})})}),e.jsx(Se,{primary:e.jsx(x,{variant:"body2",noWrap:!0,sx:{fontWeight:z?600:400,color:z?"primary.main":"text.primary"},children:D.title}),secondary:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(x,{variant:"caption",color:"text.secondary",noWrap:!0,children:D.channel_name||D.artist||"Unknown Artist"}),e.jsx(x,{variant:"caption",color:"text.disabled",children:L1(D.duration)})]}),sx:{mr:8}})]},`${D.id}-${R}`)};return e.jsx(pd,{anchor:"right",open:t,onClose:r,PaperProps:{sx:{width:d?"100%":400,maxWidth:"100%",bgcolor:"background.default",backgroundImage:"none"}},children:e.jsxs(h,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs(h,{sx:{p:2,display:"flex",alignItems:"center",justifyContent:"space-between",borderBottom:1,borderColor:"divider"},children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ei,{color:"primary"}),e.jsx(x,{variant:"h6",fontWeight:600,children:"Queue"}),e.jsx(de,{label:n.length,size:"small",sx:{ml:1,height:22}})]}),e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1},children:[n.length>1&&e.jsx(be,{title:"Clear queue (except current)",children:e.jsx(J,{size:"small",onClick:c,sx:{color:"text.secondary"},children:e.jsx(Lh,{})})}),e.jsx(J,{onClick:r,children:e.jsx(ea,{})})]})]}),e.jsx(h,{sx:{flex:1,overflow:"auto",p:1},children:n.length===0?e.jsxs(h,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",opacity:.6},children:[e.jsx(Ei,{sx:{fontSize:64,mb:2,color:"text.disabled"}}),e.jsx(x,{color:"text.secondary",children:"Your queue is empty"}),e.jsx(x,{variant:"caption",color:"text.disabled",sx:{mt:1},children:"Play something or add tracks to the queue"})]}):e.jsxs(Ge,{disablePadding:!0,children:[S&&e.jsxs(e.Fragment,{children:[e.jsx(x,{variant:"overline",sx:{px:2,py:1,display:"block",color:"text.secondary"},children:"Now Playing"}),P(S,s)]}),m.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(De,{sx:{my:1}}),e.jsxs(x,{variant:"overline",sx:{px:2,py:1,display:"block",color:"text.secondary"},children:["Up Next (",m.length,")"]}),m.map((D,R)=>P(D,s+1+R))]}),b.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(De,{sx:{my:1}}),e.jsxs(x,{variant:"overline",sx:{px:2,py:1,display:"block",color:"text.disabled"},children:["Previously Played (",b.length,")"]}),b.map((D,R)=>P(D,R,!0))]})]})}),n.length>0&&e.jsx(h,{sx:{p:2,borderTop:1,borderColor:"divider",bgcolor:"background.paper"},children:e.jsxs(x,{variant:"caption",color:"text.secondary",children:[m.length," track",m.length!==1?"s":""," remaining","  ",$1(m)]})})]})})}function $1(t){const r=t.reduce((a,i)=>a+(i.duration||0),0);if(r<=0)return"Unknown duration";const n=Math.floor(r/3600),s=Math.floor(r%3600/60);return n>0?`${n}h ${s}m`:`${s} min`}var Es={},Oc;function B1(){if(Oc)return Es;Oc=1;var t=te();Object.defineProperty(Es,"__esModule",{value:!0}),Es.default=void 0;var r=t(ne()),n=re();return Es.default=(0,r.default)((0,n.jsx)("path",{d:"M12 5V2L8 6l4 4V7c3.31 0 6 2.69 6 6 0 2.97-2.17 5.43-5 5.91v2.02c3.95-.49 7-3.85 7-7.93 0-4.42-3.58-8-8-8m-6 8c0-1.65.67-3.15 1.76-4.24L6.34 7.34C4.9 8.79 4 10.79 4 13c0 4.08 3.05 7.44 7 7.93v-2.02c-2.83-.48-5-2.94-5-5.91"}),"RestartAlt"),Es}var q1=B1();const N1=ee(q1);var Ts={},Fc;function U1(){if(Fc)return Ts;Fc=1;var t=te();Object.defineProperty(Ts,"__esModule",{value:!0}),Ts.default=void 0;var r=t(ne()),n=re();return Ts.default=(0,r.default)((0,n.jsx)("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m3-10H5V5h10z"}),"Save"),Ts}var H1=U1();const V1=ee(H1);var zs={},Lc;function Y1(){if(Lc)return zs;Lc=1;var t=te();Object.defineProperty(zs,"__esModule",{value:!0}),zs.default=void 0;var r=t(ne()),n=re();return zs.default=(0,r.default)((0,n.jsx)("path",{d:"M3 17v2h6v-2zM3 5v2h10V5zm10 16v-2h8v-2h-8v-2h-2v6zM7 9v2H3v2h4v2h2V9zm14 4v-2H11v2zm-6-4h2V7h4V5h-4V3h-2z"}),"Tune"),zs}var G1=Y1();const Nu=ee(G1);function Q1({open:t,onClose:r}){const n=Ot(),s=Xa(n.breakpoints.down("sm")),{enabled:a,activePresetId:i,gains:o,presets:c,customPresets:f,setEnabled:d,setGain:u,selectPreset:p,saveCustomPreset:g,deleteCustomPreset:y,resetToFlat:m}=Bu(),[b,S]=l.useState(!1),[v,j]=l.useState(""),w=c.find(_=>_.id===i),C=i==="custom"||w?.isCustom,A=_=>{p(_.target.value)},P=_=>(z,W)=>{u(_,W)},D=()=>{v.trim()&&(g(v.trim()),j(""),S(!1))},R=l.useMemo(()=>{const _=s?280:500,z=80,W=10,B=o.map((se,I)=>{const k=W+I/(o.length-1)*(_-W*2),O=z/2-se/Gs*(z/2-W);return{x:k,y:O}});let H=`M ${B[0].x} ${B[0].y}`;for(let se=1;se<B.length;se++){const I=B[se-1],k=B[se],O=(I.x+k.x)/2;H+=` Q ${O} ${I.y} ${O} ${(I.y+k.y)/2}`,H+=` Q ${O} ${k.y} ${k.x} ${k.y}`}return e.jsx(h,{sx:{width:"100%",display:"flex",justifyContent:"center",mb:2,opacity:a?1:.3,transition:"opacity 0.3s"},children:e.jsxs("svg",{width:_,height:z,style:{overflow:"visible"},children:[e.jsx("line",{x1:W,y1:z/2,x2:_-W,y2:z/2,stroke:qe(n.palette.text.secondary,.2),strokeDasharray:"4 4"}),e.jsx("line",{x1:W,y1:z/4,x2:_-W,y2:z/4,stroke:qe(n.palette.text.secondary,.1),strokeDasharray:"2 4"}),e.jsx("line",{x1:W,y1:3*z/4,x2:_-W,y2:3*z/4,stroke:qe(n.palette.text.secondary,.1),strokeDasharray:"2 4"}),e.jsx("defs",{children:e.jsxs("linearGradient",{id:"curveGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:n.palette.primary.main,stopOpacity:.4}),e.jsx("stop",{offset:"100%",stopColor:n.palette.primary.main,stopOpacity:.05})]})}),e.jsx("path",{d:`${H} L ${B[B.length-1].x} ${z/2} L ${B[0].x} ${z/2} Z`,fill:"url(#curveGradient)"}),e.jsx("path",{d:H,fill:"none",stroke:n.palette.primary.main,strokeWidth:2,strokeLinecap:"round"}),B.map((se,I)=>e.jsx("circle",{cx:se.x,cy:se.y,r:4,fill:n.palette.primary.main,stroke:n.palette.background.paper,strokeWidth:1},I))]})})},[o,a,n,s]);return e.jsxs(e.Fragment,{children:[e.jsxs(Qe,{open:t,onClose:r,maxWidth:"md",fullWidth:!0,fullScreen:s,PaperProps:{sx:{bgcolor:"background.paper",backgroundImage:"none"}},children:[e.jsxs(Xe,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ho,{color:"primary"}),e.jsx(x,{variant:"h6",sx:{flexGrow:1},children:"Equalizer"}),e.jsx($e,{control:e.jsx(et,{checked:a,onChange:_=>d(_.target.checked),color:"primary"}),label:a?"On":"Off"})]}),e.jsxs(Ke,{children:[R,e.jsxs(h,{sx:{display:"flex",gap:2,mb:3,flexWrap:"wrap",alignItems:"center"},children:[e.jsxs(jt,{size:"small",sx:{minWidth:150},children:[e.jsx(zt,{children:"Preset"}),e.jsxs(_t,{value:i==="custom"?"":i,onChange:A,label:"Preset",displayEmpty:!0,children:[i==="custom"&&e.jsx(ve,{value:"",disabled:!0,children:e.jsx("em",{children:"Custom"})}),e.jsx(ve,{disabled:!0,sx:{opacity:.7,fontSize:"0.75rem"},children:" Built-in "}),Ki.map(_=>e.jsx(ve,{value:_.id,children:_.name},_.id)),f.length>0&&e.jsx(ve,{disabled:!0,sx:{opacity:.7,fontSize:"0.75rem"},children:" Custom "}),f.map(_=>e.jsx(ve,{value:_.id,children:_.name},_.id))]})]}),e.jsx(be,{title:"Reset to Flat",children:e.jsx(J,{onClick:m,size:"small",children:e.jsx(N1,{})})}),e.jsx(be,{title:"Save as Custom Preset",children:e.jsx(J,{onClick:()=>S(!0),size:"small",color:"primary",children:e.jsx(V1,{})})}),w?.isCustom&&e.jsx(be,{title:"Delete Custom Preset",children:e.jsx(J,{onClick:()=>y(i),size:"small",color:"error",children:e.jsx(fi,{})})}),C&&e.jsx(de,{icon:e.jsx(Nu,{sx:{fontSize:16}}),label:"Custom",size:"small",color:"secondary",variant:"outlined"})]}),e.jsx(De,{sx:{mb:3}}),e.jsx(h,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-end",gap:s?.5:1,px:s?0:2,opacity:a?1:.4,transition:"opacity 0.3s",pointerEvents:a?"auto":"none"},children:Hb.map((_,z)=>e.jsxs(h,{sx:{display:"flex",flexDirection:"column",alignItems:"center",flex:1},children:[e.jsxs(x,{variant:"caption",sx:{mb:1,color:o[z]>0?"success.main":o[z]<0?"error.main":"text.secondary",fontWeight:600,fontSize:s?"0.65rem":"0.75rem"},children:[o[z]>0?"+":"",o[z]]}),e.jsx(wr,{orientation:"vertical",value:o[z],min:Ga,max:Gs,step:1,onChange:P(z),sx:{height:s?100:150,"& .MuiSlider-track":{width:4,background:W=>o[z]>=0?`linear-gradient(to top, ${W.palette.primary.main}, ${W.palette.success.main})`:`linear-gradient(to bottom, ${W.palette.primary.main}, ${W.palette.error.main})`},"& .MuiSlider-rail":{width:4,opacity:.3},"& .MuiSlider-thumb":{width:s?14:16,height:s?14:16,"&:hover, &.Mui-focusVisible":{boxShadow:W=>`0 0 0 8px ${qe(W.palette.primary.main,.16)}`}}}}),e.jsx(x,{variant:"caption",sx:{mt:1,color:"text.secondary",fontSize:s?"0.6rem":"0.7rem",fontWeight:500},children:_})]},_))}),e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",mt:2,px:2},children:[e.jsxs(x,{variant:"caption",color:"text.secondary",children:["+",Gs,"dB"]}),e.jsx(x,{variant:"caption",color:"text.secondary",children:"0dB"}),e.jsxs(x,{variant:"caption",color:"text.secondary",children:[Ga,"dB"]})]}),s&&e.jsx(h,{sx:{mt:3,display:"flex",flexWrap:"wrap",gap:1,justifyContent:"center"},children:Ki.slice(0,6).map(_=>e.jsx(de,{label:_.name,size:"small",variant:i===_.id?"filled":"outlined",color:i===_.id?"primary":"default",onClick:()=>p(_.id),sx:{fontSize:"0.75rem"}},_.id))})]}),e.jsx(tt,{children:e.jsx(q,{onClick:r,children:"Close"})})]}),e.jsxs(Qe,{open:b,onClose:()=>S(!1),maxWidth:"xs",fullWidth:!0,children:[e.jsx(Xe,{children:"Save Custom Preset"}),e.jsx(Ke,{children:e.jsx(je,{autoFocus:!0,margin:"dense",label:"Preset Name",fullWidth:!0,variant:"outlined",value:v,onChange:_=>j(_.target.value),onKeyDown:_=>{_.key==="Enter"&&v.trim()&&D()}})}),e.jsxs(tt,{children:[e.jsx(q,{onClick:()=>S(!1),children:"Cancel"}),e.jsx(q,{onClick:D,variant:"contained",disabled:!v.trim(),children:"Save"})]})]})]})}var Os={},Wc;function K1(){if(Wc)return Os;Wc=1;var t=te();Object.defineProperty(Os,"__esModule",{value:!0}),Os.default=void 0;var r=t(ne()),n=re();return Os.default=(0,r.default)((0,n.jsx)("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8zm4 18H6V4h7v5h5zM8 15.01l1.41 1.41L11 14.84V19h2v-4.16l1.59 1.59L16 15.01 12.01 11z"}),"UploadFile"),Os}var J1=K1();const $c=ee(J1);var Fs={},Bc;function X1(){if(Bc)return Fs;Bc=1;var t=te();Object.defineProperty(Fs,"__esModule",{value:!0}),Fs.default=void 0;var r=t(ne()),n=re();return Fs.default=(0,r.default)((0,n.jsx)("path",{d:"m20.41 8.41-4.83-4.83c-.37-.37-.88-.58-1.41-.58H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V9.83c0-.53-.21-1.04-.59-1.42M7 7h7v2H7zm10 10H7v-2h10zm0-4H7v-2h10z"}),"TextSnippet"),Fs}var Z1=X1();const ev=ee(Z1);var Ls={},qc;function tv(){if(qc)return Ls;qc=1;var t=te();Object.defineProperty(Ls,"__esModule",{value:!0}),Ls.default=void 0;var r=t(ne()),n=re();return Ls.default=(0,r.default)((0,n.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM8 9h8v10H8zm7.5-5-1-1h-5l-1 1H5v2h14V4z"}),"DeleteOutline"),Ls}var rv=tv();const nv=ee(rv);var Ws={},Nc;function sv(){if(Nc)return Ws;Nc=1;var t=te();Object.defineProperty(Ws,"__esModule",{value:!0}),Ws.default=void 0;var r=t(ne()),n=re();return Ws.default=(0,r.default)((0,n.jsx)("path",{d:"M6.99 11 3 15l3.99 4v-3H14v-2H6.99zM21 9l-3.99-4v3H10v2h7.01v3z"}),"SwapHoriz"),Ws}var av=sv();const iv=ee(av);function ov({youtubeId:t,currentTime:r,onClose:n,embedded:s=!1,onSeek:a,visualizerTheme:i,isLightMode:o}){const{settings:c}=Sr(),f=Ot(),d=i||c.visualizer_theme||Eu,u=o!==void 0?o:f.palette.mode==="light",p=f.palette.primary.main,[g,y]=l.useState(null),[m,b]=l.useState(!0),[S,v]=l.useState(""),[j,w]=l.useState([]),[C,A]=l.useState(-1),[P,D]=l.useState(0),[R,_]=l.useState(!0),[z,W]=l.useState(0),B=l.useMemo(()=>(console.log("[LyricsPlayer] Getting colors - theme:",d,"lightMode:",u,"muiColor:",p),ry(d,u,p)),[d,u,p]),[H,se]=l.useState([]),[I,k]=l.useState(!1),[O,E]=l.useState(!1),[Z,G]=l.useState(""),[M,T]=l.useState(null),[ae,L]=l.useState(!1),[N,X]=l.useState(!1),[ue,$]=l.useState(null),[ie,le]=l.useState(!1),[He,Be]=l.useState(!1),oe=l.useRef(null),pe=l.useRef(null),me=l.useRef(null);l.useEffect(()=>{he()},[t]),l.useEffect(()=>{g?.is_synced&&j.length>0&&gt()},[r,j]),l.useEffect(()=>{if(R&&me.current&&pe.current){const V=pe.current,xe=me.current,ye=V.clientHeight,we=xe.offsetTop;V.scrollTo({top:we-ye/2+xe.clientHeight/2,behavior:"smooth"})}},[C,R]);const he=async()=>{try{b(!0),v("");let V=null;try{const ye=dt.getLyrics(t),we=new Promise((Me,Te)=>setTimeout(()=>Te(new Error("Cache timeout")),2e3));V=await Promise.race([ye,we])}catch(ye){console.log("[Lyrics] Cache check failed or timed out:",ye)}if(V){if(console.log("[Lyrics] Loading from offline cache"),y(V),V.is_synced){const ye=Ht(V.synced_lyrics);w(ye)}b(!1),navigator.onLine&&U.get(`/audio/${t}/lyrics/`).then(ye=>{if(y(ye.data),ye.data.is_synced){const we=Ht(ye.data.synced_lyrics);w(we)}dt.saveLyrics(t,ye.data).catch(()=>{})}).catch(()=>{});return}if(!navigator.onLine){v("Lyrics not available offline"),b(!1);return}const xe=await U.get(`/audio/${t}/lyrics/`);if(y(xe.data),xe.data.is_synced){const ye=Ht(xe.data.synced_lyrics);w(ye)}dt.saveLyrics(t,xe.data).catch(()=>{})}catch(V){v(V.response?.data?.error||"Failed to load lyrics")}finally{b(!1)}},Fe=async()=>{try{b(!0),v("");const V=await U.post(`/audio/${t}/lyrics/fetch/`,{force:!0});if(y(V.data),V.data.is_synced){const xe=Ht(V.data.synced_lyrics);w(xe)}!V.data.has_lyrics&&!V.data.is_instrumental&&Dt()}catch(V){v(V.response?.data?.error||"Failed to fetch lyrics")}finally{b(!1)}},Dt=async V=>{try{k(!0);const xe=V?`?q=${encodeURIComponent(V)}`:"",ye=await U.get(`/audio/${t}/lyrics/suggestions/${xe}`);se(ye.data.suggestions||[]),E(!0)}catch(xe){console.error("Failed to load suggestions:",xe)}finally{k(!1)}},ur=async V=>{try{T(V.id);const xe=await U.post(`/audio/${t}/lyrics/apply/`,{synced_lyrics:V.synced_lyrics,plain_lyrics:V.plain_lyrics,instrumental:V.instrumental,language:V.language,track_name:V.track_name,artist_name:V.artist_name});if(y(xe.data),xe.data.is_synced){const ye=Ht(xe.data.synced_lyrics);w(ye)}E(!1),se([]),L(!1)}catch(xe){v(xe.response?.data?.error||"Failed to apply lyrics")}finally{T(null)}},mt=async()=>{try{X(!0),await U.delete(`/audio/${t}/lyrics/delete/`),y({audio_id:t,audio_title:g?.audio_title||"",synced_lyrics:"",plain_lyrics:"",is_instrumental:!1,source:"",language:"",has_lyrics:!1,is_synced:!1,display_lyrics:"",fetch_attempted:!0,fetch_attempts:0,last_error:""}),w([]),L(!1),Dt()}catch(V){v(V.response?.data?.error||"Failed to delete lyrics")}finally{X(!1)}},ar=V=>{V.preventDefault(),Z.trim()&&Dt(Z.trim())},Jt=V=>{const xe=Math.floor(V/60),ye=V%60;return`${xe}:${ye.toString().padStart(2,"0")}`},hr=async V=>{$(null);try{const xe=await U.get(`/audio/${t}/lyrics/download/?type=${V}`,{responseType:"blob"}),ye=new Blob([xe.data],{type:"text/plain;charset=utf-8"}),we=window.URL.createObjectURL(ye),Me=document.createElement("a");Me.href=we;const Te=xe.headers["content-disposition"];let Ct=`lyrics.${V}`;if(Te){const Vt=Te.match(/filename="(.+)"/);Vt&&(Ct=Vt[1])}Me.download=Ct,document.body.appendChild(Me),Me.click(),document.body.removeChild(Me),window.URL.revokeObjectURL(we)}catch(xe){console.error("Download failed:",xe),v(xe.response?.data?.error||"Failed to download lyrics")}},Ft=()=>{oe.current?.click()},Br=async V=>{const xe=V.target.files?.[0];if(xe){if(!xe.name.toLowerCase().endsWith(".lrc")){v("Please select a valid .lrc file");return}if(xe.size>1024*1024){v("LRC file must be smaller than 1MB");return}try{le(!0),v("");const ye=await wt.uploadLrcFile(t,xe);if(y(ye.data),ye.data.is_synced){const we=Ht(ye.data.synced_lyrics);w(we)}dt.saveLyrics(t,ye.data).catch(()=>{}),Be(!0),L(!1)}catch(ye){console.error("Upload failed:",ye),v(ye.response?.data?.error||"Failed to upload LRC file")}finally{le(!1),oe.current&&(oe.current.value="")}}},Ht=V=>{const xe=[],ye=V.split(`
`);for(const Me of ye){const Te=Me.match(/\[(\d{2}):(\d{2})\.(\d{2,3})\](.*)/);if(Te){const Ct=parseInt(Te[1]),Vt=parseInt(Te[2]),fr=parseInt(Te[3].padEnd(2,"0").substring(0,2)),cn=Ct*60+Vt+fr/100,Lt=Te[4].trim();Lt&&xe.push({time:cn,text:Lt})}}const we=xe.sort((Me,Te)=>Me.time-Te.time);for(let Me=0;Me<we.length;Me++)Me<we.length-1?we[Me].endTime=we[Me+1].time:we[Me].endTime=we[Me].time+5;return we},gt=()=>{let V=-1;for(let xe=j.length-1;xe>=0;xe--)if(r>=j[xe].time){V=xe;break}if(A(V),V>=0&&V<j.length){const xe=j[V],ye=xe.time,Me=(xe.endTime||(V<j.length-1?j[V+1].time:ye+5))-ye;if(Me>0){const Te=Math.min(1,Math.max(0,(r-ye)/Me));D(Te)}else D(1)}else D(0)};return m?e.jsxs(h,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[n&&e.jsx(h,{sx:{display:"flex",justifyContent:"flex-end",p:1},children:e.jsx(J,{size:"small",onClick:n,children:e.jsx(Gt,{})})}),e.jsx(h,{sx:{flex:1,display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx(Ae,{})})]}):S?e.jsxs(h,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[n&&e.jsx(h,{sx:{display:"flex",justifyContent:"flex-end",p:1},children:e.jsx(J,{size:"small",onClick:n,children:e.jsx(Gt,{})})}),e.jsxs(h,{sx:{flex:1,p:2},children:[e.jsx(ge,{severity:"error",sx:{mb:2},children:S}),e.jsx(q,{variant:"contained",onClick:Fe,startIcon:e.jsx(Us,{}),children:"Try Fetch Lyrics"})]})]}):g?g.is_instrumental?e.jsxs(h,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[n&&e.jsx(h,{sx:{display:"flex",justifyContent:"flex-end",p:1},children:e.jsx(J,{size:"small",onClick:n,children:e.jsx(Gt,{})})}),e.jsxs(h,{sx:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",p:4},children:[e.jsx(Tt,{sx:{fontSize:64,color:"text.secondary",mb:2}}),e.jsx(x,{variant:"h6",color:"text.secondary",children:"Instrumental Track"})]})]}):g.has_lyrics?e.jsxs(Ce,{sx:{height:"100%",display:"flex",flexDirection:"column",bgcolor:"background.paper"},children:[e.jsxs(h,{sx:{borderBottom:1,borderColor:"divider",display:"flex",alignItems:"center",px:2,pt:1},children:[e.jsx(x,{variant:"h6",sx:{flexGrow:1},children:"Lyrics"}),e.jsx(J,{size:"small",onClick:()=>{L(!ae),!ae&&H.length===0&&Dt()},sx:{mr:1},title:"Find different lyrics",color:ae?"primary":"default",children:e.jsx(iv,{})}),e.jsx(J,{size:"small",onClick:V=>$(V.currentTarget),sx:{mr:1},title:"Download lyrics",children:e.jsx(Tr,{})}),e.jsxs(la,{anchorEl:ue,open:!!ue,onClose:()=>$(null),children:[g.is_synced&&e.jsxs(ve,{onClick:()=>hr("lrc"),children:[e.jsx(Ye,{children:e.jsx(Tt,{fontSize:"small"})}),"Download .LRC (synced)"]}),e.jsxs(ve,{onClick:()=>hr("txt"),children:[e.jsx(Ye,{children:e.jsx(ev,{fontSize:"small"})}),"Download .TXT (plain)"]})]}),e.jsx(be,{title:"Upload .LRC file",children:e.jsx(J,{size:"small",onClick:Ft,sx:{mr:1},disabled:ie,children:ie?e.jsx(Ae,{size:20}):e.jsx($c,{})})}),e.jsx("input",{ref:oe,type:"file",accept:".lrc",style:{display:"none"},onChange:Br}),e.jsx(J,{size:"small",onClick:Fe,sx:{mr:1},title:"Refresh lyrics",children:e.jsx(Us,{})}),n&&e.jsx(J,{size:"small",onClick:n,children:e.jsx(Gt,{})})]}),e.jsx(ct,{open:He,autoHideDuration:3e3,onClose:()=>Be(!1),message:"LRC file uploaded successfully!",anchorOrigin:{vertical:"bottom",horizontal:"center"}}),e.jsx(Li,{in:ae,children:e.jsxs(h,{sx:{p:2,bgcolor:"action.hover",borderBottom:1,borderColor:"divider"},children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[e.jsx(x,{variant:"subtitle2",color:"primary",children:"Find Different Lyrics"}),e.jsx(q,{size:"small",color:"error",variant:"outlined",startIcon:N?e.jsx(Ae,{size:16}):e.jsx(nv,{}),onClick:mt,disabled:N,children:N?"Clearing...":"Clear & Search"})]}),e.jsx(h,{component:"form",onSubmit:ar,sx:{mb:2},children:e.jsx(je,{fullWidth:!0,size:"small",placeholder:"Search by song title or artist...",value:Z,onChange:V=>G(V.target.value),InputProps:{startAdornment:e.jsx(tr,{position:"start",children:e.jsx(Pr,{sx:{color:"text.secondary"}})}),endAdornment:e.jsx(tr,{position:"end",children:e.jsx(q,{type:"submit",size:"small",disabled:I,children:I?"Searching...":"Search"})})}})}),I&&e.jsx(h,{sx:{display:"flex",justifyContent:"center",py:2},children:e.jsx(Ae,{size:24})}),!I&&H.length>0&&e.jsxs(h,{sx:{maxHeight:250,overflow:"auto",position:"relative",zIndex:1},children:[e.jsxs(x,{variant:"caption",color:"text.secondary",sx:{mb:1,display:"block"},children:[H.length," suggestions found - select one to replace current lyrics:"]}),e.jsx(Ge,{dense:!0,sx:{bgcolor:"background.paper",borderRadius:1},children:H.map(V=>e.jsx(Oe,{sx:{borderBottom:"1px solid",borderColor:"divider","&:last-child":{borderBottom:"none"},display:"flex",alignItems:"center",pr:1},secondaryAction:e.jsx(q,{size:"small",variant:"contained",color:"primary",onClick:()=>ur(V),disabled:M===V.id,startIcon:M===V.id?e.jsx(Ae,{size:16}):e.jsx(oa,{}),sx:{minWidth:70},children:M===V.id?"...":"Use"}),children:e.jsx(Se,{sx:{pr:8},primary:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1,flexWrap:"wrap"},children:[e.jsxs(x,{variant:"body2",sx:{fontWeight:500,wordBreak:"break-word"},noWrap:!0,children:['"',V.track_name,'"']}),e.jsxs(x,{variant:"body2",color:"text.secondary",noWrap:!0,children:["by ",V.artist_name]})]}),secondary:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1,mt:.5},children:[V.has_synced&&e.jsx(de,{label:"Synced",size:"small",color:"success",sx:{height:20}}),V.has_plain&&!V.has_synced&&e.jsx(de,{label:"Plain",size:"small",sx:{height:20}}),V.instrumental&&e.jsx(de,{label:"Instrumental",size:"small",color:"info",sx:{height:20}}),e.jsx(x,{variant:"caption",color:"text.secondary",children:Jt(V.duration)})]})})},V.id))})]}),!I&&H.length===0&&e.jsx(x,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",py:2},children:"No suggestions loaded yet. Enter a search term or click Search to find lyrics."})]})}),g.is_synced&&e.jsxs(h,{sx:{px:2,py:1,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(x,{variant:"caption",color:"text.secondary",children:["Source: ",g.source==="upload"&&g.uploaded_filename?` ${g.uploaded_filename}`:g.source," ",g.language&&` ${g.language}`]}),e.jsx($e,{control:e.jsx(et,{size:"small",checked:R,onChange:V=>_(V.target.checked)}),label:e.jsx(x,{variant:"caption",children:"Auto-scroll"})})]}),g.is_synced&&g.plain_lyrics&&e.jsxs(Ji,{value:z,onChange:(V,xe)=>W(xe),sx:{px:2,minHeight:40},children:[e.jsx(qt,{label:"Synced",sx:{minHeight:40,py:.5}}),e.jsx(qt,{label:"Plain Text",sx:{minHeight:40,py:.5}})]}),e.jsx(Ie,{ref:pe,sx:{flexGrow:1,overflow:"auto",background:`linear-gradient(180deg, transparent 0%, ${B.background} 50%, transparent 100%)`,"&::-webkit-scrollbar":{width:"6px"},"&::-webkit-scrollbar-track":{backgroundColor:"rgba(255,255,255,0.05)",borderRadius:"3px"},"&::-webkit-scrollbar-thumb":{backgroundColor:B.glow,borderRadius:"3px","&:hover":{backgroundColor:B.primary}}},children:z===0&&g.is_synced?e.jsx(h,{sx:{py:2},children:j.map((V,xe)=>{const ye=xe===C,we=xe<C,Me=xe===C+1,Te=xe>C&&xe<=C+2;return e.jsx(h,{ref:ye?me:null,onClick:()=>a?.(V.time),sx:{py:1.5,px:2,my:.5,borderRadius:2,cursor:a?"pointer":"default",transition:"all 0.35s cubic-bezier(0.4, 0, 0.2, 1)",backgroundColor:ye?B.background:"transparent",transform:ye?"scale(1.03)":"scale(1)",boxShadow:ye?`0 4px 20px ${B.glow}, inset 0 0 20px ${B.glow}`:"none",borderLeft:ye?`3px solid ${B.primary}`:"3px solid transparent","&:hover":a?{backgroundColor:ye?B.backgroundHover:B.hoverBackground,transform:ye?"scale(1.03)":"scale(1.01)"}:{}},children:ye?e.jsxs(h,{sx:{position:"relative",overflow:"hidden"},children:[e.jsx(x,{variant:"body1",sx:{fontSize:"1.3rem",fontWeight:700,lineHeight:1.6,letterSpacing:"0.02em",background:`linear-gradient(135deg, ${B.gradientStart} 0%, ${B.gradientMid} 50%, ${B.gradientEnd} 100%)`,backgroundClip:"text",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",filter:`drop-shadow(0 0 8px ${B.glow})`,animation:"lyricsPulse 2s ease-in-out infinite","@keyframes lyricsPulse":{"0%, 100%":{filter:`drop-shadow(0 0 8px ${B.glow})`},"50%":{filter:`drop-shadow(0 0 15px ${B.glow})`}}},children:V.text}),e.jsx(h,{sx:{position:"absolute",bottom:-6,left:0,height:3,borderRadius:1.5,background:`linear-gradient(90deg, ${B.gradientStart}, ${B.gradientMid}, ${B.gradientEnd})`,width:`${P*100}%`,transition:"width 0.1s linear",boxShadow:`0 0 12px ${B.glow}, 0 0 4px ${B.primary}`}})]}):e.jsx(x,{variant:"body1",sx:{fontSize:Me?"1.15rem":"1rem",fontWeight:we?400:Me?500:400,lineHeight:1.6,color:we?B.pastTextColor:Te?B.upcomingTextColor:B.textColor,transition:"all 0.35s ease",...Me&&{textShadow:`0 0 20px ${B.glow}`}},children:V.text})},xe)})}):e.jsx(h,{sx:{px:1},children:g.plain_lyrics.split(`
`).map((V,xe)=>e.jsx(x,{variant:"body1",sx:{py:.5,lineHeight:1.8,color:"text.primary"},children:V||""},xe))})}),g.last_error&&e.jsxs(ge,{severity:"warning",sx:{m:2,mt:0},children:["Last fetch error: ",g.last_error]})]}):e.jsxs(h,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[n&&e.jsx(h,{sx:{display:"flex",justifyContent:"flex-end",p:1},children:e.jsx(J,{size:"small",onClick:n,children:e.jsx(Gt,{})})}),e.jsxs(h,{sx:{flex:1,p:2,overflow:"auto"},children:[e.jsxs(ge,{severity:"info",sx:{mb:2},children:["No lyrics found for this track",g.fetch_attempted&&` (Attempted ${g.fetch_attempts} times)`]}),e.jsxs(h,{sx:{display:"flex",gap:1,mb:2,flexWrap:"wrap"},children:[e.jsx(q,{variant:"contained",onClick:Fe,startIcon:e.jsx(Us,{}),size:"small",children:"Retry Fetch"}),e.jsx(q,{variant:"outlined",onClick:()=>Dt(),startIcon:e.jsx(Pr,{}),size:"small",disabled:I,children:I?"Searching...":"Find Suggestions"}),e.jsx(q,{variant:"outlined",onClick:Ft,startIcon:ie?e.jsx(Ae,{size:16}):e.jsx($c,{}),size:"small",disabled:ie,color:"secondary",children:ie?"Uploading...":"Upload .LRC"})]}),e.jsx("input",{ref:oe,type:"file",accept:".lrc",style:{display:"none"},onChange:Br}),e.jsx(ct,{open:He,autoHideDuration:3e3,onClose:()=>Be(!1),message:"LRC file uploaded successfully!",anchorOrigin:{vertical:"bottom",horizontal:"center"}}),e.jsx(h,{component:"form",onSubmit:ar,sx:{mb:2},children:e.jsx(je,{fullWidth:!0,size:"small",placeholder:"Search by song title or artist...",value:Z,onChange:V=>G(V.target.value),InputProps:{startAdornment:e.jsx(tr,{position:"start",children:e.jsx(Pr,{sx:{color:"text.secondary"}})}),endAdornment:Z&&e.jsx(tr,{position:"end",children:e.jsx(q,{type:"submit",size:"small",disabled:I,children:"Search"})})}})}),H.length>0&&e.jsxs(h,{sx:{maxHeight:300,overflow:"auto",position:"relative"},children:[e.jsxs(x,{variant:"subtitle2",sx:{mb:1,color:"text.secondary"},children:["Found ",H.length," suggestions:"]}),e.jsx(Ge,{dense:!0,sx:{bgcolor:"background.paper",borderRadius:1},children:H.map(V=>e.jsx(Oe,{sx:{borderBottom:"1px solid",borderColor:"divider","&:last-child":{borderBottom:"none"},display:"flex",alignItems:"center",pr:1},secondaryAction:e.jsx(q,{size:"small",variant:"contained",color:"primary",onClick:()=>ur(V),disabled:M===V.id,startIcon:M===V.id?e.jsx(Ae,{size:16}):e.jsx(oa,{}),sx:{minWidth:70},children:M===V.id?"...":"Use"}),children:e.jsx(Se,{sx:{pr:8},primary:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1,flexWrap:"wrap"},children:[e.jsxs(x,{variant:"body2",sx:{fontWeight:500},noWrap:!0,children:['"',V.track_name,'"']}),e.jsxs(x,{variant:"body2",color:"text.secondary",noWrap:!0,children:["by ",V.artist_name]})]}),secondary:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1,mt:.5,flexWrap:"wrap"},children:[V.has_synced&&e.jsx(de,{label:"Synced",size:"small",color:"success",sx:{height:20}}),V.has_plain&&!V.has_synced&&e.jsx(de,{label:"Plain",size:"small",sx:{height:20}}),V.instrumental&&e.jsx(de,{label:"Instrumental",size:"small",color:"info",sx:{height:20}}),e.jsx(x,{variant:"caption",color:"text.secondary",children:Jt(V.duration)}),V.album_name&&e.jsxs(x,{variant:"caption",color:"text.secondary",noWrap:!0,children:[" ",V.album_name]})]})})},V.id))})]}),I&&e.jsx(h,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(Ae,{size:32})})]})]}):null}class lv{isSupported;constructor(){this.isSupported="mediaSession"in navigator}setMetadata(r){if(!this.isSupported)return;const n=r.artwork||[{src:"/img/icons/icon-96x96.png",sizes:"96x96",type:"image/png"},{src:"/img/icons/icon-128x128.png",sizes:"128x128",type:"image/png"},{src:"/img/icons/icon-192x192.png",sizes:"192x192",type:"image/png"},{src:"/img/icons/icon-384x384.png",sizes:"384x384",type:"image/png"},{src:"/img/icons/icon-512x512.png",sizes:"512x512",type:"image/png"}];navigator.mediaSession.metadata=new MediaMetadata({title:r.title,artist:r.artist,album:r.album||"",artwork:n})}setActionHandlers(r){if(!this.isSupported)return;["play","pause","previoustrack","nexttrack","seekbackward","seekforward","seekto"].forEach(s=>{try{r[s]?navigator.mediaSession.setActionHandler(s,r[s]):navigator.mediaSession.setActionHandler(s,null)}catch{console.warn(`Media Session API doesn't support ${s} action`)}})}setPlaybackState(r){this.isSupported&&(navigator.mediaSession.playbackState=r)}setPositionState(r){if(this.isSupported)try{if("setPositionState"in navigator.mediaSession){const n=r.duration||0;let s=r.position||0;n>0?s=Math.max(0,Math.min(s,n)):s=0,n>0&&isFinite(n)&&isFinite(s)&&navigator.mediaSession.setPositionState({duration:n,playbackRate:r.playbackRate||1,position:s})}}catch(n){console.warn("Failed to set position state:",n)}}clear(){if(!this.isSupported)return;navigator.mediaSession.metadata=null,this.setPlaybackState("none"),["play","pause","previoustrack","nexttrack","seekbackward","seekforward","seekto"].forEach(n=>{try{navigator.mediaSession.setActionHandler(n,null)}catch{}})}isAPISupported(){return this.isSupported}}const Sa=new lv,cv=t=>Sa.setMetadata(t),dv=t=>Sa.setActionHandlers(t),Uc=t=>Sa.setPlaybackState(t),Hc=t=>Sa.setPositionState(t),uv=()=>Sa.clear(),hv=l.lazy(()=>bb(()=>import("./RelatedTracks-4mg7PID2.js"),__vite__mapDeps([0,1,2])));function Vc({audio:t,isPlaying:r,setIsPlaying:n,onClose:s,onMinimize:a,onNext:i,onPrevious:o,hasNext:c=!1,hasPrevious:f=!1,onFavoriteToggle:d,onTrackSelect:u,onTimeUpdate:p,initialSeek:g,isRadioMode:y=!1,queue:m=[],currentQueueIndex:b=0,onQueueReorder:S,onRemoveFromQueue:v,onPlayQueueTrack:j,onClearQueue:w}){const{settings:C,updateSetting:A}=Sr(),{isRadioMode:P,stopRadio:D}=ai(),{timerState:R,getFadeVolume:_,shouldStop:z,onSongEnded:W}=Wu(),{enabled:B,gains:H,connectAudioSource:se}=Bu(),{showAchievements:I}=a1(),k=Ot();Xa(k.breakpoints.down("md"));const[O,E]=l.useState(0),[Z,G]=l.useState(C.volume),[M,T]=l.useState(C.repeat_mode),[ae,L]=l.useState(C.shuffle_enabled),[N,X]=l.useState(!1),[ue,$]=l.useState(!1),[ie,le]=l.useState(!1),[He,Be]=l.useState(!1),[oe,pe]=l.useState(!1),[me,he]=l.useState(null),[Fe,Dt]=l.useState(!1),[ur,mt]=l.useState(!1),[ar,Jt]=l.useState(!1),[hr,Ft]=l.useState(null),[Br,Ht]=l.useState(!1),[gt,V]=l.useState(t),[xe,ye]=l.useState(0),[we,Me]=l.useState(""),[Te,Ct]=l.useState(!0),[Vt,fr]=l.useState(!1),[cn,Lt]=l.useState(!1),[dn,Ca]=l.useState(Array(16).fill(0)),[qr,nt]=l.useState(t.is_favorite||!1),[yt,ht]=l.useState(!1),ce=l.useRef(null),bt=l.useRef(null),Ze=l.useRef(null),st=l.useRef(null),ir=l.useRef(null),Ve=l.useRef([]),vt=l.useRef(null),kt=l.useRef(null),ot=l.useRef(r),Je=l.useRef(!1),xr=l.useRef(t.id),Wt=l.useRef(null),or=l.useRef(0),pr=l.useRef(0),ka=l.useRef(!1),xi=l.useRef(!1),Hu=[32,64,125,250,500,1e3,2e3,4e3,8e3,16e3];l.useEffect(()=>{V(t)},[t]),l.useEffect(()=>{if(g&&g>0&&!xi.current&&ce.current&&we){const Y=()=>{ce.current&&ce.current.readyState>=2&&(console.log(`[Player] Resuming playback at ${g}s`),ce.current.currentTime=g,E(g),xi.current=!0)};if(ce.current.readyState>=2)Y();else{const fe=()=>{Y(),ce.current?.removeEventListener("canplay",fe)};return ce.current.addEventListener("canplay",fe),()=>{ce.current?.removeEventListener("canplay",fe)}}}},[g,we]),l.useEffect(()=>{xi.current=!1},[t.id]),i1(bt,{onSwipeLeft:()=>c&&i?.(),onSwipeRight:()=>f&&o?.(),onSwipeDown:a||s,threshold:80}),l.useEffect(()=>{const Y=fe=>{if(!(fe.target instanceof HTMLInputElement||fe.target instanceof HTMLTextAreaElement)&&ce.current&&we&&!Te){const ke=C.seek_duration||3;fe.key==="ArrowLeft"?(fe.preventDefault(),Je.current=!0,ce.current.currentTime=Math.max(0,ce.current.currentTime-ke),E(ce.current.currentTime),setTimeout(()=>{Je.current=!1},100)):fe.key==="ArrowRight"?(fe.preventDefault(),Je.current=!0,ce.current.currentTime=Math.min(t.duration,ce.current.currentTime+ke),E(ce.current.currentTime),setTimeout(()=>{Je.current=!1},100)):fe.key===" "&&(fe.preventDefault(),n(!r))}};return window.addEventListener("keydown",Y),()=>window.removeEventListener("keydown",Y)},[t.duration,we,Te,r,n,C.seek_duration]),l.useEffect(()=>{console.log("[Player] Settings sync triggered - volume:",C.volume,"repeat:",C.repeat_mode,"shuffle:",C.shuffle_enabled),G(C.volume),T(C.repeat_mode),L(C.shuffle_enabled)},[C.volume,C.repeat_mode,C.shuffle_enabled]),xr.current!==t.id&&(xr.current=t.id,Me(""),Ct(!0),Lt(!1),nt(t.is_favorite||!1),ht(!1),or.current=0,pr.current=0,ka.current=!1);const pi=l.useCallback(async Y=>{if(!t.youtube_id||ka.current)return;const fe=pr.current;if(!(fe<10)){ka.current=!0;try{const ke=await dr.recordListening({youtube_id:t.youtube_id,duration_listened:Math.floor(fe),completed:Y});ke.data?.new_achievements&&ke.data.new_achievements.length>0&&I(ke.data.new_achievements)}catch(ke){console.error("Failed to record listening history:",ke)}}},[t.youtube_id,I]);l.useEffect(()=>{let Y=null;return r&&!Te&&(or.current===0&&(or.current=Date.now()),Y=setInterval(()=>{pr.current+=1},1e3)),()=>{Y&&clearInterval(Y)}},[r,Te]),l.useEffect(()=>()=>{pr.current>=10&&t.youtube_id&&!ka.current&&pi(!1)},[t.id,t.youtube_id,pi]),l.useEffect(()=>{(async()=>{if(t.media_url){Me(t.media_url),Ct(!1),Lt(!1);return}if(t.youtube_id)try{Ct(!0);const fe=await ft.getAnyCachedUrl(t.youtube_id);if(fe){console.log(`[Player]  Playing from ${fe.source} cache (saves data/battery):`,t.title),Me(fe.url),Ct(!1),Lt(!0);return}if(!navigator.onLine){console.warn("[Player]  Offline and no cached audio available:",t.title),Ct(!1),Lt(!1);return}console.log("[Player]  Streaming from server (not cached):",t.title);const Le=await(await fetch(`/api/audio/${t.youtube_id}/player/`,{headers:{Authorization:`Token ${localStorage.getItem("token")}`}})).json();Me(Le.stream_url),Ct(!1),Lt(!1),Le.stream_url&&C.prefetch_enabled!==!1&&ft.prefetchTrack(t,"low").catch(console.error)}catch(fe){console.error("Failed to fetch stream URL:",fe);const ke=await ft.getAnyCachedUrl(t.youtube_id);ke&&(console.log(`[Player]  Fallback to ${ke.source} cache after fetch error:`,t.title),Me(ke.url),Lt(!0)),Ct(!1)}})()},[t.id]),l.useEffect(()=>{const Y=t.cover_art_url||t.thumbnail_url,fe=`/api/audio/${t.youtube_id}/artwork/`,ke=Le=>{cv({title:t.title,artist:t.artist||t.channel_name||"Unknown Artist",album:t.album,artwork:Le})};return ke(Y?[{src:fe,sizes:"96x96",type:"image/jpeg"},{src:fe,sizes:"128x128",type:"image/jpeg"},{src:fe,sizes:"256x256",type:"image/jpeg"},{src:fe,sizes:"512x512",type:"image/jpeg"}]:void 0),dv({play:()=>{ot.current||n(!0)},pause:()=>{ot.current&&n(!1)},previoustrack:()=>{f&&o&&o()},nexttrack:()=>{c&&i&&i()},seekbackward:Le=>{if(ce.current){Je.current=!0;const mr=Le?.seekOffset||C.seek_duration||3;ce.current.currentTime=Math.max(0,ce.current.currentTime-mr),E(ce.current.currentTime),setTimeout(()=>{Je.current=!1},100)}},seekforward:Le=>{if(ce.current){Je.current=!0;const mr=Le?.seekOffset||C.seek_duration||3;ce.current.currentTime=Math.min(t.duration,ce.current.currentTime+mr),E(ce.current.currentTime),setTimeout(()=>{Je.current=!1},100)}},seekto:Le=>{ce.current&&Le.seekTime!==void 0&&(Je.current=!0,ce.current.currentTime=Le.seekTime,setTimeout(()=>{Je.current=!1},100))}}),()=>{uv()}},[t,c,f,i,o,n,C.seek_duration]),l.useEffect(()=>{if(ce.current){const Y=_();ce.current.volume=Z/100*Y}},[Z,_]),l.useEffect(()=>{if(!R.isFading||!ce.current)return;const Y=setInterval(()=>{if(ce.current){const fe=_();ce.current.volume=Z/100*fe}},100);return()=>clearInterval(Y)},[R.isFading,Z,_]),l.useEffect(()=>{z()&&(console.log("[Player] Sleep timer triggered stop"),n(!1))},[z,n]),l.useEffect(()=>{if(!ce.current||!we)return;if(!Ze.current)try{Ze.current=new(window.AudioContext||window.webkitAudioContext),ir.current=Ze.current.createMediaElementSource(ce.current),Ve.current=Hu.map(ke=>{const Le=Ze.current.createBiquadFilter();return Le.type="peaking",Le.frequency.value=ke,Le.Q.value=1.4,Le.gain.value=0,Le}),st.current=Ze.current.createAnalyser(),st.current.fftSize=64,st.current.smoothingTimeConstant=.8;let fe=ir.current;Ve.current.forEach(ke=>{fe.connect(ke),fe=ke}),fe.connect(st.current),st.current.connect(Ze.current.destination),vt.current=new Uint8Array(st.current.frequencyBinCount),console.log("[Player] Audio chain initialized with EQ")}catch(fe){console.error("Web Audio API not supported:",fe)}const Y=()=>{if(st.current&&vt.current&&ot.current){st.current.getByteFrequencyData(vt.current);const fe=[],ke=Math.floor(vt.current.length/16);for(let Le=0;Le<16;Le++){const mr=Math.min(Le*ke,vt.current.length-1),rh=vt.current[mr]/255,nh=Le<8?1.3:1;fe.push(Math.min(rh*nh,1))}Ca(fe)}else ot.current||Ca(fe=>fe.map(ke=>ke*.9));kt.current=requestAnimationFrame(Y)};return Y(),()=>{kt.current&&cancelAnimationFrame(kt.current)}},[we]),l.useEffect(()=>{Ve.current.length>0&&Ve.current.forEach((Y,fe)=>{H[fe]!==void 0&&(Y.gain.value=B?H[fe]:0)})},[H,B]);const Vu=l.useCallback((Y,fe)=>{const ke=fe;G(ke),X(ke===0),Wt.current&&clearTimeout(Wt.current),Wt.current=setTimeout(()=>{A("volume",ke)},300)},[A]),Yu=l.useCallback(()=>{const Y=["none","one","all"],fe=Y.indexOf(M),ke=Y[(fe+1)%Y.length];T(ke),A("repeat_mode",ke)},[M,A]),Gu=l.useCallback(()=>{const Y=!ae;L(Y),A("shuffle_enabled",Y)},[ae,A]);l.useEffect(()=>{ce.current&&we&&(ce.current.pause(),E(0),ce.current.load(),ot.current=!1)},[we]),l.useEffect(()=>{if(!(Je.current||Te)&&ce.current&&we&&r!==ot.current)if(ot.current=r,r){if(ce.current.paused){const Y=ce.current.play();Y!==void 0&&Y.then(()=>{Uc("playing")}).catch(fe=>{console.error("Playback failed:",fe),n(!1),ot.current=!1})}}else ce.current.paused||(ce.current.pause(),Uc("paused"))},[r,n,Te,we]);const Qu=l.useCallback(()=>{if(ce.current&&!Je.current){const Y=ce.current.currentTime;E(Y),p?.(Y),Hc({duration:t.duration,playbackRate:ce.current.playbackRate,position:Y})}},[t.duration]),Ku=l.useCallback((Y,fe)=>{Je.current=!0,E(fe)},[]),Ju=l.useCallback((Y,fe)=>{const ke=fe;if(ce.current&&!Te){Je.current=!0;const Le=!ce.current.paused;if(ce.current.pause(),ce.current.readyState>=2)ce.current.currentTime=ke,Le&&ce.current.play(),Hc({duration:t.duration,playbackRate:ce.current.playbackRate,position:ke});else{const mr=()=>{ce.current&&(ce.current.currentTime=ke,Le&&ce.current.play(),ce.current.removeEventListener("canplay",mr))};ce.current.addEventListener("canplay",mr)}}},[t.duration,Te]),Xu=l.useCallback(()=>{Je.current=!1},[]),po=l.useCallback(Y=>{const fe=Math.floor(Y/60),ke=Math.floor(Y%60);return`${fe}:${ke.toString().padStart(2,"0")}`},[]),Zu=l.useCallback(()=>{X(!N),ce.current&&(ce.current.muted=!N)},[N]),eh=l.useCallback(async()=>{if(!t.youtube_id){console.warn("Cannot toggle favorite for files without youtube_id");return}try{await wt.toggleFavorite(t.youtube_id);const Y=!qr;nt(Y),d&&d(t.id,Y)}catch(Y){console.error("Failed to toggle favorite:",Y)}},[t.id,t.youtube_id,qr,d]),mo=l.useCallback(()=>{const fe=(Rr.findIndex(ke=>ke.id===C.visualizer_theme)+1)%Rr.length;A("visualizer_theme",Rr[fe].id)},[C.visualizer_theme,A]),th=l.useMemo(()=>C.visualizer_enabled?e.jsx(h,{onClick:mo,sx:{cursor:"pointer","&:hover":{opacity:.9},transition:"opacity 0.2s ease"},title:`Click to change visualizer theme (Current: ${Rr.find(Y=>Y.id===C.visualizer_theme)?.name||"Classic Bars"})`,children:e.jsx(o1,{data:dn,isPlaying:r,themeId:C.visualizer_theme,height:120,showGlow:C.visualizer_glow})}):null,[dn,r,C.visualizer_theme,C.visualizer_enabled,C.visualizer_glow,mo]);return e.jsxs(h,{ref:bt,sx:{height:"100%",display:"flex",flexDirection:"column",position:"relative",overflow:"hidden",touchAction:"pan-y"},children:[e.jsxs(h,{sx:{position:"absolute",inset:0,zIndex:0},children:[e.jsx(h,{sx:{position:"absolute",inset:0,background:Y=>Y.palette.mode==="dark"?`linear-gradient(to bottom, ${Y.palette.background.paper} 0%, ${Y.palette.background.paper}e6 50%, ${Y.palette.background.default} 100%)`:`linear-gradient(to bottom, ${Y.palette.background.paper}f0 0%, ${Y.palette.background.paper}f5 50%, ${Y.palette.background.default}ff 100%)`,zIndex:10}}),e.jsx(h,{sx:{position:"absolute",inset:0,background:Y=>{const fe=r?Math.max(...dn)*.15:0,Le=Y.palette.mode==="dark"?fe:fe*.4;return`radial-gradient(ellipse at center, ${Y.palette.primary.main}${Math.round(Le*255).toString(16).padStart(2,"0")} 0%, transparent 70%)`},zIndex:11,transition:"background 0.15s ease",pointerEvents:"none"}}),e.jsx(h,{sx:{width:"100%",height:"100%",backgroundImage:t.cover_art_url||t.thumbnail_url?`url(${t.cover_art_url||t.thumbnail_url})`:"none",backgroundSize:"cover",backgroundPosition:"center",filter:"blur(60px)",opacity:.3,transform:"scale(1.5)"}})]}),e.jsxs(h,{sx:{position:"relative",zIndex:20,display:"flex",flexDirection:"column",height:"100%",p:3,justifyContent:"space-between"},children:[we?e.jsx("audio",{ref:ce,src:we,onTimeUpdate:Qu,onSeeked:Xu,onWaiting:()=>fr(!0),onCanPlay:()=>fr(!1),onPlaying:()=>fr(!1),onEnded:()=>{if(pi(!0),W()){console.log("[Player] Sleep timer triggered stop - not playing next track"),n(!1);return}M==="one"?ce.current&&(ce.current.currentTime=0,ce.current.play().catch(console.error)):c&&i||M==="all"&&i?i():n(!1)},onError:Y=>{console.error("Audio playback error:",Y),console.error("Stream URL:",we),console.error("Audio element:",ce.current)}}):e.jsx("audio",{ref:ce}),th,e.jsxs(h,{sx:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",py:4},children:[(t.cover_art_url||t.thumbnail_url)&&!yt?e.jsxs(h,{onClick:()=>t.youtube_id&&$(!ue),sx:{width:200,height:200,borderRadius:3,bgcolor:"background.paper",backgroundSize:"cover",backgroundPosition:"center",mb:3,boxShadow:r?"0 8px 32px rgba(19, 236, 106, 0.4), 0 0 60px rgba(19, 236, 106, 0.2)":Y=>Y.palette.mode==="dark"?"0 8px 32px rgba(0, 0, 0, 0.4)":"0 8px 24px rgba(0, 0, 0, 0.1)",cursor:t.youtube_id?"pointer":"default",transition:"all 0.3s ease",position:"relative",overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",animation:r?"album-pulse 2s ease-in-out infinite":"none","&:hover":t.youtube_id?{transform:"scale(1.05) rotate(2deg)",boxShadow:Y=>Y.palette.mode==="dark"?"0 12px 40px rgba(19, 236, 106, 0.5)":`0 12px 40px ${Y.palette.primary.main}40`}:{},"&::after":Vt?{content:'""',position:"absolute",inset:0,background:"rgba(0, 0, 0, 0.5)",borderRadius:3,display:"flex",alignItems:"center",justifyContent:"center"}:{},"@keyframes album-pulse":{"0%, 100%":{boxShadow:"0 8px 32px rgba(19, 236, 106, 0.4), 0 0 60px rgba(19, 236, 106, 0.2)"},"50%":{boxShadow:"0 8px 32px rgba(19, 236, 106, 0.6), 0 0 80px rgba(19, 236, 106, 0.4)"}}},title:t.youtube_id?"Click to toggle lyrics":"Lyrics not available for local files",children:[e.jsx("img",{src:t.cover_art_url||t.thumbnail_url,alt:"",style:{width:"100%",height:"100%",objectFit:"cover",position:"absolute",inset:0},onError:()=>ht(!0)}),Vt&&e.jsx(h,{sx:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",zIndex:1},children:e.jsx(Ae,{size:48,sx:{color:"primary.main"}})})]}):e.jsx(h,{onClick:()=>t.youtube_id&&$(!ue),sx:{width:200,height:200,borderRadius:3,mb:3,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"rgba(19, 236, 106, 0.1)",border:"2px solid",borderColor:"primary.main",cursor:t.youtube_id?"pointer":"default",boxShadow:r?"0 8px 32px rgba(19, 236, 106, 0.4), 0 0 60px rgba(19, 236, 106, 0.2)":"0 8px 32px rgba(0, 0, 0, 0.4)",animation:r?"album-pulse 2s ease-in-out infinite":"none",transition:"all 0.3s ease","&:hover":t.youtube_id?{transform:"scale(1.05)",bgcolor:"rgba(19, 236, 106, 0.2)"}:{},"@keyframes album-pulse":{"0%, 100%":{boxShadow:"0 8px 32px rgba(19, 236, 106, 0.4), 0 0 60px rgba(19, 236, 106, 0.2)"},"50%":{boxShadow:"0 8px 32px rgba(19, 236, 106, 0.6), 0 0 80px rgba(19, 236, 106, 0.4)"}}},title:t.youtube_id?"Click to toggle lyrics":"Lyrics not available for local files",children:e.jsx(Tt,{sx:{fontSize:80,color:"primary.main",opacity:.7}})}),e.jsx(x,{variant:"h5",sx:{fontWeight:700,mb:.5,textAlign:"center",px:2,color:"text.primary"},children:t.title}),e.jsxs(h,{sx:{display:"flex",alignItems:"center",justifyContent:"center",gap:1,flexWrap:"wrap"},children:[e.jsx(x,{variant:"body1",sx:{fontWeight:500,color:"primary.main"},children:gt.artist||t.channel_name}),gt.album&&e.jsxs(x,{variant:"body2",color:"text.secondary",children:[" ",gt.album," ",gt.year&&`(${gt.year})`]}),cn&&e.jsx(be,{title:"Playing from cache",children:e.jsx(Du,{sx:{fontSize:16,color:"success.main"}})})]}),e.jsxs(h,{sx:{display:"flex",gap:1,mt:1},children:[e.jsx(be,{title:"Track options",children:e.jsx(J,{onClick:Y=>Ft(Y.currentTarget),sx:{color:"text.secondary",transition:"all 0.2s ease","&:hover":{transform:"scale(1.1)",color:"primary.main"}},children:e.jsx(Hd,{})})}),e.jsxs(la,{anchorEl:hr,open:!!hr,onClose:()=>Ft(null),children:[e.jsxs(ve,{onClick:()=>{Ht(!0),Ft(null)},children:[e.jsx(Ye,{children:e.jsx(Yd,{fontSize:"small"})}),e.jsx(Se,{children:"Add to Playlist"})]}),e.jsxs(ve,{onClick:()=>{eh(),Ft(null)},children:[e.jsx(Ye,{children:qr?e.jsx(xa,{fontSize:"small",sx:{color:"error.main"}}):e.jsx(Vd,{fontSize:"small"})}),e.jsx(Se,{children:qr?"Remove from Favorites":"Add to Favorites"})]}),t.youtube_id&&e.jsxs(e.Fragment,{children:[e.jsx(De,{}),e.jsxs(ve,{onClick:()=>{pe(!0),Ft(null)},children:[e.jsx(Ye,{children:e.jsx(Tr,{fontSize:"small"})}),e.jsx(Se,{children:"Export Track"})]}),e.jsxs(ve,{onClick:()=>{Be(!0),Ft(null)},children:[e.jsx(Ye,{children:e.jsx($b,{fontSize:"small"})}),e.jsx(Se,{children:"Edit Metadata"})]})]})]}),t.youtube_id&&u&&e.jsx(be,{title:"Related tracks",children:e.jsx(J,{onClick:()=>le(!ie),sx:{color:ie?"primary.main":"text.secondary",transition:"all 0.2s ease","&:hover":{transform:"scale(1.1)",color:"primary.main"}},children:e.jsx(Ya,{})})}),t.youtube_id&&!P&&e.jsx(be,{title:"Start Radio",children:e.jsx(J,{onClick:Y=>he(Y.currentTarget),sx:{color:"text.secondary",transition:"all 0.2s ease","&:hover":{transform:"scale(1.1)",color:"secondary.main"}},children:e.jsx(tn,{})})}),P&&e.jsx(be,{title:"Click to stop radio",children:e.jsx(de,{icon:e.jsx(tn,{sx:{fontSize:16}}),label:"RADIO",size:"small",color:"secondary",onClick:()=>D(),sx:{cursor:"pointer",animation:"pulse 2s ease-in-out infinite","@keyframes pulse":{"0%, 100%":{opacity:1},"50%":{opacity:.7}},"&:hover":{opacity:.8}}})}),e.jsx(be,{title:R.isActive?"Sleep timer active":"Sleep timer",children:e.jsxs(J,{onClick:()=>Dt(!0),sx:{color:R.isActive?"warning.main":"text.secondary",transition:"all 0.2s ease",position:"relative","&:hover":{transform:"scale(1.1)",color:"warning.main"}},children:[e.jsx(Qi,{}),R.isActive&&e.jsx(h,{sx:{position:"absolute",top:4,right:4,width:8,height:8,borderRadius:"50%",bgcolor:"warning.main",animation:"pulse 2s ease-in-out infinite"}})]})}),e.jsx(be,{title:`Queue (${m.length} tracks)`,children:e.jsxs(J,{onClick:()=>mt(!0),sx:{color:m.length>1?"primary.main":"text.secondary",transition:"all 0.2s ease",position:"relative","&:hover":{transform:"scale(1.1)",color:"primary.main"}},children:[e.jsx(Gd,{}),m.length>1&&e.jsx(h,{sx:{position:"absolute",top:2,right:2,minWidth:16,height:16,borderRadius:"50%",bgcolor:"primary.main",color:"primary.contrastText",fontSize:10,fontWeight:"bold",display:"flex",alignItems:"center",justifyContent:"center"},children:m.length>99?"99+":m.length})]})}),e.jsx(be,{title:B?"Equalizer (on)":"Equalizer",children:e.jsx(J,{onClick:()=>Jt(!0),sx:{color:B?"secondary.main":"text.secondary",transition:"all 0.2s ease","&:hover":{transform:"scale(1.1)",color:"secondary.main"}},children:e.jsx(ho,{})})})]})]}),e.jsxs(h,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(h,{children:[e.jsx(wr,{value:O,max:t.duration,onChange:Ku,onChangeCommitted:Ju,sx:{color:"primary.main",height:6,padding:"13px 0","& .MuiSlider-thumb":{width:12,height:12,backgroundColor:Y=>Y.palette.mode==="dark"?"#fff":Y.palette.primary.main,boxShadow:Y=>Y.palette.mode==="dark"?"0 0 10px rgba(255, 255, 255, 0.5)":`0 0 10px ${Y.palette.primary.main}40`,"&:hover, &.Mui-focusVisible":{boxShadow:"0 0 0 8px rgba(19, 236, 106, 0.16)"}},"& .MuiSlider-track":{border:"none",height:6},"& .MuiSlider-rail":{opacity:Y=>Y.palette.mode==="dark"?.3:.2,backgroundColor:Y=>Y.palette.mode==="dark"?"#fff":Y.palette.text.secondary,height:6}}}),e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",mt:1},children:[e.jsx(x,{variant:"caption",sx:{color:"text.secondary",fontWeight:500,fontSize:"0.75rem"},children:po(O)}),e.jsx(x,{variant:"caption",sx:{color:"text.secondary",fontWeight:500,fontSize:"0.75rem"},children:po(t.duration)})]})]}),e.jsxs(h,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",px:1},children:[e.jsxs(h,{sx:{position:"relative"},children:[e.jsx(J,{size:"small",onClick:Gu,sx:{color:ae?"primary.main":"text.secondary",transition:"all 0.2s ease","&:hover":{color:"primary.main",transform:"scale(1.1)"},"&:active":{transform:"scale(0.95)"}},children:e.jsx(si,{})}),ae&&e.jsx(h,{sx:{position:"absolute",bottom:8,left:"50%",transform:"translateX(-50%)",width:4,height:4,borderRadius:"50%",bgcolor:"primary.main",boxShadow:"0 0 4px rgba(19, 236, 106, 0.8)"}})]}),e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:3},children:[e.jsx(J,{onClick:o,disabled:!f,sx:{color:"text.primary",transition:"all 0.2s ease","&:hover":{color:"primary.main",transform:"scale(1.1)"},"&:active":{transform:"scale(0.95)"},"&:disabled":{color:"text.disabled"}},children:e.jsx(wb,{sx:{fontSize:30}})}),e.jsx(J,{onClick:()=>n(!r),disabled:Te,sx:{width:64,height:64,bgcolor:"primary.main",color:"background.dark",boxShadow:"0 0 20px rgba(19, 236, 106, 0.4)","&:hover":{bgcolor:"primary.main",transform:"scale(1.05)",boxShadow:"0 0 30px rgba(19, 236, 106, 0.6)"},"&:active":{transform:"scale(0.95)"},"&:disabled":{bgcolor:"rgba(19, 236, 106, 0.3)",color:"rgba(0, 0, 0, 0.3)"},transition:"all 0.2s ease"},children:Te?e.jsx(Ae,{size:28,sx:{color:"background.dark"}}):r?e.jsx(yd,{sx:{fontSize:36}}):e.jsx(St,{sx:{fontSize:36}})}),e.jsx(J,{onClick:i,disabled:!c,sx:{color:"text.primary",transition:"all 0.2s ease","&:hover":{color:"primary.main",transform:"scale(1.1)"},"&:active":{transform:"scale(0.95)"},"&:disabled":{color:"text.disabled"}},children:e.jsx(kb,{sx:{fontSize:30}})})]}),e.jsxs(h,{sx:{position:"relative"},children:[e.jsx(J,{size:"small",onClick:Yu,sx:{color:M!=="none"?"primary.main":"text.secondary",transition:"all 0.2s ease","&:hover":{color:"primary.main",transform:"scale(1.1)"},"&:active":{transform:"scale(0.95)"}},children:M==="one"?e.jsx(Db,{}):e.jsx(Ib,{})}),M!=="none"&&e.jsx(h,{sx:{position:"absolute",bottom:8,left:"50%",transform:"translateX(-50%)",width:4,height:4,borderRadius:"50%",bgcolor:"primary.main",boxShadow:"0 0 4px rgba(19, 236, 106, 0.8)"}})]})]}),e.jsxs(h,{sx:{display:"flex",alignItems:"center",justifyContent:"center",gap:1.5,mt:1},children:[e.jsx(J,{onClick:Zu,size:"small",sx:{color:N?"text.disabled":"primary.main",transition:"color 0.2s ease","&:hover":{color:"primary.main"}},children:N||Z===0?e.jsx(Fb,{sx:{fontSize:20}}):e.jsx(Tb,{sx:{fontSize:20}})}),e.jsx(h,{sx:{width:120},children:e.jsx(wr,{value:N?0:Z,onChange:Vu,min:0,max:100,size:"small",sx:{color:"primary.main","& .MuiSlider-thumb":{width:10,height:10,transition:"all 0.2s ease","&:hover":{boxShadow:"0 0 0 8px rgba(19, 236, 106, 0.16)"}},"& .MuiSlider-track":{border:"none",height:3},"& .MuiSlider-rail":{opacity:.3,height:3}}})}),e.jsxs(x,{variant:"caption",sx:{color:"text.secondary",minWidth:32,textAlign:"right",fontWeight:500},children:[Math.round(N?0:Z),"%"]})]})]})]}),ie&&t.youtube_id&&u&&e.jsx(l.Suspense,{fallback:e.jsx(h,{sx:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"rgba(0, 0, 0, 0.95)",zIndex:20},children:e.jsx(Ae,{size:60,sx:{color:"primary.main"}})}),children:e.jsx(Ks,{in:ie,children:e.jsxs(h,{sx:{position:"absolute",inset:0,bgcolor:Y=>Y.palette.mode==="dark"?"rgba(0, 0, 0, 0.95)":"rgba(255, 255, 255, 0.98)",backdropFilter:"blur(10px)",zIndex:20,overflow:"auto",display:"flex",flexDirection:"column"},children:[e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",p:2,borderBottom:1,borderColor:"divider"},children:[e.jsxs(x,{variant:"h6",sx:{fontWeight:600,display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ya,{sx:{color:"primary.main"}}),"Related Tracks"]}),e.jsx(J,{onClick:()=>le(!1),size:"small",children:e.jsx(Gt,{})})]}),e.jsx(h,{sx:{flex:1,overflow:"auto",p:1},children:e.jsx(hv,{currentAudio:t,onTrackSelect:Y=>{le(!1),u(Y)},onFavoriteToggle:d?Y=>d(Y.id,!Y.is_favorite):void 0,compact:!0})})]})})}),ue&&t.youtube_id&&e.jsx(Ks,{in:ue,children:e.jsx(h,{sx:{position:"absolute",inset:0,bgcolor:"rgba(0, 0, 0, 0.95)",backdropFilter:"blur(10px)",zIndex:20,overflow:"auto"},children:e.jsx(ov,{youtubeId:t.youtube_id,currentTime:O,onClose:()=>$(!1),embedded:!0,visualizerTheme:C.visualizer_theme,isLightMode:k.palette.mode==="light",onSeek:Y=>{ce.current&&(ce.current.currentTime=Y,E(Y))}})})}),t.youtube_id&&e.jsx(y1,{audio:gt,open:He,onClose:()=>Be(!1),onUpdate:Y=>V(Y)}),t.youtube_id&&e.jsx(I1,{youtubeId:t.youtube_id,title:t.title,open:oe,onClose:()=>pe(!1)}),e.jsx(Kd,{anchorEl:me,open:!!me,onClose:()=>he(null),track:t}),e.jsx(F1,{open:Fe,onClose:()=>Dt(!1)}),e.jsx(W1,{open:ur,onClose:()=>mt(!1),queue:m,currentIndex:b,onPlayTrack:Y=>{j?.(Y),mt(!1)},onRemoveTrack:Y=>v?.(Y),onReorderTrack:(Y,fe)=>S?.(Y,fe),onClearQueue:()=>{w?.(),mt(!1)}}),e.jsx(Q1,{open:ar,onClose:()=>Jt(!1)}),e.jsx(Jd,{open:Br,onClose:()=>Ht(!1),track:t})]})}const fv=()=>{const{isOnline:t,canInstall:r,isUpdateAvailable:n,showInstallPrompt:s,updateApp:a}=ba(),[i,o]=Ee.useState(!1),[c,f]=Ee.useState(!1),[d,u]=Ee.useState(!1),[p,g]=Ee.useState(!1),[y,m]=Ee.useState(!1);Ee.useEffect(()=>{if(t)y&&(o(!1),f(!0),m(!1));else{o(!0),m(!0);const v=setTimeout(()=>{o(!1)},5e3);return()=>clearTimeout(v)}},[t,y]),Ee.useEffect(()=>{if(r){const v=setTimeout(()=>{u(!0)},3e3);return()=>clearTimeout(v)}},[r]),Ee.useEffect(()=>{n&&g(!0)},[n]);const b=async()=>{await s()&&u(!1)},S=async()=>{await a(),g(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(ct,{open:i,autoHideDuration:5e3,onClose:()=>o(!1),anchorOrigin:{vertical:"bottom",horizontal:"center"},sx:{bottom:{xs:80,sm:24}},children:e.jsxs(ge,{severity:"warning",icon:e.jsx(jr,{}),onClose:()=>o(!1),sx:{width:"100%"},children:[e.jsx(x,{variant:"body2",fontWeight:600,children:"You're offline"}),e.jsx(x,{variant:"caption",children:"Cached content is still available"})]})}),e.jsx(ct,{open:c,autoHideDuration:4e3,onClose:()=>f(!1),anchorOrigin:{vertical:"bottom",horizontal:"center"},sx:{bottom:{xs:80,sm:24}},children:e.jsx(ge,{severity:"success",icon:e.jsx(Xs,{}),onClose:()=>f(!1),sx:{width:"100%"},children:"You're back online!"})}),e.jsx(ct,{open:d,anchorOrigin:{vertical:"bottom",horizontal:"center"},sx:{bottom:{xs:80,sm:24}},children:e.jsx(ge,{severity:"info",icon:e.jsx(Oi,{}),action:e.jsxs(h,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e.jsx(q,{color:"inherit",size:"small",variant:"outlined",onClick:b,sx:{fontWeight:600},children:"Install"}),e.jsx(J,{size:"small",color:"inherit",onClick:()=>u(!1),children:e.jsx(ea,{fontSize:"small"})})]}),sx:{width:"100%",alignItems:"center"},children:e.jsxs(h,{children:[e.jsx(x,{variant:"body2",fontWeight:600,gutterBottom:!0,children:"Install SoundWave"}),e.jsx(x,{variant:"caption",children:"Install the app for faster access and offline playback"})]})})}),e.jsx(ct,{open:p,anchorOrigin:{vertical:"bottom",horizontal:"center"},sx:{bottom:{xs:80,sm:24}},children:e.jsx(ge,{severity:"info",icon:e.jsx(cd,{}),action:e.jsxs(h,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e.jsx(q,{color:"inherit",size:"small",variant:"outlined",onClick:S,sx:{fontWeight:600},children:"Update"}),e.jsx(J,{size:"small",color:"inherit",onClick:()=>g(!1),children:e.jsx(ea,{fontSize:"small"})})]}),sx:{width:"100%",alignItems:"center"},children:e.jsxs(h,{children:[e.jsx(x,{variant:"body2",fontWeight:600,gutterBottom:!0,children:"Update Available"}),e.jsx(x,{variant:"caption",children:"A new version of SoundWave is ready to install"})]})})}),!t&&e.jsxs(h,{sx:{position:"fixed",top:0,left:0,right:0,bgcolor:"warning.main",color:"warning.contrastText",py:.5,px:2,display:"flex",alignItems:"center",justifyContent:"center",gap:1,zIndex:9999},children:[e.jsx(jr,{fontSize:"small"}),e.jsx(x,{variant:"caption",fontWeight:600,children:"Offline Mode"})]})]})};var $s={},Yc;function xv(){if(Yc)return $s;Yc=1;var t=te();Object.defineProperty($s,"__esModule",{value:!0}),$s.default=void 0;var r=t(ne()),n=re();return $s.default=(0,r.default)((0,n.jsx)("path",{d:"M4 6h18V4H4c-1.1 0-2 .9-2 2v11H0v3h14v-3H4zm19 2h-6c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h6c.55 0 1-.45 1-1V9c0-.55-.45-1-1-1m-1 9h-4v-7h4z"}),"Devices"),$s}var pv=xv();const mv=ee(pv);var Bs={},Gc;function gv(){if(Gc)return Bs;Gc=1;var t=te();Object.defineProperty(Bs,"__esModule",{value:!0}),Bs.default=void 0;var r=t(ne()),n=re();return Bs.default=(0,r.default)([(0,n.jsx)("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"},"0"),(0,n.jsx)("path",{d:"M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"},"1")],"AccessTime"),Bs}var yv=gv();const bv=ee(yv),Pi=t=>{const r=Math.floor(t/60),n=Math.floor(t%60);return`${r}:${n.toString().padStart(2,"0")}`},vv=t=>t<60?"just now":t<3600?`${Math.floor(t/60)} minutes ago`:t<86400?`${Math.floor(t/3600)} hours ago`:`${Math.floor(t/86400)} days ago`;function jv({open:t,session:r,onResume:n,onDismiss:s}){if(!r?.audio_details)return null;const{audio_details:a,position:i,device_name:o,seconds_since_update:c}=r,f=i/a.duration*100,d=Math.max(0,i-5);return e.jsxs(Qe,{open:t,onClose:s,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:3,bgcolor:"background.paper",backgroundImage:"none"}},children:[e.jsxs(Xe,{sx:{pb:1,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(mv,{color:"primary"}),e.jsx(x,{variant:"h6",component:"span",children:"Continue Listening?"})]}),e.jsx(J,{size:"small",onClick:s,sx:{color:"text.secondary"},children:e.jsx(Gt,{})})]}),e.jsxs(Ke,{sx:{pt:2},children:[e.jsxs(h,{sx:{display:"flex",gap:2,p:2,borderRadius:2,bgcolor:"action.hover",mb:2},children:[e.jsx(Ue,{variant:"rounded",src:a.cover_art_url||a.thumbnail_url,sx:{width:80,height:80},children:e.jsx(Tt,{})}),e.jsxs(h,{sx:{flex:1,minWidth:0},children:[e.jsx(x,{variant:"subtitle1",fontWeight:600,noWrap:!0,children:a.title}),e.jsx(x,{variant:"body2",color:"text.secondary",noWrap:!0,children:a.artist||a.channel_name}),e.jsxs(h,{sx:{mt:1.5},children:[e.jsx(rt,{variant:"determinate",value:f,sx:{height:4,borderRadius:2,bgcolor:"rgba(255,255,255,0.1)","& .MuiLinearProgress-bar":{borderRadius:2}}}),e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",mt:.5},children:[e.jsx(x,{variant:"caption",color:"text.secondary",children:Pi(d)}),e.jsx(x,{variant:"caption",color:"text.secondary",children:Pi(a.duration)})]})]})]})]}),e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1,color:"text.secondary"},children:[e.jsx(bv,{fontSize:"small"}),e.jsxs(x,{variant:"body2",children:["Last played ",vv(c),o&&` on ${o}`]})]})]}),e.jsxs(tt,{sx:{p:2,pt:1},children:[e.jsx(q,{onClick:s,color:"inherit",sx:{color:"text.secondary"},children:"Not Now"}),e.jsxs(q,{onClick:n,variant:"contained",startIcon:e.jsx(St,{}),sx:{px:3},children:["Resume at ",Pi(d)]})]})]})}const Qc={track:"Track Radio",artist:"Artist Radio",favorites:"Favorites Mix",discovery:"Discovery Mode",recent:"New Additions"},wv={track:"",artist:"",favorites:"",discovery:"",recent:""};function Sv({compact:t=!1}){const{isRadioMode:r,radioSession:n,stopRadio:s,currentReason:a,isLoading:i}=ai(),[o,c]=l.useState(null),[f,d]=l.useState(n?.variety_level??50);if(!r||!n)return null;const u=m=>{d(n.variety_level),c(m.currentTarget)},p=()=>{c(null)},g=async(m,b)=>{const S=b;d(S);try{await lr.updateSettings({variety_level:S})}catch(v){console.error("Failed to update variety level:",v)}},y=async()=>{try{await lr.updateSettings({reset_learning:!0}),p()}catch(m){console.error("Failed to reset learning:",m)}};return t?e.jsx(be,{title:`${Qc[n.mode]}: ${n.seed_title}`,children:e.jsx(de,{icon:e.jsx(tn,{sx:{fontSize:16}}),label:"RADIO",size:"small",color:"primary",onDelete:s,deleteIcon:e.jsx(Gt,{sx:{fontSize:14}}),sx:{animation:"pulse 2s ease-in-out infinite","@keyframes pulse":{"0%, 100%":{opacity:1},"50%":{opacity:.7}}}})}):e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1.5,px:2,py:1,borderRadius:2,bgcolor:"primary.main",color:"primary.contrastText",background:"linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)"},children:[e.jsx(tn,{sx:{fontSize:20,animation:"pulse 2s ease-in-out infinite","@keyframes pulse":{"0%, 100%":{transform:"scale(1)"},"50%":{transform:"scale(1.1)"}}}}),e.jsxs(h,{sx:{flex:1,minWidth:0},children:[e.jsx(h,{sx:{display:"flex",alignItems:"center",gap:.5},children:e.jsxs(x,{variant:"caption",sx:{fontWeight:600,textTransform:"uppercase",letterSpacing:1},children:[wv[n.mode]," ",Qc[n.mode]]})}),e.jsx(x,{variant:"body2",noWrap:!0,sx:{opacity:.9},children:n.seed_title}),a&&e.jsxs(x,{variant:"caption",sx:{opacity:.7,display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Ya,{sx:{fontSize:12}}),a]}),e.jsxs(x,{variant:"caption",sx:{opacity:.7},children:[n.tracks_played," played  ",n.tracks_skipped," skipped"]})]}),e.jsx(be,{title:"Radio Settings",children:e.jsx(J,{size:"small",onClick:u,sx:{color:"inherit"},children:e.jsx(Nu,{fontSize:"small"})})}),e.jsx(be,{title:"Stop Radio",children:e.jsx(J,{size:"small",onClick:s,sx:{color:"inherit"},children:e.jsx(Gt,{fontSize:"small"})})}),i&&e.jsx(rt,{sx:{position:"absolute",bottom:0,left:0,right:0,height:2,borderBottomLeftRadius:8,borderBottomRightRadius:8}}),e.jsxs(la,{anchorEl:o,open:!!o,onClose:p,PaperProps:{sx:{width:280,p:1}},children:[e.jsxs(h,{sx:{px:2,py:1},children:[e.jsx(x,{variant:"subtitle2",gutterBottom:!0,children:"Variety Level"}),e.jsx(x,{variant:"caption",color:"text.secondary",gutterBottom:!0,sx:{display:"block",mb:1},children:"Lower = stick to similar tracks, Higher = more variety"}),e.jsx(wr,{value:f,onChange:g,min:0,max:100,valueLabelDisplay:"auto",marks:[{value:0,label:"Similar"},{value:50,label:"Balanced"},{value:100,label:"Varied"}]})]}),e.jsx(De,{sx:{my:1}}),e.jsx(ve,{onClick:y,children:"Reset Learning Data"})]})]})}const Cv=10,Di="soundwave_play_history",kv=(t={})=>{const{historySize:r=Cv,enabled:n=!0}=t,[s,a]=l.useState([]),i=l.useRef([]);l.useEffect(()=>{try{const u=localStorage.getItem(Di);if(u){const p=JSON.parse(u);Array.isArray(p)&&(a(p.slice(-r)),i.current=p.slice(-r))}}catch(u){console.error("Failed to load play history:",u)}},[r]),l.useEffect(()=>{try{localStorage.setItem(Di,JSON.stringify(s)),i.current=s}catch(u){console.error("Failed to save play history:",u)}},[s]);const o=l.useCallback(u=>{a(p=>[...p.filter(y=>y!==u),u].slice(-r))},[r]),c=l.useCallback(()=>{a([]),localStorage.removeItem(Di)},[]),f=l.useCallback((u,p,g=!0)=>{if(!u||u.length===0)return null;if(u.length===1)return{audio:u[0],index:0};const y=i.current;let m=u.map((S,v)=>({audio:S,index:v}));if(g&&p>=0&&(m=m.filter(S=>S.index!==p)),n&&y.length>0){const S=m.filter(v=>!y.includes(v.audio.id));S.length>0&&(m=S)}if(m.length===0)return null;const b=Math.floor(Math.random()*m.length);return m[b]},[n]),d=l.useCallback((u,p)=>{if(!u||u.length===0)return[];if(u.length===1)return[...u];const g=i.current,y=[],m=[...u];if(p){const b=m.findIndex(S=>S.id===p.id);b!==-1&&y.push(m.splice(b,1)[0])}for(;m.length>0;){let b;if(n&&g.length>0){const S=m.map((v,j)=>({audio:v,index:j})).filter(v=>!g.includes(v.audio.id)).map(v=>v.index);S.length>0?b=S[Math.floor(Math.random()*S.length)]:b=Math.floor(Math.random()*m.length)}else b=Math.floor(Math.random()*m.length);y.push(m.splice(b,1)[0])}return y},[n]);return{playHistory:s,addToHistory:o,clearHistory:c,getSmartShuffledNext:f,generateSmartShuffledQueue:d}};function _v({enabled:t,queue:r,currentIndex:n,currentAudio:s,isPlaying:a,shuffleEnabled:i=!1}){const o=l.useRef(-1),c=l.useRef(0),f=l.useRef(0);l.useEffect(()=>{t&&ft.init().catch(console.error)},[t]),l.useEffect(()=>{if(a&&s)c.current=Date.now();else if(!a&&c.current>0){const m=(Date.now()-c.current)/1e3;f.current+=m,c.current=0}},[a,s]),l.useEffect(()=>()=>{if(s&&s.youtube_id&&f.current>0){const m=s.duration||0,b=m>0&&f.current>=m*.8;ft.recordPlay(s.youtube_id,b,f.current),f.current=0}},[s?.youtube_id]),l.useEffect(()=>{if(!t||r.length===0||n===o.current)return;o.current=n;const m=setTimeout(()=>{console.log("[Prefetch] Prefetching upcoming tracks from index:",n),ft.prefetchUpcoming(r,n,i)},2e3);return()=>clearTimeout(m)},[t,r,n,i]);const d=l.useCallback(async m=>t?ft.getCachedUrl(m):null,[t]),u=l.useCallback(async m=>t?ft.isCached(m):!1,[t]),p=l.useCallback(async m=>{if(t)return ft.prefetchTrack(m,"high")},[t]),g=l.useCallback(async()=>ft.getCacheStats(),[]),y=l.useCallback(async()=>ft.clearCache(),[]);return{getCachedUrl:d,isCached:u,prefetchTrack:p,getCacheStats:g,clearCache:y}}async function Kc(){try{const t=await Oa.getSession();if(t.data?.has_session&&t.data?.session)return t.data.session}catch(t){t?.response?.status!==404&&console.debug("[PlaybackSync] Check session failed:",t)}return null}function Rv(){const[t,r]=l.useState(!1),[n,s]=l.useState(null),[a,i]=l.useState(!1),[o,c]=l.useState(!1),[f,d]=l.useState(!1),[u,p]=l.useState([]),[g,y]=l.useState(0),[m,b]=l.useState(0),S=Ot(),v=Xa(S.breakpoints.up("lg")),j=At(),[w,C]=l.useState(null),[A,P]=l.useState(!1),D=l.useRef(0),R=l.useRef(null),_=(()=>{try{return Sr()}catch{return null}})(),{isRadioMode:z,getNextTrack:W,reportPlayed:B,reportSkip:H,stopRadio:se,setCurrentTrackInfo:I}=ai();l.useEffect(()=>{z&&n?.youtube_id&&I(n.youtube_id,n.duration)},[z,n?.youtube_id,n?.duration,I]);const k=kv({historySize:_?.settings?.smart_shuffle_history_size??10,enabled:_?.settings?.smart_shuffle_enabled??!0});_v({enabled:_?.settings?.prefetch_enabled!==!1&&t,queue:u,currentIndex:g,currentAudio:n,isPlaying:a,shuffleEnabled:_?.settings?.shuffle_enabled??!1}),l.useEffect(()=>{localStorage.getItem("token")&&(r(!0),_?.loadSettings&&_.loadSettings(),(async()=>{try{const he=await Kc();he&&he.audio_details&&(console.log("[App] Found existing playback session on page load:",he),C(he),P(!0))}catch{console.debug("[App] No playback session to resume")}})());const pe=me=>{console.log("[App] Token expired:",me.detail?.message),ae()};return window.addEventListener("token-expired",pe),()=>{window.removeEventListener("token-expired",pe)}},[]),l.useEffect(()=>{n&&i(!0)},[n]),l.useEffect(()=>{if(!t||!n?.youtube_id){R.current&&(clearInterval(R.current),R.current=null);return}const oe=()=>{let he=localStorage.getItem("soundwave_device_id");return he||(he="device_"+Date.now()+"_"+Math.random().toString(36).substring(2,9),localStorage.setItem("soundwave_device_id",he)),he},pe=()=>{const he=navigator.userAgent;return/iPhone/i.test(he)?"iPhone":/iPad/i.test(he)?"iPad":/Android/i.test(he)?"Android":/Mac/i.test(he)?"Mac":/Windows/i.test(he)?"Windows":/Linux/i.test(he)?"Linux":"Web Browser"},me=async()=>{if(n?.youtube_id)try{await Oa.syncPlayback({youtube_id:n.youtube_id,position:m,duration:n.duration,is_playing:a,volume:_?.settings?.volume??100,queue_youtube_ids:u.map(he=>he.youtube_id).filter(Boolean),queue_index:g,device_id:oe(),device_name:pe()}),D.current=Date.now()}catch(he){console.debug("[PlaybackSync] Sync failed:",he)}};return me(),R.current=setInterval(()=>{a&&me()},15e3),()=>{R.current&&(clearInterval(R.current),R.current=null)}},[t,n?.youtube_id,n?.duration,a,m,u,g,_?.settings?.volume]),l.useEffect(()=>{if(!(!t||!n?.youtube_id)&&!a&&m>0){const oe=()=>localStorage.getItem("soundwave_device_id")||"unknown",pe=()=>{const me=navigator.userAgent;return/iPhone|iPad/i.test(me)?"iOS":/Android/i.test(me)?"Android":/Mac/i.test(me)?"Mac":/Windows/i.test(me)?"Windows":"Web"};Oa.syncPlayback({youtube_id:n.youtube_id,position:m,duration:n.duration,is_playing:!1,volume:_?.settings?.volume??100,queue_youtube_ids:u.map(me=>me.youtube_id).filter(Boolean),queue_index:g,device_id:oe(),device_name:pe()}).catch(()=>{})}},[a]);const O=l.useCallback(oe=>{b(oe)},[]),E=(oe,pe)=>{n&&n.id===oe&&s({...n,is_favorite:pe})},Z=oe=>{s(oe),i(!0)},G=async()=>{r(!0),_?.loadSettings&&_.loadSettings();try{const oe=await Kc();oe&&oe.audio_details&&(console.log("[App] Found existing playback session:",oe),C(oe),P(!0))}catch{console.debug("[App] No playback session to resume")}},M=async()=>{if(w?.audio_details){try{const pe=(await wt.get(w.youtube_id)).data;if(pe){const me=Math.max(0,w.position-5);if(w.queue_youtube_ids?.length>0)try{const he=await wt.list({youtube_ids:w.queue_youtube_ids.join(","),page_size:100}),Fe=he.data?.data||he.data||[];Fe.length>0?(p(Fe),y(w.queue_index)):(p([pe]),y(0))}catch{p([pe]),y(0)}else p([pe]),y(0);s({...pe,_initialSeek:me}),i(!0)}}catch(oe){console.error("[App] Failed to resume playback:",oe)}P(!1),C(null)}},T=()=>{P(!1),C(null),Oa.clearSession().catch(()=>{})},ae=async()=>{localStorage.removeItem("token");try{await fetch("/api/user/logout/",{method:"POST",headers:{"Content-Type":"application/json"}})}catch(oe){console.error("Logout error:",oe)}try{await dt.clearAllData(),console.log("[Logout] Cleared IndexedDB offline data")}catch(oe){console.error("Failed to clear offline data:",oe)}try{await We.clearCache(),console.log("[Logout] Cleared Service Worker caches")}catch(oe){console.error("Failed to clear SW cache:",oe)}document.cookie.split(";").forEach(oe=>{document.cookie=oe.replace(/^ +/,"").replace(/=.*/,"=;expires="+new Date().toUTCString()+";path=/")}),s(null),p([]),y(0),i(!1),d(!1),c(!1),j("/",{replace:!0}),r(!1)},L=()=>{c(!o)};l.useEffect(()=>{n&&a&&k.addToHistory(n.id)},[n?.id,a]);const N=l.useCallback(async()=>{if(z)try{n&&await B();const he=await W();if(he){s(he),p(Fe=>[...Fe,he]),y(Fe=>Fe+1);return}}catch(he){console.error("[Radio] Failed to get next track:",he)}if(u.length===0)return;const oe=_?.settings?.shuffle_enabled??!1,pe=_?.settings?.smart_shuffle_enabled??!0,me=_?.settings?.repeat_mode??"none";if(oe&&pe){const he=k.getSmartShuffledNext(u,g);if(he){y(he.index),s(he.audio);return}}if(oe&&!pe){const he=u.map((Fe,Dt)=>Dt).filter(Fe=>Fe!==g);if(he.length>0){const Fe=he[Math.floor(Math.random()*he.length)];y(Fe),s(u[Fe]);return}}if(g<u.length-1){const he=g+1;y(he),s(u[he])}else me==="all"&&(y(0),s(u[0]))},[u,g,_?.settings?.shuffle_enabled,_?.settings?.smart_shuffle_enabled,_?.settings?.repeat_mode,k,z,W,B,n]),X=()=>{if(u.length>0&&g>0){const oe=g-1;y(oe),s(u[oe])}},ue=l.useCallback(async()=>{z&&await H(),await N()},[z,H,N]),$=(oe,pe)=>{if(s(oe),pe&&pe.length>0){p(pe);const me=pe.findIndex(he=>he.id===oe.id);y(me>=0?me:0)}else p([oe]),y(0)},ie=l.useCallback((oe,pe)=>{oe!==pe&&(p(me=>{const he=[...me],[Fe]=he.splice(oe,1);return he.splice(pe,0,Fe),he}),y(me=>oe===me?pe:oe<me&&pe>=me?me-1:oe>me&&pe<=me?me+1:me))},[]),le=l.useCallback(oe=>{oe!==g&&(p(pe=>{const me=[...pe];return me.splice(oe,1),me}),y(pe=>oe<pe?pe-1:pe))},[g]),He=l.useCallback(oe=>{oe>=0&&oe<u.length&&(y(oe),s(u[oe]))},[u]),Be=l.useCallback(()=>{n&&(p([n]),y(0))},[n]);return l.useCallback(oe=>{p(pe=>{const me=pe.findIndex(Fe=>Fe.id===oe.id),he=[...pe];if(me!==-1&&me!==g){he.splice(me,1);const Fe=me<g+1?g:g+1;he.splice(Fe,0,oe)}else me===-1&&he.splice(g+1,0,oe);return he})},[g]),l.useCallback(oe=>{p(pe=>pe.some(me=>me.id===oe.id)?pe:[...pe,oe])},[]),t?e.jsxs(h,{sx:{display:"flex",height:"100vh",backgroundColor:"background.default"},children:[e.jsx(nb,{mobileOpen:o,onMobileClose:()=>c(!1)}),e.jsxs(h,{sx:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",position:"relative"},children:[e.jsx(h,{sx:{position:"absolute",top:0,left:0,right:0,height:"96px",background:oe=>`linear-gradient(to bottom, ${oe.palette.background.default} 0%, transparent 100%)`,zIndex:10,pointerEvents:"none"}}),e.jsx(mb,{onLogout:ae,onMenuClick:L}),z&&e.jsx(h,{sx:{px:4,pt:1},children:e.jsx(Sv,{})}),e.jsx(h,{sx:{flex:1,overflow:"auto",px:4,py:2,pb:3,"&::-webkit-scrollbar":{display:"none"},msOverflowStyle:"none",scrollbarWidth:"none"},children:e.jsxs(Yh,{children:[e.jsx(at,{path:"/",element:e.jsx(Jx,{setCurrentAudio:$})}),e.jsx(at,{path:"/search",element:e.jsx(Yp,{setCurrentAudio:$})}),e.jsx(at,{path:"/library",element:e.jsx(zp,{setCurrentAudio:$})}),e.jsx(at,{path:"/favorites",element:e.jsx(Gp,{setCurrentAudio:$})}),e.jsx(at,{path:"/channels",element:e.jsx(Zg,{})}),e.jsx(at,{path:"/channels/:channelId",element:e.jsx(e0,{setCurrentAudio:$})}),e.jsx(at,{path:"/playlists",element:e.jsx(m0,{})}),e.jsx(at,{path:"/playlists/:playlistId",element:e.jsx(g0,{setCurrentAudio:$})}),e.jsx(at,{path:"/smart-playlists",element:e.jsx(b0,{setCurrentAudio:$})}),e.jsx(at,{path:"/smart-playlist/:playlistId",element:e.jsx(v0,{setCurrentAudio:$})}),e.jsx(at,{path:"/analytics",element:e.jsx(ky,{})}),e.jsx(at,{path:"/achievements",element:e.jsx(_y,{})}),e.jsx(at,{path:"/wrapped",element:e.jsx(Ry,{})}),e.jsx(at,{path:"/history",element:e.jsx(My,{onTrackSelect:$})}),e.jsx(at,{path:"/local-files",element:e.jsx(jy,{setCurrentAudio:$})}),e.jsx(at,{path:"/offline",element:e.jsx(Sy,{})}),e.jsx(at,{path:"/settings",element:e.jsx(py,{})}),e.jsx(at,{path:"/admin/users",element:e.jsx(Ey,{children:e.jsx(wy,{})})}),e.jsx(at,{path:"*",element:e.jsx(gd,{to:"/",replace:!0})})]})})]}),n&&v&&e.jsx(h,{sx:{width:380,display:"flex",flexDirection:"column",bgcolor:"background.paper",borderLeft:"1px solid",borderColor:"rgba(255, 255, 255, 0.05)",position:"relative",overflow:"hidden"},children:e.jsx(Vc,{audio:n,isPlaying:a,setIsPlaying:i,onClose:()=>{s(null),z&&se()},onNext:ue,onPrevious:X,hasNext:z||u.length>1&&(_?.settings?.shuffle_enabled||_?.settings?.repeat_mode==="all"||g<u.length-1),hasPrevious:g>0,onFavoriteToggle:E,onTrackSelect:Z,onTimeUpdate:O,initialSeek:n._initialSeek,isRadioMode:z,queue:u,currentQueueIndex:g,onQueueReorder:ie,onRemoveFromQueue:le,onPlayQueueTrack:He,onClearQueue:Be})}),n&&!v&&e.jsxs(e.Fragment,{children:[!f&&e.jsx(h,{onClick:()=>d(!0),sx:{position:"fixed",top:0,left:0,right:0,bottom:0,bgcolor:"rgba(0, 0, 0, 0.5)",zIndex:999,backdropFilter:"blur(4px)"}}),e.jsx(h,{sx:{position:"fixed",bottom:0,left:0,right:0,zIndex:1e3,maxHeight:"85vh",overflowY:"auto",transform:f?"translateY(100%)":"translateY(0)",transition:"transform 0.3s ease-in-out",visibility:f?"hidden":"visible"},children:e.jsx(Vc,{audio:n,isPlaying:a,setIsPlaying:i,onClose:()=>{s(null),z&&se()},onMinimize:()=>d(!0),onNext:ue,onPrevious:X,hasNext:z||u.length>1&&(_?.settings?.shuffle_enabled||_?.settings?.repeat_mode==="all"||g<u.length-1),hasPrevious:g>0,onFavoriteToggle:E,onTrackSelect:Z,onTimeUpdate:O,initialSeek:n._initialSeek,isRadioMode:z,queue:u,currentQueueIndex:g,onQueueReorder:ie,onRemoveFromQueue:le,onPlayQueueTrack:He,onClearQueue:Be})}),f&&e.jsxs(h,{onClick:()=>d(!1),sx:{display:{xs:"flex",lg:"none"},position:"fixed",bottom:0,left:0,right:0,height:72,bgcolor:"background.paper",borderTop:"1px solid",borderColor:"rgba(255, 255, 255, 0.1)",alignItems:"center",px:2,gap:2,zIndex:1e3,cursor:"pointer",transition:"all 0.2s ease","&:active":{bgcolor:"rgba(255, 255, 255, 0.05)"}},children:[e.jsx(h,{component:"img",src:n.cover_art_url||"/img/icons/icon-192x192.png",alt:n.title,sx:{width:48,height:48,borderRadius:1,objectFit:"cover",flexShrink:0}}),e.jsxs(h,{sx:{flex:1,minWidth:0},children:[e.jsx(x,{variant:"body2",sx:{fontWeight:600,color:"text.primary",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:n.title}),e.jsx(x,{variant:"caption",sx:{color:"text.secondary",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"block"},children:n.artist||"Unknown Artist"})]}),e.jsx(J,{onClick:oe=>{oe.stopPropagation(),i(!a)},sx:{bgcolor:"primary.main",color:"background.dark",width:40,height:40,flexShrink:0,"&:hover":{bgcolor:"primary.main",transform:"scale(1.05)"}},children:a?e.jsx(yd,{}):e.jsx(St,{})})]})]}),e.jsx(jv,{open:A,session:w,onResume:M,onDismiss:T}),e.jsx(fv,{})]}):e.jsx(Kx,{onLoginSuccess:G})}const Uu=l.createContext({themeMode:"dark",setThemeMode:()=>{}}),Iv=()=>l.useContext(Uu);function Av(){const{settings:t,updateSetting:r,loading:n}=Sr(),[s,a]=l.useState(t.theme||K0());l.useEffect(()=>{!n&&t.theme&&a(t.theme)},[t.theme,n]);const i=c=>{a(c),Q0(c),r("theme",c)},o=G0(s);return e.jsx(Uu.Provider,{value:{themeMode:s,setThemeMode:i},children:e.jsxs(Bh,{theme:o,children:[e.jsx(qh,{}),e.jsx(Rv,{})]})})}const Pv=l.createContext(null);function Dv({children:t}){const[r,n]=l.useState([]),[s,a]=l.useState(0),[i,o]=l.useState([]),c=l.useRef(!1),f=l.useCallback((R,_=0)=>{c.current=!0,n(R),a(Math.max(0,Math.min(_,R.length-1))),o([]),c.current=!1},[]),d=l.useCallback((R,_)=>{n(R),a(_)},[]),u=l.useCallback(()=>{n([]),a(0),o([])},[]),p=l.useCallback(R=>{n(_=>{const z=s+1,W=[..._],B=W.findIndex(H=>H.id===R.id);if(B!==-1&&B!==s){W.splice(B,1);const H=B<z?z-1:z;W.splice(H,0,R)}else B===-1&&W.splice(z,0,R);return W})},[s]),g=l.useCallback(R=>{n(_=>_.some(z=>z.id===R.id)?_:[..._,R])},[]),y=l.useCallback(R=>{n(_=>{const z=[..._],W=s+1,B=R.filter(H=>!z.some(se=>se.id===H.id)||z.findIndex(se=>se.id===H.id)===s);return z.splice(W,0,...B),z})},[s]),m=l.useCallback(R=>{n(_=>{const z=R.filter(W=>!_.some(B=>B.id===W.id));return[..._,...z]})},[]),b=l.useCallback(R=>R<0||R>=r.length?null:(r[s]&&o(_=>[..._.slice(-49),r[s]]),a(R),r[R]),[r,s]),S=l.useCallback(()=>{if(s>=r.length-1)return null;r[s]&&o(_=>[..._.slice(-49),r[s]]);const R=s+1;return a(R),r[R]},[r,s]),v=l.useCallback(()=>{if(s>0){const R=s-1;return a(R),r[R]}if(i.length>0){const R=i[i.length-1];return o(_=>_.slice(0,-1)),n(_=>[R,..._]),R}return null},[r,s,i]),j=l.useCallback((R,_)=>{R!==_&&(R<0||R>=r.length||_<0||_>=r.length||(n(z=>{const W=[...z],[B]=W.splice(R,1);return W.splice(_,0,B),W}),a(z=>R===z?_:R<z&&_>=z?z-1:R>z&&_<=z?z+1:z)))},[r.length]),w=l.useCallback(R=>{R<0||R>=r.length||R!==s&&(n(_=>{const z=[..._];return z.splice(R,1),z}),a(_=>R<_?_-1:_))},[r.length,s]),C=r[s]||null,A=s<r.length-1,P=s>0||i.length>0,D={queue:r,currentIndex:s,history:i,setQueue:f,clearQueue:u,playNext:p,addToQueue:g,playNextMultiple:y,addToQueueMultiple:m,playTrackAtIndex:b,goToNext:S,goToPrevious:v,moveTrack:j,removeTrack:w,currentTrack:C,hasNext:A,hasPrevious:P,setCurrentIndex:a,syncQueueFromExternal:d};return e.jsx(Pv.Provider,{value:D,children:t})}Jh.createRoot(document.getElementById("root")).render(e.jsx(Ee.StrictMode,{children:e.jsx(Gh,{children:e.jsx(i0,{children:e.jsx(iy,{children:e.jsx(Ag,{children:e.jsx(Vb,{children:e.jsx(Tp,{children:e.jsx(Nb,{children:e.jsx(Dv,{children:e.jsx(s1,{children:e.jsx(Av,{})})})})})})})})})})}));export{wt as a};
