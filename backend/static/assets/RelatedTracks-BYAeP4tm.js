import{j as e,B as r,T as n,bu as x,bb as m,A as w,t as R,y as T,m as z,b7 as W,b8 as Y,ba as H,w as O,s as U,z as q,aY as G,aL as J,h as K,g as Q,c as _,bv as V,bw as X,aa as Z,D as ee,a_ as se,au as te}from"./mui-DL9BudVb.js";import{a as o}from"./vendor-4GryFJQ2.js";import{a as L}from"./index-3BGFTiTe.js";function oe({currentAudio:l,onTrackSelect:u,onFavoriteToggle:j,compact:d=!1}){const[g,M]=o.useState([]),[y,C]=o.useState([]),[E,h]=o.useState(!0),[v,c]=o.useState(""),[b,P]=o.useState(!0),[S,k]=o.useState(!1),[B,$]=o.useState(null);o.useEffect(()=>{A()},[l.id]);const A=async()=>{if(!l.youtube_id){c("Recommendations not available for local files"),h(!1);return}h(!0),c("");try{const[s,a]=await Promise.allSettled([L.getRecommendations(l.youtube_id),L.getSimilarTracks(l.youtube_id)]);if(s.status==="fulfilled"){const i=s.value.data;M(i.recommendations),$(i.algorithm_weights)}if(a.status==="fulfilled"){const i=a.value.data;C(i.similar_tracks)}s.status==="rejected"&&a.status==="rejected"&&c("Failed to load recommendations")}catch(s){console.error("Error loading related tracks:",s),c("Failed to load recommendations")}finally{h(!1)}},D=s=>{const a=Math.floor(s/60),i=s%60;return`${a}:${i.toString().padStart(2,"0")}`},F=async(s,a)=>{a.stopPropagation(),j&&j(s)},I=(s,a,i,f,N)=>s.length===0?null:e.jsxs(r,{sx:{mb:2},children:[e.jsxs(R,{onClick:N,sx:{px:0,py:1},children:[e.jsx(T,{children:i}),e.jsx(z,{primary:a,secondary:`${s.length} tracks`,sx:{"& .MuiListItemText-primary":{fontSize:"0.95rem",fontWeight:600},"& .MuiListItemText-secondary":{fontSize:"0.8rem"}}}),f?e.jsx(W,{}):e.jsx(Y,{})]}),e.jsxs(H,{in:f,children:[e.jsx(O,{dense:!0,disablePadding:!0,children:s.slice(0,d?3:8).map(t=>e.jsx(U,{disablePadding:!0,children:e.jsxs(R,{onClick:()=>u(t),sx:{py:.5,"&:hover":{bgcolor:"rgba(255, 255, 255, 0.05)"}},children:[e.jsx(T,{children:e.jsx(q,{src:t.thumbnail_url||void 0,sx:{width:32,height:32},children:e.jsx(G,{fontSize:"small"})})}),e.jsx(z,{primary:t.title,secondary:`${t.channel_name} â€¢ ${D(t.duration)}`,sx:{"& .MuiListItemText-primary":{fontSize:"0.85rem",fontWeight:500,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},"& .MuiListItemText-secondary":{fontSize:"0.75rem",color:"text.disabled"}}}),e.jsx(J,{children:e.jsxs(r,{sx:{display:"flex",gap:.5},children:[t.play_count>0&&e.jsx(K,{label:t.play_count,size:"small",sx:{fontSize:"0.7rem",height:20,bgcolor:"rgba(25, 118, 210, 0.1)",color:"primary.main"}}),e.jsx(Q,{title:t.is_favorite?"Remove from favorites":"Add to favorites",children:e.jsx(_,{size:"small",onClick:p=>F(t,p),sx:{color:t.is_favorite?"#e91e63":"text.disabled","&:hover":{color:"#e91e63"}},children:t.is_favorite?e.jsx(V,{sx:{fontSize:16}}):e.jsx(X,{sx:{fontSize:16}})})}),e.jsx(_,{size:"small",onClick:p=>{p.stopPropagation(),u(t)},sx:{color:"primary.main"},children:e.jsx(Z,{sx:{fontSize:16}})})]})})]})},t.id))}),s.length>(d?3:8)&&e.jsxs(n,{variant:"caption",sx:{px:2,color:"text.disabled"},children:["+",s.length-(d?3:8)," more tracks"]})]}),!f&&e.jsx(ee,{sx:{mt:1}})]});return E?e.jsxs(r,{sx:{p:2},children:[e.jsxs(n,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(x,{color:"primary"}),"Related Tracks"]}),Array.from({length:5}).map((s,a)=>e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(m,{variant:"circular",width:32,height:32}),e.jsxs(r,{sx:{flex:1},children:[e.jsx(m,{variant:"text",width:"70%"}),e.jsx(m,{variant:"text",width:"40%"})]}),e.jsx(m,{variant:"circular",width:24,height:24})]},a))]}):v?e.jsxs(r,{sx:{p:2},children:[e.jsxs(n,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(x,{color:"primary"}),"Related Tracks"]}),e.jsx(w,{severity:"info",variant:"outlined",children:v})]}):g.length===0&&y.length===0?e.jsxs(r,{sx:{p:2},children:[e.jsxs(n,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(x,{color:"primary"}),"Related Tracks"]}),e.jsx(w,{severity:"info",variant:"outlined",children:"No related tracks found. Start listening to more music to get personalized recommendations!"})]}):e.jsxs(r,{sx:{p:2},children:[e.jsxs(n,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(x,{color:"primary"}),"Related Tracks"]}),B&&!d&&e.jsx(n,{variant:"caption",sx:{color:"text.secondary",mb:2,display:"block"},children:"Based on your listening patterns, favorites, and popular tracks"}),I(g,"Recommended for You",e.jsx(se,{color:"primary",sx:{fontSize:20}}),b,()=>P(!b)),I(y,`More from ${l.channel_name}`,e.jsx(te,{color:"action",sx:{fontSize:20}}),S,()=>k(!S))]})}export{oe as default};
