const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/RelatedTracks-2Uo9X4J2.js","assets/mui-DL9BudVb.js","assets/vendor-4GryFJQ2.js"])))=>i.map(i=>d[i]);
import{u as fh,r as ne,a as se,j as e,B as h,T as x,b as Ce,I as nr,c as X,F as We,C as qo,d as N,A as pe,e as Ie,f as $e,L as rt,g as ve,h as ue,Z as id,i as ld,M as ha,k as we,l as Ge,m as ke,D as Ee,n as Ke,o as tt,P as xh,p as Xe,q as cd,s as Le,t as tr,v as sr,w as Qe,Q as No,x as nt,S as it,y as Ft,z as Ve,E as Lr,G as yt,H as Wr,J as $r,K as ht,N as Z,O as Br,R as ph,U as mh,V as ea,W as oi,X as Ut,Y as ee,_ as _e,$ as Ri,a0 as Pe,a1 as dd,a2 as gh,a3 as yh,a4 as ud,a5 as Ha,a6 as nn,a7 as hd,a8 as ta,a9 as Uo,aa as ar,ab as bh,ac as jr,ad as ra,ae as ro,af as vh,ag as jh,ah as fr,ai as fd,aj as Ii,ak as Xr,al as Er,am as xd,an as Ho,ao as Ct,ap as Wt,aq as Rt,ar as pd,as as md,at as wh,au as gd,av as Sh,aw as na,ax as Ch,ay as fa,az as Pt,aA as qr,aB as Ai,aC as kh,aD as Kr,aE as et,aF as yd,aG as _h,aH as Tr,aI as Sr,aJ as Wa,aK as bd,aL as Ar,aM as Vo,aN as Pr,aO as Rh,aP as Ih,aQ as Ah,aR as Ph,aS as Dh,aT as Mh,aU as Eh,aV as Pi,aW as vd,aX as no,aY as Ht,aZ as Va,a_ as jd,a$ as Di,b0 as wd,b1 as Ya,b2 as Th,b3 as so,b4 as zh,b5 as Oh,b6 as Fh,b7 as Sd,b8 as Cd,b9 as Lh,ba as Yo,bb as Mi,bc as Wh,bd as kd,be as $h,bf as Bh,bg as ko,bh as qh,bi as Nh,bj as sa,bk as Uh,bl as Hh,bm as Vh,bn as _o,bo as ao,bp as Yh,bq as Gh,br as Qh,bs as Kh,bt as Xh}from"./mui-DL9BudVb.js";import{f as Jh,b as re,g as Zh,a as l,u as Dt,r as ef,h as tf,i as _d,c as ze,e as Ys,j as ii,N as Rd,k as rf,l as at,B as nf}from"./vendor-4GryFJQ2.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function n(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(a){if(a.ep)return;a.ep=!0;const o=n(a);fetch(a.href,o)}})();var Da={},Ei;function sf(){if(Ei)return Da;Ei=1;var t=Jh();return Da.createRoot=t.createRoot,Da.hydrateRoot=t.hydrateRoot,Da}var af=sf();const of=re(af);var mn={},Ro={};const lf=Zh(fh);var Ti;function ae(){return Ti||(Ti=1,(function(t){"use client";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return r.createSvgIcon}});var r=lf})(Ro)),Ro}var zi;function cf(){if(zi)return mn;zi=1;var t=ne();Object.defineProperty(mn,"__esModule",{value:!0}),mn.default=void 0;var r=t(ae()),n=se();return mn.default=(0,r.default)((0,n.jsx)("path",{d:"M8 5v14l11-7z"}),"PlayArrow"),mn}var df=cf();const gt=re(df);var gn={},Oi;function uf(){if(Oi)return gn;Oi=1;var t=ne();Object.defineProperty(gn,"__esModule",{value:!0}),gn.default=void 0;var r=t(ae()),n=se();return gn.default=(0,r.default)((0,n.jsx)("path",{d:"M6 19h4V5H6zm8-14v14h4V5z"}),"Pause"),gn}var hf=uf();const Id=re(hf);var yn={},Fi;function ff(){if(Fi)return yn;Fi=1;var t=ne();Object.defineProperty(yn,"__esModule",{value:!0}),yn.default=void 0;var r=t(ae()),n=se();return yn.default=(0,r.default)((0,n.jsx)("path",{d:"M12 5.9c1.16 0 2.1.94 2.1 2.1s-.94 2.1-2.1 2.1S9.9 9.16 9.9 8s.94-2.1 2.1-2.1m0 9c2.97 0 6.1 1.46 6.1 2.1v1.1H5.9V17c0-.64 3.13-2.1 6.1-2.1M12 4C9.79 4 8 5.79 8 8s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4m0 9c-2.67 0-8 1.34-8 4v3h16v-3c0-2.66-5.33-4-8-4"}),"PersonOutline"),yn}var xf=ff();const pf=re(xf);var bn={},Li;function mf(){if(Li)return bn;Li=1;var t=ne();Object.defineProperty(bn,"__esModule",{value:!0}),bn.default=void 0;var r=t(ae()),n=se();return bn.default=(0,r.default)((0,n.jsx)("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2M9 6c0-1.66 1.34-3 3-3s3 1.34 3 3v2H9zm9 14H6V10h12zm-6-3c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2"}),"LockOutlined"),bn}var gf=mf();const Wi=re(gf);var vn={},$i;function yf(){if($i)return vn;$i=1;var t=ne();Object.defineProperty(vn,"__esModule",{value:!0}),vn.default=void 0;var r=t(ae()),n=se();return vn.default=(0,r.default)((0,n.jsx)("path",{d:"M12 6c3.79 0 7.17 2.13 8.82 5.5C19.17 14.87 15.79 17 12 17s-7.17-2.13-8.82-5.5C4.83 8.13 8.21 6 12 6m0-2C7 4 2.73 7.11 1 11.5 2.73 15.89 7 19 12 19s9.27-3.11 11-7.5C21.27 7.11 17 4 12 4m0 5c1.38 0 2.5 1.12 2.5 2.5S13.38 14 12 14s-2.5-1.12-2.5-2.5S10.62 9 12 9m0-2c-2.48 0-4.5 2.02-4.5 4.5S9.52 16 12 16s4.5-2.02 4.5-4.5S14.48 7 12 7"}),"VisibilityOutlined"),vn}var bf=yf();const vf=re(bf);var jn={},Bi;function jf(){if(Bi)return jn;Bi=1;var t=ne();Object.defineProperty(jn,"__esModule",{value:!0}),jn.default=void 0;var r=t(ae()),n=se();return jn.default=(0,r.default)((0,n.jsx)("path",{d:"M12 6c3.79 0 7.17 2.13 8.82 5.5-.59 1.22-1.42 2.27-2.41 3.12l1.41 1.41c1.39-1.23 2.49-2.77 3.18-4.53C21.27 7.11 17 4 12 4c-1.27 0-2.49.2-3.64.57l1.65 1.65C10.66 6.09 11.32 6 12 6m-1.07 1.14L13 9.21c.57.25 1.03.71 1.28 1.28l2.07 2.07c.08-.34.14-.7.14-1.07C16.5 9.01 14.48 7 12 7c-.37 0-.72.05-1.07.14M2.01 3.87l2.68 2.68C3.06 7.83 1.77 9.53 1 11.5 2.73 15.89 7 19 12 19c1.52 0 2.98-.29 4.32-.82l3.42 3.42 1.41-1.41L3.42 2.45zm7.5 7.5 2.61 2.61c-.04.01-.08.02-.12.02-1.38 0-2.5-1.12-2.5-2.5 0-.05.01-.08.01-.13m-3.4-3.4 1.75 1.75c-.23.55-.36 1.15-.36 1.78 0 2.48 2.02 4.5 4.5 4.5.63 0 1.23-.13 1.77-.36l.98.98c-.88.24-1.8.38-2.75.38-3.79 0-7.17-2.13-8.82-5.5.7-1.43 1.72-2.61 2.93-3.53"}),"VisibilityOffOutlined"),jn}var wf=jf();const Sf=re(wf);var wn={},qi;function Cf(){if(qi)return wn;qi=1;var t=ne();Object.defineProperty(wn,"__esModule",{value:!0}),wn.default=void 0;var r=t(ae()),n=se();return wn.default=(0,r.default)((0,n.jsx)("path",{d:"m12 4-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"}),"ArrowForward"),wn}var kf=Cf();const _f=re(kf);var Sn={},Ni;function Rf(){if(Ni)return Sn;Ni=1;var t=ne();Object.defineProperty(Sn,"__esModule",{value:!0}),Sn.default=void 0;var r=t(ae()),n=se();return Sn.default=(0,r.default)((0,n.jsx)("path",{d:"m14.5 14.2 2.9 1.7-.8 1.3L13 15v-5h1.5zM22 14c0 4.41-3.59 8-8 8-2.02 0-3.86-.76-5.27-2H4c-1.15 0-2-.85-2-2V9c0-1.12.89-1.96 2-2v-.5C4 4.01 6.01 2 8.5 2c2.34 0 4.24 1.79 4.46 4.08.34-.05.69-.08 1.04-.08 4.41 0 8 3.59 8 8M6 7h5v-.74C10.88 4.99 9.8 4 8.5 4 7.12 4 6 5.12 6 6.5zm14 7c0-3.31-2.69-6-6-6s-6 2.69-6 6 2.69 6 6 6 6-2.69 6-6"}),"LockClock"),Sn}var If=Rf();const Ui=re(If);function Ad(t,r){return function(){return t.apply(r,arguments)}}const{toString:Af}=Object.prototype,{getPrototypeOf:li}=Object,{iterator:oo,toStringTag:Pd}=Symbol,io=(t=>r=>{const n=Af.call(r);return t[n]||(t[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),Jt=t=>(t=t.toLowerCase(),r=>io(r)===t),lo=t=>r=>typeof r===t,{isArray:on}=Array,sn=lo("undefined");function xa(t){return t!==null&&!sn(t)&&t.constructor!==null&&!sn(t.constructor)&&It(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const Dd=Jt("ArrayBuffer");function Pf(t){let r;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?r=ArrayBuffer.isView(t):r=t&&t.buffer&&Dd(t.buffer),r}const Df=lo("string"),It=lo("function"),Md=lo("number"),pa=t=>t!==null&&typeof t=="object",Mf=t=>t===!0||t===!1,$a=t=>{if(io(t)!=="object")return!1;const r=li(t);return(r===null||r===Object.prototype||Object.getPrototypeOf(r)===null)&&!(Pd in t)&&!(oo in t)},Ef=t=>{if(!pa(t)||xa(t))return!1;try{return Object.keys(t).length===0&&Object.getPrototypeOf(t)===Object.prototype}catch{return!1}},Tf=Jt("Date"),zf=Jt("File"),Of=Jt("Blob"),Ff=Jt("FileList"),Lf=t=>pa(t)&&It(t.pipe),Wf=t=>{let r;return t&&(typeof FormData=="function"&&t instanceof FormData||It(t.append)&&((r=io(t))==="formdata"||r==="object"&&It(t.toString)&&t.toString()==="[object FormData]"))},$f=Jt("URLSearchParams"),[Bf,qf,Nf,Uf]=["ReadableStream","Request","Response","Headers"].map(Jt),Hf=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function ma(t,r,{allOwnKeys:n=!1}={}){if(t===null||typeof t>"u")return;let s,a;if(typeof t!="object"&&(t=[t]),on(t))for(s=0,a=t.length;s<a;s++)r.call(null,t[s],s,t);else{if(xa(t))return;const o=n?Object.getOwnPropertyNames(t):Object.keys(t),i=o.length;let c;for(s=0;s<i;s++)c=o[s],r.call(null,t[c],c,t)}}function Ed(t,r){if(xa(t))return null;r=r.toLowerCase();const n=Object.keys(t);let s=n.length,a;for(;s-- >0;)if(a=n[s],r===a.toLowerCase())return a;return null}const Rr=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Td=t=>!sn(t)&&t!==Rr;function Go(){const{caseless:t,skipUndefined:r}=Td(this)&&this||{},n={},s=(a,o)=>{const i=t&&Ed(n,o)||o;$a(n[i])&&$a(a)?n[i]=Go(n[i],a):$a(a)?n[i]=Go({},a):on(a)?n[i]=a.slice():(!r||!sn(a))&&(n[i]=a)};for(let a=0,o=arguments.length;a<o;a++)arguments[a]&&ma(arguments[a],s);return n}const Vf=(t,r,n,{allOwnKeys:s}={})=>(ma(r,(a,o)=>{n&&It(a)?t[o]=Ad(a,n):t[o]=a},{allOwnKeys:s}),t),Yf=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),Gf=(t,r,n,s)=>{t.prototype=Object.create(r.prototype,s),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:r.prototype}),n&&Object.assign(t.prototype,n)},Qf=(t,r,n,s)=>{let a,o,i;const c={};if(r=r||{},t==null)return r;do{for(a=Object.getOwnPropertyNames(t),o=a.length;o-- >0;)i=a[o],(!s||s(i,t,r))&&!c[i]&&(r[i]=t[i],c[i]=!0);t=n!==!1&&li(t)}while(t&&(!n||n(t,r))&&t!==Object.prototype);return r},Kf=(t,r,n)=>{t=String(t),(n===void 0||n>t.length)&&(n=t.length),n-=r.length;const s=t.indexOf(r,n);return s!==-1&&s===n},Xf=t=>{if(!t)return null;if(on(t))return t;let r=t.length;if(!Md(r))return null;const n=new Array(r);for(;r-- >0;)n[r]=t[r];return n},Jf=(t=>r=>t&&r instanceof t)(typeof Uint8Array<"u"&&li(Uint8Array)),Zf=(t,r)=>{const s=(t&&t[oo]).call(t);let a;for(;(a=s.next())&&!a.done;){const o=a.value;r.call(t,o[0],o[1])}},ex=(t,r)=>{let n;const s=[];for(;(n=t.exec(r))!==null;)s.push(n);return s},tx=Jt("HTMLFormElement"),rx=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,s,a){return s.toUpperCase()+a}),Hi=(({hasOwnProperty:t})=>(r,n)=>t.call(r,n))(Object.prototype),nx=Jt("RegExp"),zd=(t,r)=>{const n=Object.getOwnPropertyDescriptors(t),s={};ma(n,(a,o)=>{let i;(i=r(a,o,t))!==!1&&(s[o]=i||a)}),Object.defineProperties(t,s)},sx=t=>{zd(t,(r,n)=>{if(It(t)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const s=t[n];if(It(s)){if(r.enumerable=!1,"writable"in r){r.writable=!1;return}r.set||(r.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},ax=(t,r)=>{const n={},s=a=>{a.forEach(o=>{n[o]=!0})};return on(t)?s(t):s(String(t).split(r)),n},ox=()=>{},ix=(t,r)=>t!=null&&Number.isFinite(t=+t)?t:r;function lx(t){return!!(t&&It(t.append)&&t[Pd]==="FormData"&&t[oo])}const cx=t=>{const r=new Array(10),n=(s,a)=>{if(pa(s)){if(r.indexOf(s)>=0)return;if(xa(s))return s;if(!("toJSON"in s)){r[a]=s;const o=on(s)?[]:{};return ma(s,(i,c)=>{const u=n(i,a+1);!sn(u)&&(o[c]=u)}),r[a]=void 0,o}}return s};return n(t,0)},dx=Jt("AsyncFunction"),ux=t=>t&&(pa(t)||It(t))&&It(t.then)&&It(t.catch),Od=((t,r)=>t?setImmediate:r?((n,s)=>(Rr.addEventListener("message",({source:a,data:o})=>{a===Rr&&o===n&&s.length&&s.shift()()},!1),a=>{s.push(a),Rr.postMessage(n,"*")}))(`axios@${Math.random()}`,[]):n=>setTimeout(n))(typeof setImmediate=="function",It(Rr.postMessage)),hx=typeof queueMicrotask<"u"?queueMicrotask.bind(Rr):typeof process<"u"&&process.nextTick||Od,fx=t=>t!=null&&It(t[oo]),L={isArray:on,isArrayBuffer:Dd,isBuffer:xa,isFormData:Wf,isArrayBufferView:Pf,isString:Df,isNumber:Md,isBoolean:Mf,isObject:pa,isPlainObject:$a,isEmptyObject:Ef,isReadableStream:Bf,isRequest:qf,isResponse:Nf,isHeaders:Uf,isUndefined:sn,isDate:Tf,isFile:zf,isBlob:Of,isRegExp:nx,isFunction:It,isStream:Lf,isURLSearchParams:$f,isTypedArray:Jf,isFileList:Ff,forEach:ma,merge:Go,extend:Vf,trim:Hf,stripBOM:Yf,inherits:Gf,toFlatObject:Qf,kindOf:io,kindOfTest:Jt,endsWith:Kf,toArray:Xf,forEachEntry:Zf,matchAll:ex,isHTMLForm:tx,hasOwnProperty:Hi,hasOwnProp:Hi,reduceDescriptors:zd,freezeMethods:sx,toObjectSet:ax,toCamelCase:rx,noop:ox,toFiniteNumber:ix,findKey:Ed,global:Rr,isContextDefined:Td,isSpecCompliantForm:lx,toJSONObject:cx,isAsyncFn:dx,isThenable:ux,setImmediate:Od,asap:hx,isIterable:fx};function Re(t,r,n,s,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",r&&(this.code=r),n&&(this.config=n),s&&(this.request=s),a&&(this.response=a,this.status=a.status?a.status:null)}L.inherits(Re,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:L.toJSONObject(this.config),code:this.code,status:this.status}}});const Fd=Re.prototype,Ld={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{Ld[t]={value:t}});Object.defineProperties(Re,Ld);Object.defineProperty(Fd,"isAxiosError",{value:!0});Re.from=(t,r,n,s,a,o)=>{const i=Object.create(Fd);L.toFlatObject(t,i,function(f){return f!==Error.prototype},d=>d!=="isAxiosError");const c=t&&t.message?t.message:"Error",u=r==null&&t?t.code:r;return Re.call(i,c,u,n,s,a),t&&i.cause==null&&Object.defineProperty(i,"cause",{value:t,configurable:!0}),i.name=t&&t.name||"Error",o&&Object.assign(i,o),i};const xx=null;function Qo(t){return L.isPlainObject(t)||L.isArray(t)}function Wd(t){return L.endsWith(t,"[]")?t.slice(0,-2):t}function Vi(t,r,n){return t?t.concat(r).map(function(a,o){return a=Wd(a),!n&&o?"["+a+"]":a}).join(n?".":""):r}function px(t){return L.isArray(t)&&!t.some(Qo)}const mx=L.toFlatObject(L,{},null,function(r){return/^is[A-Z]/.test(r)});function co(t,r,n){if(!L.isObject(t))throw new TypeError("target must be an object");r=r||new FormData,n=L.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(j,C){return!L.isUndefined(C[j])});const s=n.metaTokens,a=n.visitor||f,o=n.dots,i=n.indexes,u=(n.Blob||typeof Blob<"u"&&Blob)&&L.isSpecCompliantForm(r);if(!L.isFunction(a))throw new TypeError("visitor must be a function");function d(y){if(y===null)return"";if(L.isDate(y))return y.toISOString();if(L.isBoolean(y))return y.toString();if(!u&&L.isBlob(y))throw new Re("Blob is not supported. Use a Buffer instead.");return L.isArrayBuffer(y)||L.isTypedArray(y)?u&&typeof Blob=="function"?new Blob([y]):Buffer.from(y):y}function f(y,j,C){let w=y;if(y&&!C&&typeof y=="object"){if(L.endsWith(j,"{}"))j=s?j:j.slice(0,-2),y=JSON.stringify(y);else if(L.isArray(y)&&px(y)||(L.isFileList(y)||L.endsWith(j,"[]"))&&(w=L.toArray(y)))return j=Wd(j),w.forEach(function(v,S){!(L.isUndefined(v)||v===null)&&r.append(i===!0?Vi([j],S,o):i===null?j:j+"[]",d(v))}),!1}return Qo(y)?!0:(r.append(Vi(C,j,o),d(y)),!1)}const p=[],g=Object.assign(mx,{defaultVisitor:f,convertValue:d,isVisitable:Qo});function m(y,j){if(!L.isUndefined(y)){if(p.indexOf(y)!==-1)throw Error("Circular reference detected in "+j.join("."));p.push(y),L.forEach(y,function(w,b){(!(L.isUndefined(w)||w===null)&&a.call(r,w,L.isString(b)?b.trim():b,j,g))===!0&&m(w,j?j.concat(b):[b])}),p.pop()}}if(!L.isObject(t))throw new TypeError("data must be an object");return m(t),r}function Yi(t){const r={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(s){return r[s]})}function ci(t,r){this._pairs=[],t&&co(t,this,r)}const $d=ci.prototype;$d.append=function(r,n){this._pairs.push([r,n])};$d.toString=function(r){const n=r?function(s){return r.call(this,s,Yi)}:Yi;return this._pairs.map(function(a){return n(a[0])+"="+n(a[1])},"").join("&")};function gx(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function Bd(t,r,n){if(!r)return t;const s=n&&n.encode||gx;L.isFunction(n)&&(n={serialize:n});const a=n&&n.serialize;let o;if(a?o=a(r,n):o=L.isURLSearchParams(r)?r.toString():new ci(r,n).toString(s),o){const i=t.indexOf("#");i!==-1&&(t=t.slice(0,i)),t+=(t.indexOf("?")===-1?"?":"&")+o}return t}class Gi{constructor(){this.handlers=[]}use(r,n,s){return this.handlers.push({fulfilled:r,rejected:n,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(r){this.handlers[r]&&(this.handlers[r]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(r){L.forEach(this.handlers,function(s){s!==null&&r(s)})}}const qd={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},yx=typeof URLSearchParams<"u"?URLSearchParams:ci,bx=typeof FormData<"u"?FormData:null,vx=typeof Blob<"u"?Blob:null,jx={isBrowser:!0,classes:{URLSearchParams:yx,FormData:bx,Blob:vx},protocols:["http","https","file","blob","url","data"]},di=typeof window<"u"&&typeof document<"u",Ko=typeof navigator=="object"&&navigator||void 0,wx=di&&(!Ko||["ReactNative","NativeScript","NS"].indexOf(Ko.product)<0),Sx=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Cx=di&&window.location.href||"http://localhost",kx=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:di,hasStandardBrowserEnv:wx,hasStandardBrowserWebWorkerEnv:Sx,navigator:Ko,origin:Cx},Symbol.toStringTag,{value:"Module"})),mt={...kx,...jx};function _x(t,r){return co(t,new mt.classes.URLSearchParams,{visitor:function(n,s,a,o){return mt.isNode&&L.isBuffer(n)?(this.append(s,n.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)},...r})}function Rx(t){return L.matchAll(/\w+|\[(\w*)]/g,t).map(r=>r[0]==="[]"?"":r[1]||r[0])}function Ix(t){const r={},n=Object.keys(t);let s;const a=n.length;let o;for(s=0;s<a;s++)o=n[s],r[o]=t[o];return r}function Nd(t){function r(n,s,a,o){let i=n[o++];if(i==="__proto__")return!0;const c=Number.isFinite(+i),u=o>=n.length;return i=!i&&L.isArray(a)?a.length:i,u?(L.hasOwnProp(a,i)?a[i]=[a[i],s]:a[i]=s,!c):((!a[i]||!L.isObject(a[i]))&&(a[i]=[]),r(n,s,a[i],o)&&L.isArray(a[i])&&(a[i]=Ix(a[i])),!c)}if(L.isFormData(t)&&L.isFunction(t.entries)){const n={};return L.forEachEntry(t,(s,a)=>{r(Rx(s),a,n,0)}),n}return null}function Ax(t,r,n){if(L.isString(t))try{return(r||JSON.parse)(t),L.trim(t)}catch(s){if(s.name!=="SyntaxError")throw s}return(n||JSON.stringify)(t)}const ga={transitional:qd,adapter:["xhr","http","fetch"],transformRequest:[function(r,n){const s=n.getContentType()||"",a=s.indexOf("application/json")>-1,o=L.isObject(r);if(o&&L.isHTMLForm(r)&&(r=new FormData(r)),L.isFormData(r))return a?JSON.stringify(Nd(r)):r;if(L.isArrayBuffer(r)||L.isBuffer(r)||L.isStream(r)||L.isFile(r)||L.isBlob(r)||L.isReadableStream(r))return r;if(L.isArrayBufferView(r))return r.buffer;if(L.isURLSearchParams(r))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),r.toString();let c;if(o){if(s.indexOf("application/x-www-form-urlencoded")>-1)return _x(r,this.formSerializer).toString();if((c=L.isFileList(r))||s.indexOf("multipart/form-data")>-1){const u=this.env&&this.env.FormData;return co(c?{"files[]":r}:r,u&&new u,this.formSerializer)}}return o||a?(n.setContentType("application/json",!1),Ax(r)):r}],transformResponse:[function(r){const n=this.transitional||ga.transitional,s=n&&n.forcedJSONParsing,a=this.responseType==="json";if(L.isResponse(r)||L.isReadableStream(r))return r;if(r&&L.isString(r)&&(s&&!this.responseType||a)){const i=!(n&&n.silentJSONParsing)&&a;try{return JSON.parse(r,this.parseReviver)}catch(c){if(i)throw c.name==="SyntaxError"?Re.from(c,Re.ERR_BAD_RESPONSE,this,null,this.response):c}}return r}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:mt.classes.FormData,Blob:mt.classes.Blob},validateStatus:function(r){return r>=200&&r<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};L.forEach(["delete","get","head","post","put","patch"],t=>{ga.headers[t]={}});const Px=L.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Dx=t=>{const r={};let n,s,a;return t&&t.split(`
`).forEach(function(i){a=i.indexOf(":"),n=i.substring(0,a).trim().toLowerCase(),s=i.substring(a+1).trim(),!(!n||r[n]&&Px[n])&&(n==="set-cookie"?r[n]?r[n].push(s):r[n]=[s]:r[n]=r[n]?r[n]+", "+s:s)}),r},Qi=Symbol("internals");function Cn(t){return t&&String(t).trim().toLowerCase()}function Ba(t){return t===!1||t==null?t:L.isArray(t)?t.map(Ba):String(t)}function Mx(t){const r=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=n.exec(t);)r[s[1]]=s[2];return r}const Ex=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function Io(t,r,n,s,a){if(L.isFunction(s))return s.call(this,r,n);if(a&&(r=n),!!L.isString(r)){if(L.isString(s))return r.indexOf(s)!==-1;if(L.isRegExp(s))return s.test(r)}}function Tx(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(r,n,s)=>n.toUpperCase()+s)}function zx(t,r){const n=L.toCamelCase(" "+r);["get","set","has"].forEach(s=>{Object.defineProperty(t,s+n,{value:function(a,o,i){return this[s].call(this,r,a,o,i)},configurable:!0})})}let At=class{constructor(r){r&&this.set(r)}set(r,n,s){const a=this;function o(c,u,d){const f=Cn(u);if(!f)throw new Error("header name must be a non-empty string");const p=L.findKey(a,f);(!p||a[p]===void 0||d===!0||d===void 0&&a[p]!==!1)&&(a[p||u]=Ba(c))}const i=(c,u)=>L.forEach(c,(d,f)=>o(d,f,u));if(L.isPlainObject(r)||r instanceof this.constructor)i(r,n);else if(L.isString(r)&&(r=r.trim())&&!Ex(r))i(Dx(r),n);else if(L.isObject(r)&&L.isIterable(r)){let c={},u,d;for(const f of r){if(!L.isArray(f))throw TypeError("Object iterator must return a key-value pair");c[d=f[0]]=(u=c[d])?L.isArray(u)?[...u,f[1]]:[u,f[1]]:f[1]}i(c,n)}else r!=null&&o(n,r,s);return this}get(r,n){if(r=Cn(r),r){const s=L.findKey(this,r);if(s){const a=this[s];if(!n)return a;if(n===!0)return Mx(a);if(L.isFunction(n))return n.call(this,a,s);if(L.isRegExp(n))return n.exec(a);throw new TypeError("parser must be boolean|regexp|function")}}}has(r,n){if(r=Cn(r),r){const s=L.findKey(this,r);return!!(s&&this[s]!==void 0&&(!n||Io(this,this[s],s,n)))}return!1}delete(r,n){const s=this;let a=!1;function o(i){if(i=Cn(i),i){const c=L.findKey(s,i);c&&(!n||Io(s,s[c],c,n))&&(delete s[c],a=!0)}}return L.isArray(r)?r.forEach(o):o(r),a}clear(r){const n=Object.keys(this);let s=n.length,a=!1;for(;s--;){const o=n[s];(!r||Io(this,this[o],o,r,!0))&&(delete this[o],a=!0)}return a}normalize(r){const n=this,s={};return L.forEach(this,(a,o)=>{const i=L.findKey(s,o);if(i){n[i]=Ba(a),delete n[o];return}const c=r?Tx(o):String(o).trim();c!==o&&delete n[o],n[c]=Ba(a),s[c]=!0}),this}concat(...r){return this.constructor.concat(this,...r)}toJSON(r){const n=Object.create(null);return L.forEach(this,(s,a)=>{s!=null&&s!==!1&&(n[a]=r&&L.isArray(s)?s.join(", "):s)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([r,n])=>r+": "+n).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(r){return r instanceof this?r:new this(r)}static concat(r,...n){const s=new this(r);return n.forEach(a=>s.set(a)),s}static accessor(r){const s=(this[Qi]=this[Qi]={accessors:{}}).accessors,a=this.prototype;function o(i){const c=Cn(i);s[c]||(zx(a,i),s[c]=!0)}return L.isArray(r)?r.forEach(o):o(r),this}};At.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);L.reduceDescriptors(At.prototype,({value:t},r)=>{let n=r[0].toUpperCase()+r.slice(1);return{get:()=>t,set(s){this[n]=s}}});L.freezeMethods(At);function Ao(t,r){const n=this||ga,s=r||n,a=At.from(s.headers);let o=s.data;return L.forEach(t,function(c){o=c.call(n,o,a.normalize(),r?r.status:void 0)}),a.normalize(),o}function Ud(t){return!!(t&&t.__CANCEL__)}function ln(t,r,n){Re.call(this,t??"canceled",Re.ERR_CANCELED,r,n),this.name="CanceledError"}L.inherits(ln,Re,{__CANCEL__:!0});function Hd(t,r,n){const s=n.config.validateStatus;!n.status||!s||s(n.status)?t(n):r(new Re("Request failed with status code "+n.status,[Re.ERR_BAD_REQUEST,Re.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}function Ox(t){const r=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return r&&r[1]||""}function Fx(t,r){t=t||10;const n=new Array(t),s=new Array(t);let a=0,o=0,i;return r=r!==void 0?r:1e3,function(u){const d=Date.now(),f=s[o];i||(i=d),n[a]=u,s[a]=d;let p=o,g=0;for(;p!==a;)g+=n[p++],p=p%t;if(a=(a+1)%t,a===o&&(o=(o+1)%t),d-i<r)return;const m=f&&d-f;return m?Math.round(g*1e3/m):void 0}}function Lx(t,r){let n=0,s=1e3/r,a,o;const i=(d,f=Date.now())=>{n=f,a=null,o&&(clearTimeout(o),o=null),t(...d)};return[(...d)=>{const f=Date.now(),p=f-n;p>=s?i(d,f):(a=d,o||(o=setTimeout(()=>{o=null,i(a)},s-p)))},()=>a&&i(a)]}const Ga=(t,r,n=3)=>{let s=0;const a=Fx(50,250);return Lx(o=>{const i=o.loaded,c=o.lengthComputable?o.total:void 0,u=i-s,d=a(u),f=i<=c;s=i;const p={loaded:i,total:c,progress:c?i/c:void 0,bytes:u,rate:d||void 0,estimated:d&&c&&f?(c-i)/d:void 0,event:o,lengthComputable:c!=null,[r?"download":"upload"]:!0};t(p)},n)},Ki=(t,r)=>{const n=t!=null;return[s=>r[0]({lengthComputable:n,total:t,loaded:s}),r[1]]},Xi=t=>(...r)=>L.asap(()=>t(...r)),Wx=mt.hasStandardBrowserEnv?((t,r)=>n=>(n=new URL(n,mt.origin),t.protocol===n.protocol&&t.host===n.host&&(r||t.port===n.port)))(new URL(mt.origin),mt.navigator&&/(msie|trident)/i.test(mt.navigator.userAgent)):()=>!0,$x=mt.hasStandardBrowserEnv?{write(t,r,n,s,a,o,i){if(typeof document>"u")return;const c=[`${t}=${encodeURIComponent(r)}`];L.isNumber(n)&&c.push(`expires=${new Date(n).toUTCString()}`),L.isString(s)&&c.push(`path=${s}`),L.isString(a)&&c.push(`domain=${a}`),o===!0&&c.push("secure"),L.isString(i)&&c.push(`SameSite=${i}`),document.cookie=c.join("; ")},read(t){if(typeof document>"u")return null;const r=document.cookie.match(new RegExp("(?:^|; )"+t+"=([^;]*)"));return r?decodeURIComponent(r[1]):null},remove(t){this.write(t,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function Bx(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function qx(t,r){return r?t.replace(/\/?\/$/,"")+"/"+r.replace(/^\/+/,""):t}function Vd(t,r,n){let s=!Bx(r);return t&&(s||n==!1)?qx(t,r):r}const Ji=t=>t instanceof At?{...t}:t;function zr(t,r){r=r||{};const n={};function s(d,f,p,g){return L.isPlainObject(d)&&L.isPlainObject(f)?L.merge.call({caseless:g},d,f):L.isPlainObject(f)?L.merge({},f):L.isArray(f)?f.slice():f}function a(d,f,p,g){if(L.isUndefined(f)){if(!L.isUndefined(d))return s(void 0,d,p,g)}else return s(d,f,p,g)}function o(d,f){if(!L.isUndefined(f))return s(void 0,f)}function i(d,f){if(L.isUndefined(f)){if(!L.isUndefined(d))return s(void 0,d)}else return s(void 0,f)}function c(d,f,p){if(p in r)return s(d,f);if(p in t)return s(void 0,d)}const u={url:o,method:o,data:o,baseURL:i,transformRequest:i,transformResponse:i,paramsSerializer:i,timeout:i,timeoutMessage:i,withCredentials:i,withXSRFToken:i,adapter:i,responseType:i,xsrfCookieName:i,xsrfHeaderName:i,onUploadProgress:i,onDownloadProgress:i,decompress:i,maxContentLength:i,maxBodyLength:i,beforeRedirect:i,transport:i,httpAgent:i,httpsAgent:i,cancelToken:i,socketPath:i,responseEncoding:i,validateStatus:c,headers:(d,f,p)=>a(Ji(d),Ji(f),p,!0)};return L.forEach(Object.keys({...t,...r}),function(f){const p=u[f]||a,g=p(t[f],r[f],f);L.isUndefined(g)&&p!==c||(n[f]=g)}),n}const Yd=t=>{const r=zr({},t);let{data:n,withXSRFToken:s,xsrfHeaderName:a,xsrfCookieName:o,headers:i,auth:c}=r;if(r.headers=i=At.from(i),r.url=Bd(Vd(r.baseURL,r.url,r.allowAbsoluteUrls),t.params,t.paramsSerializer),c&&i.set("Authorization","Basic "+btoa((c.username||"")+":"+(c.password?unescape(encodeURIComponent(c.password)):""))),L.isFormData(n)){if(mt.hasStandardBrowserEnv||mt.hasStandardBrowserWebWorkerEnv)i.setContentType(void 0);else if(L.isFunction(n.getHeaders)){const u=n.getHeaders(),d=["content-type","content-length"];Object.entries(u).forEach(([f,p])=>{d.includes(f.toLowerCase())&&i.set(f,p)})}}if(mt.hasStandardBrowserEnv&&(s&&L.isFunction(s)&&(s=s(r)),s||s!==!1&&Wx(r.url))){const u=a&&o&&$x.read(o);u&&i.set(a,u)}return r},Nx=typeof XMLHttpRequest<"u",Ux=Nx&&function(t){return new Promise(function(n,s){const a=Yd(t);let o=a.data;const i=At.from(a.headers).normalize();let{responseType:c,onUploadProgress:u,onDownloadProgress:d}=a,f,p,g,m,y;function j(){m&&m(),y&&y(),a.cancelToken&&a.cancelToken.unsubscribe(f),a.signal&&a.signal.removeEventListener("abort",f)}let C=new XMLHttpRequest;C.open(a.method.toUpperCase(),a.url,!0),C.timeout=a.timeout;function w(){if(!C)return;const v=At.from("getAllResponseHeaders"in C&&C.getAllResponseHeaders()),A={data:!c||c==="text"||c==="json"?C.responseText:C.response,status:C.status,statusText:C.statusText,headers:v,config:t,request:C};Hd(function(P){n(P),j()},function(P){s(P),j()},A),C=null}"onloadend"in C?C.onloadend=w:C.onreadystatechange=function(){!C||C.readyState!==4||C.status===0&&!(C.responseURL&&C.responseURL.indexOf("file:")===0)||setTimeout(w)},C.onabort=function(){C&&(s(new Re("Request aborted",Re.ECONNABORTED,t,C)),C=null)},C.onerror=function(S){const A=S&&S.message?S.message:"Network Error",E=new Re(A,Re.ERR_NETWORK,t,C);E.event=S||null,s(E),C=null},C.ontimeout=function(){let S=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const A=a.transitional||qd;a.timeoutErrorMessage&&(S=a.timeoutErrorMessage),s(new Re(S,A.clarifyTimeoutError?Re.ETIMEDOUT:Re.ECONNABORTED,t,C)),C=null},o===void 0&&i.setContentType(null),"setRequestHeader"in C&&L.forEach(i.toJSON(),function(S,A){C.setRequestHeader(A,S)}),L.isUndefined(a.withCredentials)||(C.withCredentials=!!a.withCredentials),c&&c!=="json"&&(C.responseType=a.responseType),d&&([g,y]=Ga(d,!0),C.addEventListener("progress",g)),u&&C.upload&&([p,m]=Ga(u),C.upload.addEventListener("progress",p),C.upload.addEventListener("loadend",m)),(a.cancelToken||a.signal)&&(f=v=>{C&&(s(!v||v.type?new ln(null,t,C):v),C.abort(),C=null)},a.cancelToken&&a.cancelToken.subscribe(f),a.signal&&(a.signal.aborted?f():a.signal.addEventListener("abort",f)));const b=Ox(a.url);if(b&&mt.protocols.indexOf(b)===-1){s(new Re("Unsupported protocol "+b+":",Re.ERR_BAD_REQUEST,t));return}C.send(o||null)})},Hx=(t,r)=>{const{length:n}=t=t?t.filter(Boolean):[];if(r||n){let s=new AbortController,a;const o=function(d){if(!a){a=!0,c();const f=d instanceof Error?d:this.reason;s.abort(f instanceof Re?f:new ln(f instanceof Error?f.message:f))}};let i=r&&setTimeout(()=>{i=null,o(new Re(`timeout ${r} of ms exceeded`,Re.ETIMEDOUT))},r);const c=()=>{t&&(i&&clearTimeout(i),i=null,t.forEach(d=>{d.unsubscribe?d.unsubscribe(o):d.removeEventListener("abort",o)}),t=null)};t.forEach(d=>d.addEventListener("abort",o));const{signal:u}=s;return u.unsubscribe=()=>L.asap(c),u}},Vx=function*(t,r){let n=t.byteLength;if(n<r){yield t;return}let s=0,a;for(;s<n;)a=s+r,yield t.slice(s,a),s=a},Yx=async function*(t,r){for await(const n of Gx(t))yield*Vx(n,r)},Gx=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const r=t.getReader();try{for(;;){const{done:n,value:s}=await r.read();if(n)break;yield s}}finally{await r.cancel()}},Zi=(t,r,n,s)=>{const a=Yx(t,r);let o=0,i,c=u=>{i||(i=!0,s&&s(u))};return new ReadableStream({async pull(u){try{const{done:d,value:f}=await a.next();if(d){c(),u.close();return}let p=f.byteLength;if(n){let g=o+=p;n(g)}u.enqueue(new Uint8Array(f))}catch(d){throw c(d),d}},cancel(u){return c(u),a.return()}},{highWaterMark:2})},el=64*1024,{isFunction:Ma}=L,Qx=(({Request:t,Response:r})=>({Request:t,Response:r}))(L.global),{ReadableStream:tl,TextEncoder:rl}=L.global,nl=(t,...r)=>{try{return!!t(...r)}catch{return!1}},Kx=t=>{t=L.merge.call({skipUndefined:!0},Qx,t);const{fetch:r,Request:n,Response:s}=t,a=r?Ma(r):typeof fetch=="function",o=Ma(n),i=Ma(s);if(!a)return!1;const c=a&&Ma(tl),u=a&&(typeof rl=="function"?(y=>j=>y.encode(j))(new rl):async y=>new Uint8Array(await new n(y).arrayBuffer())),d=o&&c&&nl(()=>{let y=!1;const j=new n(mt.origin,{body:new tl,method:"POST",get duplex(){return y=!0,"half"}}).headers.has("Content-Type");return y&&!j}),f=i&&c&&nl(()=>L.isReadableStream(new s("").body)),p={stream:f&&(y=>y.body)};a&&["text","arrayBuffer","blob","formData","stream"].forEach(y=>{!p[y]&&(p[y]=(j,C)=>{let w=j&&j[y];if(w)return w.call(j);throw new Re(`Response type '${y}' is not supported`,Re.ERR_NOT_SUPPORT,C)})});const g=async y=>{if(y==null)return 0;if(L.isBlob(y))return y.size;if(L.isSpecCompliantForm(y))return(await new n(mt.origin,{method:"POST",body:y}).arrayBuffer()).byteLength;if(L.isArrayBufferView(y)||L.isArrayBuffer(y))return y.byteLength;if(L.isURLSearchParams(y)&&(y=y+""),L.isString(y))return(await u(y)).byteLength},m=async(y,j)=>{const C=L.toFiniteNumber(y.getContentLength());return C??g(j)};return async y=>{let{url:j,method:C,data:w,signal:b,cancelToken:v,timeout:S,onDownloadProgress:A,onUploadProgress:E,responseType:P,headers:k,withCredentials:R="same-origin",fetchOptions:z}=Yd(y),B=r||fetch;P=P?(P+"").toLowerCase():"text";let F=Hx([b,v&&v.toAbortSignal()],S),W=null;const H=F&&F.unsubscribe&&(()=>{F.unsubscribe()});let I;try{if(E&&d&&C!=="get"&&C!=="head"&&(I=await m(k,w))!==0){let M=new n(j,{method:"POST",body:w,duplex:"half"}),T;if(L.isFormData(w)&&(T=M.headers.get("content-type"))&&k.setContentType(T),M.body){const[te,$]=Ki(I,Ga(Xi(E)));w=Zi(M.body,el,te,$)}}L.isString(R)||(R=R?"include":"omit");const _=o&&"credentials"in n.prototype,O={...z,signal:F,method:C.toUpperCase(),headers:k.normalize().toJSON(),body:w,duplex:"half",credentials:_?R:void 0};W=o&&new n(j,O);let D=await(o?B(W,z):B(j,O));const Q=f&&(P==="stream"||P==="response");if(f&&(A||Q&&H)){const M={};["status","statusText","headers"].forEach(U=>{M[U]=D[U]});const T=L.toFiniteNumber(D.headers.get("content-length")),[te,$]=A&&Ki(T,Ga(Xi(A),!0))||[];D=new s(Zi(D.body,el,te,()=>{$&&$(),H&&H()}),M)}P=P||"text";let J=await p[L.findKey(p,P)||"text"](D,y);return!Q&&H&&H(),await new Promise((M,T)=>{Hd(M,T,{data:J,headers:At.from(D.headers),status:D.status,statusText:D.statusText,config:y,request:W})})}catch(_){throw H&&H(),_&&_.name==="TypeError"&&/Load failed|fetch/i.test(_.message)?Object.assign(new Re("Network Error",Re.ERR_NETWORK,y,W),{cause:_.cause||_}):Re.from(_,_&&_.code,y,W)}}},Xx=new Map,Gd=t=>{let r=t&&t.env||{};const{fetch:n,Request:s,Response:a}=r,o=[s,a,n];let i=o.length,c=i,u,d,f=Xx;for(;c--;)u=o[c],d=f.get(u),d===void 0&&f.set(u,d=c?new Map:Kx(r)),f=d;return d};Gd();const ui={http:xx,xhr:Ux,fetch:{get:Gd}};L.forEach(ui,(t,r)=>{if(t){try{Object.defineProperty(t,"name",{value:r})}catch{}Object.defineProperty(t,"adapterName",{value:r})}});const sl=t=>`- ${t}`,Jx=t=>L.isFunction(t)||t===null||t===!1;function Zx(t,r){t=L.isArray(t)?t:[t];const{length:n}=t;let s,a;const o={};for(let i=0;i<n;i++){s=t[i];let c;if(a=s,!Jx(s)&&(a=ui[(c=String(s)).toLowerCase()],a===void 0))throw new Re(`Unknown adapter '${c}'`);if(a&&(L.isFunction(a)||(a=a.get(r))))break;o[c||"#"+i]=a}if(!a){const i=Object.entries(o).map(([u,d])=>`adapter ${u} `+(d===!1?"is not supported by the environment":"is not available in the build"));let c=n?i.length>1?`since :
`+i.map(sl).join(`
`):" "+sl(i[0]):"as no adapter specified";throw new Re("There is no suitable adapter to dispatch the request "+c,"ERR_NOT_SUPPORT")}return a}const Qd={getAdapter:Zx,adapters:ui};function Po(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new ln(null,t)}function al(t){return Po(t),t.headers=At.from(t.headers),t.data=Ao.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),Qd.getAdapter(t.adapter||ga.adapter,t)(t).then(function(s){return Po(t),s.data=Ao.call(t,t.transformResponse,s),s.headers=At.from(s.headers),s},function(s){return Ud(s)||(Po(t),s&&s.response&&(s.response.data=Ao.call(t,t.transformResponse,s.response),s.response.headers=At.from(s.response.headers))),Promise.reject(s)})}const Kd="1.13.2",uo={};["object","boolean","number","function","string","symbol"].forEach((t,r)=>{uo[t]=function(s){return typeof s===t||"a"+(r<1?"n ":" ")+t}});const ol={};uo.transitional=function(r,n,s){function a(o,i){return"[Axios v"+Kd+"] Transitional option '"+o+"'"+i+(s?". "+s:"")}return(o,i,c)=>{if(r===!1)throw new Re(a(i," has been removed"+(n?" in "+n:"")),Re.ERR_DEPRECATED);return n&&!ol[i]&&(ol[i]=!0,console.warn(a(i," has been deprecated since v"+n+" and will be removed in the near future"))),r?r(o,i,c):!0}};uo.spelling=function(r){return(n,s)=>(console.warn(`${s} is likely a misspelling of ${r}`),!0)};function ep(t,r,n){if(typeof t!="object")throw new Re("options must be an object",Re.ERR_BAD_OPTION_VALUE);const s=Object.keys(t);let a=s.length;for(;a-- >0;){const o=s[a],i=r[o];if(i){const c=t[o],u=c===void 0||i(c,o,t);if(u!==!0)throw new Re("option "+o+" must be "+u,Re.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new Re("Unknown option "+o,Re.ERR_BAD_OPTION)}}const qa={assertOptions:ep,validators:uo},er=qa.validators;let Dr=class{constructor(r){this.defaults=r||{},this.interceptors={request:new Gi,response:new Gi}}async request(r,n){try{return await this._request(r,n)}catch(s){if(s instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const o=a.stack?a.stack.replace(/^.+\n/,""):"";try{s.stack?o&&!String(s.stack).endsWith(o.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+o):s.stack=o}catch{}}throw s}}_request(r,n){typeof r=="string"?(n=n||{},n.url=r):n=r||{},n=zr(this.defaults,n);const{transitional:s,paramsSerializer:a,headers:o}=n;s!==void 0&&qa.assertOptions(s,{silentJSONParsing:er.transitional(er.boolean),forcedJSONParsing:er.transitional(er.boolean),clarifyTimeoutError:er.transitional(er.boolean)},!1),a!=null&&(L.isFunction(a)?n.paramsSerializer={serialize:a}:qa.assertOptions(a,{encode:er.function,serialize:er.function},!0)),n.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?n.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:n.allowAbsoluteUrls=!0),qa.assertOptions(n,{baseUrl:er.spelling("baseURL"),withXsrfToken:er.spelling("withXSRFToken")},!0),n.method=(n.method||this.defaults.method||"get").toLowerCase();let i=o&&L.merge(o.common,o[n.method]);o&&L.forEach(["delete","get","head","post","put","patch","common"],y=>{delete o[y]}),n.headers=At.concat(i,o);const c=[];let u=!0;this.interceptors.request.forEach(function(j){typeof j.runWhen=="function"&&j.runWhen(n)===!1||(u=u&&j.synchronous,c.unshift(j.fulfilled,j.rejected))});const d=[];this.interceptors.response.forEach(function(j){d.push(j.fulfilled,j.rejected)});let f,p=0,g;if(!u){const y=[al.bind(this),void 0];for(y.unshift(...c),y.push(...d),g=y.length,f=Promise.resolve(n);p<g;)f=f.then(y[p++],y[p++]);return f}g=c.length;let m=n;for(;p<g;){const y=c[p++],j=c[p++];try{m=y(m)}catch(C){j.call(this,C);break}}try{f=al.call(this,m)}catch(y){return Promise.reject(y)}for(p=0,g=d.length;p<g;)f=f.then(d[p++],d[p++]);return f}getUri(r){r=zr(this.defaults,r);const n=Vd(r.baseURL,r.url,r.allowAbsoluteUrls);return Bd(n,r.params,r.paramsSerializer)}};L.forEach(["delete","get","head","options"],function(r){Dr.prototype[r]=function(n,s){return this.request(zr(s||{},{method:r,url:n,data:(s||{}).data}))}});L.forEach(["post","put","patch"],function(r){function n(s){return function(o,i,c){return this.request(zr(c||{},{method:r,headers:s?{"Content-Type":"multipart/form-data"}:{},url:o,data:i}))}}Dr.prototype[r]=n(),Dr.prototype[r+"Form"]=n(!0)});let tp=class Xd{constructor(r){if(typeof r!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(o){n=o});const s=this;this.promise.then(a=>{if(!s._listeners)return;let o=s._listeners.length;for(;o-- >0;)s._listeners[o](a);s._listeners=null}),this.promise.then=a=>{let o;const i=new Promise(c=>{s.subscribe(c),o=c}).then(a);return i.cancel=function(){s.unsubscribe(o)},i},r(function(o,i,c){s.reason||(s.reason=new ln(o,i,c),n(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(r){if(this.reason){r(this.reason);return}this._listeners?this._listeners.push(r):this._listeners=[r]}unsubscribe(r){if(!this._listeners)return;const n=this._listeners.indexOf(r);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const r=new AbortController,n=s=>{r.abort(s)};return this.subscribe(n),r.signal.unsubscribe=()=>this.unsubscribe(n),r.signal}static source(){let r;return{token:new Xd(function(a){r=a}),cancel:r}}};function rp(t){return function(n){return t.apply(null,n)}}function np(t){return L.isObject(t)&&t.isAxiosError===!0}const Xo={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(Xo).forEach(([t,r])=>{Xo[r]=t});function Jd(t){const r=new Dr(t),n=Ad(Dr.prototype.request,r);return L.extend(n,Dr.prototype,r,{allOwnKeys:!0}),L.extend(n,r,null,{allOwnKeys:!0}),n.create=function(a){return Jd(zr(t,a))},n}const Ne=Jd(ga);Ne.Axios=Dr;Ne.CanceledError=ln;Ne.CancelToken=tp;Ne.isCancel=Ud;Ne.VERSION=Kd;Ne.toFormData=co;Ne.AxiosError=Re;Ne.Cancel=Ne.CanceledError;Ne.all=function(r){return Promise.all(r)};Ne.spread=rp;Ne.isAxiosError=np;Ne.mergeConfig=zr;Ne.AxiosHeaders=At;Ne.formToJSON=t=>Nd(L.isHTMLForm(t)?new FormData(t):t);Ne.getAdapter=Qd.getAdapter;Ne.HttpStatusCode=Xo;Ne.default=Ne;const{Axios:nj,AxiosError:sj,CanceledError:aj,isCancel:oj,CancelToken:ij,VERSION:lj,all:cj,Cancel:dj,isAxiosError:uj,spread:hj,toFormData:fj,AxiosHeaders:xj,HttpStatusCode:pj,formToJSON:mj,getAdapter:gj,mergeConfig:yj}=Ne;function sp(t){const n=`; ${document.cookie}`.split(`; ${t}=`);return n.length===2&&n.pop()?.split(";").shift()||null}const V=Ne.create({baseURL:"/api",headers:{"Content-Type":"application/json"},withCredentials:!0});V.interceptors.request.use(t=>{const r=localStorage.getItem("token");if(r&&(t.headers.Authorization=`Token ${r}`),t.method&&!["get","head","options"].includes(t.method.toLowerCase())){const n=sp("csrftoken");n&&(t.headers["X-CSRFToken"]=n)}return t});V.interceptors.response.use(t=>t,t=>{if(t.response?.status===401){const r=t.response?.data?.detail||t.response?.data?.error||"";(r.includes("expired")||r.includes("Invalid token"))&&(localStorage.removeItem("token"),window.dispatchEvent(new CustomEvent("token-expired",{detail:{message:"Your session has expired. Please log in again."}})))}return Promise.reject(t)});const kt={list:t=>V.get("/audio/list/",{params:t}),get:t=>V.get(`/audio/${t}/`),delete:t=>V.delete(`/audio/${t}/`),download:t=>V.post(`/audio/${t}/`,{action:"download"}),toggleFavorite:t=>V.post(`/audio/${t}/`,{action:"toggle_favorite"}),downloadFile:async t=>{const r=localStorage.getItem("token"),n=await fetch(`/api/audio/${t}/download/`,{headers:{Authorization:`Token ${r}`}});if(!n.ok)throw new Error("Download failed");return await n.blob()},getPlayer:t=>V.get(`/audio/${t}/player/`),updateProgress:(t,r)=>V.post(`/audio/${t}/progress/`,r),getLyrics:t=>V.get(`/audio/${t}/lyrics/`),fetchLyrics:(t,r)=>V.post(`/audio/${t}/lyrics/fetch/`,{force:r}),updateLyrics:(t,r)=>V.put(`/audio/${t}/lyrics/`,r),deleteLyrics:t=>V.delete(`/audio/${t}/lyrics/`),uploadLrcFile:(t,r)=>{const n=new FormData;return n.append("lrc_file",r),V.post(`/audio/${t}/lyrics/upload/`,n,{headers:{"Content-Type":"multipart/form-data"}})},fetchBatchLyrics:t=>V.post("/audio/lyrics/fetch_batch/",{youtube_ids:t}),fetchAllMissingLyrics:t=>V.post("/audio/lyrics/fetch_all_missing/",{limit:t}),getLyricsStats:()=>V.get("/audio/lyrics/stats/"),getRecommendations:t=>V.get(`/audio/${t}/recommendations/`),getSimilarTracks:t=>V.get(`/audio/${t}/similar/`),searchMetadata:(t,r)=>V.get(`/audio/${t}/metadata/search/`,{params:r}),applyMetadata:(t,r)=>V.post(`/audio/${t}/metadata/apply/`,r),autoFetchMetadata:t=>V.post(`/audio/${t}/metadata/auto/`)},Jr={list:t=>V.get("/channel/",{params:t}),get:t=>V.get(`/channel/${t}/`),subscribe:t=>V.post("/channel/",t),unsubscribe:t=>V.delete(`/channel/${t}/`)},Qt={list:t=>V.get("/playlist/",{params:t}),get:t=>V.get(`/playlist/${t}/`),getWithItems:t=>V.get(`/playlist/${t}/`,{params:{include_items:"true"}}),create:t=>V.post("/playlist/",t),delete:t=>V.delete(`/playlist/${t}/`),download:t=>V.post(`/playlist/${t}/`,{action:"download"}),getItems:t=>V.get(`/playlist/${t}/items/`),addItem:(t,r)=>V.post(`/playlist/${t}/items/`,{youtube_id:r}),removeItem:(t,r)=>V.delete(`/playlist/${t}/items/`,{data:{youtube_id:r}}),findContaining:t=>V.get(`/playlist/containing/${t}/`)},rr={list:()=>V.get("/playlist/smart/"),get:t=>V.get(`/playlist/smart/${t}/`),getWithTracks:t=>V.get(`/playlist/smart/${t}/`,{params:{include_tracks:"true"}}),getTracks:(t,r)=>V.get(`/playlist/smart/${t}/tracks/`,{params:r}),create:t=>V.post("/playlist/smart/",t),update:(t,r)=>V.put(`/playlist/smart/${t}/`,r),delete:t=>V.delete(`/playlist/smart/${t}/`),getChoices:()=>V.get("/playlist/smart/choices/"),preview:t=>V.post("/playlist/smart/preview/",t),getRules:t=>V.get(`/playlist/smart/${t}/rules/`),addRule:(t,r)=>V.post(`/playlist/smart/${t}/rules/`,r),setRules:(t,r)=>V.put(`/playlist/smart/${t}/rules/`,{rules:r})},Kt={audio:()=>V.get("/stats/audio/"),channel:()=>V.get("/stats/channel/"),download:()=>V.get("/stats/download/"),insights:t=>V.get("/stats/insights/",{params:t?{days:t}:{}}),recordListening:t=>V.post("/stats/record/",t),history:t=>V.get("/stats/history/",{params:t}),clearHistory:t=>V.delete("/stats/history/",{params:t?{days:t}:{}}),onThisDay:()=>V.get("/stats/on-this-day/"),achievements:t=>V.get("/stats/achievements/",{params:t}),checkAchievements:()=>V.post("/stats/achievements/"),markAchievementsSeen:t=>V.patch("/stats/achievements/",t?{ids:t}:{all:!0}),streak:()=>V.get("/stats/streak/"),yearlyWrapped:t=>V.get("/stats/wrapped/",{params:t?{year:t}:{}}),homepage:()=>V.get("/stats/homepage/"),clearContinueListening:()=>V.delete("/stats/homepage/")},_r={login:t=>V.post("/user/login/",t),logout:()=>V.post("/user/logout/"),account:()=>V.get("/user/account/"),config:()=>V.get("/user/config/"),updateConfig:t=>V.post("/user/config/",t),twoFactorStatus:()=>V.get("/user/2fa/status/"),twoFactorSetup:()=>V.post("/user/2fa/setup/"),twoFactorVerify:t=>V.post("/user/2fa/verify/",t),twoFactorDisable:t=>V.post("/user/2fa/disable/",t),twoFactorRegenerateCodes:()=>V.post("/user/2fa/regenerate-codes/"),twoFactorDownloadCodes:()=>V.get("/user/2fa/download-codes/",{responseType:"blob"})},Na={getSession:()=>V.get("/playback-sync/"),checkStatus:()=>V.get("/playback-sync/status/"),syncPlayback:t=>V.post("/playback-sync/",t),clearSession:()=>V.delete("/playback-sync/")},ur={start:t=>V.post("/radio/start/",t),stop:()=>V.post("/radio/stop/"),status:()=>V.get("/radio/status/"),next:()=>V.get("/radio/next/"),skip:t=>V.post("/radio/skip/",t),like:t=>V.post("/radio/like/",t),getSettings:()=>V.get("/radio/settings/"),updateSettings:t=>V.post("/radio/settings/",t)};function ap({onLoginSuccess:t}){const[r,n]=l.useState(""),[s,a]=l.useState(""),[o,i]=l.useState(!1),[c,u]=l.useState(!1),[d,f]=l.useState(""),[p,g]=l.useState(!1),[m,y]=l.useState(""),[j,C]=l.useState(!1),[w,b]=l.useState(0),[v,S]=l.useState(null);l.useEffect(()=>{if(w>0){const k=setInterval(()=>{b(R=>R<=1?(C(!1),f(""),0):R-1)},1e3);return()=>clearInterval(k)}},[w]);const A=k=>{const R=Math.floor(k/60),z=k%60;return`${R}:${z.toString().padStart(2,"0")}`},E=async()=>{if(!j)try{S(null);const k=await _r.login({username:r,password:s,...p&&{two_factor_code:m}});if(k.data.requires_2fa){g(!0),f("Please enter your two-factor authentication code");return}localStorage.setItem("token",k.data.token),t()}catch(k){const R=k.response?.data;if(k.response?.status===429&&R?.locked){C(!0),b(R.remaining_seconds||3600),f(R.error||"Account temporarily locked"),S(null);return}if(R?.remaining_attempts!==void 0){S(R.remaining_attempts),f(R.message||"Invalid credentials");return}R?.requires_2fa?(g(!0),f("Please enter your two-factor authentication code")):f(R?.error||"Invalid credentials or verification code")}},P=k=>{k.key==="Enter"&&!j&&E()};return e.jsxs(h,{sx:{display:"flex",flexDirection:"column",minHeight:"100vh",width:"100vw",background:"linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%)",position:"relative",overflow:"auto"},children:[e.jsxs(h,{sx:{flex:{xs:.6,sm:1},display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:{xs:3,sm:4},paddingTop:{xs:6,sm:8}},children:[e.jsx(h,{component:"img",src:"/img/logo.png",alt:"SoundWave Logo",sx:{width:{xs:180,sm:220},height:{xs:180,sm:220},borderRadius:"50%",mb:3,boxShadow:"0 20px 60px rgba(34, 211, 238, 0.3)",border:"4px solid rgba(34, 211, 238, 0.2)",position:"relative",animation:"pulse 2s ease-in-out infinite","@keyframes pulse":{"0%, 100%":{transform:"scale(1)",boxShadow:"0 20px 60px rgba(34, 211, 238, 0.3)"},"50%":{transform:"scale(1.05)",boxShadow:"0 25px 70px rgba(34, 211, 238, 0.5)"}}}}),e.jsx(x,{sx:{fontSize:{xs:"2.5rem",sm:"3.5rem"},fontWeight:800,letterSpacing:"-0.03em",color:"#22d3ee",textAlign:"center",textShadow:"0 4px 20px rgba(34, 211, 238, 0.4)",mb:1},children:"SoundWave"}),e.jsx(x,{sx:{fontSize:{xs:"0.9rem",sm:"1rem"},color:"#94a3b8",textAlign:"center",fontWeight:500},children:"Your Personal Music Hub"})]}),e.jsx(h,{sx:{flex:{xs:1,sm:1.2},backgroundColor:"rgba(30, 41, 59, 0.8)",backdropFilter:"blur(20px)",borderTopLeftRadius:{xs:32,sm:40},borderTopRightRadius:{xs:32,sm:40},padding:{xs:3,sm:4},paddingTop:{xs:4,sm:5},display:"flex",flexDirection:"column",alignItems:"center",border:"1px solid rgba(34, 211, 238, 0.1)",borderBottom:"none"},children:e.jsxs(h,{sx:{width:"100%",maxWidth:{xs:"100%",sm:420},padding:{xs:0,sm:2}},children:[e.jsx(x,{variant:"h4",sx:{color:"#f8fafc",fontWeight:700,marginBottom:{xs:3,sm:4},fontSize:{xs:"1.5rem",sm:"1.75rem"},textAlign:"center"},children:"Welcome Back"}),e.jsx(Ce,{fullWidth:!0,placeholder:"Username",value:r,onChange:k=>n(k.target.value),onKeyPress:P,autoFocus:!0,sx:{marginBottom:2,"& .MuiOutlinedInput-root":{backgroundColor:"rgba(15, 23, 42, 0.6)",borderRadius:3,boxShadow:"0 2px 8px rgba(0, 0, 0, 0.3)","& fieldset":{borderColor:"rgba(34, 211, 238, 0.2)",borderWidth:2},"&:hover fieldset":{borderColor:"rgba(34, 211, 238, 0.4)"},"&.Mui-focused fieldset":{borderColor:"#22d3ee",borderWidth:2}},"& .MuiOutlinedInput-input":{padding:{xs:"14px 16px",sm:"16px 18px"},fontSize:"0.95rem",color:"#f8fafc"}},InputProps:{startAdornment:e.jsx(nr,{position:"start",children:e.jsx(pf,{sx:{color:"#94a3b8",fontSize:22}})})}}),e.jsx(Ce,{fullWidth:!0,type:o?"text":"password",placeholder:"Password",value:s,onChange:k=>a(k.target.value),onKeyPress:P,sx:{marginBottom:1.5,"& .MuiOutlinedInput-root":{backgroundColor:"rgba(15, 23, 42, 0.6)",borderRadius:3,boxShadow:"0 2px 8px rgba(0, 0, 0, 0.3)","& fieldset":{borderColor:"rgba(34, 211, 238, 0.2)",borderWidth:2},"&:hover fieldset":{borderColor:"rgba(34, 211, 238, 0.4)"},"&.Mui-focused fieldset":{borderColor:"#22d3ee",borderWidth:2}},"& .MuiOutlinedInput-input":{padding:{xs:"14px 16px",sm:"16px 18px"},fontSize:"0.95rem",color:"#f8fafc"}},InputProps:{startAdornment:e.jsx(nr,{position:"start",children:e.jsx(Wi,{sx:{color:"#94a3b8",fontSize:22}})}),endAdornment:e.jsx(nr,{position:"end",children:e.jsx(X,{onClick:()=>i(!o),edge:"end",sx:{backgroundColor:"rgba(34, 211, 238, 0.2)",borderRadius:"50%",width:36,height:36,"&:hover":{backgroundColor:"rgba(34, 211, 238, 0.3)"}},children:o?e.jsx(Sf,{sx:{color:"#22d3ee",fontSize:18}}):e.jsx(vf,{sx:{color:"#22d3ee",fontSize:18}})})})}}),p&&e.jsx(Ce,{fullWidth:!0,placeholder:"Two-Factor Code",value:m,onChange:k=>y(k.target.value),onKeyPress:P,autoFocus:!0,inputProps:{maxLength:6},sx:{marginBottom:1.5,"& .MuiOutlinedInput-root":{backgroundColor:"rgba(15, 23, 42, 0.6)",borderRadius:3,boxShadow:"0 2px 8px rgba(0, 0, 0, 0.3)","& fieldset":{borderColor:"rgba(34, 211, 238, 0.2)",borderWidth:2},"&:hover fieldset":{borderColor:"rgba(34, 211, 238, 0.4)"},"&.Mui-focused fieldset":{borderColor:"#22d3ee",borderWidth:2}},"& .MuiOutlinedInput-input":{padding:"14px 16px",fontSize:"0.95rem",color:"#f8fafc",textAlign:"center",letterSpacing:"0.5em"}},InputProps:{startAdornment:e.jsx(nr,{position:"start",children:e.jsx(Wi,{sx:{color:"#94a3b8",fontSize:22}})})}}),e.jsx(We,{control:e.jsx(qo,{checked:c,onChange:k=>u(k.target.checked),sx:{color:"#475569","&.Mui-checked":{color:"#22d3ee"}}}),label:e.jsx(x,{sx:{color:"#94a3b8",fontSize:"0.9rem"},children:"Remember Password"}),sx:{marginBottom:{xs:2.5,sm:3}}}),e.jsx(N,{fullWidth:!0,variant:"contained",onClick:E,sx:{background:"linear-gradient(135deg, #22d3ee 0%, #06b6d4 100%)",color:"#0f172a",padding:{xs:"14px",sm:"16px"},borderRadius:3,fontSize:"0.95rem",fontWeight:700,textTransform:"uppercase",letterSpacing:"0.5px",boxShadow:"0 4px 20px rgba(34, 211, 238, 0.4)",border:"1px solid rgba(34, 211, 238, 0.3)","&:hover":{background:"linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)",boxShadow:"0 6px 30px rgba(34, 211, 238, 0.6)",transform:"translateY(-2px)"},transition:"all 0.3s ease","&:disabled":{backgroundColor:"rgba(100, 100, 100, 0.5)",color:"rgba(255, 255, 255, 0.5)"}},endIcon:j?e.jsx(Ui,{}):e.jsx(_f,{}),disabled:j,children:j?`Locked (${A(w)})`:"Login"}),j&&e.jsxs(pe,{severity:"error",icon:e.jsx(Ui,{}),sx:{mt:2,backgroundColor:"rgba(239, 68, 68, 0.15)",border:"1px solid rgba(239, 68, 68, 0.3)","& .MuiAlert-icon":{color:"#ef4444"}},children:[e.jsx(x,{variant:"body2",fontWeight:600,children:"Account Temporarily Locked"}),e.jsxs(x,{variant:"caption",children:["Too many failed login attempts. Please wait ",A(w)," before trying again."]})]}),!j&&v!==null&&e.jsxs(pe,{severity:v<=1?"error":"warning",sx:{mt:2,backgroundColor:v<=1?"rgba(239, 68, 68, 0.15)":"rgba(251, 191, 36, 0.15)",border:v<=1?"1px solid rgba(239, 68, 68, 0.3)":"1px solid rgba(251, 191, 36, 0.3)"},children:[e.jsx(x,{variant:"body2",fontWeight:600,children:v<=1?" Last Attempt!":"Invalid Credentials"}),e.jsx(x,{variant:"caption",children:v===0?"Account will be locked on next failed attempt.":`${v} attempt${v!==1?"s":""} remaining before your account is locked for 60 minutes.`})]}),d&&!j&&v===null&&e.jsx(x,{sx:{color:"#ef4444",fontSize:"0.875rem",marginTop:2,textAlign:"center",backgroundColor:"rgba(239, 68, 68, 0.1)",padding:"8px 12px",borderRadius:2,border:"1px solid rgba(239, 68, 68, 0.2)"},children:d})]})})]})}var kn={},il;function op(){if(il)return kn;il=1;var t=ne();Object.defineProperty(kn,"__esModule",{value:!0}),kn.default=void 0;var r=t(ae()),n=se();return kn.default=(0,r.default)((0,n.jsx)("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4z"}),"Refresh"),kn}var ip=op();const Zr=re(ip),ll={FOR_YOU:{bg:"primary.main",text:"background.paper"},DISCOVER:{bg:"#00C853",text:"#fff"},OTHER:{bg:"#2196F3",text:"#fff"},THROWBACK:{bg:"#FF5722",text:"#fff"}},lp={FOR_YOU:"FOR YOU",DISCOVER:"DISCOVER",OTHER:"OTHER",THROWBACK:"THROWBACK"},cp=t=>{const r=Math.floor(t/60),n=Math.floor(t%60);return`${r}m ${n}s left`};function dp({setCurrentAudio:t}){const r=Dt(),[n,s]=l.useState(null),[a,o]=l.useState(!0),[i,c]=l.useState(!1),u=l.useCallback(async(m=!1)=>{try{m?c(!0):o(!0);const y=await Kt.homepage();s(y.data)}catch(y){console.error("Failed to load homepage data:",y)}finally{o(!1),c(!1)}},[]);l.useEffect(()=>{u()},[u]);const d=async()=>{try{await Kt.clearContinueListening(),u()}catch(m){console.error("Failed to clear continue listening:",m)}},f=()=>{u(!0)},p=(m,y)=>{const j=Math.max(0,m.position-5),C={id:m.id,youtube_id:m.youtube_id,title:m.title,artist:m.artist,channel_name:m.channel_name,duration:m.duration,thumbnail_url:m.thumbnail_url,file_size:0,play_count:0,_initialSeek:j},w=y?.map(b=>({id:b.id,youtube_id:b.youtube_id,title:b.title,artist:b.artist,channel_name:b.channel_name,duration:b.duration,thumbnail_url:b.thumbnail_url,file_size:0,play_count:0}));t(C,w)},g=(m,y)=>{const j={id:m.id,youtube_id:m.youtube_id,title:m.title,artist:m.artist,channel_name:m.channel_name,duration:m.duration,thumbnail_url:m.thumbnail_url,file_size:0,play_count:0};t(j,y?.map(C=>({id:C.id,youtube_id:C.youtube_id,title:C.title,artist:C.artist,channel_name:C.channel_name,duration:C.duration,thumbnail_url:C.thumbnail_url,file_size:0,play_count:0})))};return a?e.jsx(h,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh"},children:e.jsx(Ie,{})}):e.jsxs(h,{sx:{pb:4},children:[n?.continue_listening&&n.continue_listening.length>0&&e.jsxs(h,{sx:{mb:5},children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2,px:.5},children:[e.jsx(x,{variant:"h6",sx:{fontWeight:700,letterSpacing:"-0.02em"},children:"Continue Listening"}),e.jsx(x,{variant:"body2",onClick:d,sx:{color:"primary.main",cursor:"pointer",fontWeight:500,"&:hover":{opacity:.8}},children:"Clear"})]}),e.jsx(h,{sx:{display:"flex",gap:2,overflowX:"auto",pb:2,"&::-webkit-scrollbar":{height:8},"&::-webkit-scrollbar-thumb":{bgcolor:"rgba(255,255,255,0.1)",borderRadius:1}},children:n.continue_listening.map(m=>e.jsxs(h,{onClick:()=>p(m,n.continue_listening),sx:{minWidth:240,maxWidth:240,p:1.5,borderRadius:3,bgcolor:y=>$e(y.palette.primary.main,.08),cursor:"pointer",display:"flex",alignItems:"center",gap:1.5,transition:"all 0.2s ease","&:hover":{bgcolor:y=>$e(y.palette.primary.main,.15),transform:"translateY(-2px)"},"& .play-button":{opacity:0,transition:"opacity 0.2s ease"},"&:hover .play-button":{opacity:1}},children:[e.jsxs(h,{sx:{position:"relative",flexShrink:0},children:[e.jsx(h,{sx:{width:56,height:56,borderRadius:2,backgroundImage:`url(${m.thumbnail_url||"/placeholder.jpg"})`,backgroundSize:"cover",backgroundPosition:"center"}}),e.jsx(X,{className:"play-button",size:"small",sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",bgcolor:"primary.main",color:"background.paper",width:32,height:32,"&:hover":{bgcolor:"primary.dark"}},children:e.jsx(gt,{sx:{fontSize:18}})})]}),e.jsxs(h,{sx:{flexGrow:1,minWidth:0},children:[e.jsx(x,{variant:"body2",noWrap:!0,sx:{fontWeight:600,mb:.25},children:m.title}),e.jsx(x,{variant:"caption",color:"text.secondary",noWrap:!0,sx:{display:"block",mb:.5},children:m.artist||m.channel_name}),e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(rt,{variant:"determinate",value:m.progress_percent,sx:{flexGrow:1,height:3,borderRadius:1,bgcolor:"rgba(255,255,255,0.1)","& .MuiLinearProgress-bar":{bgcolor:"primary.main"}}}),e.jsx(x,{variant:"caption",color:"primary.main",sx:{fontWeight:500,whiteSpace:"nowrap"},children:cp(m.time_left)})]})]})]},m.youtube_id))})]}),n?.made_for_you&&n.made_for_you.length>0&&e.jsxs(h,{sx:{mb:5},children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2,px:.5},children:[e.jsx(x,{variant:"h6",sx:{fontWeight:700,letterSpacing:"-0.02em"},children:"Made For You"}),e.jsx(ve,{title:"Refresh recommendations",children:e.jsx(X,{size:"small",onClick:f,disabled:i,sx:{color:"primary.main"},children:e.jsx(Zr,{sx:{fontSize:20,animation:i?"spin 1s linear infinite":"none"}})})})]}),e.jsx(h,{sx:{display:"flex",gap:3,overflowX:"auto",pb:2,"&::-webkit-scrollbar":{height:8},"&::-webkit-scrollbar-thumb":{bgcolor:"rgba(255,255,255,0.1)",borderRadius:1}},children:n.made_for_you.map(m=>e.jsxs(h,{onClick:()=>g(m),sx:{minWidth:160,width:160,cursor:"pointer","& .play-button":{opacity:0,transform:"translateY(8px)"},"&:hover .play-button":{opacity:1,transform:"translateY(0)"},"&:hover .card-image":{transform:"scale(1.05)"}},children:[e.jsxs(h,{sx:{position:"relative",aspectRatio:"1",borderRadius:3,overflow:"hidden",mb:1.5},children:[e.jsx(ue,{label:lp[m.tag],size:"small",sx:{position:"absolute",top:8,left:8,zIndex:2,height:20,fontSize:"0.65rem",fontWeight:700,bgcolor:ll[m.tag]?.bg||"primary.main",color:ll[m.tag]?.text||"#fff","& .MuiChip-label":{px:1}}}),e.jsx(h,{className:"card-image",sx:{width:"100%",height:"100%",backgroundImage:`url(${m.thumbnail_url||"/placeholder.jpg"})`,backgroundSize:"cover",backgroundPosition:"center",transition:"transform 0.5s ease"}}),e.jsx(h,{sx:{position:"absolute",inset:0,bgcolor:"rgba(0, 0, 0, 0.2)",transition:"background-color 0.3s ease","&:hover":{bgcolor:"rgba(0, 0, 0, 0.4)"}}}),e.jsx(X,{className:"play-button",sx:{position:"absolute",bottom:12,right:12,width:40,height:40,bgcolor:"primary.main",color:"background.dark",transition:"all 0.3s ease",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)","&:hover":{bgcolor:"primary.main",transform:"scale(1.1)"}},children:e.jsx(gt,{})})]}),e.jsx(x,{variant:"body2",noWrap:!0,sx:{fontWeight:600,mb:.25},children:m.title}),e.jsx(x,{variant:"caption",color:"primary.main",noWrap:!0,sx:{fontWeight:500},children:m.reason})]},m.youtube_id))})]}),n?.recently_played&&n.recently_played.length>0&&e.jsxs(h,{sx:{mb:5},children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2,px:.5},children:[e.jsx(x,{variant:"h6",sx:{fontWeight:700,letterSpacing:"-0.02em"},children:"Recently Played"}),e.jsx(x,{variant:"body2",onClick:()=>r("/history"),sx:{color:"primary.main",cursor:"pointer",fontWeight:500,"&:hover":{opacity:.8}},children:"See All"})]}),e.jsx(h,{sx:{display:"flex",gap:3,overflowX:"auto",pb:2,"&::-webkit-scrollbar":{height:8},"&::-webkit-scrollbar-thumb":{bgcolor:"rgba(255,255,255,0.1)",borderRadius:1}},children:n.recently_played.map(m=>e.jsxs(h,{onClick:()=>g(m,n.recently_played),sx:{minWidth:160,width:160,cursor:"pointer","& .play-button":{opacity:0,transform:"translateY(8px)"},"&:hover .play-button":{opacity:1,transform:"translateY(0)"},"&:hover .card-image":{transform:"scale(1.05)"}},children:[e.jsxs(h,{sx:{position:"relative",aspectRatio:"1",borderRadius:3,overflow:"hidden",mb:1.5},children:[e.jsx(h,{className:"card-image",sx:{width:"100%",height:"100%",backgroundImage:`url(${m.thumbnail_url||"/placeholder.jpg"})`,backgroundSize:"cover",backgroundPosition:"center",transition:"transform 0.5s ease"}}),e.jsx(h,{sx:{position:"absolute",inset:0,bgcolor:"rgba(0, 0, 0, 0.2)",transition:"background-color 0.3s ease"}}),e.jsx(X,{className:"play-button",sx:{position:"absolute",bottom:12,right:12,width:40,height:40,bgcolor:"primary.main",color:"background.dark",transition:"all 0.3s ease",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)","&:hover":{bgcolor:"primary.main",transform:"scale(1.1)"}},children:e.jsx(gt,{})})]}),e.jsx(x,{variant:"body2",noWrap:!0,sx:{fontWeight:600,mb:.5},children:m.title}),e.jsx(x,{variant:"caption",color:"text.secondary",noWrap:!0,children:m.artist||m.channel_name})]},`${m.youtube_id}-${m.played_at}`))})]}),n?.recently_added&&n.recently_added.length>0&&e.jsxs(h,{sx:{mb:5},children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2,px:.5},children:[e.jsx(x,{variant:"h6",sx:{fontWeight:700,letterSpacing:"-0.02em"},children:"Recently Added"}),e.jsx(x,{variant:"body2",onClick:()=>r("/library"),sx:{color:"primary.main",cursor:"pointer",fontWeight:500,"&:hover":{opacity:.8}},children:"See All"})]}),e.jsx(h,{sx:{display:"flex",gap:3,overflowX:"auto",pb:2,"&::-webkit-scrollbar":{height:8},"&::-webkit-scrollbar-thumb":{bgcolor:"rgba(255,255,255,0.1)",borderRadius:1}},children:n.recently_added.map(m=>e.jsxs(h,{onClick:()=>g(m,n.recently_added),sx:{minWidth:160,width:160,cursor:"pointer","& .play-button":{opacity:0,transform:"translateY(8px)"},"&:hover .play-button":{opacity:1,transform:"translateY(0)"},"&:hover .card-image":{transform:"scale(1.05)"}},children:[e.jsxs(h,{sx:{position:"relative",aspectRatio:"1",borderRadius:3,overflow:"hidden",mb:1.5},children:[e.jsx(h,{className:"card-image",sx:{width:"100%",height:"100%",backgroundImage:`url(${m.thumbnail_url||"/placeholder.jpg"})`,backgroundSize:"cover",backgroundPosition:"center",transition:"transform 0.5s ease"}}),e.jsx(h,{sx:{position:"absolute",inset:0,bgcolor:"rgba(0, 0, 0, 0.2)",transition:"background-color 0.3s ease"}}),e.jsx(X,{className:"play-button",sx:{position:"absolute",bottom:12,right:12,width:40,height:40,bgcolor:"primary.main",color:"background.dark",transition:"all 0.3s ease",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)","&:hover":{bgcolor:"primary.main",transform:"scale(1.1)"}},children:e.jsx(gt,{})})]}),e.jsx(x,{variant:"body2",noWrap:!0,sx:{fontWeight:600,mb:.5},children:m.title}),e.jsx(x,{variant:"caption",color:"text.secondary",noWrap:!0,children:m.artist||m.channel_name})]},m.youtube_id))})]}),!a&&n&&!n.continue_listening?.length&&!n.made_for_you?.length&&!n.recently_played?.length&&!n.recently_added?.length&&e.jsxs(h,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",py:10,color:"text.secondary"},children:[e.jsx(x,{variant:"h6",sx:{mb:1},children:"Welcome to Soundwave!"}),e.jsx(x,{variant:"body2",children:"Start by downloading some music or exploring your library."})]}),e.jsx("style",{children:`
        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }
      `})]})}var _n={},cl;function up(){if(cl)return _n;cl=1;var t=ne();Object.defineProperty(_n,"__esModule",{value:!0}),_n.default=void 0;var r=t(ae()),n=se();return _n.default=(0,r.default)((0,n.jsx)("path",{d:"M10.59 9.17 5.41 4 4 5.41l5.17 5.17zM14.5 4l2.04 2.04L4 18.59 5.41 20 17.96 7.46 20 9.5V4zm.33 9.41-1.41 1.41 3.13 3.13L14.5 20H20v-5.5l-2.04 2.04z"}),"Shuffle"),_n}var hp=up();const ho=re(hp),aa=50;async function Qa(t={}){let r=[],n=1,s=!0;for(;s;){const a=await kt.list({...t,page:n}),o=a.data?.data||a.data||[];Array.isArray(o)&&o.length>0?(r=[...r,...o],n++,o.length<aa&&(s=!1)):s=!1}return r}async function Zd(t={}){const r=await Qt.list(t);if(Array.isArray(r.data))return r.data;const n=r.data?.data||r.data?.results||[];if(r.data?.paginate||r.data?.next){let s=Array.isArray(n)?[...n]:[],a=2,o=n.length>=aa;for(;o;){const i=await Qt.list({...t,page:a}),c=i.data?.data||i.data?.results||i.data||[];Array.isArray(c)&&c.length>0?(s=[...s,...c],a++,c.length<aa&&(o=!1)):o=!1}return s}return Array.isArray(n)?n:[]}async function eu(t={}){const r=await Jr.list(t);if(Array.isArray(r.data))return r.data;const n=r.data?.data||r.data?.results||[];if(r.data?.paginate||r.data?.next){let s=Array.isArray(n)?[...n]:[],a=2,o=n.length>=aa;for(;o;){const i=await Jr.list({...t,page:a}),c=i.data?.data||i.data?.results||i.data||[];Array.isArray(c)&&c.length>0?(s=[...s,...c],a++,c.length<aa&&(o=!1)):o=!1}return s}return Array.isArray(n)?n:[]}var Rn={},dl;function fp(){if(dl)return Rn;dl=1;var t=ne();Object.defineProperty(Rn,"__esModule",{value:!0}),Rn.default=void 0;var r=t(ae()),n=se();return Rn.default=(0,r.default)((0,n.jsx)("path",{d:"M7.41 15.41 12 10.83l4.59 4.58L18 14l-6-6-6 6z"}),"KeyboardArrowUp"),Rn}var xp=fp();const pp=re(xp);function cn({threshold:t=300}){const[r,n]=l.useState(!1);l.useEffect(()=>{const a=()=>{n(window.scrollY>t)};return window.addEventListener("scroll",a),()=>window.removeEventListener("scroll",a)},[t]);const s=()=>{window.scrollTo({top:0,behavior:"smooth"})};return e.jsx(id,{in:r,children:e.jsx(ld,{color:"primary",size:"medium",onClick:s,sx:{position:"fixed",bottom:100,right:24,zIndex:1e3},"aria-label":"scroll to top",children:e.jsx(pp,{})})})}var In={},ul;function mp(){if(ul)return In;ul=1;var t=ne();Object.defineProperty(In,"__esModule",{value:!0}),In.default=void 0;var r=t(ae()),n=se();return In.default=(0,r.default)((0,n.jsx)("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"}),"MoreVert"),In}var gp=mp();const tu=re(gp);var An={},hl;function yp(){if(hl)return An;hl=1;var t=ne();Object.defineProperty(An,"__esModule",{value:!0}),An.default=void 0;var r=t(ae()),n=se();return An.default=(0,r.default)((0,n.jsx)("path",{d:"M3.24 6.15C2.51 6.43 2 7.17 2 8v12c0 1.1.89 2 2 2h16c1.11 0 2-.9 2-2V8c0-1.11-.89-2-2-2H8.3l8.26-3.34L15.88 1zM7 20c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m13-8h-2v-2h-2v2H4V8h16z"}),"Radio"),An}var bp=yp();const an=re(bp);var Pn={},fl;function vp(){if(fl)return Pn;fl=1;var t=ne();Object.defineProperty(Pn,"__esModule",{value:!0}),Pn.default=void 0;var r=t(ae()),n=se();return Pn.default=(0,r.default)((0,n.jsx)("path",{d:"m12 21.35-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54z"}),"Favorite"),Pn}var jp=vp();const ya=re(jp);var Dn={},xl;function wp(){if(xl)return Dn;xl=1;var t=ne();Object.defineProperty(Dn,"__esModule",{value:!0}),Dn.default=void 0;var r=t(ae()),n=se();return Dn.default=(0,r.default)((0,n.jsx)("path",{d:"M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3m-4.4 15.55-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05"}),"FavoriteBorder"),Dn}var Sp=wp();const ru=re(Sp);var Mn={},pl;function Cp(){if(pl)return Mn;pl=1;var t=ne();Object.defineProperty(Mn,"__esModule",{value:!0}),Mn.default=void 0;var r=t(ae()),n=se();return Mn.default=(0,r.default)((0,n.jsx)("path",{d:"M14 10H3v2h11zm0-4H3v2h11zm4 8v-4h-2v4h-4v2h4v4h2v-4h4v-2zM3 16h7v-2H3z"}),"PlaylistAdd"),Mn}var kp=Cp();const nu=re(kp);var En={},ml;function _p(){if(ml)return En;ml=1;var t=ne();Object.defineProperty(En,"__esModule",{value:!0}),En.default=void 0;var r=t(ae()),n=se();return En.default=(0,r.default)((0,n.jsx)("path",{d:"M3 10h11v2H3zm0-4h11v2H3zm0 8h7v2H3zm13-1v8l6-4z"}),"PlaylistPlay"),En}var Rp=_p();const oa=re(Rp);var Tn={},gl;function Ip(){if(gl)return Tn;gl=1;var t=ne();Object.defineProperty(Tn,"__esModule",{value:!0}),Tn.default=void 0;var r=t(ae()),n=se();return Tn.default=(0,r.default)((0,n.jsx)("path",{d:"M15 6H3v2h12zm0 4H3v2h12zM3 16h8v-2H3zM17 6v8.18c-.31-.11-.65-.18-1-.18-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3V8h3V6z"}),"QueueMusic"),Tn}var Ap=Ip();const su=re(Ap);var zn={},yl;function Pp(){if(yl)return zn;yl=1;var t=ne();Object.defineProperty(zn,"__esModule",{value:!0}),zn.default=void 0;var r=t(ae()),n=se();return zn.default=(0,r.default)((0,n.jsx)("path",{d:"M5 20h14v-2H5zM19 9h-4V3H9v6H5l7 7z"}),"Download"),zn}var Dp=Pp();const Or=re(Dp);var On={},bl;function Mp(){if(bl)return On;bl=1;var t=ne();Object.defineProperty(On,"__esModule",{value:!0}),On.default=void 0,a(ef());var r=t(ae()),n=se();function s(o){if(typeof WeakMap!="function")return null;var i=new WeakMap,c=new WeakMap;return(s=function(u){return u?c:i})(o)}function a(o,i){if(o&&o.__esModule)return o;if(o===null||typeof o!="object"&&typeof o!="function")return{default:o};var c=s(i);if(c&&c.has(o))return c.get(o);var u={__proto__:null},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in o)if(f!=="default"&&Object.prototype.hasOwnProperty.call(o,f)){var p=d?Object.getOwnPropertyDescriptor(o,f):null;p&&(p.get||p.set)?Object.defineProperty(u,f,p):u[f]=o[f]}return u.default=o,c&&c.set(o,u),u}return On.default=(0,r.default)((0,n.jsx)("path",{d:"M10 15l5.19-3L10 9v6m11.56-7.83c.13.47.22 1.1.28 1.9.07.8.1 1.49.1 2.09L22 12c0 2.19-.16 3.8-.44 4.83-.25.9-.83 1.48-1.73 1.73-.47.13-1.33.22-2.65.28-1.3.07-2.49.1-3.59.1L12 19c-4.19 0-6.8-.16-7.83-.44-.9-.25-1.48-.83-1.73-1.73-.13-.47-.22-1.1-.28-1.9-.07-.8-.1-1.49-.1-2.09L2 12c0-2.19.16-3.8.44-4.83.25-.9.83-1.48 1.73-1.73.47-.13 1.33-.22 2.65-.28 1.3-.07 2.49-.1 3.59-.1L12 5c4.19 0 6.8.16 7.83.44.9.25 1.48.83 1.73 1.73z"}),"YouTube"),On}var Ep=Mp();const en=re(Ep);var Fn={},vl;function Tp(){if(vl)return Fn;vl=1;var t=ne();Object.defineProperty(Fn,"__esModule",{value:!0}),Fn.default=void 0;var r=t(ae()),n=se();return Fn.default=(0,r.default)((0,n.jsx)("path",{d:"M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8z"}),"Folder"),Fn}var zp=Tp();const Op=re(zp);var Ln={},jl;function Fp(){if(jl)return Ln;jl=1;var t=ne();Object.defineProperty(Ln,"__esModule",{value:!0}),Ln.default=void 0;var r=t(ae()),n=se();return Ln.default=(0,r.default)((0,n.jsx)("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"}),"Person"),Ln}var Lp=Fp();const Jo=re(Lp);var Wn={},wl;function Wp(){if(wl)return Wn;wl=1;var t=ne();Object.defineProperty(Wn,"__esModule",{value:!0}),Wn.default=void 0;var r=t(ae()),n=se();return Wn.default=(0,r.default)((0,n.jsx)("path",{d:"M12 10.9c-.61 0-1.1.49-1.1 1.1s.49 1.1 1.1 1.1c.61 0 1.1-.49 1.1-1.1s-.49-1.1-1.1-1.1M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m2.19 12.19L6 18l3.81-8.19L18 6z"}),"Explore"),Wn}var $p=Wp();const Bp=re($p);var $n={},Sl;function qp(){if(Sl)return $n;Sl=1;var t=ne();Object.defineProperty($n,"__esModule",{value:!0}),$n.default=void 0;var r=t(ae()),n=se();return $n.default=(0,r.default)((0,n.jsx)("path",{d:"m23 12-2.44-2.78.34-3.68-3.61-.82-1.89-3.18L12 3 8.6 1.54 6.71 4.72l-3.61.81.34 3.68L1 12l2.44 2.78-.34 3.69 3.61.82 1.89 3.18L12 21l3.4 1.46 1.89-3.18 3.61-.82-.34-3.68zm-10 5h-2v-2h2zm0-4h-2V7h2z"}),"NewReleases"),$n}var Np=qp();const Up=re(Np),au=l.createContext(null);function Hp({children:t}){const[r,n]=l.useState(!1),[s,a]=l.useState(null),[o,i]=l.useState(!1),[c,u]=l.useState(""),d=l.useRef(null),f=l.useCallback((v,S)=>{d.current={youtubeId:v,duration:S,startTime:Date.now()}},[]);l.useEffect(()=>{p()},[]);const p=l.useCallback(async()=>{try{const v=await ur.status();v.data?.has_session&&v.data?.session?.is_active?(a(v.data.session),n(!0)):(a(null),n(!1))}catch(v){console.debug("[Radio] Failed to get status:",v)}},[]),g=l.useCallback(async(v,S,A,E=50)=>{i(!0);try{const P=await ur.start({mode:v,seed_youtube_id:S,seed_channel_id:A,variety_level:E});return P.data?.session?(a(P.data.session),n(!0),u("Radio started"),P.data.first_track||null):null}catch(P){return console.error("[Radio] Failed to start:",P),null}finally{i(!1)}},[]),m=l.useCallback(async()=>{try{await ur.stop(),n(!1),a(null),u("")}catch(v){console.error("[Radio] Failed to stop:",v)}},[]),y=l.useCallback(async()=>{if(!r)return null;i(!0);try{const v=await ur.next();return v.data?.track?(u(v.data.reason||""),s&&a({...s,current_youtube_id:v.data.track.youtube_id,tracks_played:v.data.total_played}),v.data.track):null}catch(v){return console.error("[Radio] Failed to get next track:",v),v?.response?.status===404&&n(!1),null}finally{i(!1)}},[r,s]),j=l.useCallback(async()=>{if(!r||!d.current)return;const{youtubeId:v,duration:S,startTime:A}=d.current,E=(Date.now()-A)/1e3;try{await ur.skip({youtube_id:v,listen_duration:Math.floor(E),track_duration:Math.floor(S)}),s&&a({...s,tracks_skipped:s.tracks_skipped+1})}catch(P){console.debug("[Radio] Failed to report skip:",P)}},[r,s]),C=l.useCallback(async()=>{if(!r||!d.current)return;const{youtubeId:v,duration:S,startTime:A}=d.current,E=(Date.now()-A)/1e3;try{await ur.like({youtube_id:v,feedback_type:"played",listen_duration:Math.floor(E),track_duration:Math.floor(S)})}catch(P){console.debug("[Radio] Failed to report played:",P)}},[r]),w=l.useCallback(async()=>{if(!(!r||!d.current))try{await ur.like({youtube_id:d.current.youtubeId,feedback_type:"liked"})}catch(v){console.debug("[Radio] Failed to report liked:",v)}},[r]),b={isRadioMode:r,radioSession:s,isLoading:o,currentReason:c,startRadio:g,stopRadio:m,getNextTrack:y,reportSkip:j,reportPlayed:C,reportLiked:w,setCurrentTrackInfo:f,refreshStatus:p};return e.jsx(au.Provider,{value:b,children:t})}function fo(){const t=l.useContext(au);if(!t)throw new Error("useRadio must be used within a RadioProvider");return t}const Cl=[{mode:"track",label:"Track Radio",description:"Similar to this song",icon:e.jsx(an,{}),requiresTrack:!0},{mode:"artist",label:"Artist Radio",description:"More from this artist",icon:e.jsx(Jo,{}),requiresTrack:!0},{mode:"favorites",label:"Favorites Mix",description:"Your most played tracks",icon:e.jsx(ya,{}),requiresTrack:!1},{mode:"discovery",label:"Discovery Mode",description:"Explore your unplayed tracks",icon:e.jsx(Bp,{}),requiresTrack:!1},{mode:"recent",label:"New Additions",description:"Recently added tracks",icon:e.jsx(Up,{}),requiresTrack:!1}];function ou({anchorEl:t,open:r,onClose:n,track:s}){const{startRadio:a,isLoading:o}=fo(),i=async c=>{let u,d;s&&(c==="track"||c==="artist")&&(u=s.youtube_id,d=s.channel_id),await a(c,u,d),n()};return e.jsxs(ha,{anchorEl:t,open:r,onClose:n,PaperProps:{sx:{width:280}},children:[e.jsx(x,{variant:"overline",sx:{px:2,color:"text.secondary"},children:"Start Radio"}),s&&e.jsxs(e.Fragment,{children:[Cl.filter(c=>c.requiresTrack).map(c=>e.jsxs(we,{onClick:()=>i(c.mode),disabled:o,children:[e.jsx(Ge,{sx:{color:"primary.main"},children:c.icon}),e.jsx(ke,{primary:c.label,secondary:`${c.description}: ${s.title}`,secondaryTypographyProps:{noWrap:!0,sx:{maxWidth:180}}})]},c.mode)),e.jsx(Ee,{sx:{my:.5}}),e.jsx(x,{variant:"overline",sx:{px:2,color:"text.secondary"},children:"Or start a mix"})]}),Cl.filter(c=>!c.requiresTrack).map(c=>e.jsxs(we,{onClick:()=>i(c.mode),disabled:o,children:[e.jsx(Ge,{sx:{color:"secondary.main"},children:c.icon}),e.jsx(ke,{primary:c.label,secondary:c.description})]},c.mode))]})}function iu({open:t,onClose:r,track:n,onSuccess:s}){const[a,o]=l.useState([]),[i,c]=l.useState(!0),[u,d]=l.useState(null),[f,p]=l.useState(!1),[g,m]=l.useState(""),[y,j]=l.useState(!1),[C,w]=l.useState({open:!1,message:"",severity:"success"}),b=l.useCallback(async()=>{try{c(!0);const P=((await Qt.list()).data.data||[]).filter(k=>k.playlist_type==="custom");o(P)}catch(E){console.error("Failed to load playlists:",E)}finally{c(!1)}},[]);l.useEffect(()=>{t&&(b(),p(!1),m(""))},[t,b]);const v=async E=>{if(n?.youtube_id)try{d(E.playlist_id),await Qt.addItem(E.playlist_id,n.youtube_id),w({open:!0,message:`Added to "${E.title}"`,severity:"success"}),s&&s(E.title),r()}catch(P){const k=P.response?.data?.error||"Failed to add to playlist";w({open:!0,message:k,severity:"error"})}finally{d(null)}},S=async()=>{if(!(!g.trim()||!n?.youtube_id))try{j(!0);const P=(await Qt.create({name:g.trim(),playlist_type:"custom"})).data;await Qt.addItem(P.playlist_id,n.youtube_id),w({open:!0,message:`Created "${g}" and added track`,severity:"success"}),s&&s(g),r()}catch(E){const P=E.response?.data?.error||"Failed to create playlist";w({open:!0,message:P,severity:"error"})}finally{j(!1)}},A=()=>{p(!1),m(""),r()};return e.jsxs(e.Fragment,{children:[e.jsxs(Ke,{open:t,onClose:A,maxWidth:"xs",fullWidth:!0,children:[e.jsxs(tt,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(xh,{color:"primary"}),"Add to Playlist"]}),e.jsxs(Xe,{dividers:!0,children:[n&&e.jsxs(h,{sx:{mb:2,p:1.5,bgcolor:"action.hover",borderRadius:1},children:[e.jsx(x,{variant:"body2",noWrap:!0,fontWeight:"medium",children:n.title}),e.jsx(x,{variant:"caption",color:"text.secondary",noWrap:!0,children:n.artist||n.channel_name})]}),i?e.jsx(h,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(Ie,{size:32})}):f?e.jsxs(h,{sx:{py:1},children:[e.jsx(Ce,{autoFocus:!0,fullWidth:!0,label:"Playlist Name",value:g,onChange:E=>m(E.target.value),onKeyDown:E=>{E.key==="Enter"&&g.trim()&&S()},disabled:y,sx:{mb:2}}),e.jsxs(h,{sx:{display:"flex",gap:1},children:[e.jsx(N,{variant:"outlined",onClick:()=>p(!1),disabled:y,children:"Back"}),e.jsx(N,{variant:"contained",onClick:S,disabled:!g.trim()||y,startIcon:y?e.jsx(Ie,{size:16}):e.jsx(cd,{}),children:y?"Creating...":"Create & Add"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(Le,{disablePadding:!0,children:e.jsxs(tr,{onClick:()=>p(!0),children:[e.jsx(Ge,{children:e.jsx(sr,{color:"primary"})}),e.jsx(ke,{primary:"Create New Playlist",primaryTypographyProps:{color:"primary",fontWeight:"medium"}})]})}),a.length>0&&e.jsx(Ee,{sx:{my:1}}),a.length===0?e.jsx(x,{variant:"body2",color:"text.secondary",sx:{py:2,textAlign:"center"},children:"No custom playlists yet. Create one!"}):e.jsx(Qe,{disablePadding:!0,children:a.map(E=>e.jsx(Le,{disablePadding:!0,children:e.jsxs(tr,{onClick:()=>v(E),disabled:u!==null,children:[e.jsx(Ge,{children:u===E.playlist_id?e.jsx(Ie,{size:24}):e.jsx(No,{})}),e.jsx(ke,{primary:E.title,secondary:`${E.item_count} tracks`})]})},E.playlist_id))})]})]}),e.jsx(nt,{children:e.jsx(N,{onClick:A,children:"Cancel"})})]}),e.jsx(it,{open:C.open,autoHideDuration:3e3,onClose:()=>w({...C,open:!1}),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(pe,{severity:C.severity,onClose:()=>w({...C,open:!1}),children:C.message})})]})}function Fr({track:t,onTrackUpdate:r,onDownload:n,onPlayNext:s,onAddToQueue:a,size:o="small",showQueueActions:i=!0}){const c=Dt(),[u,d]=l.useState(null),[f,p]=l.useState(null),[g,m]=l.useState(!1),[y,j]=l.useState(!1),[C,w]=l.useState([]),[b,v]=l.useState(!1),[S,A]=l.useState(t.is_favorite),E=D=>{D.stopPropagation(),d(D.currentTarget)},P=()=>{d(null)},k=D=>{D.stopPropagation(),p(D.currentTarget),P()},R=()=>{p(null)},z=D=>{D.stopPropagation(),s&&s(),P()},B=D=>{D.stopPropagation(),a&&a(),P()},F=async D=>{if(D.stopPropagation(),!!t.youtube_id){try{const J=(await kt.toggleFavorite(t.youtube_id)).data.is_favorite;A(J),r&&r({...t,is_favorite:J})}catch(Q){console.error("Failed to toggle favorite:",Q)}P()}},W=D=>{D.stopPropagation(),m(!0),P()},H=D=>{D.stopPropagation(),n&&n(),P()},I=D=>{D.stopPropagation(),t.channel_id&&t.youtube_id&&c(`/channels/${t.channel_id}?highlight=${t.youtube_id}`),P()},_=async D=>{if(D.stopPropagation(),!!t.youtube_id){j(!0),v(!0),P();try{const Q=await Qt.findContaining(t.youtube_id);w(Q.data.data||[])}catch(Q){console.error("Failed to find playlists:",Q),w([])}finally{v(!1)}}},O=D=>{j(!1),c(`/playlists/${D}?highlight=${t.youtube_id}`)};return e.jsxs(e.Fragment,{children:[e.jsx(X,{size:o,onClick:E,sx:{color:"text.secondary","&:hover":{color:"text.primary",bgcolor:"rgba(255, 255, 255, 0.1)"}},children:e.jsx(tu,{fontSize:o})}),e.jsxs(ha,{anchorEl:u,open:!!u,onClose:P,onClick:D=>D.stopPropagation(),children:[i&&s&&e.jsxs(we,{onClick:z,children:[e.jsx(Ge,{children:e.jsx(oa,{fontSize:"small",sx:{color:"primary.main"}})}),e.jsx(ke,{children:"Play Next"})]}),i&&a&&e.jsxs(we,{onClick:B,children:[e.jsx(Ge,{children:e.jsx(su,{fontSize:"small"})}),e.jsx(ke,{children:"Add to Queue"})]}),i&&(s||a)&&e.jsx(Ee,{sx:{my:.5}}),e.jsxs(we,{onClick:k,children:[e.jsx(Ge,{children:e.jsx(an,{fontSize:"small",sx:{color:"primary.main"}})}),e.jsx(ke,{children:"Start Radio"})]}),e.jsx(Ee,{sx:{my:.5}}),e.jsxs(we,{onClick:F,children:[e.jsx(Ge,{children:S?e.jsx(ya,{fontSize:"small",sx:{color:"error.main"}}):e.jsx(ru,{fontSize:"small"})}),e.jsx(ke,{children:S?"Remove from Favorites":"Add to Favorites"})]}),e.jsxs(we,{onClick:W,children:[e.jsx(Ge,{children:e.jsx(nu,{fontSize:"small"})}),e.jsx(ke,{children:"Add to Playlist"})]}),n&&e.jsxs(we,{onClick:H,children:[e.jsx(Ge,{children:e.jsx(Or,{fontSize:"small"})}),e.jsx(ke,{children:"Download"})]}),t.channel_id&&e.jsxs(e.Fragment,{children:[e.jsx(Ee,{sx:{my:.5}}),e.jsxs(we,{onClick:I,children:[e.jsx(Ge,{children:e.jsx(en,{fontSize:"small",sx:{color:"error.main"}})}),e.jsx(ke,{children:"Go to Channel"})]})]}),t.youtube_id&&e.jsxs(we,{onClick:_,children:[e.jsx(Ge,{children:e.jsx(Op,{fontSize:"small",sx:{color:"info.main"}})}),e.jsx(ke,{children:"Find in Playlists"})]})]}),e.jsx(ou,{anchorEl:f,open:!!f,onClose:R,track:t}),e.jsx(iu,{open:g,onClose:()=>m(!1),track:t}),e.jsxs(Ke,{open:y,onClose:()=>j(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(tt,{children:"Playlists containing this track"}),e.jsx(Xe,{children:b?e.jsx(h,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(Ie,{})}):C.length===0?e.jsx(x,{color:"text.secondary",sx:{py:2,textAlign:"center"},children:"This track is not in any playlist yet."}):e.jsx(Qe,{children:C.map(D=>e.jsx(Le,{disablePadding:!0,children:e.jsxs(tr,{onClick:()=>O(D.playlist_id),children:[e.jsx(Ft,{children:e.jsx(Ve,{src:D.thumbnail_url,variant:"rounded",sx:{width:48,height:48},children:e.jsx(oa,{})})}),e.jsx(ke,{primary:D.title,secondary:`${D.item_count} tracks  Position #${D.position}`})]})},D.playlist_id))})})]})]})}function ba(t={}){const{scrollDelay:r=300,highlightDuration:n=3e3}=t,[s,a]=tf(),o=l.useRef(null),i=s.get("highlight"),c=l.useCallback(d=>!d||d!==i?null:f=>{!f||o.current===d||(o.current=d,setTimeout(()=>{f.scrollIntoView({behavior:"smooth",block:"center"}),f.classList.add("highlight-track"),setTimeout(()=>{f.classList.remove("highlight-track");const p=new URLSearchParams(s);p.delete("highlight"),a(p,{replace:!0})},n)},r))},[i,r,n,s,a]),u=l.useCallback(d=>d===i,[i]);return l.useEffect(()=>{i||(o.current=null)},[i]),{highlightYoutubeId:i,getTrackRef:c,shouldHighlight:u}}function Vp({setCurrentAudio:t}){const[r,n]=l.useState([]),[s,a]=l.useState(!1),o=_d(),{getTrackRef:i,shouldHighlight:c}=ba(),[u,d]=l.useState(!1),[f,p]=l.useState(""),g=l.useCallback(async()=>{a(!0);try{const w=await Qa();n(w)}catch(w){console.error("Failed to load audio:",w),n([])}finally{a(!1)}},[]);l.useEffect(()=>{g()},[o.key,g]);const m=w=>{const b=Math.floor(w/60),v=w%60;return`${b}:${v.toString().padStart(2,"0")}`},y=w=>`${(w/1048576).toFixed(1)} MB`,j=()=>{if(r.length===0){p("No tracks in library"),d(!0);return}t(r[0],r),p(`Playing ${r.length} tracks`),d(!0)},C=()=>{if(r.length===0){p("No tracks to shuffle"),d(!0);return}const w=[...r];for(let b=w.length-1;b>0;b--){const v=Math.floor(Math.random()*(b+1));[w[b],w[v]]=[w[v],w[b]]}t(w[0],w),p(`Shuffled ${w.length} tracks`),d(!0)};return e.jsxs(h,{children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:3,flexWrap:"wrap",gap:2},children:[e.jsx(x,{variant:"h4",sx:{fontWeight:700,letterSpacing:"-0.02em"},children:"Library"}),e.jsxs(h,{sx:{display:"flex",gap:1.5},children:[e.jsx(N,{variant:"contained",startIcon:e.jsx(gt,{}),onClick:j,disabled:r.length===0,sx:{minWidth:{xs:"48px",sm:"120px"},bgcolor:"primary.main",color:"background.dark",fontWeight:600,"&:hover":{bgcolor:"primary.dark"},"&:disabled":{bgcolor:"rgba(255, 255, 255, 0.1)"}},children:e.jsx(h,{sx:{display:{xs:"none",sm:"block"}},children:"Play All"})}),e.jsx(N,{variant:"outlined",startIcon:e.jsx(ho,{}),onClick:C,disabled:r.length===0,sx:{minWidth:{xs:"48px",sm:"120px"},borderColor:"primary.main",color:"primary.main",fontWeight:600,"&:hover":{borderColor:"primary.dark",bgcolor:"rgba(19, 236, 106, 0.05)"},"&:disabled":{borderColor:"rgba(255, 255, 255, 0.1)",color:"rgba(255, 255, 255, 0.3)"}},children:e.jsx(h,{sx:{display:{xs:"none",sm:"block"}},children:"Shuffle"})}),e.jsx(X,{onClick:g,disabled:s,sx:{color:"text.secondary","&:hover":{color:"primary.main"}},title:"Refresh library",children:e.jsx(Zr,{sx:{animation:s?"spin 1s linear infinite":"none","@keyframes spin":{"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}}})})]})]}),e.jsxs(x,{variant:"body2",color:"text.secondary",sx:{mb:2},children:[r.length," tracks in your library"]}),e.jsx(Lr,{component:yt,sx:{bgcolor:"background.paper",borderRadius:3,border:"1px solid",borderColor:"rgba(255, 255, 255, 0.05)","& .MuiTableCell-root":{borderColor:"rgba(255, 255, 255, 0.05)"}},children:e.jsxs(Wr,{children:[e.jsx($r,{children:e.jsxs(ht,{children:[e.jsx(Z,{width:50,sx:{fontWeight:600},children:"#"}),e.jsx(Z,{sx:{fontWeight:600},children:"Title"}),e.jsx(Z,{sx:{fontWeight:600},children:"Channel"}),e.jsx(Z,{align:"right",sx:{fontWeight:600},children:"Duration"}),e.jsx(Z,{align:"right",sx:{fontWeight:600},children:"Size"}),e.jsx(Z,{align:"right",sx:{fontWeight:600},children:"Plays"}),e.jsx(Z,{align:"center",width:100,sx:{fontWeight:600},children:"Actions"})]})}),e.jsx(Br,{children:r.map((w,b)=>e.jsxs(ht,{ref:i(w.youtube_id),sx:{cursor:"pointer",transition:"background-color 0.3s ease","&:hover":{bgcolor:"rgba(19, 236, 106, 0.05)"},...c(w.youtube_id)&&{bgcolor:"rgba(19, 236, 106, 0.1)"}},onClick:()=>t(w,r),children:[e.jsx(Z,{sx:{color:"text.secondary"},children:b+1}),e.jsx(Z,{children:e.jsx(x,{variant:"body2",noWrap:!0,sx:{maxWidth:300,fontWeight:500},children:w.title})}),e.jsx(Z,{children:e.jsx(x,{variant:"body2",color:"text.secondary",children:w.channel_name})}),e.jsx(Z,{align:"right",sx:{color:"text.secondary"},children:m(w.duration)}),e.jsx(Z,{align:"right",sx:{color:"text.secondary"},children:y(w.file_size)}),e.jsx(Z,{align:"right",sx:{color:"text.secondary"},children:w.play_count}),e.jsxs(Z,{align:"center",onClick:v=>v.stopPropagation(),children:[e.jsx(X,{size:"small",sx:{color:"primary.main","&:hover":{bgcolor:"rgba(19, 236, 106, 0.1)"}},children:e.jsx(gt,{})}),e.jsx(Fr,{track:w,onTrackUpdate:v=>{n(S=>S.map(A=>A.id===v.id?v:A))}})]})]},w.id))})]})}),e.jsx(it,{open:u,autoHideDuration:3e3,onClose:()=>d(!1),message:f,anchorOrigin:{vertical:"bottom",horizontal:"center"}}),e.jsx(cn,{})]})}var Bn={},kl;function Yp(){if(kl)return Bn;kl=1;var t=ne();Object.defineProperty(Bn,"__esModule",{value:!0}),Bn.default=void 0;var r=t(ae()),n=se();return Bn.default=(0,r.default)((0,n.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search"),Bn}var Gp=Yp();const wr=re(Gp);var qn={},_l;function Qp(){if(_l)return qn;_l=1;var t=ne();Object.defineProperty(qn,"__esModule",{value:!0}),qn.default=void 0;var r=t(ae()),n=se();return qn.default=(0,r.default)((0,n.jsx)("path",{d:"M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3z"}),"MusicNote"),qn}var Kp=Qp();const Lt=re(Kp);var Nn={},Rl;function Xp(){if(Rl)return Nn;Rl=1;var t=ne();Object.defineProperty(Nn,"__esModule",{value:!0}),Nn.default=void 0;var r=t(ae()),n=se();return Nn.default=(0,r.default)((0,n.jsx)("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9m-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8z"}),"History"),Nn}var Jp=Xp();const Gs=re(Jp);var Un={},Il;function Zp(){if(Il)return Un;Il=1;var t=ne();Object.defineProperty(Un,"__esModule",{value:!0}),Un.default=void 0;var r=t(ae()),n=se();return Un.default=(0,r.default)((0,n.jsx)("path",{d:"m16 6 2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"}),"TrendingUp"),Un}var em=Zp();const Do=re(em);var Hn={},Al;function tm(){if(Al)return Hn;Al=1;var t=ne();Object.defineProperty(Hn,"__esModule",{value:!0}),Hn.default=void 0;var r=t(ae()),n=se();return Hn.default=(0,r.default)((0,n.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Clear"),Hn}var rm=tm();const nm=re(rm);function sm({setCurrentAudio:t}){const r=Dt(),[n,s]=l.useState(""),[a,o]=l.useState(0),[i,c]=l.useState(!1),[u,d]=l.useState(!1),[f,p]=l.useState([]),[g,m]=l.useState(-1),[y,j]=l.useState([]),[C]=l.useState(["hip hop","rock music","jazz","classical","electronic","blues"]),w=l.useRef(null),b=l.useRef(null),[v,S]=l.useState([]),[A,E]=l.useState([]),[P,k]=l.useState([]);l.useEffect(()=>{(async()=>{try{const T=await Qa();j(T)}catch(T){console.error("Failed to load audio for suggestions:",T)}})()},[]),l.useEffect(()=>{const M=localStorage.getItem("soundwave_recent_searches");M&&p(JSON.parse(M))},[]);const R=M=>{if(!M.trim())return;const T=[M,...f.filter(te=>te!==M)].slice(0,10);p(T),localStorage.setItem("soundwave_recent_searches",JSON.stringify(T))},z=()=>{p([]),localStorage.removeItem("soundwave_recent_searches")},B=l.useMemo(()=>{const M=[],T=n.toLowerCase().trim();if(!T)return f.slice(0,5).forEach(K=>{M.push({type:"recent",text:K,icon:e.jsx(Gs,{fontSize:"small",color:"action"})})}),C.slice(0,3).forEach(K=>{M.push({type:"popular",text:K,icon:e.jsx(Do,{fontSize:"small",color:"action"})})}),M;const te=new Set,$=[];return y.forEach(K=>{K.channel_name&&te.add(K.channel_name),K.title?.toLowerCase().includes(T)&&$.push(K)}),Array.from(te).filter(K=>K.toLowerCase().includes(T)).slice(0,3).forEach(K=>{M.push({type:"artist",text:K,icon:e.jsx(Jo,{fontSize:"small",color:"primary"})})}),$.slice(0,3).forEach(K=>{M.push({type:"song",text:K.title,icon:e.jsx(Lt,{fontSize:"small",color:"secondary"}),audio:K})}),f.filter(K=>K.toLowerCase().includes(T)&&K.toLowerCase()!==T).slice(0,2).forEach(K=>{M.push({type:"recent",text:K,icon:e.jsx(Gs,{fontSize:"small",color:"action"})})}),C.filter(K=>K.toLowerCase().includes(T)&&K.toLowerCase()!==T).slice(0,2).forEach(K=>{M.push({type:"popular",text:K,icon:e.jsx(Do,{fontSize:"small",color:"action"})})}),M},[n,f,C,y]);l.useEffect(()=>{m(-1)},[B]);const F=(M,T)=>{if(!T.trim())return M;const te=M.toLowerCase(),$=T.toLowerCase(),U=te.indexOf($);return U===-1?M:e.jsxs(e.Fragment,{children:[M.slice(0,U),e.jsx(h,{component:"span",sx:{fontWeight:700,color:"primary.main"},children:M.slice(U,U+T.length)}),M.slice(U+T.length)]})};l.useEffect(()=>{if(!n.trim()){S([]),E([]),k([]);return}const M=setTimeout(()=>{W()},500);return()=>clearTimeout(M)},[n]);const W=async(M=n)=>{if(M.trim()){R(M.trim()),d(!1),c(!0);try{const T=M.toLowerCase(),te=await Qa(),$=te.filter(oe=>oe.title?.toLowerCase().includes(T)||oe.channel_name?.toLowerCase().includes(T));S($),j(te);const K=(await Zd()).filter(oe=>oe.title?.toLowerCase().includes(T)||oe.channel_name?.toLowerCase().includes(T));E(K);const q=(await eu()).filter(oe=>oe.channel_name?.toLowerCase().includes(T));k(q)}catch(T){console.error("Search failed:",T)}finally{c(!1)}}},H=M=>{s(M),W(M)},I=M=>{M.type==="song"&&M.audio?(t(M.audio,v.length>0?v:[M.audio]),d(!1),R(M.text)):H(M.text)},_=M=>{if(!u||B.length===0){M.key==="Enter"&&W();return}switch(M.key){case"ArrowDown":M.preventDefault(),m(T=>T<B.length-1?T+1:T);break;case"ArrowUp":M.preventDefault(),m(T=>T>0?T-1:-1);break;case"Enter":M.preventDefault(),g>=0&&g<B.length?I(B[g]):W();break;case"Escape":d(!1),m(-1);break}},O=()=>{d(!0)},D=()=>{d(!1),m(-1)},Q=M=>{const T=Math.floor(M/60),te=M%60;return`${T}:${te.toString().padStart(2,"0")}`},J=v.length+A.length+P.length;return e.jsxs(h,{children:[e.jsx(x,{variant:"h5",sx:{mb:3,fontWeight:700,letterSpacing:"-0.02em"},children:"Search"}),e.jsx(ph,{onClickAway:D,children:e.jsxs(h,{sx:{position:"relative",maxWidth:800,mb:3},children:[e.jsx(Ce,{ref:w,inputRef:b,fullWidth:!0,value:n,onChange:M=>s(M.target.value),onFocus:O,onKeyDown:_,placeholder:"Search for songs, artists, playlists, or channels...",variant:"outlined",InputProps:{startAdornment:e.jsx(nr,{position:"start",children:e.jsx(wr,{})}),endAdornment:n&&e.jsx(nr,{position:"end",children:e.jsx(X,{onClick:()=>{s(""),S([]),E([]),k([])},size:"small",children:e.jsx(nm,{})})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:"9999px",bgcolor:"rgba(255, 255, 255, 0.05)"}}}),e.jsx(mh,{open:u&&B.length>0,anchorEl:w.current,placement:"bottom-start",style:{width:w.current?.offsetWidth,zIndex:1300},transition:!0,children:({TransitionProps:M})=>e.jsx(ea,{...M,timeout:200,children:e.jsxs(yt,{elevation:8,sx:{mt:1,maxHeight:400,overflowY:"auto",bgcolor:"background.paper",border:"1px solid",borderColor:"divider"},children:[!n.trim()&&f.length>0&&e.jsxs(h,{sx:{px:2,py:1,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(x,{variant:"caption",color:"text.secondary",sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Gs,{fontSize:"small"}),"Recent searches"]}),e.jsx(x,{variant:"caption",color:"primary",sx:{cursor:"pointer","&:hover":{textDecoration:"underline"}},onClick:T=>{T.stopPropagation(),z()},children:"Clear all"})]}),n.trim()&&B.some(T=>T.type==="artist")&&e.jsx(h,{sx:{px:2,py:.5},children:e.jsxs(x,{variant:"caption",color:"text.secondary",sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Jo,{fontSize:"small"}),"Artists"]})}),B.map((T,te)=>{const $=te>0?B[te-1]:null,U=n.trim()&&T.type==="song"&&$?.type!=="song",K=n.trim()&&T.type==="recent"&&$?.type!=="recent",ce=T.type==="popular"&&$?.type!=="popular";return e.jsxs(h,{children:[U&&e.jsxs(e.Fragment,{children:[e.jsx(Ee,{sx:{my:.5}}),e.jsx(h,{sx:{px:2,py:.5},children:e.jsxs(x,{variant:"caption",color:"text.secondary",sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Lt,{fontSize:"small"}),"Songs"]})})]}),K&&e.jsxs(e.Fragment,{children:[e.jsx(Ee,{sx:{my:.5}}),e.jsx(h,{sx:{px:2,py:.5},children:e.jsxs(x,{variant:"caption",color:"text.secondary",sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Gs,{fontSize:"small"}),"Recent"]})})]}),ce&&e.jsxs(e.Fragment,{children:[e.jsx(Ee,{sx:{my:.5}}),e.jsx(h,{sx:{px:2,py:.5},children:e.jsxs(x,{variant:"caption",color:"text.secondary",sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Do,{fontSize:"small"}),"Popular"]})})]}),e.jsxs(tr,{onClick:()=>I(T),selected:te===g,sx:{py:1,"&.Mui-selected":{bgcolor:"action.selected"}},children:[e.jsx(Ft,{sx:{minWidth:40},children:T.icon}),e.jsx(ke,{primary:F(T.text,n),secondary:T.type==="song"&&T.audio?.channel_name,primaryTypographyProps:{sx:{fontWeight:te===g?600:400,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}}),T.type==="song"&&e.jsx(gt,{fontSize:"small",color:"action",sx:{opacity:.5}})]})]},`suggestion-${te}`)}),B.length===0&&!n.trim()&&e.jsx(h,{sx:{p:2,textAlign:"center"},children:e.jsx(x,{variant:"body2",color:"text.secondary",children:"Start typing to search"})})]})})})]})}),n&&e.jsxs(e.Fragment,{children:[e.jsx(h,{sx:{borderBottom:1,borderColor:"divider",mb:3},children:e.jsxs(oi,{value:a,onChange:(M,T)=>o(T),children:[e.jsx(Ut,{label:`All (${J})`,sx:{textTransform:"none",fontWeight:600}}),e.jsx(Ut,{label:`Songs (${v.length})`,sx:{textTransform:"none",fontWeight:600}}),e.jsx(Ut,{label:`Playlists (${A.length})`,sx:{textTransform:"none",fontWeight:600}}),e.jsx(Ut,{label:`Channels (${P.length})`,sx:{textTransform:"none",fontWeight:600}})]})}),i?e.jsx(h,{sx:{display:"flex",justifyContent:"center",py:8},children:e.jsx(Ie,{})}):J===0?e.jsxs(h,{sx:{textAlign:"center",py:8},children:[e.jsx(wr,{sx:{fontSize:64,color:"text.secondary",opacity:.3,mb:2}}),e.jsx(x,{variant:"h6",color:"text.secondary",children:"No results found"}),e.jsx(x,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Try searching with different keywords"})]}):e.jsxs(h,{children:[a===0&&e.jsxs(h,{children:[v.length>0&&e.jsxs(h,{sx:{mb:4},children:[e.jsxs(x,{variant:"h6",sx:{mb:2,fontWeight:600,display:"flex",alignItems:"center",gap:1},children:[e.jsx(Lt,{})," Songs"]}),e.jsx(Qe,{children:v.slice(0,5).map(M=>e.jsx(Le,{disablePadding:!0,secondaryAction:e.jsxs(h,{sx:{display:"flex",gap:.5},children:[e.jsx(X,{edge:"end",onClick:()=>t(M,v),disabled:!M.file_path,sx:{color:"primary.main"},children:e.jsx(gt,{})}),e.jsx(Fr,{track:M,onTrackUpdate:T=>{S(te=>te.map($=>$.id===T.id?T:$)),j(te=>te.map($=>$.id===T.id?T:$))}})]}),children:e.jsxs(tr,{onClick:()=>t(M,v),disabled:!M.file_path,children:[e.jsx(Ft,{children:e.jsx(Ve,{src:M.thumbnail_url,variant:"rounded",sx:{width:56,height:56},children:e.jsx(Lt,{})})}),e.jsx(ke,{primary:M.title,secondary:`${M.channel_name}  ${Q(M.duration)}`,primaryTypographyProps:{fontWeight:500}}),!M.file_path&&e.jsx(ue,{label:"Not Downloaded",size:"small",color:"warning",sx:{mr:2}})]})},M.id))})]}),A.length>0&&e.jsxs(h,{sx:{mb:4},children:[e.jsxs(x,{variant:"h6",sx:{mb:2,fontWeight:600,display:"flex",alignItems:"center",gap:1},children:[e.jsx(oa,{})," Playlists"]}),e.jsx(ee,{container:!0,spacing:2,children:A.slice(0,4).map(M=>e.jsx(ee,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(_e,{onClick:()=>r(`/playlists/${M.playlist_id}`),sx:{cursor:"pointer",transition:"transform 0.2s","&:hover":{transform:"translateY(-4px)"}},children:[e.jsx(Ri,{component:"img",height:"160",image:M.thumbnail_url,alt:M.title}),e.jsxs(Pe,{children:[e.jsx(x,{variant:"body2",fontWeight:600,noWrap:!0,children:M.title}),e.jsxs(x,{variant:"caption",color:"text.secondary",noWrap:!0,children:[M.downloaded_count,"/",M.item_count," tracks"]})]})]})},M.id))})]}),P.length>0&&e.jsxs(h,{sx:{mb:4},children:[e.jsxs(x,{variant:"h6",sx:{mb:2,fontWeight:600,display:"flex",alignItems:"center",gap:1},children:[e.jsx(en,{})," Channels"]}),e.jsx(Qe,{children:P.slice(0,5).map(M=>e.jsx(Le,{disablePadding:!0,children:e.jsxs(tr,{onClick:()=>r("/channels"),children:[e.jsx(Ft,{children:e.jsx(Ve,{src:M.thumbnail_url,children:e.jsx(en,{})})}),e.jsx(ke,{primary:M.channel_name,secondary:M.subscribed?"Subscribed":"Not subscribed",primaryTypographyProps:{fontWeight:500}})]})},M.id))})]})]}),a===1&&e.jsx(Qe,{children:v.map(M=>e.jsx(Le,{disablePadding:!0,secondaryAction:e.jsxs(h,{sx:{display:"flex",gap:.5},children:[e.jsx(X,{edge:"end",onClick:()=>t(M,v),disabled:!M.file_path,sx:{color:"primary.main"},children:e.jsx(gt,{})}),e.jsx(Fr,{track:M,onTrackUpdate:T=>{S(te=>te.map($=>$.id===T.id?T:$)),j(te=>te.map($=>$.id===T.id?T:$))}})]}),children:e.jsxs(tr,{onClick:()=>t(M,v),disabled:!M.file_path,children:[e.jsx(Ft,{children:e.jsx(Ve,{src:M.thumbnail_url,variant:"rounded",sx:{width:56,height:56},children:e.jsx(Lt,{})})}),e.jsx(ke,{primary:M.title,secondary:`${M.channel_name}  ${Q(M.duration)}`,primaryTypographyProps:{fontWeight:500}}),!M.file_path&&e.jsx(ue,{label:"Not Downloaded",size:"small",color:"warning",sx:{mr:2}})]})},M.id))}),a===2&&e.jsx(ee,{container:!0,spacing:2,children:A.map(M=>e.jsx(ee,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(_e,{onClick:()=>r(`/playlists/${M.playlist_id}`),sx:{cursor:"pointer",transition:"transform 0.2s","&:hover":{transform:"translateY(-4px)"}},children:[e.jsx(Ri,{component:"img",height:"160",image:M.thumbnail_url,alt:M.title}),e.jsxs(Pe,{children:[e.jsx(x,{variant:"body2",fontWeight:600,noWrap:!0,children:M.title}),e.jsx(x,{variant:"caption",color:"text.secondary",noWrap:!0,children:M.channel_name}),e.jsxs(x,{variant:"caption",color:"text.secondary",display:"block",children:[M.downloaded_count,"/",M.item_count," tracks"]})]})]})},M.id))}),a===3&&e.jsx(Qe,{children:P.map(M=>e.jsx(Le,{disablePadding:!0,children:e.jsxs(tr,{onClick:()=>r("/channels"),children:[e.jsx(Ft,{children:e.jsx(Ve,{src:M.thumbnail_url,sx:{width:56,height:56},children:e.jsx(en,{})})}),e.jsx(ke,{primary:M.channel_name,secondary:M.subscribed?"Subscribed":"Not subscribed",primaryTypographyProps:{fontWeight:500,fontSize:"1rem"}}),M.subscribed&&e.jsx(ue,{label:"Subscribed",size:"small",color:"success"})]})},M.id))})]})]}),!n&&e.jsxs(h,{sx:{textAlign:"center",py:8},children:[e.jsx(wr,{sx:{fontSize:80,color:"text.secondary",opacity:.3,mb:2}}),e.jsx(x,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"Search Your Library"}),e.jsx(x,{variant:"body2",color:"text.secondary",children:"Find songs, playlists, and channels in your collection"})]}),e.jsx(cn,{})]})}function am({setCurrentAudio:t}){const[r,n]=l.useState([]),[s,a]=l.useState(!0),{getTrackRef:o,shouldHighlight:i}=ba(),[c,u]=l.useState(!1),[d,f]=l.useState("");l.useEffect(()=>{p()},[]);const p=async()=>{try{a(!0);const b=(await Qa({favorites:!0})).filter(v=>v.is_favorite);n(b)}catch(w){console.error("Failed to load favorites:",w),n([])}finally{a(!1)}},g=w=>{w.is_favorite?n(b=>b.map(v=>v.id===w.id?w:v)):(n(b=>b.filter(v=>v.id!==w.id)),f("Removed from favorites"),u(!0))},m=()=>{if(r.length===0){f("No favorites to play"),u(!0);return}t(r[0],r),f(`Playing ${r.length} favorite tracks`),u(!0)},y=()=>{if(r.length===0){f("No favorites to shuffle"),u(!0);return}const w=[...r];for(let b=w.length-1;b>0;b--){const v=Math.floor(Math.random()*(b+1));[w[b],w[v]]=[w[v],w[b]]}t(w[0],w),f(`Shuffled ${w.length} favorite tracks`),u(!0)},j=w=>{const b=Math.floor(w/60),v=w%60;return`${b}:${v.toString().padStart(2,"0")}`},C=w=>`${(w/1048576).toFixed(1)} MB`;return s?e.jsxs(h,{children:[e.jsx(x,{variant:"h4",sx:{mb:2,fontWeight:600},children:"Favorites"}),e.jsx(x,{children:"Loading favorites..."})]}):e.jsxs(h,{children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:3,flexWrap:"wrap",gap:2},children:[e.jsx(x,{variant:"h4",sx:{fontWeight:700,letterSpacing:"-0.02em"},children:"Favorites"}),r.length>0&&e.jsxs(h,{sx:{display:"flex",gap:1.5},children:[e.jsx(N,{variant:"contained",startIcon:e.jsx(gt,{}),onClick:m,sx:{borderRadius:2.5,px:3,py:1.25,fontSize:"0.95rem",fontWeight:600},children:"Play All"}),e.jsx(N,{variant:"outlined",startIcon:e.jsx(ho,{}),onClick:y,sx:{borderRadius:2.5,px:3,py:1.25,fontSize:"0.95rem",fontWeight:600},children:"Shuffle"})]})]}),r.length===0?e.jsxs(h,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:300,gap:1.5},children:[e.jsx(ya,{sx:{fontSize:48,color:"text.secondary"}}),e.jsx(x,{variant:"subtitle1",color:"text.secondary",children:"No favorites yet"}),e.jsx(x,{variant:"caption",color:"text.secondary",children:"Start adding songs to your favorites"})]}):e.jsx(Lr,{component:yt,sx:{borderRadius:3,overflow:"hidden"},children:e.jsxs(Wr,{children:[e.jsx($r,{children:e.jsxs(ht,{children:[e.jsx(Z,{width:50,sx:{fontWeight:600},children:"#"}),e.jsx(Z,{sx:{fontWeight:600},children:"Title"}),e.jsx(Z,{sx:{fontWeight:600},children:"Channel"}),e.jsx(Z,{align:"right",sx:{fontWeight:600},children:"Duration"}),e.jsx(Z,{align:"right",sx:{fontWeight:600},children:"Size"}),e.jsx(Z,{align:"right",sx:{fontWeight:600},children:"Plays"}),e.jsx(Z,{align:"center",width:100,sx:{fontWeight:600},children:"Actions"})]})}),e.jsx(Br,{children:r.map((w,b)=>e.jsxs(ht,{ref:o(w.youtube_id),sx:{cursor:"pointer",transition:"background-color 0.3s ease","&:hover":{bgcolor:"rgba(19, 236, 106, 0.05)"},...i(w.youtube_id)&&{bgcolor:"rgba(19, 236, 106, 0.1)"}},onClick:()=>t(w,r),children:[e.jsx(Z,{sx:{color:"text.secondary"},children:b+1}),e.jsx(Z,{children:e.jsx(x,{variant:"body2",noWrap:!0,sx:{maxWidth:300,fontWeight:500},children:w.title})}),e.jsx(Z,{children:e.jsx(x,{variant:"body2",color:"text.secondary",children:w.channel_name})}),e.jsx(Z,{align:"right",sx:{color:"text.secondary"},children:j(w.duration)}),e.jsx(Z,{align:"right",sx:{color:"text.secondary"},children:C(w.file_size)}),e.jsx(Z,{align:"right",sx:{color:"text.secondary"},children:w.play_count}),e.jsxs(Z,{align:"center",onClick:v=>v.stopPropagation(),children:[e.jsx(X,{size:"small",sx:{color:"primary.main","&:hover":{bgcolor:"rgba(19, 236, 106, 0.1)"}},onClick:v=>{v.stopPropagation(),t(w,r)},children:e.jsx(gt,{})}),e.jsx(Fr,{track:w,onTrackUpdate:g})]})]},w.id))})]})}),e.jsx(it,{open:c,autoHideDuration:3e3,onClose:()=>u(!1),message:d,anchorOrigin:{vertical:"bottom",horizontal:"center"}}),e.jsx(cn,{})]})}function om(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return l.useMemo(()=>s=>{r.forEach(a=>a(s))},r)}const xo=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function dn(t){const r=Object.prototype.toString.call(t);return r==="[object Window]"||r==="[object global]"}function hi(t){return"nodeType"in t}function Mt(t){var r,n;return t?dn(t)?t:hi(t)&&(r=(n=t.ownerDocument)==null?void 0:n.defaultView)!=null?r:window:window}function fi(t){const{Document:r}=Mt(t);return t instanceof r}function va(t){return dn(t)?!1:t instanceof Mt(t).HTMLElement}function lu(t){return t instanceof Mt(t).SVGElement}function un(t){return t?dn(t)?t.document:hi(t)?fi(t)?t:va(t)||lu(t)?t.ownerDocument:document:document:document}const or=xo?l.useLayoutEffect:l.useEffect;function xi(t){const r=l.useRef(t);return or(()=>{r.current=t}),l.useCallback(function(){for(var n=arguments.length,s=new Array(n),a=0;a<n;a++)s[a]=arguments[a];return r.current==null?void 0:r.current(...s)},[])}function im(){const t=l.useRef(null),r=l.useCallback((s,a)=>{t.current=setInterval(s,a)},[]),n=l.useCallback(()=>{t.current!==null&&(clearInterval(t.current),t.current=null)},[]);return[r,n]}function ia(t,r){r===void 0&&(r=[t]);const n=l.useRef(t);return or(()=>{n.current!==t&&(n.current=t)},r),n}function ja(t,r){const n=l.useRef();return l.useMemo(()=>{const s=t(n.current);return n.current=s,s},[...r])}function Ka(t){const r=xi(t),n=l.useRef(null),s=l.useCallback(a=>{a!==n.current&&r?.(a,n.current),n.current=a},[]);return[n,s]}function Zo(t){const r=l.useRef();return l.useEffect(()=>{r.current=t},[t]),r.current}let Mo={};function wa(t,r){return l.useMemo(()=>{if(r)return r;const n=Mo[t]==null?0:Mo[t]+1;return Mo[t]=n,t+"-"+n},[t,r])}function cu(t){return function(r){for(var n=arguments.length,s=new Array(n>1?n-1:0),a=1;a<n;a++)s[a-1]=arguments[a];return s.reduce((o,i)=>{const c=Object.entries(i);for(const[u,d]of c){const f=o[u];f!=null&&(o[u]=f+t*d)}return o},{...r})}}const tn=cu(1),la=cu(-1);function lm(t){return"clientX"in t&&"clientY"in t}function pi(t){if(!t)return!1;const{KeyboardEvent:r}=Mt(t.target);return r&&t instanceof r}function cm(t){if(!t)return!1;const{TouchEvent:r}=Mt(t.target);return r&&t instanceof r}function ei(t){if(cm(t)){if(t.touches&&t.touches.length){const{clientX:r,clientY:n}=t.touches[0];return{x:r,y:n}}else if(t.changedTouches&&t.changedTouches.length){const{clientX:r,clientY:n}=t.changedTouches[0];return{x:r,y:n}}}return lm(t)?{x:t.clientX,y:t.clientY}:null}const ca=Object.freeze({Translate:{toString(t){if(!t)return;const{x:r,y:n}=t;return"translate3d("+(r?Math.round(r):0)+"px, "+(n?Math.round(n):0)+"px, 0)"}},Scale:{toString(t){if(!t)return;const{scaleX:r,scaleY:n}=t;return"scaleX("+r+") scaleY("+n+")"}},Transform:{toString(t){if(t)return[ca.Translate.toString(t),ca.Scale.toString(t)].join(" ")}},Transition:{toString(t){let{property:r,duration:n,easing:s}=t;return r+" "+n+"ms "+s}}}),Pl="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function dm(t){return t.matches(Pl)?t:t.querySelector(Pl)}const um={display:"none"};function hm(t){let{id:r,value:n}=t;return ze.createElement("div",{id:r,style:um},n)}function fm(t){let{id:r,announcement:n,ariaLiveType:s="assertive"}=t;const a={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return ze.createElement("div",{id:r,style:a,role:"status","aria-live":s,"aria-atomic":!0},n)}function xm(){const[t,r]=l.useState("");return{announce:l.useCallback(s=>{s!=null&&r(s)},[]),announcement:t}}const du=l.createContext(null);function pm(t){const r=l.useContext(du);l.useEffect(()=>{if(!r)throw new Error("useDndMonitor must be used within a children of <DndContext>");return r(t)},[t,r])}function mm(){const[t]=l.useState(()=>new Set),r=l.useCallback(s=>(t.add(s),()=>t.delete(s)),[t]);return[l.useCallback(s=>{let{type:a,event:o}=s;t.forEach(i=>{var c;return(c=i[a])==null?void 0:c.call(i,o)})},[t]),r]}const gm={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},ym={onDragStart(t){let{active:r}=t;return"Picked up draggable item "+r.id+"."},onDragOver(t){let{active:r,over:n}=t;return n?"Draggable item "+r.id+" was moved over droppable area "+n.id+".":"Draggable item "+r.id+" is no longer over a droppable area."},onDragEnd(t){let{active:r,over:n}=t;return n?"Draggable item "+r.id+" was dropped over droppable area "+n.id:"Draggable item "+r.id+" was dropped."},onDragCancel(t){let{active:r}=t;return"Dragging was cancelled. Draggable item "+r.id+" was dropped."}};function bm(t){let{announcements:r=ym,container:n,hiddenTextDescribedById:s,screenReaderInstructions:a=gm}=t;const{announce:o,announcement:i}=xm(),c=wa("DndLiveRegion"),[u,d]=l.useState(!1);if(l.useEffect(()=>{d(!0)},[]),pm(l.useMemo(()=>({onDragStart(p){let{active:g}=p;o(r.onDragStart({active:g}))},onDragMove(p){let{active:g,over:m}=p;r.onDragMove&&o(r.onDragMove({active:g,over:m}))},onDragOver(p){let{active:g,over:m}=p;o(r.onDragOver({active:g,over:m}))},onDragEnd(p){let{active:g,over:m}=p;o(r.onDragEnd({active:g,over:m}))},onDragCancel(p){let{active:g,over:m}=p;o(r.onDragCancel({active:g,over:m}))}}),[o,r])),!u)return null;const f=ze.createElement(ze.Fragment,null,ze.createElement(hm,{id:s,value:a.draggable}),ze.createElement(fm,{id:c,announcement:i}));return n?Ys.createPortal(f,n):f}var ot;(function(t){t.DragStart="dragStart",t.DragMove="dragMove",t.DragEnd="dragEnd",t.DragCancel="dragCancel",t.DragOver="dragOver",t.RegisterDroppable="registerDroppable",t.SetDroppableDisabled="setDroppableDisabled",t.UnregisterDroppable="unregisterDroppable"})(ot||(ot={}));function Xa(){}function rn(t,r){return l.useMemo(()=>({sensor:t,options:r??{}}),[t,r])}function uu(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return l.useMemo(()=>[...r].filter(s=>s!=null),[...r])}const Xt=Object.freeze({x:0,y:0});function hu(t,r){return Math.sqrt(Math.pow(t.x-r.x,2)+Math.pow(t.y-r.y,2))}function fu(t,r){let{data:{value:n}}=t,{data:{value:s}}=r;return n-s}function vm(t,r){let{data:{value:n}}=t,{data:{value:s}}=r;return s-n}function Dl(t){let{left:r,top:n,height:s,width:a}=t;return[{x:r,y:n},{x:r+a,y:n},{x:r,y:n+s},{x:r+a,y:n+s}]}function xu(t,r){if(!t||t.length===0)return null;const[n]=t;return n[r]}function Ml(t,r,n){return r===void 0&&(r=t.left),n===void 0&&(n=t.top),{x:r+t.width*.5,y:n+t.height*.5}}const pu=t=>{let{collisionRect:r,droppableRects:n,droppableContainers:s}=t;const a=Ml(r,r.left,r.top),o=[];for(const i of s){const{id:c}=i,u=n.get(c);if(u){const d=hu(Ml(u),a);o.push({id:c,data:{droppableContainer:i,value:d}})}}return o.sort(fu)},jm=t=>{let{collisionRect:r,droppableRects:n,droppableContainers:s}=t;const a=Dl(r),o=[];for(const i of s){const{id:c}=i,u=n.get(c);if(u){const d=Dl(u),f=a.reduce((g,m,y)=>g+hu(d[y],m),0),p=Number((f/4).toFixed(4));o.push({id:c,data:{droppableContainer:i,value:p}})}}return o.sort(fu)};function wm(t,r){const n=Math.max(r.top,t.top),s=Math.max(r.left,t.left),a=Math.min(r.left+r.width,t.left+t.width),o=Math.min(r.top+r.height,t.top+t.height),i=a-s,c=o-n;if(s<a&&n<o){const u=r.width*r.height,d=t.width*t.height,f=i*c,p=f/(u+d-f);return Number(p.toFixed(4))}return 0}const Sm=t=>{let{collisionRect:r,droppableRects:n,droppableContainers:s}=t;const a=[];for(const o of s){const{id:i}=o,c=n.get(i);if(c){const u=wm(c,r);u>0&&a.push({id:i,data:{droppableContainer:o,value:u}})}}return a.sort(vm)};function Cm(t,r,n){return{...t,scaleX:r&&n?r.width/n.width:1,scaleY:r&&n?r.height/n.height:1}}function mu(t,r){return t&&r?{x:t.left-r.left,y:t.top-r.top}:Xt}function km(t){return function(n){for(var s=arguments.length,a=new Array(s>1?s-1:0),o=1;o<s;o++)a[o-1]=arguments[o];return a.reduce((i,c)=>({...i,top:i.top+t*c.y,bottom:i.bottom+t*c.y,left:i.left+t*c.x,right:i.right+t*c.x}),{...n})}}const _m=km(1);function Rm(t){if(t.startsWith("matrix3d(")){const r=t.slice(9,-1).split(/, /);return{x:+r[12],y:+r[13],scaleX:+r[0],scaleY:+r[5]}}else if(t.startsWith("matrix(")){const r=t.slice(7,-1).split(/, /);return{x:+r[4],y:+r[5],scaleX:+r[0],scaleY:+r[3]}}return null}function Im(t,r,n){const s=Rm(r);if(!s)return t;const{scaleX:a,scaleY:o,x:i,y:c}=s,u=t.left-i-(1-a)*parseFloat(n),d=t.top-c-(1-o)*parseFloat(n.slice(n.indexOf(" ")+1)),f=a?t.width/a:t.width,p=o?t.height/o:t.height;return{width:f,height:p,top:d,right:u+f,bottom:d+p,left:u}}const Am={ignoreTransform:!1};function hn(t,r){r===void 0&&(r=Am);let n=t.getBoundingClientRect();if(r.ignoreTransform){const{transform:d,transformOrigin:f}=Mt(t).getComputedStyle(t);d&&(n=Im(n,d,f))}const{top:s,left:a,width:o,height:i,bottom:c,right:u}=n;return{top:s,left:a,width:o,height:i,bottom:c,right:u}}function El(t){return hn(t,{ignoreTransform:!0})}function Pm(t){const r=t.innerWidth,n=t.innerHeight;return{top:0,left:0,right:r,bottom:n,width:r,height:n}}function Dm(t,r){return r===void 0&&(r=Mt(t).getComputedStyle(t)),r.position==="fixed"}function Mm(t,r){r===void 0&&(r=Mt(t).getComputedStyle(t));const n=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(a=>{const o=r[a];return typeof o=="string"?n.test(o):!1})}function po(t,r){const n=[];function s(a){if(r!=null&&n.length>=r||!a)return n;if(fi(a)&&a.scrollingElement!=null&&!n.includes(a.scrollingElement))return n.push(a.scrollingElement),n;if(!va(a)||lu(a)||n.includes(a))return n;const o=Mt(t).getComputedStyle(a);return a!==t&&Mm(a,o)&&n.push(a),Dm(a,o)?n:s(a.parentNode)}return t?s(t):n}function gu(t){const[r]=po(t,1);return r??null}function Eo(t){return!xo||!t?null:dn(t)?t:hi(t)?fi(t)||t===un(t).scrollingElement?window:va(t)?t:null:null}function yu(t){return dn(t)?t.scrollX:t.scrollLeft}function bu(t){return dn(t)?t.scrollY:t.scrollTop}function ti(t){return{x:yu(t),y:bu(t)}}var ct;(function(t){t[t.Forward=1]="Forward",t[t.Backward=-1]="Backward"})(ct||(ct={}));function vu(t){return!xo||!t?!1:t===document.scrollingElement}function ju(t){const r={x:0,y:0},n=vu(t)?{height:window.innerHeight,width:window.innerWidth}:{height:t.clientHeight,width:t.clientWidth},s={x:t.scrollWidth-n.width,y:t.scrollHeight-n.height},a=t.scrollTop<=r.y,o=t.scrollLeft<=r.x,i=t.scrollTop>=s.y,c=t.scrollLeft>=s.x;return{isTop:a,isLeft:o,isBottom:i,isRight:c,maxScroll:s,minScroll:r}}const Em={x:.2,y:.2};function Tm(t,r,n,s,a){let{top:o,left:i,right:c,bottom:u}=n;s===void 0&&(s=10),a===void 0&&(a=Em);const{isTop:d,isBottom:f,isLeft:p,isRight:g}=ju(t),m={x:0,y:0},y={x:0,y:0},j={height:r.height*a.y,width:r.width*a.x};return!d&&o<=r.top+j.height?(m.y=ct.Backward,y.y=s*Math.abs((r.top+j.height-o)/j.height)):!f&&u>=r.bottom-j.height&&(m.y=ct.Forward,y.y=s*Math.abs((r.bottom-j.height-u)/j.height)),!g&&c>=r.right-j.width?(m.x=ct.Forward,y.x=s*Math.abs((r.right-j.width-c)/j.width)):!p&&i<=r.left+j.width&&(m.x=ct.Backward,y.x=s*Math.abs((r.left+j.width-i)/j.width)),{direction:m,speed:y}}function zm(t){if(t===document.scrollingElement){const{innerWidth:o,innerHeight:i}=window;return{top:0,left:0,right:o,bottom:i,width:o,height:i}}const{top:r,left:n,right:s,bottom:a}=t.getBoundingClientRect();return{top:r,left:n,right:s,bottom:a,width:t.clientWidth,height:t.clientHeight}}function wu(t){return t.reduce((r,n)=>tn(r,ti(n)),Xt)}function Om(t){return t.reduce((r,n)=>r+yu(n),0)}function Fm(t){return t.reduce((r,n)=>r+bu(n),0)}function Lm(t,r){if(r===void 0&&(r=hn),!t)return;const{top:n,left:s,bottom:a,right:o}=r(t);gu(t)&&(a<=0||o<=0||n>=window.innerHeight||s>=window.innerWidth)&&t.scrollIntoView({block:"center",inline:"center"})}const Wm=[["x",["left","right"],Om],["y",["top","bottom"],Fm]];class mi{constructor(r,n){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const s=po(n),a=wu(s);this.rect={...r},this.width=r.width,this.height=r.height;for(const[o,i,c]of Wm)for(const u of i)Object.defineProperty(this,u,{get:()=>{const d=c(s),f=a[o]-d;return this.rect[u]+f},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Qs{constructor(r){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(n=>{var s;return(s=this.target)==null?void 0:s.removeEventListener(...n)})},this.target=r}add(r,n,s){var a;(a=this.target)==null||a.addEventListener(r,n,s),this.listeners.push([r,n,s])}}function $m(t){const{EventTarget:r}=Mt(t);return t instanceof r?t:un(t)}function To(t,r){const n=Math.abs(t.x),s=Math.abs(t.y);return typeof r=="number"?Math.sqrt(n**2+s**2)>r:"x"in r&&"y"in r?n>r.x&&s>r.y:"x"in r?n>r.x:"y"in r?s>r.y:!1}var Nt;(function(t){t.Click="click",t.DragStart="dragstart",t.Keydown="keydown",t.ContextMenu="contextmenu",t.Resize="resize",t.SelectionChange="selectionchange",t.VisibilityChange="visibilitychange"})(Nt||(Nt={}));function Tl(t){t.preventDefault()}function Bm(t){t.stopPropagation()}var Me;(function(t){t.Space="Space",t.Down="ArrowDown",t.Right="ArrowRight",t.Left="ArrowLeft",t.Up="ArrowUp",t.Esc="Escape",t.Enter="Enter",t.Tab="Tab"})(Me||(Me={}));const Su={start:[Me.Space,Me.Enter],cancel:[Me.Esc],end:[Me.Space,Me.Enter,Me.Tab]},qm=(t,r)=>{let{currentCoordinates:n}=r;switch(t.code){case Me.Right:return{...n,x:n.x+25};case Me.Left:return{...n,x:n.x-25};case Me.Down:return{...n,y:n.y+25};case Me.Up:return{...n,y:n.y-25}}};class mo{constructor(r){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=r;const{event:{target:n}}=r;this.props=r,this.listeners=new Qs(un(n)),this.windowListeners=new Qs(Mt(n)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(Nt.Resize,this.handleCancel),this.windowListeners.add(Nt.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(Nt.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:r,onStart:n}=this.props,s=r.node.current;s&&Lm(s),n(Xt)}handleKeyDown(r){if(pi(r)){const{active:n,context:s,options:a}=this.props,{keyboardCodes:o=Su,coordinateGetter:i=qm,scrollBehavior:c="smooth"}=a,{code:u}=r;if(o.end.includes(u)){this.handleEnd(r);return}if(o.cancel.includes(u)){this.handleCancel(r);return}const{collisionRect:d}=s.current,f=d?{x:d.left,y:d.top}:Xt;this.referenceCoordinates||(this.referenceCoordinates=f);const p=i(r,{active:n,context:s.current,currentCoordinates:f});if(p){const g=la(p,f),m={x:0,y:0},{scrollableAncestors:y}=s.current;for(const j of y){const C=r.code,{isTop:w,isRight:b,isLeft:v,isBottom:S,maxScroll:A,minScroll:E}=ju(j),P=zm(j),k={x:Math.min(C===Me.Right?P.right-P.width/2:P.right,Math.max(C===Me.Right?P.left:P.left+P.width/2,p.x)),y:Math.min(C===Me.Down?P.bottom-P.height/2:P.bottom,Math.max(C===Me.Down?P.top:P.top+P.height/2,p.y))},R=C===Me.Right&&!b||C===Me.Left&&!v,z=C===Me.Down&&!S||C===Me.Up&&!w;if(R&&k.x!==p.x){const B=j.scrollLeft+g.x,F=C===Me.Right&&B<=A.x||C===Me.Left&&B>=E.x;if(F&&!g.y){j.scrollTo({left:B,behavior:c});return}F?m.x=j.scrollLeft-B:m.x=C===Me.Right?j.scrollLeft-A.x:j.scrollLeft-E.x,m.x&&j.scrollBy({left:-m.x,behavior:c});break}else if(z&&k.y!==p.y){const B=j.scrollTop+g.y,F=C===Me.Down&&B<=A.y||C===Me.Up&&B>=E.y;if(F&&!g.x){j.scrollTo({top:B,behavior:c});return}F?m.y=j.scrollTop-B:m.y=C===Me.Down?j.scrollTop-A.y:j.scrollTop-E.y,m.y&&j.scrollBy({top:-m.y,behavior:c});break}}this.handleMove(r,tn(la(p,this.referenceCoordinates),m))}}}handleMove(r,n){const{onMove:s}=this.props;r.preventDefault(),s(n)}handleEnd(r){const{onEnd:n}=this.props;r.preventDefault(),this.detach(),n()}handleCancel(r){const{onCancel:n}=this.props;r.preventDefault(),this.detach(),n()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}mo.activators=[{eventName:"onKeyDown",handler:(t,r,n)=>{let{keyboardCodes:s=Su,onActivation:a}=r,{active:o}=n;const{code:i}=t.nativeEvent;if(s.start.includes(i)){const c=o.activatorNode.current;return c&&t.target!==c?!1:(t.preventDefault(),a?.({event:t.nativeEvent}),!0)}return!1}}];function zl(t){return!!(t&&"distance"in t)}function Ol(t){return!!(t&&"delay"in t)}class gi{constructor(r,n,s){var a;s===void 0&&(s=$m(r.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=r,this.events=n;const{event:o}=r,{target:i}=o;this.props=r,this.events=n,this.document=un(i),this.documentListeners=new Qs(this.document),this.listeners=new Qs(s),this.windowListeners=new Qs(Mt(i)),this.initialCoordinates=(a=ei(o))!=null?a:Xt,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:r,props:{options:{activationConstraint:n,bypassActivationConstraint:s}}}=this;if(this.listeners.add(r.move.name,this.handleMove,{passive:!1}),this.listeners.add(r.end.name,this.handleEnd),r.cancel&&this.listeners.add(r.cancel.name,this.handleCancel),this.windowListeners.add(Nt.Resize,this.handleCancel),this.windowListeners.add(Nt.DragStart,Tl),this.windowListeners.add(Nt.VisibilityChange,this.handleCancel),this.windowListeners.add(Nt.ContextMenu,Tl),this.documentListeners.add(Nt.Keydown,this.handleKeydown),n){if(s!=null&&s({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(Ol(n)){this.timeoutId=setTimeout(this.handleStart,n.delay),this.handlePending(n);return}if(zl(n)){this.handlePending(n);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(r,n){const{active:s,onPending:a}=this.props;a(s,r,this.initialCoordinates,n)}handleStart(){const{initialCoordinates:r}=this,{onStart:n}=this.props;r&&(this.activated=!0,this.documentListeners.add(Nt.Click,Bm,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(Nt.SelectionChange,this.removeTextSelection),n(r))}handleMove(r){var n;const{activated:s,initialCoordinates:a,props:o}=this,{onMove:i,options:{activationConstraint:c}}=o;if(!a)return;const u=(n=ei(r))!=null?n:Xt,d=la(a,u);if(!s&&c){if(zl(c)){if(c.tolerance!=null&&To(d,c.tolerance))return this.handleCancel();if(To(d,c.distance))return this.handleStart()}if(Ol(c)&&To(d,c.tolerance))return this.handleCancel();this.handlePending(c,d);return}r.cancelable&&r.preventDefault(),i(u)}handleEnd(){const{onAbort:r,onEnd:n}=this.props;this.detach(),this.activated||r(this.props.active),n()}handleCancel(){const{onAbort:r,onCancel:n}=this.props;this.detach(),this.activated||r(this.props.active),n()}handleKeydown(r){r.code===Me.Esc&&this.handleCancel()}removeTextSelection(){var r;(r=this.document.getSelection())==null||r.removeAllRanges()}}const Nm={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class go extends gi{constructor(r){const{event:n}=r,s=un(n.target);super(r,Nm,s)}}go.activators=[{eventName:"onPointerDown",handler:(t,r)=>{let{nativeEvent:n}=t,{onActivation:s}=r;return!n.isPrimary||n.button!==0?!1:(s?.({event:n}),!0)}}];const Um={move:{name:"mousemove"},end:{name:"mouseup"}};var ri;(function(t){t[t.RightClick=2]="RightClick"})(ri||(ri={}));class Hm extends gi{constructor(r){super(r,Um,un(r.event.target))}}Hm.activators=[{eventName:"onMouseDown",handler:(t,r)=>{let{nativeEvent:n}=t,{onActivation:s}=r;return n.button===ri.RightClick?!1:(s?.({event:n}),!0)}}];const zo={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class yi extends gi{constructor(r){super(r,zo)}static setup(){return window.addEventListener(zo.move.name,r,{capture:!1,passive:!1}),function(){window.removeEventListener(zo.move.name,r)};function r(){}}}yi.activators=[{eventName:"onTouchStart",handler:(t,r)=>{let{nativeEvent:n}=t,{onActivation:s}=r;const{touches:a}=n;return a.length>1?!1:(s?.({event:n}),!0)}}];var Ks;(function(t){t[t.Pointer=0]="Pointer",t[t.DraggableRect=1]="DraggableRect"})(Ks||(Ks={}));var Ja;(function(t){t[t.TreeOrder=0]="TreeOrder",t[t.ReversedTreeOrder=1]="ReversedTreeOrder"})(Ja||(Ja={}));function Vm(t){let{acceleration:r,activator:n=Ks.Pointer,canScroll:s,draggingRect:a,enabled:o,interval:i=5,order:c=Ja.TreeOrder,pointerCoordinates:u,scrollableAncestors:d,scrollableAncestorRects:f,delta:p,threshold:g}=t;const m=Gm({delta:p,disabled:!o}),[y,j]=im(),C=l.useRef({x:0,y:0}),w=l.useRef({x:0,y:0}),b=l.useMemo(()=>{switch(n){case Ks.Pointer:return u?{top:u.y,bottom:u.y,left:u.x,right:u.x}:null;case Ks.DraggableRect:return a}},[n,a,u]),v=l.useRef(null),S=l.useCallback(()=>{const E=v.current;if(!E)return;const P=C.current.x*w.current.x,k=C.current.y*w.current.y;E.scrollBy(P,k)},[]),A=l.useMemo(()=>c===Ja.TreeOrder?[...d].reverse():d,[c,d]);l.useEffect(()=>{if(!o||!d.length||!b){j();return}for(const E of A){if(s?.(E)===!1)continue;const P=d.indexOf(E),k=f[P];if(!k)continue;const{direction:R,speed:z}=Tm(E,k,b,r,g);for(const B of["x","y"])m[B][R[B]]||(z[B]=0,R[B]=0);if(z.x>0||z.y>0){j(),v.current=E,y(S,i),C.current=z,w.current=R;return}}C.current={x:0,y:0},w.current={x:0,y:0},j()},[r,S,s,j,o,i,JSON.stringify(b),JSON.stringify(m),y,d,A,f,JSON.stringify(g)])}const Ym={x:{[ct.Backward]:!1,[ct.Forward]:!1},y:{[ct.Backward]:!1,[ct.Forward]:!1}};function Gm(t){let{delta:r,disabled:n}=t;const s=Zo(r);return ja(a=>{if(n||!s||!a)return Ym;const o={x:Math.sign(r.x-s.x),y:Math.sign(r.y-s.y)};return{x:{[ct.Backward]:a.x[ct.Backward]||o.x===-1,[ct.Forward]:a.x[ct.Forward]||o.x===1},y:{[ct.Backward]:a.y[ct.Backward]||o.y===-1,[ct.Forward]:a.y[ct.Forward]||o.y===1}}},[n,r,s])}function Qm(t,r){const n=r!=null?t.get(r):void 0,s=n?n.node.current:null;return ja(a=>{var o;return r==null?null:(o=s??a)!=null?o:null},[s,r])}function Km(t,r){return l.useMemo(()=>t.reduce((n,s)=>{const{sensor:a}=s,o=a.activators.map(i=>({eventName:i.eventName,handler:r(i.handler,s)}));return[...n,...o]},[]),[t,r])}var da;(function(t){t[t.Always=0]="Always",t[t.BeforeDragging=1]="BeforeDragging",t[t.WhileDragging=2]="WhileDragging"})(da||(da={}));var ni;(function(t){t.Optimized="optimized"})(ni||(ni={}));const Fl=new Map;function Xm(t,r){let{dragging:n,dependencies:s,config:a}=r;const[o,i]=l.useState(null),{frequency:c,measure:u,strategy:d}=a,f=l.useRef(t),p=C(),g=ia(p),m=l.useCallback(function(w){w===void 0&&(w=[]),!g.current&&i(b=>b===null?w:b.concat(w.filter(v=>!b.includes(v))))},[g]),y=l.useRef(null),j=ja(w=>{if(p&&!n)return Fl;if(!w||w===Fl||f.current!==t||o!=null){const b=new Map;for(let v of t){if(!v)continue;if(o&&o.length>0&&!o.includes(v.id)&&v.rect.current){b.set(v.id,v.rect.current);continue}const S=v.node.current,A=S?new mi(u(S),S):null;v.rect.current=A,A&&b.set(v.id,A)}return b}return w},[t,o,n,p,u]);return l.useEffect(()=>{f.current=t},[t]),l.useEffect(()=>{p||m()},[n,p]),l.useEffect(()=>{o&&o.length>0&&i(null)},[JSON.stringify(o)]),l.useEffect(()=>{p||typeof c!="number"||y.current!==null||(y.current=setTimeout(()=>{m(),y.current=null},c))},[c,p,m,...s]),{droppableRects:j,measureDroppableContainers:m,measuringScheduled:o!=null};function C(){switch(d){case da.Always:return!1;case da.BeforeDragging:return n;default:return!n}}}function Cu(t,r){return ja(n=>t?n||(typeof r=="function"?r(t):t):null,[r,t])}function Jm(t,r){return Cu(t,r)}function Zm(t){let{callback:r,disabled:n}=t;const s=xi(r),a=l.useMemo(()=>{if(n||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:o}=window;return new o(s)},[s,n]);return l.useEffect(()=>()=>a?.disconnect(),[a]),a}function yo(t){let{callback:r,disabled:n}=t;const s=xi(r),a=l.useMemo(()=>{if(n||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:o}=window;return new o(s)},[n]);return l.useEffect(()=>()=>a?.disconnect(),[a]),a}function eg(t){return new mi(hn(t),t)}function Ll(t,r,n){r===void 0&&(r=eg);const[s,a]=l.useState(null);function o(){a(u=>{if(!t)return null;if(t.isConnected===!1){var d;return(d=u??n)!=null?d:null}const f=r(t);return JSON.stringify(u)===JSON.stringify(f)?u:f})}const i=Zm({callback(u){if(t)for(const d of u){const{type:f,target:p}=d;if(f==="childList"&&p instanceof HTMLElement&&p.contains(t)){o();break}}}}),c=yo({callback:o});return or(()=>{o(),t?(c?.observe(t),i?.observe(document.body,{childList:!0,subtree:!0})):(c?.disconnect(),i?.disconnect())},[t]),s}function tg(t){const r=Cu(t);return mu(t,r)}const Wl=[];function rg(t){const r=l.useRef(t),n=ja(s=>t?s&&s!==Wl&&t&&r.current&&t.parentNode===r.current.parentNode?s:po(t):Wl,[t]);return l.useEffect(()=>{r.current=t},[t]),n}function ng(t){const[r,n]=l.useState(null),s=l.useRef(t),a=l.useCallback(o=>{const i=Eo(o.target);i&&n(c=>c?(c.set(i,ti(i)),new Map(c)):null)},[]);return l.useEffect(()=>{const o=s.current;if(t!==o){i(o);const c=t.map(u=>{const d=Eo(u);return d?(d.addEventListener("scroll",a,{passive:!0}),[d,ti(d)]):null}).filter(u=>u!=null);n(c.length?new Map(c):null),s.current=t}return()=>{i(t),i(o)};function i(c){c.forEach(u=>{const d=Eo(u);d?.removeEventListener("scroll",a)})}},[a,t]),l.useMemo(()=>t.length?r?Array.from(r.values()).reduce((o,i)=>tn(o,i),Xt):wu(t):Xt,[t,r])}function $l(t,r){r===void 0&&(r=[]);const n=l.useRef(null);return l.useEffect(()=>{n.current=null},r),l.useEffect(()=>{const s=t!==Xt;s&&!n.current&&(n.current=t),!s&&n.current&&(n.current=null)},[t]),n.current?la(t,n.current):Xt}function sg(t){l.useEffect(()=>{if(!xo)return;const r=t.map(n=>{let{sensor:s}=n;return s.setup==null?void 0:s.setup()});return()=>{for(const n of r)n?.()}},t.map(r=>{let{sensor:n}=r;return n}))}function ag(t,r){return l.useMemo(()=>t.reduce((n,s)=>{let{eventName:a,handler:o}=s;return n[a]=i=>{o(i,r)},n},{}),[t,r])}function ku(t){return l.useMemo(()=>t?Pm(t):null,[t])}const Bl=[];function og(t,r){r===void 0&&(r=hn);const[n]=t,s=ku(n?Mt(n):null),[a,o]=l.useState(Bl);function i(){o(()=>t.length?t.map(u=>vu(u)?s:new mi(r(u),u)):Bl)}const c=yo({callback:i});return or(()=>{c?.disconnect(),i(),t.forEach(u=>c?.observe(u))},[t]),a}function ig(t){if(!t)return null;if(t.children.length>1)return t;const r=t.children[0];return va(r)?r:t}function lg(t){let{measure:r}=t;const[n,s]=l.useState(null),a=l.useCallback(d=>{for(const{target:f}of d)if(va(f)){s(p=>{const g=r(f);return p?{...p,width:g.width,height:g.height}:g});break}},[r]),o=yo({callback:a}),i=l.useCallback(d=>{const f=ig(d);o?.disconnect(),f&&o?.observe(f),s(f?r(f):null)},[r,o]),[c,u]=Ka(i);return l.useMemo(()=>({nodeRef:c,rect:n,setRef:u}),[n,c,u])}const cg=[{sensor:go,options:{}},{sensor:mo,options:{}}],dg={current:{}},Ua={draggable:{measure:El},droppable:{measure:El,strategy:da.WhileDragging,frequency:ni.Optimized},dragOverlay:{measure:hn}};class Xs extends Map{get(r){var n;return r!=null&&(n=super.get(r))!=null?n:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(r=>{let{disabled:n}=r;return!n})}getNodeFor(r){var n,s;return(n=(s=this.get(r))==null?void 0:s.node.current)!=null?n:void 0}}const ug={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new Xs,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:Xa},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:Ua,measureDroppableContainers:Xa,windowRect:null,measuringScheduled:!1},hg={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:Xa,draggableNodes:new Map,over:null,measureDroppableContainers:Xa},bo=l.createContext(hg),_u=l.createContext(ug);function fg(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new Xs}}}function xg(t,r){switch(r.type){case ot.DragStart:return{...t,draggable:{...t.draggable,initialCoordinates:r.initialCoordinates,active:r.active}};case ot.DragMove:return t.draggable.active==null?t:{...t,draggable:{...t.draggable,translate:{x:r.coordinates.x-t.draggable.initialCoordinates.x,y:r.coordinates.y-t.draggable.initialCoordinates.y}}};case ot.DragEnd:case ot.DragCancel:return{...t,draggable:{...t.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case ot.RegisterDroppable:{const{element:n}=r,{id:s}=n,a=new Xs(t.droppable.containers);return a.set(s,n),{...t,droppable:{...t.droppable,containers:a}}}case ot.SetDroppableDisabled:{const{id:n,key:s,disabled:a}=r,o=t.droppable.containers.get(n);if(!o||s!==o.key)return t;const i=new Xs(t.droppable.containers);return i.set(n,{...o,disabled:a}),{...t,droppable:{...t.droppable,containers:i}}}case ot.UnregisterDroppable:{const{id:n,key:s}=r,a=t.droppable.containers.get(n);if(!a||s!==a.key)return t;const o=new Xs(t.droppable.containers);return o.delete(n),{...t,droppable:{...t.droppable,containers:o}}}default:return t}}function pg(t){let{disabled:r}=t;const{active:n,activatorEvent:s,draggableNodes:a}=l.useContext(bo),o=Zo(s),i=Zo(n?.id);return l.useEffect(()=>{if(!r&&!s&&o&&i!=null){if(!pi(o)||document.activeElement===o.target)return;const c=a.get(i);if(!c)return;const{activatorNode:u,node:d}=c;if(!u.current&&!d.current)return;requestAnimationFrame(()=>{for(const f of[u.current,d.current]){if(!f)continue;const p=dm(f);if(p){p.focus();break}}})}},[s,r,a,i,o]),null}function mg(t,r){let{transform:n,...s}=r;return t!=null&&t.length?t.reduce((a,o)=>o({transform:a,...s}),n):n}function gg(t){return l.useMemo(()=>({draggable:{...Ua.draggable,...t?.draggable},droppable:{...Ua.droppable,...t?.droppable},dragOverlay:{...Ua.dragOverlay,...t?.dragOverlay}}),[t?.draggable,t?.droppable,t?.dragOverlay])}function yg(t){let{activeNode:r,measure:n,initialRect:s,config:a=!0}=t;const o=l.useRef(!1),{x:i,y:c}=typeof a=="boolean"?{x:a,y:a}:a;or(()=>{if(!i&&!c||!r){o.current=!1;return}if(o.current||!s)return;const d=r?.node.current;if(!d||d.isConnected===!1)return;const f=n(d),p=mu(f,s);if(i||(p.x=0),c||(p.y=0),o.current=!0,Math.abs(p.x)>0||Math.abs(p.y)>0){const g=gu(d);g&&g.scrollBy({top:p.y,left:p.x})}},[r,i,c,s,n])}const Ru=l.createContext({...Xt,scaleX:1,scaleY:1});var br;(function(t){t[t.Uninitialized=0]="Uninitialized",t[t.Initializing=1]="Initializing",t[t.Initialized=2]="Initialized"})(br||(br={}));const Iu=l.memo(function(r){var n,s,a,o;let{id:i,accessibility:c,autoScroll:u=!0,children:d,sensors:f=cg,collisionDetection:p=Sm,measuring:g,modifiers:m,...y}=r;const j=l.useReducer(xg,void 0,fg),[C,w]=j,[b,v]=mm(),[S,A]=l.useState(br.Uninitialized),E=S===br.Initialized,{draggable:{active:P,nodes:k,translate:R},droppable:{containers:z}}=C,B=P!=null?k.get(P):null,F=l.useRef({initial:null,translated:null}),W=l.useMemo(()=>{var st;return P!=null?{id:P,data:(st=B?.data)!=null?st:dg,rect:F}:null},[P,B]),H=l.useRef(null),[I,_]=l.useState(null),[O,D]=l.useState(null),Q=ia(y,Object.values(y)),J=wa("DndDescribedBy",i),M=l.useMemo(()=>z.getEnabled(),[z]),T=gg(g),{droppableRects:te,measureDroppableContainers:$,measuringScheduled:U}=Xm(M,{dragging:E,dependencies:[R.x,R.y],config:T.droppable}),K=Qm(k,P),ce=l.useMemo(()=>O?ei(O):null,[O]),q=Nr(),oe=Jm(K,T.draggable.measure);yg({activeNode:P!=null?k.get(P):null,config:q.layoutShiftCompensation,initialRect:oe,measure:T.draggable.measure});const ie=Ll(K,T.draggable.measure,oe),Ue=Ll(K?K.parentElement:null),Be=l.useRef({activatorEvent:null,active:null,activeNode:K,collisionRect:null,collisions:null,droppableRects:te,draggableNodes:k,draggingNode:null,draggingNodeRect:null,droppableContainers:z,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),le=z.getNodeFor((n=Be.current.over)==null?void 0:n.id),xe=lg({measure:T.dragOverlay.measure}),ge=(s=xe.nodeRef.current)!=null?s:K,me=E?(a=xe.rect)!=null?a:ie:null,ye=!!(xe.nodeRef.current&&xe.rect),Et=tg(ye?null:ie),xr=ku(ge?Mt(ge):null),ft=rg(E?le??K:null),ir=og(ft),Zt=mg(m,{transform:{x:R.x-Et.x,y:R.y-Et.y,scaleX:1,scaleY:1},activatorEvent:O,active:W,activeNodeRect:ie,containerNodeRect:Ue,draggingNodeRect:me,over:Be.current.over,overlayNodeRect:xe.rect,scrollableAncestors:ft,scrollableAncestorRects:ir,windowRect:xr}),pr=ce?tn(ce,R):null,Tt=ng(ft),kr=$l(Tt),Vt=$l(Tt,[ie]),bt=tn(Zt,kr),G=me?_m(me,Zt):null,fe=W&&G?p({active:W,collisionRect:G,droppableRects:te,droppableContainers:M,pointerCoordinates:pr}):null,be=xu(fe,"id"),[Se,De]=l.useState(null),Oe=ye?Zt:tn(Zt,Vt),vt=Cm(Oe,(o=Se?.rect)!=null?o:null,ie),Yt=l.useRef(null),lr=l.useCallback((st,jt)=>{let{sensor:xt,options:de}=jt;if(H.current==null)return;const wt=k.get(H.current);if(!wt)return;const He=st.nativeEvent,Je=new xt({active:H.current,activeNode:wt,event:He,options:de,context:Be,onAbort(Ye){if(!k.get(Ye))return;const{onDragAbort:_t}=Q.current,lt={id:Ye};_t?.(lt),b({type:"onDragAbort",event:lt})},onPending(Ye,St,_t,lt){if(!k.get(Ye))return;const{onDragPending:mr}=Q.current,$t={id:Ye,constraint:St,initialCoordinates:_t,offset:lt};mr?.($t),b({type:"onDragPending",event:$t})},onStart(Ye){const St=H.current;if(St==null)return;const _t=k.get(St);if(!_t)return;const{onDragStart:lt}=Q.current,Ze={activatorEvent:He,active:{id:St,data:_t.data,rect:F}};Ys.unstable_batchedUpdates(()=>{lt?.(Ze),A(br.Initializing),w({type:ot.DragStart,initialCoordinates:Ye,active:St}),b({type:"onDragStart",event:Ze}),_(Yt.current),D(He)})},onMove(Ye){w({type:ot.DragMove,coordinates:Ye})},onEnd:cr(ot.DragEnd),onCancel:cr(ot.DragCancel)});Yt.current=Je;function cr(Ye){return async function(){const{active:_t,collisions:lt,over:Ze,scrollAdjustedTranslate:mr}=Be.current;let $t=null;if(_t&&mr){const{cancelDrop:dr}=Q.current;$t={activatorEvent:He,active:_t,collisions:lt,delta:mr,over:Ze},Ye===ot.DragEnd&&typeof dr=="function"&&await Promise.resolve(dr($t))&&(Ye=ot.DragCancel)}H.current=null,Ys.unstable_batchedUpdates(()=>{w({type:Ye}),A(br.Uninitialized),De(null),_(null),D(null),Yt.current=null;const dr=Ye===ot.DragEnd?"onDragEnd":"onDragCancel";if($t){const gr=Q.current[dr];gr?.($t),b({type:dr,event:$t})}})}}},[k]),fn=l.useCallback((st,jt)=>(xt,de)=>{const wt=xt.nativeEvent,He=k.get(de);if(H.current!==null||!He||wt.dndKit||wt.defaultPrevented)return;const Je={active:He};st(xt,jt.options,Je)===!0&&(wt.dndKit={capturedBy:jt.sensor},H.current=de,lr(xt,jt))},[k,lr]),zt=Km(f,fn);sg(f),or(()=>{ie&&S===br.Initializing&&A(br.Initialized)},[ie,S]),l.useEffect(()=>{const{onDragMove:st}=Q.current,{active:jt,activatorEvent:xt,collisions:de,over:wt}=Be.current;if(!jt||!xt)return;const He={active:jt,activatorEvent:xt,collisions:de,delta:{x:bt.x,y:bt.y},over:wt};Ys.unstable_batchedUpdates(()=>{st?.(He),b({type:"onDragMove",event:He})})},[bt.x,bt.y]),l.useEffect(()=>{const{active:st,activatorEvent:jt,collisions:xt,droppableContainers:de,scrollAdjustedTranslate:wt}=Be.current;if(!st||H.current==null||!jt||!wt)return;const{onDragOver:He}=Q.current,Je=de.get(be),cr=Je&&Je.rect.current?{id:Je.id,rect:Je.rect.current,data:Je.data,disabled:Je.disabled}:null,Ye={active:st,activatorEvent:jt,collisions:xt,delta:{x:wt.x,y:wt.y},over:cr};Ys.unstable_batchedUpdates(()=>{De(cr),He?.(Ye),b({type:"onDragOver",event:Ye})})},[be]),or(()=>{Be.current={activatorEvent:O,active:W,activeNode:K,collisionRect:G,collisions:fe,droppableRects:te,draggableNodes:k,draggingNode:ge,draggingNodeRect:me,droppableContainers:z,over:Se,scrollableAncestors:ft,scrollAdjustedTranslate:bt},F.current={initial:me,translated:G}},[W,K,fe,G,k,ge,me,te,z,Se,ft,bt]),Vm({...q,delta:R,draggingRect:G,pointerCoordinates:pr,scrollableAncestors:ft,scrollableAncestorRects:ir});const xn=l.useMemo(()=>({active:W,activeNode:K,activeNodeRect:ie,activatorEvent:O,collisions:fe,containerNodeRect:Ue,dragOverlay:xe,draggableNodes:k,droppableContainers:z,droppableRects:te,over:Se,measureDroppableContainers:$,scrollableAncestors:ft,scrollableAncestorRects:ir,measuringConfiguration:T,measuringScheduled:U,windowRect:xr}),[W,K,ie,O,fe,Ue,xe,k,z,te,Se,$,ft,ir,T,U,xr]),Ia=l.useMemo(()=>({activatorEvent:O,activators:zt,active:W,activeNodeRect:ie,ariaDescribedById:{draggable:J},dispatch:w,draggableNodes:k,over:Se,measureDroppableContainers:$}),[O,zt,W,ie,w,J,k,Se,$]);return ze.createElement(du.Provider,{value:v},ze.createElement(bo.Provider,{value:Ia},ze.createElement(_u.Provider,{value:xn},ze.createElement(Ru.Provider,{value:vt},d)),ze.createElement(pg,{disabled:c?.restoreFocus===!1})),ze.createElement(bm,{...c,hiddenTextDescribedById:J}));function Nr(){const st=I?.autoScrollEnabled===!1,jt=typeof u=="object"?u.enabled===!1:u===!1,xt=E&&!st&&!jt;return typeof u=="object"?{...u,enabled:xt}:{enabled:xt}}}),bg=l.createContext(null),ql="button",vg="Draggable";function jg(t){let{id:r,data:n,disabled:s=!1,attributes:a}=t;const o=wa(vg),{activators:i,activatorEvent:c,active:u,activeNodeRect:d,ariaDescribedById:f,draggableNodes:p,over:g}=l.useContext(bo),{role:m=ql,roleDescription:y="draggable",tabIndex:j=0}=a??{},C=u?.id===r,w=l.useContext(C?Ru:bg),[b,v]=Ka(),[S,A]=Ka(),E=ag(i,r),P=ia(n);or(()=>(p.set(r,{id:r,key:o,node:b,activatorNode:S,data:P}),()=>{const R=p.get(r);R&&R.key===o&&p.delete(r)}),[p,r]);const k=l.useMemo(()=>({role:m,tabIndex:j,"aria-disabled":s,"aria-pressed":C&&m===ql?!0:void 0,"aria-roledescription":y,"aria-describedby":f.draggable}),[s,m,j,C,y,f.draggable]);return{active:u,activatorEvent:c,activeNodeRect:d,attributes:k,isDragging:C,listeners:s?void 0:E,node:b,over:g,setNodeRef:v,setActivatorNodeRef:A,transform:w}}function wg(){return l.useContext(_u)}const Sg="Droppable",Cg={timeout:25};function kg(t){let{data:r,disabled:n=!1,id:s,resizeObserverConfig:a}=t;const o=wa(Sg),{active:i,dispatch:c,over:u,measureDroppableContainers:d}=l.useContext(bo),f=l.useRef({disabled:n}),p=l.useRef(!1),g=l.useRef(null),m=l.useRef(null),{disabled:y,updateMeasurementsFor:j,timeout:C}={...Cg,...a},w=ia(j??s),b=l.useCallback(()=>{if(!p.current){p.current=!0;return}m.current!=null&&clearTimeout(m.current),m.current=setTimeout(()=>{d(Array.isArray(w.current)?w.current:[w.current]),m.current=null},C)},[C]),v=yo({callback:b,disabled:y||!i}),S=l.useCallback((k,R)=>{v&&(R&&(v.unobserve(R),p.current=!1),k&&v.observe(k))},[v]),[A,E]=Ka(S),P=ia(r);return l.useEffect(()=>{!v||!A.current||(v.disconnect(),p.current=!1,v.observe(A.current))},[A,v]),l.useEffect(()=>(c({type:ot.RegisterDroppable,element:{id:s,key:o,disabled:n,node:A,rect:g,data:P}}),()=>c({type:ot.UnregisterDroppable,key:o,id:s})),[s]),l.useEffect(()=>{n!==f.current.disabled&&(c({type:ot.SetDroppableDisabled,id:s,key:o,disabled:n}),f.current.disabled=n)},[s,o,n,c]),{active:i,rect:g,isOver:u?.id===s,node:A,over:u,setNodeRef:E}}function bi(t,r,n){const s=t.slice();return s.splice(n<0?s.length+n:n,0,s.splice(r,1)[0]),s}function _g(t,r){return t.reduce((n,s,a)=>{const o=r.get(s);return o&&(n[a]=o),n},Array(t.length))}function Ea(t){return t!==null&&t>=0}function Rg(t,r){if(t===r)return!0;if(t.length!==r.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==r[n])return!1;return!0}function Ig(t){return typeof t=="boolean"?{draggable:t,droppable:t}:t}const vo=t=>{let{rects:r,activeIndex:n,overIndex:s,index:a}=t;const o=bi(r,s,n),i=r[a],c=o[a];return!c||!i?null:{x:c.left-i.left,y:c.top-i.top,scaleX:c.width/i.width,scaleY:c.height/i.height}},Au="Sortable",Pu=ze.createContext({activeIndex:-1,containerId:Au,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:vo,disabled:{draggable:!1,droppable:!1}});function Du(t){let{children:r,id:n,items:s,strategy:a=vo,disabled:o=!1}=t;const{active:i,dragOverlay:c,droppableRects:u,over:d,measureDroppableContainers:f}=wg(),p=wa(Au,n),g=c.rect!==null,m=l.useMemo(()=>s.map(E=>typeof E=="object"&&"id"in E?E.id:E),[s]),y=i!=null,j=i?m.indexOf(i.id):-1,C=d?m.indexOf(d.id):-1,w=l.useRef(m),b=!Rg(m,w.current),v=C!==-1&&j===-1||b,S=Ig(o);or(()=>{b&&y&&f(m)},[b,m,y,f]),l.useEffect(()=>{w.current=m},[m]);const A=l.useMemo(()=>({activeIndex:j,containerId:p,disabled:S,disableTransforms:v,items:m,overIndex:C,useDragOverlay:g,sortedRects:_g(m,u),strategy:a}),[j,p,S.draggable,S.droppable,v,m,C,u,g,a]);return ze.createElement(Pu.Provider,{value:A},r)}const Ag=t=>{let{id:r,items:n,activeIndex:s,overIndex:a}=t;return bi(n,s,a).indexOf(r)},Pg=t=>{let{containerId:r,isSorting:n,wasDragging:s,index:a,items:o,newIndex:i,previousItems:c,previousContainerId:u,transition:d}=t;return!d||!s||c!==o&&a===i?!1:n?!0:i!==a&&r===u},Dg={duration:200,easing:"ease"},Mu="transform",Mg=ca.Transition.toString({property:Mu,duration:0,easing:"linear"}),Eg={roleDescription:"sortable"};function Tg(t){let{disabled:r,index:n,node:s,rect:a}=t;const[o,i]=l.useState(null),c=l.useRef(n);return or(()=>{if(!r&&n!==c.current&&s.current){const u=a.current;if(u){const d=hn(s.current,{ignoreTransform:!0}),f={x:u.left-d.left,y:u.top-d.top,scaleX:u.width/d.width,scaleY:u.height/d.height};(f.x||f.y)&&i(f)}}n!==c.current&&(c.current=n)},[r,n,s,a]),l.useEffect(()=>{o&&i(null)},[o]),o}function zg(t){let{animateLayoutChanges:r=Pg,attributes:n,disabled:s,data:a,getNewIndex:o=Ag,id:i,strategy:c,resizeObserverConfig:u,transition:d=Dg}=t;const{items:f,containerId:p,activeIndex:g,disabled:m,disableTransforms:y,sortedRects:j,overIndex:C,useDragOverlay:w,strategy:b}=l.useContext(Pu),v=Og(s,m),S=f.indexOf(i),A=l.useMemo(()=>({sortable:{containerId:p,index:S,items:f},...a}),[p,a,S,f]),E=l.useMemo(()=>f.slice(f.indexOf(i)),[f,i]),{rect:P,node:k,isOver:R,setNodeRef:z}=kg({id:i,data:A,disabled:v.droppable,resizeObserverConfig:{updateMeasurementsFor:E,...u}}),{active:B,activatorEvent:F,activeNodeRect:W,attributes:H,setNodeRef:I,listeners:_,isDragging:O,over:D,setActivatorNodeRef:Q,transform:J}=jg({id:i,data:A,attributes:{...Eg,...n},disabled:v.draggable}),M=om(z,I),T=!!B,te=T&&!y&&Ea(g)&&Ea(C),$=!w&&O,U=$&&te?J:null,ce=te?U??(c??b)({rects:j,activeNodeRect:W,activeIndex:g,overIndex:C,index:S}):null,q=Ea(g)&&Ea(C)?o({id:i,items:f,activeIndex:g,overIndex:C}):S,oe=B?.id,ie=l.useRef({activeId:oe,items:f,newIndex:q,containerId:p}),Ue=f!==ie.current.items,Be=r({active:B,containerId:p,isDragging:O,isSorting:T,id:i,index:S,items:f,newIndex:ie.current.newIndex,previousItems:ie.current.items,previousContainerId:ie.current.containerId,transition:d,wasDragging:ie.current.activeId!=null}),le=Tg({disabled:!Be,index:S,node:k,rect:P});return l.useEffect(()=>{T&&ie.current.newIndex!==q&&(ie.current.newIndex=q),p!==ie.current.containerId&&(ie.current.containerId=p),f!==ie.current.items&&(ie.current.items=f)},[T,q,p,f]),l.useEffect(()=>{if(oe===ie.current.activeId)return;if(oe!=null&&ie.current.activeId==null){ie.current.activeId=oe;return}const ge=setTimeout(()=>{ie.current.activeId=oe},50);return()=>clearTimeout(ge)},[oe]),{active:B,activeIndex:g,attributes:H,data:A,rect:P,index:S,newIndex:q,items:f,isOver:R,isSorting:T,isDragging:O,listeners:_,node:k,overIndex:C,over:D,setNodeRef:M,setActivatorNodeRef:Q,setDroppableNodeRef:z,setDraggableNodeRef:I,transform:le??ce,transition:xe()};function xe(){if(le||Ue&&ie.current.newIndex===S)return Mg;if(!($&&!pi(F)||!d)&&(T||Be))return ca.Transition.toString({...d,property:Mu})}}function Og(t,r){var n,s;return typeof t=="boolean"?{draggable:t,droppable:!1}:{draggable:(n=t?.draggable)!=null?n:r.draggable,droppable:(s=t?.droppable)!=null?s:r.droppable}}function Za(t){if(!t)return!1;const r=t.data.current;return!!(r&&"sortable"in r&&typeof r.sortable=="object"&&"containerId"in r.sortable&&"items"in r.sortable&&"index"in r.sortable)}const Fg=[Me.Down,Me.Right,Me.Up,Me.Left],Eu=(t,r)=>{let{context:{active:n,collisionRect:s,droppableRects:a,droppableContainers:o,over:i,scrollableAncestors:c}}=r;if(Fg.includes(t.code)){if(t.preventDefault(),!n||!s)return;const u=[];o.getEnabled().forEach(p=>{if(!p||p!=null&&p.disabled)return;const g=a.get(p.id);if(g)switch(t.code){case Me.Down:s.top<g.top&&u.push(p);break;case Me.Up:s.top>g.top&&u.push(p);break;case Me.Left:s.left>g.left&&u.push(p);break;case Me.Right:s.left<g.left&&u.push(p);break}});const d=jm({collisionRect:s,droppableRects:a,droppableContainers:u});let f=xu(d,"id");if(f===i?.id&&d.length>1&&(f=d[1].id),f!=null){const p=o.get(n.id),g=o.get(f),m=g?a.get(g.id):null,y=g?.node.current;if(y&&m&&p&&g){const C=po(y).some((E,P)=>c[P]!==E),w=Tu(p,g),b=Lg(p,g),v=C||!w?{x:0,y:0}:{x:b?s.width-m.width:0,y:b?s.height-m.height:0},S={x:m.left,y:m.top};return v.x&&v.y?S:la(S,v)}}}};function Tu(t,r){return!Za(t)||!Za(r)?!1:t.data.current.sortable.containerId===r.data.current.sortable.containerId}function Lg(t,r){return!Za(t)||!Za(r)||!Tu(t,r)?!1:t.data.current.sortable.index<r.data.current.sortable.index}const Oo={theme:"dark",volume:80,repeat_mode:"none",shuffle_enabled:!1,smart_shuffle_enabled:!0,smart_shuffle_history_size:10,audio_quality:"high",items_per_page:50,visualizer_theme:"rounded-bars",visualizer_enabled:!0,visualizer_glow:!0,seek_duration:3,prefetch_enabled:!0,playback_sync_enabled:!0,extra_settings:{}},Wg=()=>{const[t,r]=l.useState(Oo),[n,s]=l.useState(!0),[a,o]=l.useState(null),i=l.useCallback(async()=>{try{s(!0),o(null);const p=await V.get("/user/config/");console.log("[Settings] Loaded from backend:",p.data),r(p.data)}catch(p){console.error("Failed to load user settings:",p),o(p?.message||"Failed to load settings"),r(Oo)}finally{s(!1)}},[]),c=l.useCallback(async p=>{try{const g=await V.post("/user/config/",p);return r(g.data.config),!0}catch(g){return console.error("Failed to save user settings:",g),o(g?.message||"Failed to save settings"),!1}},[]),u=l.useCallback(async(p,g)=>{r(y=>({...y,[p]:g}));const m=await c({[p]:g});return m||await i(),m},[c,i]),d=l.useCallback(async(p,g)=>{const m={...t.extra_settings,[p]:g};return await u("extra_settings",m)},[t.extra_settings,u]),f=l.useCallback((p,g=null)=>t.extra_settings[p]??g,[t.extra_settings]);return l.useEffect(()=>{const p=localStorage.getItem("token");console.log("[Settings] Mount check - token exists:",!!p),p?i():(r(Oo),s(!1))},[i]),{settings:t,loading:n,error:a,updateSetting:u,updateExtraSetting:d,getExtraSetting:f,saveSettings:c,loadSettings:i}},zu=l.createContext(void 0),$g=({children:t})=>{const r=Wg();return e.jsx(zu.Provider,{value:r,children:t})},Cr=()=>{const t=l.useContext(zu);if(t===void 0)throw new Error("useSettings must be used within a SettingsProvider");return t};var Vn={},Nl;function Bg(){if(Nl)return Vn;Nl=1;var t=ne();Object.defineProperty(Vn,"__esModule",{value:!0}),Vn.default=void 0;var r=t(ae()),n=se();return Vn.default=(0,r.default)((0,n.jsx)("path",{d:"M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8m0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4z"}),"Sync"),Vn}var qg=Bg();const vi=re(qg);var Yn={},Ul;function Ng(){if(Ul)return Yn;Ul=1;var t=ne();Object.defineProperty(Yn,"__esModule",{value:!0}),Yn.default=void 0;var r=t(ae()),n=se();return Yn.default=(0,r.default)((0,n.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete"),Yn}var Ug=Ng();const jo=re(Ug);var Gn={},Hl;function Hg(){if(Hl)return Gn;Hl=1;var t=ne();Object.defineProperty(Gn,"__esModule",{value:!0}),Gn.default=void 0;var r=t(ae()),n=se();return Gn.default=(0,r.default)((0,n.jsx)("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2m-9 14-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8z"}),"CheckBox"),Gn}var Vg=Hg();const Yg=re(Vg);var Qn={},Vl;function Gg(){if(Vl)return Qn;Vl=1;var t=ne();Object.defineProperty(Qn,"__esModule",{value:!0}),Qn.default=void 0;var r=t(ae()),n=se();return Qn.default=(0,r.default)((0,n.jsx)("path",{d:"M19 5v14H5V5zm0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2"}),"CheckBoxOutlineBlank"),Qn}var Qg=Gg();const Kg=re(Qg);var Kn={},Yl;function Xg(){if(Yl)return Kn;Yl=1;var t=ne();Object.defineProperty(Kn,"__esModule",{value:!0}),Kn.default=void 0;var r=t(ae()),n=se();return Kn.default=(0,r.default)((0,n.jsx)("path",{d:"M20 8H4V6h16zm-2-6H6v2h12zm4 10v8c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2v-8c0-1.1.9-2 2-2h16c1.1 0 2 .9 2 2m-6 4-6-3.27v6.53z"}),"Subscriptions"),Kn}var Jg=Xg();const Zg=re(Jg);var Xn={},Gl;function e0(){if(Gl)return Xn;Gl=1;var t=ne();Object.defineProperty(Xn,"__esModule",{value:!0}),Xn.default=void 0;var r=t(ae()),n=se();return Xn.default=(0,r.default)((0,n.jsx)("path",{d:"M4 6H2v14c0 1.1.9 2 2 2h14v-2H4zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m-8 12.5v-9l6 4.5z"}),"VideoLibrary"),Xn}var t0=e0();const r0=re(t0);var Jn={},Ql;function n0(){if(Ql)return Jn;Ql=1;var t=ne();Object.defineProperty(Jn,"__esModule",{value:!0}),Jn.default=void 0;var r=t(ae()),n=se();return Jn.default=(0,r.default)((0,n.jsx)("path",{d:"M20.13 5.41 18.72 4l-9.19 9.19-4.25-4.24-1.41 1.41 5.66 5.66zM5 18h14v2H5z"}),"DownloadDone"),Jn}var s0=n0();const a0=re(s0),Kl=t=>t>=1e6?`${(t/1e6).toFixed(1)}M`:t>=1e3?`${(t/1e3).toFixed(1)}K`:t.toString();function o0({channel:t,selectionMode:r=!1,isSelected:n=!1,onSync:s,onDelete:a,onClick:o,onToggleSelect:i}){const c=d=>{switch(d){case"syncing":return"primary";case"success":return"success";case"failed":return"error";case"stale":return"warning";default:return"default"}},u=d=>{if(!d)return"Never synced";const f=new Date(d),g=new Date().getTime()-f.getTime(),m=Math.floor(g/6e4),y=Math.floor(g/36e5),j=Math.floor(g/864e5);return m<1?"Just now":m<60?`${m}m ago`:y<24?`${y}h ago`:`${j}d ago`};return e.jsxs(h,{onClick:()=>{r?i?.():o?.()},sx:{width:"100%",borderRadius:3,overflow:"hidden",bgcolor:"background.paper",cursor:"pointer",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",position:"relative",border:n?"2px solid":"2px solid transparent",borderColor:n?"primary.main":"transparent","&:hover":{transform:"translateY(-4px)",boxShadow:d=>`0 12px 24px ${d.palette.mode==="dark"?"rgba(0,0,0,0.4)":"rgba(0,0,0,0.12)"}`,"& .channel-overlay":{opacity:1},"& .channel-play-btn":{opacity:1,transform:"scale(1)"}}},children:[e.jsxs(h,{sx:{height:100,background:t.channel_thumbnail?`linear-gradient(135deg, rgba(102, 126, 234, 0.8), rgba(118, 75, 162, 0.8)), url(${t.channel_thumbnail})`:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",backgroundSize:"cover",backgroundPosition:"center",position:"relative"},children:[e.jsx(h,{className:"channel-overlay",sx:{position:"absolute",inset:0,background:"rgba(0,0,0,0.3)",opacity:0,transition:"opacity 0.3s ease",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(h,{className:"channel-play-btn",sx:{transform:"scale(0.8)",opacity:0,transition:"all 0.3s ease"},children:e.jsx(h,{sx:{width:48,height:48,borderRadius:"50%",bgcolor:"white",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 20px rgba(0,0,0,0.3)"},children:e.jsx(gt,{sx:{fontSize:28,color:"primary.main"}})})})}),r&&e.jsx(h,{sx:{position:"absolute",top:8,right:8,zIndex:2,bgcolor:"background.paper",borderRadius:"50%",width:32,height:32,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:2},children:n?e.jsx(Yg,{color:"primary"}):e.jsx(Kg,{color:"action"})}),e.jsx(h,{sx:{position:"absolute",top:8,left:8},children:e.jsx(ue,{label:t.status_display,color:c(t.sync_status),size:"small",sx:{height:24,fontSize:"0.7rem",fontWeight:600,backdropFilter:"blur(4px)"}})})]}),e.jsx(h,{sx:{display:"flex",justifyContent:"center",mt:-5,position:"relative",zIndex:1},children:e.jsx(Ve,{src:t.channel_thumbnail,sx:{width:80,height:80,border:"4px solid",borderColor:"background.paper",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",bgcolor:"primary.main"},children:e.jsx(en,{sx:{fontSize:40}})})}),e.jsxs(h,{sx:{p:2,pt:1.5},children:[e.jsx(x,{variant:"subtitle1",fontWeight:700,textAlign:"center",noWrap:!0,sx:{mb:.5},children:t.channel_name}),e.jsxs(x,{variant:"caption",color:"text.secondary",textAlign:"center",display:"block",sx:{mb:2},children:["Updated ",u(t.last_refreshed)]}),t.error_message&&e.jsx(pe,{severity:"error",sx:{mb:2,py:0,"& .MuiAlert-message":{fontSize:"0.75rem"}},children:t.error_message}),e.jsxs(h,{sx:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:1,mb:2,p:1.5,bgcolor:d=>d.palette.mode==="dark"?"rgba(255,255,255,0.03)":"rgba(0,0,0,0.02)",borderRadius:2},children:[e.jsxs(h,{sx:{textAlign:"center"},children:[e.jsx(Zg,{sx:{fontSize:20,color:"text.secondary",mb:.5}}),e.jsx(x,{variant:"body2",fontWeight:700,children:Kl(t.subscriber_count)}),e.jsx(x,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.65rem"},children:"Subs"})]}),e.jsxs(h,{sx:{textAlign:"center"},children:[e.jsx(r0,{sx:{fontSize:20,color:"text.secondary",mb:.5}}),e.jsx(x,{variant:"body2",fontWeight:700,children:Kl(t.video_count)}),e.jsx(x,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.65rem"},children:"Videos"})]}),e.jsxs(h,{sx:{textAlign:"center"},children:[e.jsx(a0,{sx:{fontSize:20,color:"primary.main",mb:.5}}),e.jsx(x,{variant:"body2",fontWeight:700,color:"primary.main",children:t.downloaded_count}),e.jsx(x,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.65rem"},children:"Downloaded"})]})]}),e.jsxs(h,{sx:{mb:2},children:[e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",mb:.5},children:[e.jsx(x,{variant:"caption",color:"text.secondary",children:"Download progress"}),e.jsxs(x,{variant:"caption",color:"primary.main",fontWeight:600,children:[t.progress_percent,"%"]})]}),e.jsx(rt,{variant:"determinate",value:t.progress_percent,sx:{height:6,borderRadius:3,bgcolor:"rgba(255,255,255,0.1)","& .MuiLinearProgress-bar":{borderRadius:3,background:t.progress_percent===100?"linear-gradient(90deg, #00C853, #69F0AE)":"linear-gradient(90deg, #667eea, #764ba2)"}}})]}),e.jsxs(h,{sx:{display:"flex",justifyContent:"center",gap:1},children:[e.jsx(ve,{title:"Sync channel",children:e.jsx(X,{size:"small",color:"primary",onClick:d=>{d.stopPropagation(),s?.()},disabled:t.sync_status==="syncing",sx:{bgcolor:"rgba(102, 126, 234, 0.1)","&:hover":{bgcolor:"rgba(102, 126, 234, 0.2)"}},children:e.jsx(vi,{sx:{fontSize:20}})})}),e.jsx(ve,{title:"Remove channel",children:e.jsx(X,{size:"small",color:"error",onClick:d=>{d.stopPropagation(),a?.()},sx:{bgcolor:"rgba(244, 67, 54, 0.1)","&:hover":{bgcolor:"rgba(244, 67, 54, 0.2)"}},children:e.jsx(jo,{sx:{fontSize:20}})})})]}),!t.active&&e.jsx(h,{sx:{mt:1.5,textAlign:"center"},children:e.jsx(ue,{label:"Inactive",color:"error",size:"small",variant:"outlined",sx:{fontSize:"0.7rem"}})})]})]})}var Zn={},Xl;function i0(){if(Xl)return Zn;Xl=1;var t=ne();Object.defineProperty(Zn,"__esModule",{value:!0}),Zn.default=void 0;var r=t(ae()),n=se();return Zn.default=(0,r.default)((0,n.jsx)("path",{d:"M11 18c0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2 2 .9 2 2m-2-8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0-6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m6 4c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"}),"DragIndicator"),Zn}var l0=i0();const c0=re(l0);function Ou({id:t,children:r,disabled:n=!1}){const{attributes:s,listeners:a,setNodeRef:o,transform:i,transition:c,isDragging:u}=zg({id:t,disabled:n}),d={transform:ca.Transform.toString(i),transition:c,opacity:u?.5:1,zIndex:u?1e3:"auto"};return e.jsxs(h,{ref:o,style:d,sx:{position:"relative","&:hover .drag-handle":{opacity:n?0:1},"@media (hover: none)":{"& .drag-handle":{opacity:n?0:.7}}},children:[!n&&e.jsx(h,{className:"drag-handle",...s,...a,sx:{position:"absolute",top:8,left:8,zIndex:10,cursor:u?"grabbing":"grab",opacity:0,transition:"opacity 0.2s ease",bgcolor:"rgba(0,0,0,0.6)",borderRadius:1,p:.5,display:"flex",alignItems:"center",justifyContent:"center",backdropFilter:"blur(4px)","@media (hover: none)":{p:.75,minWidth:32,minHeight:32},"&:hover":{bgcolor:"rgba(0,0,0,0.8)"},"&:focus":{opacity:1,outline:"2px solid",outlineColor:"primary.main"},touchAction:"none",userSelect:"none",WebkitUserSelect:"none"},children:e.jsx(c0,{sx:{fontSize:20,color:"white"}})}),r]})}function Fu({items:t,storageKey:r,getItemId:n,getExtraSetting:s,updateExtraSetting:a}){const[o,i]=l.useState(t),[c,u]=l.useState(null),[d,f]=l.useState(!1),p=l.useRef(!0),g=!!(s&&a);l.useEffect(()=>{const j=()=>{let C=null;if(g&&s){const w=s(r,null);w&&Array.isArray(w)&&(C=w)}if(!C){const w=localStorage.getItem(r);if(w)try{const b=JSON.parse(w);Array.isArray(b)&&(C=b,g&&a&&a(r,b))}catch(b){console.error("Failed to parse saved order:",b)}}C&&u(C),f(!0)};p.current&&(j(),p.current=!1)},[r,g,s,a]),l.useEffect(()=>{if(g&&s&&d){const j=s(r,null);j&&Array.isArray(j)&&u(j)}},[g,s,r,d]),l.useEffect(()=>{if(c&&t.length>0){const j=[...t].sort((C,w)=>{const b=c.indexOf(n(C)),v=c.indexOf(n(w));return b===-1&&v===-1?0:b===-1?1:v===-1?-1:b-v});i(j)}else i(t)},[t,c,n]);const m=l.useCallback(j=>{const{active:C,over:w}=j;w&&C.id!==w.id&&i(b=>{const v=b.findIndex(P=>n(P)===C.id),S=b.findIndex(P=>n(P)===w.id),A=bi(b,v,S),E=A.map(n);return localStorage.setItem(r,JSON.stringify(E)),g&&a&&a(r,E),u(E),A})},[n,r,g,a]),y=l.useCallback(()=>{localStorage.removeItem(r),g&&a&&a(r,null),u(null),i(t)},[r,t,g,a]);return{sortedItems:o,handleDragEnd:m,resetOrder:y,hasCustomOrder:c!==null}}function d0(){const t=Dt(),{getExtraSetting:r,updateExtraSetting:n}=Cr(),[s,a]=l.useState([]),[o,i]=l.useState(!0),[c,u]=l.useState(!1),[d,f]=l.useState(""),[p,g]=l.useState(""),[m,y]=l.useState(new Set),[j,C]=l.useState(!1),[w,b]=l.useState(!1),[v,S]=l.useState(""),[A,E]=l.useState([]),P=l.useCallback(J=>J.channel_id,[]),{sortedItems:k,handleDragEnd:R,resetOrder:z,hasCustomOrder:B}=Fu({items:s,storageKey:"soundwave-channel-order",getItemId:P,getExtraSetting:r,updateExtraSetting:n}),F=uu(rn(go,{activationConstraint:{distance:8}}),rn(yi,{activationConstraint:{delay:250,tolerance:5}}),rn(mo,{coordinateGetter:Eu})),W=async()=>{try{const J=await eu();a(J)}catch(J){console.error("Failed to load channels:",J),a([])}finally{i(!1)}};l.useEffect(()=>{W()},[]);const H=async()=>{g(""),b(!0);try{const J=await Jr.subscribe({url:d}),M=J.data?.task_id,T=J.data?.message||"Channel subscription started",te=d.match(/@([^/?]+)/),$=te?`@${te[1]}`:"channel";S(` Subscribing to ${$}... Downloading channel info and videos in background.`),f(""),u(!1),M&&(E(U=>[...U,M]),setTimeout(()=>{E(U=>U.filter(K=>K!==M)),W()},3e4)),setTimeout(()=>{W()},2e3)}catch(J){g(J.response?.data?.error||J.response?.data?.detail||"Failed to subscribe to channel")}finally{b(!1)}},I=async J=>{if(confirm("Are you sure you want to unsubscribe from this channel?"))try{await Jr.unsubscribe(J),W()}catch(M){console.error("Failed to unsubscribe:",M)}},_=async()=>{if(m.size!==0&&confirm(`Are you sure you want to unsubscribe from ${m.size} channel(s)?`))try{await Promise.all(Array.from(m).map(J=>Jr.unsubscribe(J))),y(new Set),C(!1),W()}catch(J){console.error("Failed to bulk delete:",J)}},O=J=>{const M=new Set(m);M.has(J)?M.delete(J):M.add(J),y(M)},D=()=>{m.size===s.length?y(new Set):y(new Set(s.map(J=>J.channel_id)))},Q=()=>{C(!j),y(new Set)};return e.jsxs(h,{children:[e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(x,{variant:"h4",fontWeight:"bold",children:"YouTube Channels"}),B&&e.jsx(ve,{title:"Reset to default order",children:e.jsx(X,{size:"small",onClick:z,sx:{opacity:.7},children:e.jsx(dd,{fontSize:"small"})})})]}),e.jsxs(h,{sx:{display:"flex",gap:1},children:[s.length>0&&e.jsx(N,{variant:j?"contained":"outlined",size:"small",startIcon:j?e.jsx(gh,{}):e.jsx(yh,{}),onClick:Q,color:j?"primary":"inherit",children:j?"Cancel":"Select"}),e.jsx(N,{variant:"contained",size:"small",startIcon:e.jsx(sr,{}),onClick:()=>u(!0),children:"Subscribe to Channel"})]})]}),A.length>0&&e.jsx(pe,{severity:"info",sx:{mb:2},children:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsxs(x,{variant:"body2",children:[" Processing ",A.length," channel subscription",A.length>1?"s":"","..."]}),e.jsx(x,{variant:"caption",sx:{opacity:.7},children:"Server is downloading in background - will auto-refresh"})]})}),j&&e.jsxs(h,{sx:{mb:2,p:2,bgcolor:"primary.main",color:"primary.contrastText",borderRadius:2,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(N,{variant:"outlined",size:"small",onClick:D,sx:{color:"inherit",borderColor:"currentColor","&:hover":{borderColor:"currentColor",bgcolor:"rgba(255,255,255,0.1)"}},children:m.size===s.length?"Deselect All":"Select All"}),e.jsxs(x,{variant:"body2",children:[m.size," of ",s.length," selected"]})]}),e.jsx(N,{variant:"contained",color:"error",size:"small",startIcon:e.jsx(ud,{}),onClick:_,disabled:m.size===0,children:"Delete Selected"})]}),e.jsx(Iu,{sensors:F,collisionDetection:pu,onDragEnd:R,children:e.jsx(Du,{items:k.map(J=>J.channel_id),strategy:vo,children:e.jsx(ee,{container:!0,spacing:3,children:k.map(J=>e.jsx(ee,{item:!0,xs:12,sm:6,md:4,lg:3,children:e.jsx(Ou,{id:J.channel_id,disabled:j,children:e.jsx(o0,{channel:J,selectionMode:j,isSelected:m.has(J.channel_id),onDelete:()=>I(J.channel_id),onClick:()=>t(`/channels/${J.channel_id}`),onToggleSelect:()=>O(J.channel_id)})})},J.channel_id))})})}),!o&&s.length===0&&e.jsxs(h,{sx:{textAlign:"center",py:8,color:"text.secondary"},children:[e.jsx(Ha,{sx:{fontSize:64,mb:2,opacity:.3}}),e.jsx(x,{variant:"h6",gutterBottom:!0,children:"No channels subscribed"}),e.jsx(x,{variant:"body2",sx:{mb:3},children:"Subscribe to YouTube channels to automatically download their content"}),e.jsx(N,{variant:"contained",startIcon:e.jsx(sr,{}),onClick:()=>u(!0),children:"Subscribe to Channel"})]}),e.jsxs(Ke,{open:c,onClose:()=>u(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(tt,{children:"Subscribe to YouTube Channel"}),e.jsxs(Xe,{children:[p&&e.jsx(pe,{severity:"error",sx:{mb:2},children:p}),e.jsx(Ce,{autoFocus:!0,margin:"dense",label:"Channel URL",placeholder:"https://www.youtube.com/@channelname or channel ID",fullWidth:!0,value:d,onChange:J=>f(J.target.value),helperText:"Enter a YouTube channel URL or channel ID"})]}),e.jsxs(nt,{children:[e.jsx(N,{onClick:()=>u(!1),disabled:w,children:"Cancel"}),e.jsx(N,{onClick:H,variant:"contained",disabled:!d||w,children:w?"Subscribing...":"Subscribe"})]})]}),e.jsx(it,{open:!!v,autoHideDuration:6e3,onClose:()=>S(""),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(pe,{onClose:()=>S(""),severity:"success",sx:{width:"100%"},children:v})}),e.jsx(cn,{})]})}function u0({setCurrentAudio:t}){const{channelId:r}=ii(),n=Dt(),{getTrackRef:s,shouldHighlight:a}=ba(),[o,i]=l.useState(null),[c,u]=l.useState(!0),[d,f]=l.useState(""),[p,g]=l.useState(!1),[m,y]=l.useState("");l.useEffect(()=>{r&&j()},[r]);const j=async()=>{try{u(!0);const k=await Jr.get(r);i(k.data),f("")}catch(k){console.error("Failed to load channel:",k),f(k.response?.data?.detail||"Failed to load channel")}finally{u(!1)}},C=k=>{o?.audio_files?t(k,o.audio_files):t(k)},w=()=>{o?.audio_files&&o.audio_files.length>0&&(t(o.audio_files[0],o.audio_files),y(`Playing all ${o.audio_files.length} tracks from ${o.channel_name}`),g(!0))},b=()=>{if(o?.audio_files&&o.audio_files.length>0){const k=[...o.audio_files].sort(()=>Math.random()-.5);t(k[0],k),y(`Shuffling ${o.audio_files.length} tracks from ${o.channel_name}`),g(!0)}},v=async()=>{if(!o?.audio_files)return;const k=o.audio_files.filter(R=>R.file_path&&R.youtube_id);if(k.length===0){y("No downloaded tracks to save"),g(!0);return}y(`Downloading ${k.length} tracks to your device`),g(!0);for(const R of k)try{const z=await kt.downloadFile(R.youtube_id),B=window.URL.createObjectURL(z),F=document.createElement("a");F.href=B,F.download=R.title||"audio",F.style.display="none",document.body.appendChild(F),F.click(),document.body.removeChild(F),window.URL.revokeObjectURL(B),await new Promise(W=>setTimeout(W,500))}catch(z){console.error(`Failed to download ${R.title}:`,z)}},S=k=>{i(R=>R?.audio_files?{...R,audio_files:R.audio_files.map(z=>z.id===k.id?k:z)}:R)},A=k=>{const R=Math.floor(k/3600),z=Math.floor(k%3600/60),B=k%60;return R>0?`${R}:${z.toString().padStart(2,"0")}:${B.toString().padStart(2,"0")}`:`${z}:${B.toString().padStart(2,"0")}`},E=k=>k>=1e6?`${(k/1e6).toFixed(1)}M`:k>=1e3?`${(k/1e3).toFixed(1)}K`:k.toString(),P=k=>{switch(k){case"syncing":return"primary";case"success":return"success";case"failed":return"error";case"stale":return"warning";default:return"default"}};return c?e.jsx(h,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"50vh",children:e.jsx(Ie,{})}):d||!o?e.jsxs(h,{children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(X,{onClick:()=>n("/channels"),children:e.jsx(nn,{})}),e.jsx(x,{variant:"h5",children:"Channel Details"})]}),e.jsx(pe,{severity:"error",children:d||"Channel not found"})]}):e.jsxs(h,{children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(X,{onClick:()=>n("/channels"),sx:{mr:1},children:e.jsx(nn,{})}),e.jsx(x,{variant:"h4",fontWeight:"bold",children:"Channel Details"})]}),e.jsx(_e,{sx:{mb:3,p:3},children:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(Ve,{src:o.channel_thumbnail,sx:{width:80,height:80},children:e.jsx(Ha,{sx:{fontSize:40}})}),e.jsxs(h,{sx:{flex:1},children:[e.jsx(x,{variant:"h5",fontWeight:"bold",gutterBottom:!0,children:o.channel_name}),e.jsxs(h,{sx:{display:"flex",gap:1,flexWrap:"wrap",mb:2},children:[e.jsx(ue,{label:o.status_display,color:P(o.sync_status),size:"small"}),e.jsx(ue,{label:`${E(o.subscriber_count)} subscribers`,variant:"outlined",size:"small"}),e.jsx(ue,{label:`${o.audio_count||0} tracks`,variant:"outlined",size:"small"}),e.jsx(ue,{label:`${o.downloaded_count} downloaded`,variant:"outlined",size:"small"})]}),e.jsx(h,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:o.audio_files&&o.audio_files.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(N,{variant:"contained",startIcon:e.jsx(hd,{}),onClick:w,children:"Play All"}),e.jsx(N,{variant:"outlined",startIcon:e.jsx(ta,{}),onClick:b,children:"Shuffle"}),e.jsx(N,{variant:"outlined",startIcon:e.jsx(Uo,{}),onClick:v,children:"Download All"})]})})]})]})}),o.audio_files&&o.audio_files.length>0?e.jsx(Lr,{component:yt,children:e.jsxs(Wr,{children:[e.jsx($r,{children:e.jsxs(ht,{children:[e.jsx(Z,{width:60,children:"#"}),e.jsx(Z,{children:"Title"}),e.jsx(Z,{width:120,children:"Duration"}),e.jsx(Z,{width:120,children:"Published"}),e.jsx(Z,{width:100,children:"Plays"}),e.jsx(Z,{width:100,children:"Actions"})]})}),e.jsx(Br,{children:o.audio_files.map((k,R)=>e.jsxs(ht,{ref:s(k.youtube_id),hover:!0,sx:{cursor:"pointer","&:hover":{bgcolor:"action.hover"},...a(k.youtube_id)&&{bgcolor:"rgba(19, 236, 106, 0.1)"}},onClick:()=>C(k),children:[e.jsx(Z,{children:e.jsxs(h,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(x,{variant:"body2",color:"text.secondary",sx:{mr:1},children:R+1}),e.jsx(X,{size:"small",onClick:z=>{z.stopPropagation(),C(k)},children:e.jsx(ar,{fontSize:"small"})})]})}),e.jsx(Z,{children:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(h,{component:"img",src:k.thumbnail_url,alt:k.title,sx:{width:40,height:30,objectFit:"cover",borderRadius:1},onError:z=>{z.currentTarget.style.display="none"}}),e.jsxs(h,{children:[e.jsx(x,{variant:"body2",fontWeight:"medium",noWrap:!0,children:k.title}),e.jsxs(x,{variant:"caption",color:"text.secondary",children:[E(k.view_count||0)," views"]})]})]})}),e.jsx(Z,{children:e.jsx(x,{variant:"body2",color:"text.secondary",children:A(k.duration)})}),e.jsx(Z,{children:e.jsx(x,{variant:"body2",color:"text.secondary",children:k.published_date?new Date(k.published_date).toLocaleDateString():"N/A"})}),e.jsx(Z,{children:e.jsx(x,{variant:"body2",color:"text.secondary",children:k.play_count})}),e.jsx(Z,{children:e.jsxs(h,{sx:{display:"flex",gap:.5},children:[e.jsx(ve,{title:"Download",children:e.jsx(X,{size:"small",onClick:async z=>{z.stopPropagation();try{const B=await kt.downloadFile(k.youtube_id),F=window.URL.createObjectURL(B),W=document.createElement("a");W.href=F,W.download=k.title||"audio",W.click(),window.URL.revokeObjectURL(F)}catch(B){console.error("Download failed:",B)}},children:e.jsx(Uo,{fontSize:"small"})})}),e.jsx(Fr,{track:k,onTrackUpdate:S})]})})]},k.id))})]})}):e.jsxs(yt,{sx:{p:4,textAlign:"center"},children:[e.jsx(Ha,{sx:{fontSize:64,mb:2,opacity:.3}}),e.jsx(x,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No audio files found"}),e.jsx(x,{variant:"body2",color:"text.secondary",children:"Audio files will appear here once they are downloaded from this channel."})]}),e.jsx(it,{open:p,autoHideDuration:4e3,onClose:()=>g(!1),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(pe,{onClose:()=>g(!1),severity:"success",sx:{width:"100%"},children:m})})]})}class h0{deferredPrompt=null;isInstalled=!1;isOnline=navigator.onLine;listeners=new Map;registration=null;constructor(){this.init()}init(){console.log("[PWA] Initializing PWAManager..."),console.log("[PWA] Protocol:",window.location.protocol),console.log("[PWA] Hostname:",window.location.hostname),console.log("[PWA] Secure context:",window.isSecureContext),console.log("[PWA] Service Worker support:","serviceWorker"in navigator);const r=this.checkIfInstalled();console.log("[PWA] Already installed:",r),window.deferredPWAPrompt?(this.deferredPrompt=window.deferredPWAPrompt,console.log("[PWA] Using early-captured install prompt"),setTimeout(()=>this.emit("canInstall",!0),0)):console.log("[PWA] No early-captured install prompt found"),window.addEventListener("beforeinstallprompt",n=>{n.preventDefault(),this.deferredPrompt=n,console.log("[PWA] Install prompt captured in React"),this.emit("canInstall",!0)}),window.addEventListener("pwa-install-available",()=>{window.deferredPWAPrompt&&!this.deferredPrompt&&(this.deferredPrompt=window.deferredPWAPrompt,console.log("[PWA] Install prompt received via custom event"),this.emit("canInstall",!0))}),window.addEventListener("appinstalled",()=>{this.isInstalled=!0,this.deferredPrompt=null,this.emit("installed",!0)}),window.addEventListener("online",()=>{this.isOnline=!0,this.emit("online",!0)}),window.addEventListener("offline",()=>{this.isOnline=!1,this.emit("offline",!0)}),"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("controllerchange",()=>{this.emit("update",!0)})}checkIfInstalled(){return window.matchMedia("(display-mode: standalone)").matches?(this.isInstalled=!0,!0):navigator.standalone===!0?(this.isInstalled=!0,!0):!1}async registerServiceWorker(){if(!("serviceWorker"in navigator))return console.warn("[PWA] Service Worker not supported"),null;if(!window.isSecureContext)return console.warn("[PWA] Not in a secure context (HTTPS required)"),null;try{this.registration=await navigator.serviceWorker.register("/service-worker.js",{scope:"/"}),console.log("[PWA] Service Worker registered:",this.registration),console.log("[PWA] SW State:",this.registration.active?.state||"no active worker");let r=!1;return navigator.serviceWorker.addEventListener("controllerchange",()=>{r||(r=!0,console.log("[PWA] Controller changed, reloading..."),window.location.reload())}),this.registration.addEventListener("updatefound",()=>{console.log("[PWA] Update found! Installing new service worker...");const n=this.registration.installing;n&&n.addEventListener("statechange",()=>{console.log("[PWA] New worker state:",n.state),n.state==="installed"&&navigator.serviceWorker.controller&&(console.log("[PWA] New version available! Showing update notification..."),this.emit("updateAvailable",n))})}),this.registration.waiting&&navigator.serviceWorker.controller&&(console.log("[PWA] Found waiting service worker from previous session"),this.emit("updateAvailable",this.registration.waiting)),this.registration}catch(r){return console.error("Service Worker registration failed:",r),null}}async showInstallPrompt(){if(!this.deferredPrompt)return console.warn("Install prompt not available"),!1;try{await this.deferredPrompt.prompt();const{outcome:r}=await this.deferredPrompt.userChoice;return r==="accepted"?(console.log("User accepted install prompt"),this.deferredPrompt=null,!0):(console.log("User dismissed install prompt"),!1)}catch(r){return console.error("Error showing install prompt:",r),!1}}async updateServiceWorker(){if(!this.registration){console.warn("[PWA] No service worker registration");return}const r=this.registration.waiting;r?(console.log("[PWA] Telling waiting service worker to skip waiting..."),r.postMessage({type:"SKIP_WAITING"})):(console.warn("[PWA] No waiting service worker to activate"),await this.registration.update())}async clearCache(){if(!("serviceWorker"in navigator))return!1;try{const r=await navigator.serviceWorker.ready,n=new MessageChannel;return new Promise(s=>{n.port1.onmessage=a=>{s(a.data.success)},r.active?.postMessage({type:"CLEAR_CACHE"},[n.port2])})}catch(r){return console.error("Error clearing cache:",r),!1}}async cacheAudio(r){if(!("serviceWorker"in navigator))return!1;try{const n=await navigator.serviceWorker.ready,s=new MessageChannel;return new Promise(a=>{s.port1.onmessage=o=>{a(o.data.success)},n.active?.postMessage({type:"CACHE_AUDIO",url:r},[s.port2])})}catch(n){return console.error("Error caching audio:",n),!1}}async requestNotificationPermission(){return"Notification"in window?Notification.permission==="granted"?"granted":Notification.permission!=="denied"?await Notification.requestPermission():Notification.permission:(console.warn("Notifications not supported"),"denied")}async showNotification(r,n){if(Notification.permission==="granted"){if(!this.registration){new Notification(r,n);return}await this.registration.showNotification(r,{icon:"/img/icons/icon-192x192.png",badge:"/img/icon-72x72.png",...n})}}canInstall(){return this.deferredPrompt!==null}getIsInstalled(){return this.isInstalled}getIsOnline(){return this.isOnline}on(r,n){this.listeners.has(r)||this.listeners.set(r,new Set),this.listeners.get(r).add(n)}off(r,n){this.listeners.has(r)&&this.listeners.get(r).delete(n)}emit(r,n){this.listeners.has(r)&&this.listeners.get(r).forEach(s=>s(n))}async cachePlaylist(r,n,s){if(!("serviceWorker"in navigator))return console.log("[PWA] Service Worker not supported"),{success:!1,cached:0,failed:0};try{const a=await navigator.serviceWorker.ready,o=new MessageChannel,i=localStorage.getItem("token");return i?new Promise(c=>{const u=setTimeout(()=>{console.error("[PWA] Playlist caching timed out"),c({success:!1,cached:0,failed:n.length})},3e5);o.port1.onmessage=d=>{const f=d.data;if(f.type==="progress"){console.log("[PWA] Cache progress:",f),s&&s({current:f.current,total:f.total,percent:f.percent,currentItem:f.currentItem,status:f.status});return}(f.type==="complete"||f.success!==void 0)&&(clearTimeout(u),console.log("[PWA] Playlist cache complete:",f),c({success:f.success,cached:f.cached||0,failed:f.failed||0}))},a.active?.postMessage({type:"CACHE_PLAYLIST",playlistId:r,audioUrls:n,authToken:i},[o.port2])}):(console.error("[PWA] No auth token available for caching"),{success:!1,cached:0,failed:0})}catch(a){return console.error("Error caching playlist:",a),{success:!1,cached:0,failed:n.length}}}async removePlaylistCache(r,n){if(!("serviceWorker"in navigator))return!1;try{const s=await navigator.serviceWorker.ready,a=new MessageChannel;return new Promise(o=>{a.port1.onmessage=i=>{o(i.data.success)},s.active?.postMessage({type:"REMOVE_PLAYLIST_CACHE",playlistId:r,audioUrls:n},[a.port2])})}catch(s){return console.error("Error removing playlist cache:",s),!1}}async getCacheSize(){if("storage"in navigator&&"estimate"in navigator.storage){const r=await navigator.storage.estimate();return{usage:r.usage||0,quota:r.quota||0}}return null}}const qe=new h0;function f0(){return navigator.connection||navigator.mozConnection||navigator.webkitConnection||null}function Mr(){const t=f0(),r=navigator.onLine;if(!r)return{quality:"offline",effectiveType:"none",isOnline:!1,isSaveData:!1,isCellular:!1,isSlowConnection:!0,downlink:null,rtt:null};if(!t)return{quality:"good",effectiveType:"unknown",isOnline:!0,isSaveData:!1,isCellular:!1,isSlowConnection:!1,downlink:null,rtt:null};const n=t.effectiveType||"4g",s=t.saveData||!1,a=t.type==="cellular",o=t.downlink??null,i=t.rtt??null;let c;return n==="slow-2g"||n==="2g"||i&&i>1e3?c="poor":n==="3g"||i&&i>500?c="moderate":o&&o>=10?c="excellent":c="good",s&&(c="poor"),{quality:c,effectiveType:n,isOnline:r,isSaveData:s,isCellular:a,isSlowConnection:c==="poor"||c==="moderate"||s,downlink:o,rtt:i}}function x0(){const t=Mr();return!(!t.isOnline||t.isSaveData||t.quality==="poor")}function p0(){const t=Mr();if(!t.isOnline||t.isSaveData)return 0;switch(t.quality){case"excellent":return 3;case"good":return 2;case"moderate":return 1;default:return 0}}function Jl(t){const r=Mr();if(!r.isOnline)return t*10;switch(r.quality){case"excellent":return t;case"good":return t*1.5;case"moderate":return t*2;case"poor":return t*4;default:return t*2}}class Ta{baseDelay;maxDelay;failures=0;lastFailure=0;constructor(r=1e3,n=6e4){this.baseDelay=r,this.maxDelay=n}recordFailure(){this.failures++,this.lastFailure=Date.now();const r=this.baseDelay*Math.pow(2,Math.min(this.failures-1,10)),n=Math.random()*.3*r;return Math.min(r+n,this.maxDelay)}recordSuccess(){this.failures=0,this.lastFailure=0}shouldAttempt(){if(this.failures===0)return!0;const r=this.baseDelay*Math.pow(2,Math.min(this.failures-1,10));return Date.now()-this.lastFailure>=r}getFailureCount(){return this.failures}reset(){this.failures=0,this.lastFailure=0}}const hr={playbackSync:new Ta(5e3,12e4),homepage:new Ta(2e3,6e4),downloads:new Ta(3e3,9e4),prefetch:new Ta(5e3,3e5)},m0="soundwave-audio-cache",g0=2,Fe={AUDIO_BLOBS:"audioBlobs",METADATA:"metadata",ANALYTICS:"analytics"},Gr={maxCacheSize:500*1024*1024,maxCachedTracks:50,prefetchCount:3,staleTime:10080*60*1e3,cleanupInterval:3600*1e3};class y0{db=null;prefetchQueue=new Set;prefetchingInProgress=new Set;cleanupScheduled=!1;initialized=!1;cachedTrackIds=new Set;swCachedTrackIds=new Set;async init(){if(!this.initialized)return new Promise((r,n)=>{const s=indexedDB.open(m0,g0);s.onerror=()=>{console.error("[AudioCache] Failed to open database:",s.error),n(s.error)},s.onsuccess=()=>{this.db=s.result,this.initialized=!0,this.scheduleCleanup(),this.buildCacheIndex(),this.buildServiceWorkerCacheIndex(),console.log("[AudioCache] Initialized successfully"),r()},s.onupgradeneeded=a=>{const o=a.target.result;if(!o.objectStoreNames.contains(Fe.AUDIO_BLOBS)){const i=o.createObjectStore(Fe.AUDIO_BLOBS,{keyPath:"id"});i.createIndex("lastAccessed","lastAccessed",{unique:!1}),i.createIndex("cachedAt","cachedAt",{unique:!1})}if(o.objectStoreNames.contains(Fe.METADATA)||o.createObjectStore(Fe.METADATA,{keyPath:"id"}),!o.objectStoreNames.contains(Fe.ANALYTICS)){const i=o.createObjectStore(Fe.ANALYTICS,{keyPath:"id"});i.createIndex("playCount","playCount",{unique:!1}),i.createIndex("lastPlayed","lastPlayed",{unique:!1})}}})}async buildCacheIndex(){if(this.db)try{const s=this.db.transaction(Fe.AUDIO_BLOBS,"readonly").objectStore(Fe.AUDIO_BLOBS).getAllKeys();s.onsuccess=()=>{this.cachedTrackIds=new Set(s.result),console.log(`[AudioCache] Index built: ${this.cachedTrackIds.size} tracks in IndexedDB cache`)}}catch(r){console.error("[AudioCache] Failed to build cache index:",r)}}async buildServiceWorkerCacheIndex(){try{if(!("caches"in window))return;const n=await(await caches.open("soundwave-audio-v1")).keys();this.swCachedTrackIds=new Set(n.map(s=>{const a=s.url.match(/\/api\/audio\/([^/]+)\/download\//);return a?a[1]:null}).filter(s=>s!==null)),console.log(`[AudioCache] SW Index built: ${this.swCachedTrackIds.size} tracks in Service Worker cache`)}catch(r){console.error("[AudioCache] Failed to build SW cache index:",r)}}isLikelyCached(r){return this.cachedTrackIds.has(r)||this.swCachedTrackIds.has(r)}async isCached(r){return this.cachedTrackIds.has(r)?!0:(this.db||await this.init(),new Promise(n=>{try{const o=this.db.transaction(Fe.AUDIO_BLOBS,"readonly").objectStore(Fe.AUDIO_BLOBS).get(r);o.onsuccess=()=>{const i=!!o.result;i&&this.cachedTrackIds.add(r),n(i)},o.onerror=()=>n(!1)}catch{n(!1)}}))}async getCachedAudio(r){return this.db||await this.init(),new Promise(n=>{try{const a=this.db.transaction(Fe.AUDIO_BLOBS,"readwrite").objectStore(Fe.AUDIO_BLOBS),o=a.get(r);o.onsuccess=()=>{const i=o.result;i?(i.lastAccessed=Date.now(),i.accessCount+=1,a.put(i),n(i.blob)):n(null)},o.onerror=()=>n(null)}catch{n(null)}})}async getCachedUrl(r){const n=await this.getCachedAudio(r);return n?URL.createObjectURL(n):null}async cacheAudio(r,n,s){return this.db||await this.init(),await this.ensureCacheSpace(n.size),new Promise(a=>{try{const o=this.db.transaction([Fe.AUDIO_BLOBS,Fe.METADATA],"readwrite"),i=o.objectStore(Fe.AUDIO_BLOBS),c=o.objectStore(Fe.METADATA),u=Date.now(),d={id:r,blob:n,size:n.size,cachedAt:u,lastAccessed:u,accessCount:1,duration:s?.duration};if(i.put(d),s){const f={id:r,youtube_id:r,title:s.title||"",artist:s.artist,duration:s.duration,cachedAt:u,size:n.size};c.put(f)}o.oncomplete=()=>{this.cachedTrackIds.add(r),console.log(`[AudioCache] Cached: ${r} (${(n.size/1024/1024).toFixed(2)}MB)`),a(!0)},o.onerror=()=>a(!1)}catch{a(!1)}})}async prefetchTrack(r,n="normal"){const s=r.youtube_id;if(!s)return;if(n!=="high"&&!x0()){const o=Mr();console.log(`[AudioCache] Skipping prefetch due to network: ${o.quality}, saveData: ${o.isSaveData}`);return}if(!hr.prefetch.shouldAttempt()){console.log(`[AudioCache] Skipping prefetch due to backoff (failures: ${hr.prefetch.getFailureCount()})`);return}if(this.cachedTrackIds.has(s)){console.log(`[AudioCache] Already cached (fast): ${r.title}`);return}if(this.prefetchingInProgress.has(s))return;if(await this.isCached(s)){console.log(`[AudioCache] Already cached: ${r.title}`);return}this.prefetchingInProgress.add(s);const a=Mr();console.log(`[AudioCache] Prefetching (${n}, network: ${a.quality}): ${r.title}`);try{const o=await fetch(`/api/audio/${s}/player/`,{headers:{Authorization:`Token ${localStorage.getItem("token")}`}});if(!o.ok)throw hr.prefetch.recordFailure(),new Error("Failed to get stream URL");const c=(await o.json()).stream_url;if(!c)throw new Error("No stream URL returned");const u=await fetch(c);if(!u.ok)throw hr.prefetch.recordFailure(),new Error("Failed to fetch audio");const d=await u.blob();await this.cacheAudio(s,d,{title:r.title,artist:r.channel_name,duration:r.duration}),hr.prefetch.recordSuccess()}catch(o){console.error(`[AudioCache] Failed to prefetch ${r.title}:`,o)}finally{this.prefetchingInProgress.delete(s),this.prefetchQueue.delete(s)}}async prefetchUpcoming(r,n,s=!1){if(r.length===0)return;const a=p0(),o=Mr();if(a===0){console.log(`[AudioCache] Skipping prefetch - poor network (${o.quality}) or save-data enabled`);return}console.log(`[AudioCache] Prefetching ${a} tracks (network: ${o.quality})`);const i=[];for(let c=1;c<=a;c++){const u=n+c;u<r.length&&i.push(r[u])}if(s&&r.length>5&&o.quality==="excellent"){const c=new Set;for(;c.size<Math.min(1,r.length-n-1);){const u=Math.floor(Math.random()*r.length);u!==n&&!i.find(d=>d.id===r[u].id)&&c.add(u)}c.forEach(u=>i.push(r[u]))}if(o.quality==="excellent"||o.quality==="good")for(let c=0;c<i.length;c++){const u=c===0?"high":c<2?"normal":"low";this.prefetchTrack(i[c],u)}else for(let c=0;c<i.length;c++)await this.prefetchTrack(i[c],"high")}async recordPlay(r,n,s){return this.db||await this.init(),new Promise(a=>{try{const i=this.db.transaction(Fe.ANALYTICS,"readwrite").objectStore(Fe.ANALYTICS),c=i.get(r);c.onsuccess=()=>{const d=c.result||{id:r,playCount:0,lastPlayed:0,skipCount:0,completionRate:0,listeningTime:0};d.playCount+=1,d.lastPlayed=Date.now(),d.listeningTime+=s,n||(d.skipCount+=1);const f=d.playCount,p=f-d.skipCount;d.completionRate=p/f,i.put(d),a()},c.onerror=()=>a()}catch{a()}})}async getFrequentlyPlayed(r=10){return this.db||await this.init(),new Promise(n=>{try{const i=this.db.transaction(Fe.ANALYTICS,"readonly").objectStore(Fe.ANALYTICS).index("playCount").openCursor(null,"prev"),c=[];i.onsuccess=()=>{const u=i.result;if(u&&c.length<r){const d=u.value;d.completionRate>.5&&c.push(d.id),u.continue()}else n(c)},i.onerror=()=>n([])}catch{n([])}})}async ensureCacheSpace(r){if(!this.db)return;const n=await this.getCacheStats();if(n.totalSize+r>Gr.maxCacheSize){const s=n.totalSize+r-Gr.maxCacheSize+10485760;await this.evictOldest(s)}n.count>=Gr.maxCachedTracks&&await this.evictOldest(0,5)}async evictOldest(r=0,n=0){if(this.db)return new Promise(s=>{try{const c=this.db.transaction(Fe.AUDIO_BLOBS,"readwrite").objectStore(Fe.AUDIO_BLOBS).index("lastAccessed").openCursor();let u=0,d=0;c.onsuccess=()=>{const f=c.result;if(f){const p=f.value;(Date.now()-p.cachedAt>Gr.staleTime||u<r||d<n)&&(console.log(`[AudioCache] Evicting: ${p.id} (${(p.size/1024/1024).toFixed(2)}MB)`),f.delete(),u+=p.size,d++),f.continue()}else console.log(`[AudioCache] Cleanup complete: evicted ${d} tracks, freed ${(u/1024/1024).toFixed(2)}MB`),s()},c.onerror=()=>s()}catch{s()}})}async getCacheStats(){return this.db||await this.init(),new Promise(r=>{try{const a=this.db.transaction(Fe.AUDIO_BLOBS,"readonly").objectStore(Fe.AUDIO_BLOBS).getAll();a.onsuccess=()=>{const o=a.result,i=o.reduce((u,d)=>u+d.size,0),c=o.length>0?Math.min(...o.map(u=>u.cachedAt)):Date.now();r({count:o.length,totalSize:i,oldestEntry:c})},a.onerror=()=>r({count:0,totalSize:0,oldestEntry:Date.now()})}catch{r({count:0,totalSize:0,oldestEntry:Date.now()})}})}async clearCache(){return this.db||await this.init(),new Promise(r=>{try{const n=this.db.transaction([Fe.AUDIO_BLOBS,Fe.METADATA],"readwrite");n.objectStore(Fe.AUDIO_BLOBS).clear(),n.objectStore(Fe.METADATA).clear(),n.oncomplete=()=>{console.log("[AudioCache] Cache cleared"),r()},n.onerror=()=>r()}catch{r()}})}async getServiceWorkerCachedUrl(r){try{if(!("caches"in window))return console.log("[AudioCache] Cache API not available"),null;const n=`/api/audio/${r}/download/`,a=await(await caches.open("soundwave-audio-v1")).match(n);if(a){console.log("[AudioCache] Found in Service Worker cache:",r);const o=await a.blob();return URL.createObjectURL(o)}return null}catch(n){return console.error("[AudioCache] Error checking Service Worker cache:",n),null}}async getAnyCachedUrl(r){const n=this.cachedTrackIds.has(r),s=this.swCachedTrackIds.has(r);if(!n&&!s)return null;if(n){const i=await this.getCachedUrl(r);if(i)return{url:i,source:"indexeddb"}}if(s){const i=await this.getServiceWorkerCachedUrl(r);if(i)return{url:i,source:"serviceworker"}}const a=await this.getCachedUrl(r);if(a)return this.cachedTrackIds.add(r),{url:a,source:"indexeddb"};const o=await this.getServiceWorkerCachedUrl(r);return o?(this.swCachedTrackIds.add(r),{url:o,source:"serviceworker"}):null}async isAvailableOffline(r){if(this.cachedTrackIds.has(r)||this.swCachedTrackIds.has(r)||await this.isCached(r))return!0;try{if("caches"in window)return!!await(await caches.open("soundwave-audio-v1")).match(`/api/audio/${r}/download/`)}catch{}return!1}scheduleCleanup(){this.cleanupScheduled||(this.cleanupScheduled=!0,setInterval(async()=>{console.log("[AudioCache] Running scheduled cleanup..."),await this.evictOldest(0,0)},Gr.cleanupInterval))}async refreshServiceWorkerIndex(){await this.buildServiceWorkerCacheIndex()}addToServiceWorkerIndex(r){this.swCachedTrackIds.add(r)}}const dt=new y0,b0=Gr,Lu=l.createContext(void 0),Sa=()=>{const t=l.useContext(Lu);if(!t)throw new Error("usePWA must be used within PWAProvider");return t},v0=({children:t})=>{const[r,n]=l.useState(navigator.onLine),[s,a]=l.useState(!1),[o,i]=l.useState(qe.getIsInstalled()),[c,u]=l.useState(!1),[d,f]=l.useState(null);l.useEffect(()=>{qe.registerServiceWorker();const v=()=>n(!0),S=()=>n(!1),A=()=>a(!0),E=()=>{i(!0),a(!1)},P=()=>u(!0);return qe.on("online",v),qe.on("offline",S),qe.on("canInstall",A),qe.on("installed",E),qe.on("updateAvailable",P),(async()=>{const R=await qe.getCacheSize();f(R)})(),a(qe.canInstall()),()=>{qe.off("online",v),qe.off("offline",S),qe.off("canInstall",A),qe.off("installed",E),qe.off("updateAvailable",P)}},[]);const b={isOnline:r,canInstall:s,isInstalled:o,isUpdateAvailable:c,cacheSize:d,showInstallPrompt:async()=>await qe.showInstallPrompt(),updateApp:async()=>{await qe.updateServiceWorker()},clearCache:async()=>{const v=await qe.clearCache();if(v){const S=await qe.getCacheSize();f(S)}return v},cacheAudio:async v=>{const S=await qe.cacheAudio(v);if(S){const A=await qe.getCacheSize();f(A)}return S},cachePlaylist:async(v,S,A)=>{const E=await qe.cachePlaylist(v,S,A);if(E.success){const P=await qe.getCacheSize();f(P),await dt.refreshServiceWorkerIndex(),console.log("[PWA] Refreshed cache index after playlist cache")}return E},removePlaylistCache:async(v,S)=>{const A=await qe.removePlaylistCache(v,S);if(A){const E=await qe.getCacheSize();f(E),await dt.refreshServiceWorkerIndex()}return A},requestNotifications:async()=>await qe.requestNotificationPermission()};return e.jsx(Lu.Provider,{value:b,children:t})},j0="soundwave-offline",w0=2,Ae={AUDIO_QUEUE:"audioQueue",FAVORITES:"favorites",PLAYLISTS:"playlists",SETTINGS:"settings",PENDING_UPLOADS:"pendingUploads",LYRICS:"lyrics"};class S0{db=null;async init(){return new Promise((r,n)=>{const s=indexedDB.open(j0,w0);s.onerror=()=>n(s.error),s.onsuccess=()=>{this.db=s.result,r()},s.onupgradeneeded=a=>{const o=a.target.result;o.objectStoreNames.contains(Ae.AUDIO_QUEUE)||o.createObjectStore(Ae.AUDIO_QUEUE,{keyPath:"id"}),o.objectStoreNames.contains(Ae.FAVORITES)||o.createObjectStore(Ae.FAVORITES,{keyPath:"id"}).createIndex("timestamp","timestamp",{unique:!1}),o.objectStoreNames.contains(Ae.PLAYLISTS)||o.createObjectStore(Ae.PLAYLISTS,{keyPath:"id"}),o.objectStoreNames.contains(Ae.SETTINGS)||o.createObjectStore(Ae.SETTINGS,{keyPath:"key"}),o.objectStoreNames.contains(Ae.PENDING_UPLOADS)||o.createObjectStore(Ae.PENDING_UPLOADS,{keyPath:"id",autoIncrement:!0}).createIndex("timestamp","timestamp",{unique:!1}),o.objectStoreNames.contains(Ae.LYRICS)||o.createObjectStore(Ae.LYRICS,{keyPath:"youtube_id"})}})}async get(r,n){try{return this.db||await this.init(),this.db.objectStoreNames.contains(r)?new Promise((s,a)=>{const c=this.db.transaction(r,"readonly").objectStore(r).get(n);c.onsuccess=()=>s(c.result),c.onerror=()=>a(c.error)}):(console.log(`[OfflineStorage] Store ${r} does not exist`),null)}catch(s){return console.error(`[OfflineStorage] Error getting from ${r}:`,s),null}}async getAll(r){try{return this.db||await this.init(),this.db.objectStoreNames.contains(r)?new Promise((n,s)=>{const i=this.db.transaction(r,"readonly").objectStore(r).getAll();i.onsuccess=()=>n(i.result),i.onerror=()=>s(i.error)}):(console.log(`[OfflineStorage] Store ${r} does not exist`),[])}catch(n){return console.error(`[OfflineStorage] Error getting all from ${r}:`,n),[]}}async put(r,n){try{if(this.db||await this.init(),!this.db.objectStoreNames.contains(r)){console.log(`[OfflineStorage] Store ${r} does not exist, skipping put`);return}return new Promise((s,a)=>{const c=this.db.transaction(r,"readwrite").objectStore(r).put(n);c.onsuccess=()=>s(),c.onerror=()=>a(c.error)})}catch(s){console.error(`[OfflineStorage] Error putting to ${r}:`,s)}}async delete(r,n){return this.db||await this.init(),new Promise((s,a)=>{const c=this.db.transaction(r,"readwrite").objectStore(r).delete(n);c.onsuccess=()=>s(),c.onerror=()=>a(c.error)})}async clear(r){return this.db||await this.init(),new Promise((n,s)=>{const i=this.db.transaction(r,"readwrite").objectStore(r).clear();i.onsuccess=()=>n(),i.onerror=()=>s(i.error)})}async saveAudioQueue(r){await this.clear(Ae.AUDIO_QUEUE);for(const n of r)await this.put(Ae.AUDIO_QUEUE,n)}async getAudioQueue(){return await this.getAll(Ae.AUDIO_QUEUE)}async addFavorite(r){await this.put(Ae.FAVORITES,{...r,timestamp:Date.now()})}async removeFavorite(r){await this.delete(Ae.FAVORITES,r)}async getFavorites(){return await this.getAll(Ae.FAVORITES)}async addPendingUpload(r){await this.put(Ae.PENDING_UPLOADS,{...r,timestamp:Date.now()})}async getPendingUploads(){return await this.getAll(Ae.PENDING_UPLOADS)}async removePendingUpload(r){await this.delete(Ae.PENDING_UPLOADS,r)}async saveSetting(r,n){await this.put(Ae.SETTINGS,{key:r,value:n})}async getSetting(r){return(await this.get(Ae.SETTINGS,r))?.value}async savePlaylist(r){await this.put(Ae.PLAYLISTS,{...r,offline:!0,lastSync:Date.now()})}async getPlaylist(r){return await this.get(Ae.PLAYLISTS,r)}async getPlaylistByPlaylistId(r){return(await this.getAll(Ae.PLAYLISTS)).find(s=>s.playlist_id===r)||null}async getPlaylists(){return await this.getAll(Ae.PLAYLISTS)}async getOfflinePlaylists(){return(await this.getAll(Ae.PLAYLISTS)).filter(n=>n.offline)}async removePlaylist(r){await this.delete(Ae.PLAYLISTS,r)}async updatePlaylistSyncStatus(r,n){const s=await this.getPlaylist(r);s&&(s.syncStatus=n,s.lastSync=Date.now(),await this.put(Ae.PLAYLISTS,s))}async clearAllData(){await this.clear(Ae.AUDIO_QUEUE),await this.clear(Ae.FAVORITES),await this.clear(Ae.PLAYLISTS),await this.clear(Ae.PENDING_UPLOADS),await this.clear(Ae.LYRICS)}async saveLyrics(r,n){await this.put(Ae.LYRICS,{youtube_id:r,...n,cachedAt:Date.now()})}async getLyrics(r){return await this.get(Ae.LYRICS,r)}async removeLyrics(r){await this.delete(Ae.LYRICS,r)}}const ut=new S0;ut.init().catch(t=>{console.error("Failed to initialize offline storage:",t)});var es={},Zl;function C0(){if(Zl)return es;Zl=1;var t=ne();Object.defineProperty(es,"__esModule",{value:!0}),es.default=void 0;var r=t(ae()),n=se();return es.default=(0,r.default)((0,n.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M10 17l-3.5-3.5 1.41-1.41L10 14.17 15.18 9l1.41 1.41z"}),"CloudDone"),es}var k0=C0();const Wu=re(k0);var ts={},ec;function _0(){if(ec)return ts;ec=1;var t=ne();Object.defineProperty(ts,"__esModule",{value:!0}),ts.default=void 0;var r=t(ae()),n=se();return ts.default=(0,r.default)((0,n.jsx)("path",{d:"M22.99 9C19.15 5.16 13.8 3.76 8.84 4.78l2.52 2.52c3.47-.17 6.99 1.05 9.63 3.7zm-4 4c-1.29-1.29-2.84-2.13-4.49-2.56l3.53 3.53zM2 3.05 5.07 6.1C3.6 6.82 2.22 7.78 1 9l1.99 2c1.24-1.24 2.67-2.16 4.2-2.77l2.24 2.24C7.81 10.89 6.27 11.73 5 13v.01L6.99 15c1.36-1.36 3.14-2.04 4.92-2.06L18.98 20l1.27-1.26L3.29 1.79zM9 17l3 3 3-3c-1.65-1.66-4.34-1.66-6 0"}),"WifiOff"),ts}var R0=_0();const I0=re(R0);function A0({playlist:t,isOffline:r=!1,isOnline:n=!0,isSyncing:s=!1,onSync:a,onDelete:o,onClick:i}){const c=t.item_count>0?Math.round(t.downloaded_count/t.item_count*100):0,u=d=>{if(!d)return"Never synced";const f=new Date(d),g=new Date().getTime()-f.getTime(),m=Math.floor(g/6e4),y=Math.floor(g/36e5),j=Math.floor(g/864e5);return m<1?"Just now":m<60?`${m}m ago`:y<24?`${y}h ago`:`${j}d ago`};return e.jsxs(h,{onClick:i,sx:{width:"100%",minWidth:0,maxWidth:280,borderRadius:3,overflow:"hidden",bgcolor:"background.paper",cursor:"pointer",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",position:"relative","&:hover":{transform:"translateY(-8px) scale(1.02)",boxShadow:d=>`0 20px 40px ${d.palette.mode==="dark"?"rgba(0,0,0,0.4)":"rgba(0,0,0,0.15)"}`,"& .playlist-overlay":{opacity:1},"& .playlist-play-btn":{opacity:1,transform:"scale(1)"}}},children:[e.jsxs(h,{sx:{height:0,paddingBottom:"100%",width:"100%",position:"relative",backgroundImage:t.thumbnail_url?`url(${t.thumbnail_url})`:"none",backgroundSize:"cover",backgroundPosition:"center",bgcolor:"grey.900"},children:[!t.thumbnail_url&&e.jsx(h,{sx:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"},children:e.jsx(oa,{sx:{fontSize:64,color:"white",opacity:.8}})}),e.jsx(h,{className:"playlist-overlay",sx:{position:"absolute",inset:0,background:"linear-gradient(to top, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0.3) 50%, rgba(0,0,0,0.1) 100%)",opacity:0,transition:"opacity 0.3s ease"}}),e.jsx(h,{className:"playlist-play-btn",sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%) scale(0.8)",opacity:0,transition:"all 0.3s ease"},children:e.jsx(h,{sx:{width:56,height:56,borderRadius:"50%",bgcolor:"primary.main",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 20px rgba(0,0,0,0.4)"},children:e.jsx(gt,{sx:{fontSize:32,color:"white"}})})}),e.jsxs(h,{sx:{position:"absolute",bottom:8,right:8,bgcolor:"rgba(0,0,0,0.75)",backdropFilter:"blur(4px)",borderRadius:1.5,px:1,py:.5,display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Lt,{sx:{fontSize:14,color:"white"}}),e.jsxs(x,{variant:"caption",sx:{color:"white",fontWeight:600},children:[t.downloaded_count,"/",t.item_count]})]}),r&&e.jsx(ue,{icon:e.jsx(Wu,{sx:{fontSize:14}}),label:"Offline",size:"small",sx:{position:"absolute",top:8,left:8,height:24,fontSize:"0.7rem",fontWeight:600,bgcolor:"success.main",color:"white","& .MuiChip-icon":{color:"white"}}}),!n&&!r&&e.jsx(ue,{icon:e.jsx(I0,{sx:{fontSize:14}}),label:"Unavailable",size:"small",sx:{position:"absolute",top:8,left:8,height:24,fontSize:"0.7rem",fontWeight:600,bgcolor:"rgba(0, 0, 0, 0.7)",color:"warning.main","& .MuiChip-icon":{color:"warning.main"}}})]}),e.jsxs(h,{sx:{p:2},children:[e.jsx(x,{variant:"subtitle2",fontWeight:600,noWrap:!0,sx:{mb:.5,lineHeight:1.3},children:t.title}),e.jsx(x,{variant:"caption",color:"text.secondary",noWrap:!0,sx:{display:"block",mb:1.5},children:t.channel_name}),e.jsxs(h,{sx:{mb:1.5},children:[e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:.5},children:[e.jsx(x,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.65rem"},children:u(t.last_refresh)}),e.jsxs(x,{variant:"caption",color:"primary.main",fontWeight:600,sx:{fontSize:"0.7rem"},children:[c,"%"]})]}),e.jsx(rt,{variant:"determinate",value:c,sx:{height:4,borderRadius:2,bgcolor:"rgba(255,255,255,0.1)","& .MuiLinearProgress-bar":{borderRadius:2,background:c===100?"linear-gradient(90deg, #00C853, #69F0AE)":"linear-gradient(90deg, #667eea, #764ba2)"}}})]}),e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(ve,{title:s?"Syncing...":"Sync playlist",children:e.jsx("span",{children:e.jsx(X,{size:"small",color:"primary",onClick:d=>{d.stopPropagation(),a?.()},disabled:s,sx:{bgcolor:"rgba(102, 126, 234, 0.1)","&:hover":{bgcolor:"rgba(102, 126, 234, 0.2)"}},children:s?e.jsx(Ie,{size:18,color:"inherit"}):e.jsx(vi,{sx:{fontSize:18}})})})}),e.jsx(ve,{title:"Remove playlist",children:e.jsx(X,{size:"small",color:"error",onClick:d=>{d.stopPropagation(),o?.()},sx:{bgcolor:"rgba(244, 67, 54, 0.1)","&:hover":{bgcolor:"rgba(244, 67, 54, 0.2)"}},children:e.jsx(jo,{sx:{fontSize:18}})})})]})]})]})}function P0(){const t=Dt(),{isOnline:r}=Sa(),{getExtraSetting:n,updateExtraSetting:s}=Cr(),[a,o]=l.useState([]),[i,c]=l.useState(!0),[u,d]=l.useState(!1),[f,p]=l.useState(""),[g,m]=l.useState(""),[y,j]=l.useState(new Set),[C,w]=l.useState(new Set),[b,v]=l.useState({open:!1,message:"",severity:"info"}),S=l.useCallback(I=>I.playlist_id,[]),{sortedItems:A,handleDragEnd:E,resetOrder:P,hasCustomOrder:k}=Fu({items:a,storageKey:"soundwave-playlist-order",getItemId:S,getExtraSetting:n,updateExtraSetting:s}),R=uu(rn(go,{activationConstraint:{distance:8}}),rn(yi,{activationConstraint:{delay:250,tolerance:5}}),rn(mo,{coordinateGetter:Eu})),z=async()=>{try{if(!r){console.log("[Offline] Loading playlists from cache");const _=await ut.getOfflinePlaylists();if(_.length>0){const O=_.map(D=>({id:D.id,playlist_id:D.playlist_id,title:D.title,channel_name:D.channel_name||"Offline",thumbnail_url:D.thumbnail_url,subscribed:!0,item_count:D.item_count||D.items?.length||0,downloaded_count:D.downloaded_count||D.items?.length||0,last_refresh:null,sync_status:"success",status_display:"Offline",error_message:"",active:!0,progress_percent:100}));o(O),j(new Set(O.map(D=>D.id)))}else o([]);c(!1);return}const I=await Zd();o(I),await B()}catch(I){console.error("Failed to load playlists:",I),o([])}finally{c(!1)}},B=async()=>{try{const I=await ut.getOfflinePlaylists(),_=new Set(I.map(O=>O.id));j(_)}catch(I){console.error("Failed to load offline status:",I)}};l.useEffect(()=>{z()},[r]);const F=async()=>{m(""),c(!0);try{await Qt.create({url:f}),p(""),d(!1),alert(" Playlist subscription started! Fetching metadata and downloading audio..."),await z(),c(!1),setTimeout(async()=>{await z()},3e4)}catch(I){c(!1),m(I.response?.data?.detail||"Failed to subscribe to playlist")}},W=async I=>{w(_=>new Set(_).add(I));try{const _=await Qt.download(I);console.log("[Playlist] Download started:",_.data),v({open:!0,message:" Sync started! Server processing in background...",severity:"info"}),setTimeout(async()=>{await z(),w(D=>{const Q=new Set(D);return Q.delete(I),Q});const O=a.find(D=>D.playlist_id===I);O&&(O.sync_status==="success"?v({open:!0,message:` Sync complete! ${O.downloaded_count}/${O.item_count} tracks available`,severity:"success"}):O.sync_status==="failed"&&v({open:!0,message:` Sync failed: ${O.error_message||"Unknown error"}`,severity:"error"}))},3e4)}catch(_){console.error("Failed to start download:",_),w(O=>{const D=new Set(O);return D.delete(I),D}),v({open:!0,message:` Failed to start sync: ${_.response?.data?.detail||_.message||"Unknown error"}`,severity:"error"})}},H=async I=>{if(confirm("Are you sure you want to remove this playlist?"))try{await Qt.delete(I),z()}catch(_){console.error("Failed to delete playlist:",_)}};return e.jsxs(h,{children:[e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,px:.5},children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(x,{variant:"h6",sx:{fontWeight:700,letterSpacing:"-0.02em"},children:"YouTube Playlists"}),k&&e.jsx(ve,{title:"Reset to default order",children:e.jsx(X,{size:"small",onClick:P,sx:{opacity:.7},children:e.jsx(dd,{fontSize:"small"})})})]}),e.jsx(N,{variant:"contained",size:"small",startIcon:e.jsx(sr,{}),onClick:()=>d(!0),sx:{borderRadius:"9999px",textTransform:"none",fontWeight:600},children:"Add Playlist"})]}),e.jsx(Iu,{sensors:R,collisionDetection:pu,onDragEnd:E,children:e.jsx(Du,{items:A.map(I=>I.playlist_id),strategy:vo,children:e.jsx(h,{sx:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:{xs:1.5,sm:2,md:3},pb:2,"@media (min-width: 900px)":{gridTemplateColumns:"repeat(3, 1fr)"},"@media (min-width: 1200px)":{gridTemplateColumns:"repeat(4, 1fr)"}},children:A.map(I=>e.jsx(Ou,{id:I.playlist_id,children:e.jsx(A0,{playlist:I,isOffline:y.has(I.id),isOnline:r,isSyncing:C.has(I.playlist_id)||I.sync_status==="syncing",onSync:()=>W(I.playlist_id),onDelete:()=>H(I.playlist_id),onClick:()=>t(`/playlists/${I.playlist_id}`)})},I.playlist_id))})})}),!i&&a.length===0&&e.jsxs(h,{sx:{textAlign:"center",py:8,color:"text.secondary"},children:[e.jsx(hd,{sx:{fontSize:64,mb:2,opacity:.3}}),e.jsx(x,{variant:"h6",gutterBottom:!0,children:"No playlists added"}),e.jsx(x,{variant:"body2",sx:{mb:3},children:"Add YouTube playlists to automatically download all their videos"}),e.jsx(N,{variant:"contained",startIcon:e.jsx(sr,{}),onClick:()=>d(!0),children:"Add Playlist"})]}),e.jsxs(Ke,{open:u,onClose:()=>d(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(tt,{children:"Add YouTube Playlist"}),e.jsxs(Xe,{children:[g&&e.jsx(pe,{severity:"error",sx:{mb:2},children:g}),e.jsx(Ce,{autoFocus:!0,margin:"dense",label:"Playlist URL",placeholder:"https://www.youtube.com/playlist?list=...",fullWidth:!0,value:f,onChange:I=>p(I.target.value),helperText:"Enter a YouTube playlist URL"})]}),e.jsxs(nt,{children:[e.jsx(N,{onClick:()=>d(!1),children:"Cancel"}),e.jsx(N,{onClick:F,variant:"contained",disabled:!f,children:"Add Playlist"})]})]}),e.jsx(it,{open:b.open,autoHideDuration:5e3,onClose:()=>v(I=>({...I,open:!1})),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(pe,{onClose:()=>v(I=>({...I,open:!1})),severity:b.severity,sx:{width:"100%"},children:b.message})}),e.jsx(cn,{})]})}function D0({setCurrentAudio:t}){const{playlistId:r}=ii(),n=Dt(),{isOnline:s,cachePlaylist:a,removePlaylistCache:o,cacheSize:i}=Sa(),{getTrackRef:c,shouldHighlight:u}=ba(),[d,f]=l.useState(null),[p,g]=l.useState(!0),[m,y]=l.useState(""),[j,C]=l.useState(!1),[w,b]=l.useState(""),[v,S]=l.useState(!1),[A,E]=l.useState(!1),[P,k]=l.useState(null),[R,z]=l.useState(new Set),B=l.useCallback(async()=>{if(!d?.items)return;const $=new Set;for(const U of d.items)U.audio.youtube_id&&await dt.isAvailableOffline(U.audio.youtube_id)&&$.add(U.audio.youtube_id);z($)},[d?.items]);l.useEffect(()=>{r&&(W(),F())},[r]),l.useEffect(()=>{d?.items&&B()},[d?.items,v,B]);const F=async()=>{if(r)try{const $=await ut.getPlaylistByPlaylistId(r);S($?.offline||!1)}catch($){console.error("Failed to check offline status:",$)}},W=async()=>{try{if(g(!0),!s){const U=await ut.getPlaylistByPlaylistId(r);if(U&&U.items){console.log("[Offline] Loading playlist from cache:",U.title),f({...U,sync_status:"success",status_display:"Offline",progress_percent:100}),S(!0),y("");return}else{y("Playlist not available offline");return}}const $=await Qt.getWithItems(r);f($.data),y("")}catch($){console.error("Failed to load playlist:",$);try{const U=await ut.getPlaylistByPlaylistId(r);if(U&&U.items){console.log("[Fallback] Loading playlist from cache:",U.title),f({...U,sync_status:"success",status_display:"Cached",progress_percent:100}),S(!0),y("");return}}catch(U){console.error("Failed to load from cache:",U)}y($.response?.data?.detail||"Failed to load playlist")}finally{g(!1)}},H=async()=>{if(!d?.items)return;const $=d.items.filter(U=>U.audio.file_path&&U.audio.youtube_id);if($.length===0){b("No downloaded tracks to save"),C(!0);return}b(`Downloading ${$.length} tracks to your device`),C(!0);for(const U of $)try{const K=await kt.downloadFile(U.audio.youtube_id),ce=window.URL.createObjectURL(K),q=document.createElement("a");q.href=ce,q.download=U.audio.title||"audio",q.style.display="none",document.body.appendChild(q),q.click(),document.body.removeChild(q),window.URL.revokeObjectURL(ce),await new Promise(oe=>setTimeout(oe,500))}catch(K){console.error(`Failed to download ${U.audio.title}:`,K)}},I=$=>{f(U=>U?.items?{...U,items:U.items.map(K=>K.audio.id===$.id?{...K,audio:$}:K)}:U)},_=async()=>{if(!d?.items||!s){b(s?"No tracks to cache":"Must be online to download for offline use"),C(!0);return}const $=d.items.filter(U=>U.audio.file_path);if($.length===0){b("No tracks downloaded yet. Download tracks first."),C(!0);return}E(!0),k({current:0,total:$.length+1,percent:0,currentItem:"Starting...",status:"downloading"});try{const U=$.map(ce=>`/api/audio/${ce.audio.youtube_id}/download/`),K=await a(d.playlist_id,U,ce=>{k(ce)});if(K.success){await ut.savePlaylist({id:d.id,playlist_id:d.playlist_id,title:d.title,description:d.description,channel_name:d.channel_name,thumbnail_url:d.thumbnail_url,item_count:d.item_count,downloaded_count:$.length,items:$.map(ce=>({id:ce.id,position:ce.position,audio:ce.audio})),offline:!0,lastSync:Date.now()});for(const ce of $)if(ce.audio.youtube_id)try{const q=localStorage.getItem("token"),oe=await fetch(`/api/audio/${ce.audio.youtube_id}/lyrics/`,{headers:{Authorization:`Token ${q}`}});if(oe.ok){const ie=await oe.json();await ut.saveLyrics(ce.audio.youtube_id,ie),console.log("[Offline] Cached lyrics for:",ce.audio.title)}}catch{console.log("[Offline] Could not cache lyrics for:",ce.audio.title)}S(!0),await B(),K.failed>0?b(` ${K.cached} tracks cached, ${K.failed} failed`):b(` ${K.cached} tracks available offline!`)}else b("Failed to cache playlist")}catch(U){console.error("Failed to cache offline:",U),b("Offline caching failed")}finally{E(!1),k(null),C(!0)}},O=async()=>{if(d?.items)try{const $=d.items.filter(U=>U.audio.file_path).map(U=>`/api/audio/${U.audio.youtube_id}/download/`);await o(d.playlist_id,$),await ut.removePlaylist(d.id),S(!1),z(new Set),b("Offline data removed"),C(!0)}catch($){console.error("Failed to remove offline data:",$),b("Failed to remove offline data"),C(!0)}},D=async($,U)=>{try{b(`Downloading "${U}" to your device`),C(!0);const K=await kt.downloadFile($),ce=window.URL.createObjectURL(K),q=document.createElement("a");q.href=ce,q.download=U||"audio",q.style.display="none",document.body.appendChild(q),q.click(),document.body.removeChild(q),window.URL.revokeObjectURL(ce)}catch(K){console.error("Download failed:",K),b("Download failed"),C(!0)}},Q=()=>{if(!d?.items)return;const $=d.items.filter(U=>U.audio.file_path).map(U=>U.audio);$.length>0?(t($[0],$),b(`Playing ${$.length} tracks`),C(!0)):(b("No downloaded tracks to play"),C(!0))},J=()=>{if(!d?.items)return;const $=d.items.filter(U=>U.audio.file_path).map(U=>U.audio);if($.length>0){const U=[...$];for(let K=U.length-1;K>0;K--){const ce=Math.floor(Math.random()*(K+1));[U[K],U[ce]]=[U[ce],U[K]]}t(U[0],U),b(`Shuffled ${U.length} tracks`),C(!0)}else b("No downloaded tracks to shuffle"),C(!0)},M=$=>{const U=Math.floor($/60),K=$%60;return`${U}:${K.toString().padStart(2,"0")}`},T=$=>new Date($).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),te=$=>{switch($){case"syncing":return"primary";case"success":return"success";case"failed":return"error";case"stale":return"warning";default:return"default"}};return p?e.jsx(h,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh"},children:e.jsx(Ie,{})}):m||!d?e.jsxs(h,{children:[e.jsx(X,{onClick:()=>n("/playlists"),sx:{mb:2},children:e.jsx(nn,{})}),e.jsx(pe,{severity:"error",children:m||"Playlist not found"})]}):e.jsxs(h,{children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:2,mb:3,flexWrap:"wrap"},children:[e.jsx(X,{onClick:()=>n("/playlists"),sx:{bgcolor:"rgba(255, 255, 255, 0.05)","&:hover":{bgcolor:"rgba(255, 255, 255, 0.1)"}},children:e.jsx(nn,{})}),e.jsxs(h,{sx:{flex:1,minWidth:200},children:[e.jsx(x,{variant:"h5",sx:{fontWeight:700,letterSpacing:"-0.02em",mb:.5},children:d.title}),e.jsx(x,{variant:"body2",color:"text.secondary",children:d.channel_name})]}),e.jsx(ue,{label:d.status_display,color:te(d.sync_status),size:"small"})]}),!s&&e.jsx(_e,{sx:{mb:3,bgcolor:"rgba(255, 193, 7, 0.1)",border:"1px solid rgba(255, 193, 7, 0.3)"},children:e.jsxs(h,{sx:{p:2,display:"flex",alignItems:"center",gap:2},children:[e.jsx(bh,{sx:{color:"warning.main"}}),e.jsxs(h,{sx:{flex:1},children:[e.jsx(x,{variant:"subtitle2",sx:{fontWeight:600,color:"warning.main"},children:"Offline Mode"}),e.jsx(x,{variant:"caption",color:"text.secondary",children:v?"This playlist is available offline":"You are offline. Cache playlists when online for offline access."})]})]})}),e.jsxs(h,{sx:{display:"flex",gap:1.5,mb:3,flexWrap:"wrap"},children:[e.jsx(N,{variant:"contained",startIcon:e.jsx(ar,{}),onClick:Q,disabled:!d.downloaded_count,sx:{minWidth:{xs:"48px",sm:"120px"},bgcolor:"primary.main",color:"background.dark",fontWeight:600,"&:hover":{bgcolor:"primary.dark"},"&:disabled":{bgcolor:"rgba(255, 255, 255, 0.1)"}},children:e.jsx(h,{sx:{display:{xs:"none",sm:"block"}},children:"Play All"})}),e.jsx(N,{variant:"outlined",startIcon:e.jsx(ta,{}),onClick:J,disabled:!d.downloaded_count,sx:{minWidth:{xs:"48px",sm:"120px"},borderColor:"primary.main",color:"primary.main",fontWeight:600,"&:hover":{borderColor:"primary.dark",bgcolor:"rgba(19, 236, 106, 0.05)"},"&:disabled":{borderColor:"rgba(255, 255, 255, 0.1)",color:"rgba(255, 255, 255, 0.3)"}},children:e.jsx(h,{sx:{display:{xs:"none",sm:"block"}},children:"Shuffle"})}),e.jsx(N,{variant:"outlined",startIcon:e.jsx(jr,{}),onClick:H,disabled:!d.downloaded_count,sx:{minWidth:{xs:"48px",sm:"150px"},borderColor:"primary.main",color:"primary.main",fontWeight:600,"&:hover":{borderColor:"primary.dark",bgcolor:"rgba(19, 236, 106, 0.05)"},"&:disabled":{borderColor:"rgba(255, 255, 255, 0.1)",color:"rgba(255, 255, 255, 0.3)"}},title:"Download all tracks to your device",children:e.jsx(h,{sx:{display:{xs:"none",sm:"block"}},children:"Save All"})})]}),e.jsx(_e,{sx:{mb:3,bgcolor:v?"rgba(76, 175, 80, 0.1)":"rgba(33, 150, 243, 0.1)",border:`1px solid ${v?"rgba(76, 175, 80, 0.3)":"rgba(33, 150, 243, 0.3)"}`},children:e.jsxs(h,{sx:{p:2},children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[v?e.jsx(ra,{sx:{color:"success.main"}}):e.jsx(ro,{sx:{color:"info.main"}}),e.jsxs(h,{sx:{flex:1},children:[e.jsx(x,{variant:"subtitle2",sx:{fontWeight:600,mb:.5},children:v?" Offline Ready":" Cache for Offline"}),e.jsx(x,{variant:"caption",color:"text.secondary",children:v?`${d.downloaded_count} tracks cached and available without internet`:"Download this playlist to listen without an internet connection"})]})]}),e.jsxs(h,{sx:{display:"flex",gap:1.5,flexWrap:"wrap"},children:[v?e.jsxs(e.Fragment,{children:[e.jsx(ve,{title:"Remove offline cache to free up storage space",children:e.jsx(N,{variant:"outlined",startIcon:e.jsx(vh,{}),onClick:O,size:"small",sx:{borderColor:"error.main",color:"error.main",fontWeight:600,"&:hover":{borderColor:"error.dark",bgcolor:"rgba(244, 67, 54, 0.05)"}},children:"Remove Offline"})}),e.jsx(ue,{icon:e.jsx(ra,{}),label:"Cached",color:"success",size:"small",sx:{fontWeight:600}})]}):e.jsx(N,{variant:"contained",startIcon:e.jsx(jr,{}),onClick:_,disabled:!s||A||!d.downloaded_count,size:"small",sx:{bgcolor:"info.main",color:"white",fontWeight:600,"&:hover":{bgcolor:"info.dark"},"&:disabled":{bgcolor:"rgba(255, 255, 255, 0.1)"}},children:A?"Caching...":"Make Available Offline"}),i&&e.jsxs(h,{sx:{ml:"auto",display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[e.jsx(x,{variant:"caption",color:"text.secondary",children:"Storage Used"}),e.jsxs(x,{variant:"caption",sx:{fontWeight:600},children:[(i.usage/1024/1024).toFixed(1)," MB / ",(i.quota/1024/1024/1024).toFixed(1)," GB"]})]})]})]})}),d.downloaded_count<d.item_count&&e.jsxs(h,{sx:{mb:3},children:[e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsx(x,{variant:"caption",color:"text.secondary",children:"Download Progress"}),e.jsxs(x,{variant:"caption",color:"text.secondary",children:[d.downloaded_count," / ",d.item_count," tracks"]})]}),e.jsx(rt,{variant:"determinate",value:d.progress_percent,sx:{height:6,borderRadius:1}})]}),e.jsxs(h,{sx:{display:"flex",gap:3,mb:3,flexWrap:"wrap"},children:[e.jsxs(h,{children:[e.jsx(x,{variant:"caption",color:"text.secondary",children:"Total Tracks"}),e.jsx(x,{variant:"h6",sx:{fontWeight:600},children:d.item_count})]}),e.jsxs(h,{children:[e.jsx(x,{variant:"caption",color:"text.secondary",children:"Downloaded"}),e.jsx(x,{variant:"h6",sx:{fontWeight:600,color:"primary.main"},children:d.downloaded_count})]}),d.last_refresh&&e.jsxs(h,{children:[e.jsx(x,{variant:"caption",color:"text.secondary",children:"Last Updated"}),e.jsx(x,{variant:"body2",sx:{fontWeight:500},children:T(d.last_refresh)})]})]}),e.jsx(Lr,{children:e.jsxs(Wr,{size:"small",children:[e.jsx($r,{children:e.jsxs(ht,{children:[e.jsx(Z,{width:60,sx:{fontWeight:600,fontSize:{xs:"0.7rem",sm:"0.75rem"}},children:"#"}),e.jsx(Z,{sx:{fontWeight:600,fontSize:{xs:"0.7rem",sm:"0.75rem"}},children:"Title"}),e.jsx(Z,{sx:{fontWeight:600,fontSize:{xs:"0.7rem",sm:"0.75rem"},display:{xs:"none",md:"table-cell"}},children:"Channel"}),e.jsx(Z,{align:"right",sx:{fontWeight:600,fontSize:{xs:"0.7rem",sm:"0.75rem"}},children:"Duration"}),e.jsx(Z,{align:"center",width:120,sx:{fontWeight:600,fontSize:{xs:"0.7rem",sm:"0.75rem"}},children:"Actions"})]})}),e.jsx(Br,{children:d.items&&d.items.length>0?d.items.map(($,U)=>{const K=(d.items||[]).filter(ce=>ce.audio.file_path).map(ce=>ce.audio);return e.jsxs(ht,{ref:c($.audio.youtube_id),sx:{cursor:"pointer",transition:"background-color 0.3s ease","&:hover":{bgcolor:"rgba(19, 236, 106, 0.05)"},opacity:$.audio.file_path?1:.5,...u($.audio.youtube_id)&&{bgcolor:"rgba(19, 236, 106, 0.1)"}},onClick:()=>$.audio.file_path&&t($.audio,K),children:[e.jsx(Z,{sx:{color:"text.secondary",fontSize:{xs:"0.7rem",sm:"0.75rem"}},children:U+1}),e.jsx(Z,{children:e.jsxs(h,{children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(x,{variant:"body2",noWrap:!0,sx:{maxWidth:{xs:180,sm:280,md:380},fontWeight:500,fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:$.audio.title}),$.audio.youtube_id&&R.has($.audio.youtube_id)&&e.jsx(ve,{title:"Available offline",children:e.jsx(jh,{sx:{fontSize:14,color:"success.main",flexShrink:0}})})]}),!$.audio.file_path&&e.jsx(ue,{label:"Not Downloaded",size:"small",color:"warning",sx:{mt:.5,height:18,fontSize:"0.65rem"}})]})}),e.jsx(Z,{sx:{display:{xs:"none",md:"table-cell"}},children:e.jsx(x,{variant:"body2",color:"text.secondary",noWrap:!0,sx:{maxWidth:150,fontSize:"0.75rem"},children:$.audio.channel_name})}),e.jsx(Z,{align:"right",sx:{color:"text.secondary",fontSize:{xs:"0.7rem",sm:"0.75rem"}},children:M($.audio.duration)}),e.jsx(Z,{align:"center",onClick:ce=>ce.stopPropagation(),children:e.jsxs(h,{sx:{display:"flex",gap:.5,justifyContent:"center"},children:[e.jsx(X,{size:"small",onClick:()=>$.audio.file_path&&t($.audio,K),disabled:!$.audio.file_path,sx:{color:"primary.main","&:disabled":{color:"rgba(255, 255, 255, 0.3)"}},title:"Play",children:e.jsx(ar,{})}),$.audio.file_path&&$.audio.youtube_id&&e.jsx(X,{size:"small",onClick:()=>D($.audio.youtube_id,$.audio.title),sx:{color:"primary.main"},title:"Download to device",children:e.jsx(Uo,{})}),e.jsx(Fr,{track:$.audio,onTrackUpdate:I})]})})]},$.id)}):e.jsx(ht,{children:e.jsx(Z,{colSpan:5,align:"center",sx:{py:4},children:e.jsx(x,{variant:"body2",color:"text.secondary",children:"No tracks found in this playlist"})})})})]})}),e.jsx(it,{open:A,autoHideDuration:2e3,onClose:()=>{},anchorOrigin:{vertical:"bottom",horizontal:"center"},sx:{mb:8},children:e.jsx(pe,{severity:"info",icon:e.jsx(jr,{}),sx:{width:"100%",minWidth:300,alignItems:"center"},children:e.jsxs(h,{children:[e.jsx(x,{variant:"body2",fontWeight:600,children:"Caching for Offline"}),P&&e.jsxs(h,{sx:{mt:.5},children:[e.jsxs(x,{variant:"caption",color:"text.secondary",children:[P.currentItem," (",P.current,"/",P.total,")"]}),e.jsx(rt,{variant:"determinate",value:P.percent,sx:{height:4,borderRadius:1,mt:.5}})]})]})})}),e.jsx(it,{open:j,autoHideDuration:3e3,onClose:()=>C(!1),message:w,anchorOrigin:{vertical:"bottom",horizontal:"center"}})]})}const za=[{label:"Most Played (Top 50)",rules:[{field:"play_count",operator:"greater_than",value:"0"}],order_by:"-play_count",limit:50},{label:"Recently Added (Last 30 days)",rules:[{field:"downloaded_date",operator:"in_last_days",value:"30"}],order_by:"-downloaded_date",limit:null},{label:"Favorites",rules:[{field:"is_favorite",operator:"is_true",value:""}],order_by:"-downloaded_date",limit:null},{label:"By Genre...",rules:[{field:"genre",operator:"contains",value:""}],order_by:"title",limit:null},{label:"By Artist...",rules:[{field:"artist",operator:"contains",value:""}],order_by:"title",limit:null},{label:"Short Tracks (Under 3 min)",rules:[{field:"duration",operator:"less_than",value:"180"}],order_by:"duration",limit:null},{label:"Custom Rules...",rules:[],order_by:"-downloaded_date",limit:null}],M0={local_fire_department:e.jsx(na,{}),new_releases:e.jsx(Sh,{}),history:e.jsx(gd,{}),explore:e.jsx(wh,{}),bolt:e.jsx(fd,{}),album:e.jsx(md,{}),auto_awesome:e.jsx(fr,{}),tune:e.jsx(Xr,{})};function E0({setCurrentAudio:t}){const r=Dt(),[n,s]=l.useState([]),[a,o]=l.useState(!0),[i,c]=l.useState(!1),[u,d]=l.useState(""),[f,p]=l.useState(""),[g,m]=l.useState(0),[y,j]=l.useState(""),[C,w]=l.useState(null),[b,v]=l.useState([]),[S,A]=l.useState({open:!1,message:"",severity:"info"}),E=l.useCallback(async()=>{try{o(!0);const _=await rr.list();s(_.data.data||[])}catch(_){console.error("Failed to load smart playlists:",_),A({open:!0,message:"Failed to load smart playlists",severity:"error"})}finally{o(!1)}},[]),P=l.useCallback(async()=>{try{const _=await rr.getChoices();w(_.data)}catch(_){console.error("Failed to load choices:",_)}},[]);l.useEffect(()=>{E(),P()},[E,P]);const k=()=>{d(""),p(""),m(0),j(""),v([{field:"genre",operator:"contains",value:""}])},R=()=>{k(),c(!0)},z=async()=>{if(!u.trim()){A({open:!0,message:"Please enter a name",severity:"error"});return}const _=za[g];let O=[..._.rules];_.label.includes("...")&&y.trim()&&(O=O.map(D=>({...D,value:y.trim()}))),g===za.length-1&&(O=b.filter(D=>D.value.trim()||D.operator==="is_true"||D.operator==="is_false")),O.length===0&&A({open:!0,message:"No rules set - playlist will include all tracks. Add rules after creation to filter.",severity:"info"});try{const D=await rr.create({name:u,description:f,order_by:_.order_by,limit:_.limit,rules:O});k(),c(!1),A({open:!0,message:"Smart playlist created!",severity:"success"}),E(),D.data?.id&&r(`/smart-playlist/${D.data.id}`)}catch(D){console.error("Failed to create smart playlist:",D),A({open:!0,message:D.response?.data?.name?.[0]||"Failed to create smart playlist",severity:"error"})}},B=async(_,O)=>{if(O.stopPropagation(),_.is_system){A({open:!0,message:"Cannot delete system playlists",severity:"error"});return}if(confirm(`Delete "${_.name}"?`))try{await rr.delete(_.id),A({open:!0,message:"Smart playlist deleted",severity:"success"}),E()}catch(D){console.error("Failed to delete smart playlist:",D),A({open:!0,message:"Failed to delete smart playlist",severity:"error"})}},F=async(_,O,D)=>{D.stopPropagation();try{const J=(await rr.getTracks(_.id,{page_size:100})).data.data;if(J.length===0){A({open:!0,message:"No tracks in this playlist",severity:"info"});return}let M=[...J];if(O)for(let T=M.length-1;T>0;T--){const te=Math.floor(Math.random()*(T+1));[M[T],M[te]]=[M[te],M[T]]}t(M[0],M),A({open:!0,message:`Playing ${J.length} tracks${O?" (shuffled)":""}`,severity:"success"})}catch(Q){console.error("Failed to play playlist:",Q),A({open:!0,message:"Failed to load tracks",severity:"error"})}},W=_=>M0[_]||e.jsx(fr,{}),H=n.filter(_=>_.is_system),I=n.filter(_=>!_.is_system);return a?e.jsx(h,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh"},children:e.jsx(Ie,{})}):e.jsxs(h,{sx:{p:{xs:2,sm:3}},children:[e.jsx(cn,{}),e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(fr,{sx:{fontSize:32,color:"primary.main"}}),e.jsx(x,{variant:"h4",fontWeight:"bold",children:"Smart Playlists"})]}),e.jsx(N,{variant:"contained",startIcon:e.jsx(sr,{}),onClick:R,children:"Create"})]}),e.jsx(x,{variant:"body1",color:"text.secondary",sx:{mb:4},children:"Dynamic playlists that automatically update based on rules. Your library changes, they update instantly."}),H.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(x,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(fd,{sx:{color:"warning.main"}}),"Auto Playlists"]}),e.jsx(ee,{container:!0,spacing:2,sx:{mb:4},children:H.map(_=>e.jsx(ee,{item:!0,xs:12,sm:6,md:4,lg:3,children:e.jsx(ea,{in:!0,timeout:300,children:e.jsx(_e,{sx:{height:"100%",background:`linear-gradient(135deg, ${_.color}22 0%, transparent 50%)`,borderLeft:`4px solid ${_.color}`,transition:"transform 0.2s, box-shadow 0.2s","&:hover":{transform:"translateY(-4px)",boxShadow:4}},children:e.jsx(Ii,{onClick:()=>r(`/smart-playlist/${_.id}`),children:e.jsxs(Pe,{children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(h,{sx:{color:_.color},children:W(_.icon)}),e.jsx(x,{variant:"h6",noWrap:!0,sx:{flex:1},children:_.name})]}),e.jsx(x,{variant:"body2",color:"text.secondary",sx:{mb:1,minHeight:40},children:_.description}),e.jsxs(h,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx(ue,{label:`${_.track_count} tracks`,size:"small",sx:{bgcolor:`${_.color}22`,color:_.color}}),e.jsxs(h,{sx:{display:"flex",gap:.5},children:[e.jsx(ve,{title:"Play",children:e.jsx(X,{size:"small",onClick:O=>F(_,!1,O),sx:{color:_.color},children:e.jsx(ar,{})})}),e.jsx(ve,{title:"Shuffle",children:e.jsx(X,{size:"small",onClick:O=>F(_,!0,O),sx:{color:_.color},children:e.jsx(ta,{})})})]})]})]})})})})},_.id))})]}),e.jsxs(x,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(Xr,{sx:{color:"primary.main"}}),"Custom Smart Playlists"]}),I.length===0?e.jsxs(yt,{sx:{p:4,textAlign:"center",bgcolor:"background.default"},children:[e.jsx(fr,{sx:{fontSize:64,color:"text.secondary",opacity:.5,mb:2}}),e.jsx(x,{variant:"h6",color:"text.secondary",children:"No custom smart playlists yet"}),e.jsx(x,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Create your own rules-based playlists"}),e.jsx(N,{variant:"outlined",startIcon:e.jsx(sr,{}),onClick:R,children:"Create Smart Playlist"})]}):e.jsx(ee,{container:!0,spacing:2,children:I.map(_=>e.jsx(ee,{item:!0,xs:12,sm:6,md:4,lg:3,children:e.jsx(ea,{in:!0,timeout:300,children:e.jsx(_e,{sx:{height:"100%",background:`linear-gradient(135deg, ${_.color}22 0%, transparent 50%)`,borderLeft:`4px solid ${_.color}`,transition:"transform 0.2s, box-shadow 0.2s","&:hover":{transform:"translateY(-4px)",boxShadow:4}},children:e.jsx(Ii,{onClick:()=>r(`/smart-playlist/${_.id}`),children:e.jsxs(Pe,{children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(h,{sx:{color:_.color},children:W(_.icon)}),e.jsx(x,{variant:"h6",noWrap:!0,sx:{flex:1},children:_.name})]}),e.jsx(x,{variant:"body2",color:"text.secondary",sx:{mb:1,minHeight:40},children:_.description||"No description"}),e.jsxs(h,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx(ue,{label:`${_.track_count} tracks`,size:"small",sx:{bgcolor:`${_.color}22`,color:_.color}}),e.jsxs(h,{sx:{display:"flex",gap:.5},children:[e.jsx(ve,{title:"Play",children:e.jsx(X,{size:"small",onClick:O=>F(_,!1,O),sx:{color:_.color},children:e.jsx(ar,{})})}),e.jsx(ve,{title:"Shuffle",children:e.jsx(X,{size:"small",onClick:O=>F(_,!0,O),sx:{color:_.color},children:e.jsx(ta,{})})}),e.jsx(ve,{title:"Delete",children:e.jsx(X,{size:"small",onClick:O=>B(_,O),sx:{color:"error.main"},children:e.jsx(Er,{})})})]})]})]})})})})},_.id))}),e.jsxs(Ke,{open:i,onClose:()=>c(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(tt,{children:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(fr,{color:"primary"}),"Create Smart Playlist"]})}),e.jsxs(Xe,{children:[e.jsx(Ce,{autoFocus:!0,margin:"dense",label:"Name",fullWidth:!0,value:u,onChange:_=>d(_.target.value),sx:{mb:2}}),e.jsx(Ce,{margin:"dense",label:"Description (optional)",fullWidth:!0,multiline:!0,rows:2,value:f,onChange:_=>p(_.target.value),sx:{mb:3}}),e.jsx(Ee,{sx:{mb:2}}),e.jsxs(x,{variant:"subtitle2",sx:{mb:1,display:"flex",alignItems:"center",gap:1},children:[e.jsx(Xr,{fontSize:"small"}),"Choose what tracks to include:"]}),e.jsx(xd,{value:g,onChange:_=>{m(Number(_.target.value)),j("")},children:za.map((_,O)=>e.jsxs(h,{children:[e.jsx(We,{value:O,control:e.jsx(Ho,{size:"small"}),label:_.label,sx:{ml:0}}),g===O&&_.label.includes("...")&&e.jsx(Ce,{size:"small",placeholder:_.label.includes("Genre")?"e.g., Rock, Pop, Jazz":"e.g., Artist name",value:y,onChange:D=>j(D.target.value),sx:{ml:4,mb:1,width:"calc(100% - 32px)"}})]},O))}),g===za.length-1&&C&&e.jsxs(h,{sx:{ml:4,mt:1},children:[b.map((_,O)=>e.jsxs(h,{sx:{display:"flex",gap:1,mb:1,alignItems:"center"},children:[e.jsxs(Ct,{size:"small",sx:{minWidth:120},children:[e.jsx(Wt,{children:"Field"}),e.jsx(Rt,{value:_.field,label:"Field",onChange:D=>{const Q=[...b];Q[O].field=D.target.value,v(Q)},children:C.fields.map(D=>e.jsx(we,{value:D.value,children:D.label},D.value))})]}),e.jsxs(Ct,{size:"small",sx:{minWidth:130},children:[e.jsx(Wt,{children:"Operator"}),e.jsx(Rt,{value:_.operator,label:"Operator",onChange:D=>{const Q=[...b];Q[O].operator=D.target.value,v(Q)},children:C.operators.map(D=>e.jsx(we,{value:D.value,children:D.label},D.value))})]}),!["is_true","is_false","is_set","is_not_set"].includes(_.operator)&&e.jsx(Ce,{size:"small",placeholder:"Value",value:_.value,onChange:D=>{const Q=[...b];Q[O].value=D.target.value,v(Q)},sx:{flex:1}}),e.jsx(X,{size:"small",onClick:()=>{const D=b.filter((Q,J)=>J!==O);v(D.length?D:[{field:"genre",operator:"contains",value:""}])},disabled:b.length===1,children:e.jsx(pd,{})})]},O)),e.jsx(N,{size:"small",startIcon:e.jsx(sr,{}),onClick:()=>v([...b,{field:"genre",operator:"contains",value:""}]),children:"Add Rule"})]}),e.jsx(pe,{severity:"info",sx:{mt:2},children:"Smart playlists automatically update when your library changes. You can refine rules after creation."})]}),e.jsxs(nt,{children:[e.jsx(N,{onClick:()=>c(!1),children:"Cancel"}),e.jsx(N,{onClick:z,variant:"contained",children:"Create"})]})]}),e.jsx(it,{open:S.open,autoHideDuration:4e3,onClose:()=>A({...S,open:!1}),children:e.jsx(pe,{severity:S.severity,onClose:()=>A({...S,open:!1}),children:S.message})})]})}function T0({setCurrentAudio:t}){const{playlistId:r}=ii(),n=Dt(),{getTrackRef:s,shouldHighlight:a}=ba(),[o,i]=l.useState(null),[c,u]=l.useState([]),[d,f]=l.useState(!0),[p,g]=l.useState(""),[m,y]=l.useState(!1),[j,C]=l.useState(""),[w,b]=l.useState(!1),[v,S]=l.useState(null),[A,E]=l.useState([]),[P,k]=l.useState("all"),[R,z]=l.useState("-downloaded_date"),[B,F]=l.useState(""),[W,H]=l.useState(null),[I,_]=l.useState(!1);l.useEffect(()=>{r&&(O(),D())},[r]);const O=async()=>{try{f(!0);const q=await rr.getTracks(parseInt(r));i(q.data.playlist),u(q.data.data||[]),g("")}catch(q){console.error("Failed to load smart playlist:",q),g(q.response?.data?.detail||"Failed to load playlist")}finally{f(!1)}},D=async()=>{try{const q=await rr.getChoices();S(q.data)}catch(q){console.error("Failed to load choices:",q)}},Q=(q=0,oe=!1)=>{if(c.length===0)return;let ie=[...c];if(oe){for(let Ue=ie.length-1;Ue>0;Ue--){const Be=Math.floor(Math.random()*(Ue+1));[ie[Ue],ie[Be]]=[ie[Be],ie[Ue]]}q=0}t(ie[q],ie)},J=q=>{u(oe=>oe.map(ie=>ie.youtube_id===q.youtube_id?q:ie))},M=async()=>{if(o)try{const oe=(await rr.get(o.id)).data;E(oe.rules||[]),k(oe.match_mode),z(oe.order_by),F(oe.limit||""),b(!0)}catch(q){console.error("Failed to load playlist details:",q)}},T=()=>{E([...A,{field:"genre",operator:"contains",value:"",order:A.length}])},te=q=>{E(A.filter((oe,ie)=>ie!==q))},$=(q,oe,ie)=>{E(A.map((Ue,Be)=>Be===q?{...Ue,[oe]:ie}:Ue))},U=async()=>{_(!0);try{const q=await rr.preview({rules:A.map(oe=>({field:oe.field,operator:oe.operator,value:oe.value,value_2:oe.value_2})),match_mode:P,order_by:R,limit:B?parseInt(B.toString()):null});H(q.data.total_count)}catch(q){console.error("Failed to preview:",q)}finally{_(!1)}},K=async()=>{if(o)try{await rr.update(o.id,{rules:A.map(q=>({field:q.field,operator:q.operator,value:q.value,value_2:q.value_2})),match_mode:P,order_by:R,limit:B?parseInt(B.toString()):null}),b(!1),C("Rules updated!"),y(!0),O()}catch(q){console.error("Failed to save rules:",q),C(q.response?.data?.error||"Failed to save rules"),y(!0)}},ce=q=>{if(!v)return[];const oe=v.field_types[q];return v.operator_groups[oe]||[]};return d?e.jsx(h,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh"},children:e.jsx(Ie,{})}):p?e.jsxs(h,{sx:{p:3},children:[e.jsx(pe,{severity:"error",children:p}),e.jsx(N,{startIcon:e.jsx(nn,{}),onClick:()=>n("/smart-playlists"),sx:{mt:2},children:"Back to Smart Playlists"})]}):o?e.jsxs(h,{sx:{p:{xs:2,sm:3}},children:[e.jsxs(h,{sx:{mb:3},children:[e.jsx(N,{startIcon:e.jsx(nn,{}),onClick:()=>n("/smart-playlists"),sx:{mb:2},children:"Back to Smart Playlists"}),e.jsx(_e,{sx:{background:`linear-gradient(135deg, ${o.color}33 0%, transparent 50%)`,borderLeft:`4px solid ${o.color}`},children:e.jsx(Pe,{children:e.jsxs(h,{sx:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",flexWrap:"wrap",gap:2},children:[e.jsxs(h,{children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(fr,{sx:{color:o.color,fontSize:32}}),e.jsx(x,{variant:"h4",fontWeight:"bold",children:o.name}),o.is_system&&e.jsx(ue,{label:"Auto",size:"small",color:"warning"})]}),e.jsx(x,{variant:"body1",color:"text.secondary",sx:{mb:2},children:o.description}),e.jsx(h,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:e.jsx(ue,{label:`${c.length} tracks`,sx:{bgcolor:`${o.color}22`,color:o.color}})})]}),e.jsxs(h,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[e.jsx(N,{variant:"contained",startIcon:e.jsx(ar,{}),onClick:()=>Q(0,!1),disabled:c.length===0,sx:{bgcolor:o.color,"&:hover":{bgcolor:o.color,filter:"brightness(0.9)"}},children:"Play All"}),e.jsx(N,{variant:"outlined",startIcon:e.jsx(ta,{}),onClick:()=>Q(0,!0),disabled:c.length===0,sx:{borderColor:o.color,color:o.color},children:"Shuffle"}),!o.is_system&&e.jsx(N,{variant:"outlined",startIcon:e.jsx(Xr,{}),onClick:M,children:"Edit Rules"})]})]})})})]}),c.length===0?e.jsxs(yt,{sx:{p:4,textAlign:"center"},children:[e.jsx(fr,{sx:{fontSize:64,color:"text.secondary",opacity:.5,mb:2}}),e.jsx(x,{variant:"h6",color:"text.secondary",children:"No tracks match the rules"}),!o.is_system&&e.jsx(N,{variant:"outlined",startIcon:e.jsx(Xr,{}),onClick:M,sx:{mt:2},children:"Edit Rules"})]}):e.jsx(Lr,{component:yt,children:e.jsxs(Wr,{size:"small",children:[e.jsx($r,{children:e.jsxs(ht,{children:[e.jsx(Z,{width:50,children:"#"}),e.jsx(Z,{children:"Title"}),e.jsx(Z,{sx:{display:{xs:"none",md:"table-cell"}},children:"Artist"}),e.jsx(Z,{sx:{display:{xs:"none",sm:"table-cell"}},children:"Channel"}),e.jsx(Z,{align:"right",sx:{display:{xs:"none",lg:"table-cell"}},children:"Plays"}),e.jsx(Z,{align:"right",width:100,children:"Actions"})]})}),e.jsx(Br,{children:c.map((q,oe)=>e.jsxs(ht,{ref:s(q.youtube_id),hover:!0,sx:{cursor:"pointer",...a(q.youtube_id)&&{bgcolor:"rgba(19, 236, 106, 0.1)"}},onClick:()=>Q(oe,!1),children:[e.jsx(Z,{children:oe+1}),e.jsx(Z,{children:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1},children:[q.thumbnail_url&&e.jsx(h,{component:"img",src:q.thumbnail_url,alt:q.title,sx:{width:40,height:40,borderRadius:1,objectFit:"cover"}}),e.jsxs(h,{sx:{overflow:"hidden"},children:[e.jsx(x,{variant:"body2",noWrap:!0,children:q.title}),e.jsx(x,{variant:"caption",color:"text.secondary",sx:{display:{sm:"none"}},children:q.artist||q.channel_name})]})]})}),e.jsx(Z,{sx:{display:{xs:"none",md:"table-cell"}},children:e.jsx(x,{variant:"body2",noWrap:!0,children:q.artist||"-"})}),e.jsx(Z,{sx:{display:{xs:"none",sm:"table-cell"}},children:e.jsx(x,{variant:"body2",noWrap:!0,children:q.channel_name})}),e.jsx(Z,{align:"right",sx:{display:{xs:"none",lg:"table-cell"}},children:q.play_count}),e.jsx(Z,{align:"right",onClick:ie=>ie.stopPropagation(),children:e.jsx(Fr,{track:q,onTrackUpdate:J})})]},q.id))})]})}),e.jsxs(Ke,{open:w,onClose:()=>b(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(tt,{children:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Xr,{}),"Edit Smart Playlist Rules"]})}),e.jsxs(Xe,{dividers:!0,children:[e.jsx(h,{sx:{mb:3},children:e.jsxs(Ct,{fullWidth:!0,size:"small",children:[e.jsx(Wt,{children:"Match Mode"}),e.jsxs(Rt,{value:P,onChange:q=>k(q.target.value),label:"Match Mode",children:[e.jsx(we,{value:"all",children:"Match ALL rules (AND)"}),e.jsx(we,{value:"any",children:"Match ANY rule (OR)"})]})]})}),e.jsx(x,{variant:"subtitle2",sx:{mb:1},children:"Rules"}),A.length===0?e.jsx(pe,{severity:"info",sx:{mb:2},children:"No rules defined. All tracks will be included."}):e.jsx(yt,{variant:"outlined",sx:{p:2,mb:2},children:A.map((q,oe)=>e.jsxs(h,{sx:{display:"flex",gap:1,mb:1,alignItems:"center",flexWrap:"wrap"},children:[e.jsxs(Ct,{size:"small",sx:{minWidth:140},children:[e.jsx(Wt,{children:"Field"}),e.jsx(Rt,{value:q.field,onChange:ie=>$(oe,"field",ie.target.value),label:"Field",children:v?.fields.map(ie=>e.jsx(we,{value:ie.value,children:ie.label},ie.value))})]}),e.jsxs(Ct,{size:"small",sx:{minWidth:160},children:[e.jsx(Wt,{children:"Operator"}),e.jsx(Rt,{value:q.operator,onChange:ie=>$(oe,"operator",ie.target.value),label:"Operator",children:v?.operators.filter(ie=>ce(q.field).includes(ie.value)).map(ie=>e.jsx(we,{value:ie.value,children:ie.label},ie.value))})]}),!["is_true","is_false","is_set","is_not_set"].includes(q.operator)&&e.jsx(Ce,{size:"small",label:"Value",value:q.value,onChange:ie=>$(oe,"value",ie.target.value),sx:{minWidth:120}}),q.operator==="between"&&e.jsx(Ce,{size:"small",label:"To",value:q.value_2||"",onChange:ie=>$(oe,"value_2",ie.target.value),sx:{width:80}}),e.jsx(X,{size:"small",onClick:()=>te(oe),color:"error",children:e.jsx(pd,{})})]},oe))}),e.jsx(N,{startIcon:e.jsx(sr,{}),onClick:T,size:"small",children:"Add Rule"}),e.jsx(Ee,{sx:{my:3}}),e.jsxs(ee,{container:!0,spacing:2,children:[e.jsx(ee,{item:!0,xs:12,sm:6,children:e.jsxs(Ct,{fullWidth:!0,size:"small",children:[e.jsx(Wt,{children:"Order By"}),e.jsx(Rt,{value:R,onChange:q=>z(q.target.value),label:"Order By",children:v?.order_by_options.map(q=>e.jsx(we,{value:q.value,children:q.label},q.value))})]})}),e.jsx(ee,{item:!0,xs:12,sm:6,children:e.jsx(Ce,{fullWidth:!0,size:"small",label:"Limit (empty = unlimited)",type:"number",value:B,onChange:q=>F(q.target.value?parseInt(q.target.value):""),InputProps:{inputProps:{min:1}}})})]}),e.jsxs(h,{sx:{mt:3,display:"flex",alignItems:"center",gap:2},children:[e.jsx(N,{variant:"outlined",startIcon:I?e.jsx(Ie,{size:16}):e.jsx(Ch,{}),onClick:U,disabled:I,children:"Preview"}),W!==null&&e.jsxs(x,{variant:"body2",color:"text.secondary",children:[W," tracks would match"]})]})]}),e.jsxs(nt,{children:[e.jsx(N,{onClick:()=>b(!1),children:"Cancel"}),e.jsx(N,{onClick:K,variant:"contained",children:"Save Rules"})]})]}),e.jsx(it,{open:m,autoHideDuration:4e3,onClose:()=>y(!1),children:e.jsx(pe,{severity:"success",onClose:()=>y(!1),children:j})})]}):null}var rs={},tc;function z0(){if(tc)return rs;tc=1;var t=ne();Object.defineProperty(rs,"__esModule",{value:!0}),rs.default=void 0;var r=t(ae()),n=se();return rs.default=(0,r.default)((0,n.jsx)("path",{d:"M12 1 3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11z"}),"Security"),rs}var O0=z0();const rc=re(O0);var ns={},nc;function F0(){if(nc)return ns;nc=1;var t=ne();Object.defineProperty(ns,"__esModule",{value:!0}),ns.default=void 0;var r=t(ae()),n=se();return ns.default=(0,r.default)((0,n.jsx)("path",{d:"M12 2C6.49 2 2 6.49 2 12s4.49 10 10 10c1.38 0 2.5-1.12 2.5-2.5 0-.61-.23-1.2-.64-1.67-.08-.1-.13-.21-.13-.33 0-.28.22-.5.5-.5H16c3.31 0 6-2.69 6-6 0-4.96-4.49-9-10-9m5.5 11c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5m-3-4c-.83 0-1.5-.67-1.5-1.5S13.67 6 14.5 6s1.5.67 1.5 1.5S15.33 9 14.5 9M5 11.5c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5S7.33 13 6.5 13 5 12.33 5 11.5m6-4c0 .83-.67 1.5-1.5 1.5S8 8.33 8 7.5 8.67 6 9.5 6s1.5.67 1.5 1.5"}),"Palette"),ns}var L0=F0();const W0=re(L0);var ss={},sc;function $0(){if(sc)return ss;sc=1;var t=ne();Object.defineProperty(ss,"__esModule",{value:!0}),ss.default=void 0;var r=t(ae()),n=se();return ss.default=(0,r.default)((0,n.jsx)("path",{d:"m20.38 8.57-1.23 1.85a8 8 0 0 1-.22 7.58H5.07A8 8 0 0 1 15.58 6.85l1.85-1.23A10 10 0 0 0 3.35 19a2 2 0 0 0 1.72 1h13.85a2 2 0 0 0 1.74-1 10 10 0 0 0-.27-10.44zm-9.79 6.84a2 2 0 0 0 2.83 0l5.66-8.49-8.49 5.66a2 2 0 0 0 0 2.83"}),"Speed"),ss}var B0=$0();const ac=re(B0);var as={},oc;function q0(){if(oc)return as;oc=1;var t=ne();Object.defineProperty(as,"__esModule",{value:!0}),as.default=void 0;var r=t(ae()),n=se();return as.default=(0,r.default)((0,n.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore"),as}var N0=q0();const U0=re(N0);var os={},ic;function H0(){if(ic)return os;ic=1;var t=ne();Object.defineProperty(os,"__esModule",{value:!0}),os.default=void 0;var r=t(ae()),n=se();return os.default=(0,r.default)((0,n.jsx)("path",{d:"M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3m-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3m0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5m8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5"}),"Group"),os}var V0=H0();const lc=re(V0);var is={},cc;function Y0(){if(cc)return is;cc=1;var t=ne();Object.defineProperty(is,"__esModule",{value:!0}),is.default=void 0;var r=t(ae()),n=se();return is.default=(0,r.default)((0,n.jsx)("path",{d:"M10 20h4V4h-4zm-6 0h4v-8H4zM16 9v11h4V9z"}),"Equalizer"),is}var G0=Y0();const ji=re(G0);var ls={},dc;function Q0(){if(dc)return ls;dc=1;var t=ne();Object.defineProperty(ls,"__esModule",{value:!0}),ls.default=void 0;var r=t(ae()),n=se();return ls.default=(0,r.default)((0,n.jsx)("path",{d:"m4 18 8.5-6L4 6zm9-12v12l8.5-6z"}),"FastForward"),ls}var K0=Q0();const X0=re(K0);var cs={},uc;function J0(){if(uc)return cs;uc=1;var t=ne();Object.defineProperty(cs,"__esModule",{value:!0}),cs.default=void 0;var r=t(ae()),n=se();return cs.default=(0,r.default)((0,n.jsx)("path",{d:"m19 8-4 4h3c0 3.31-2.69 6-6 6-1.01 0-1.97-.25-2.8-.7l-1.46 1.46C8.97 19.54 10.43 20 12 20c4.42 0 8-3.58 8-8h3zM6 12c0-3.31 2.69-6 6-6 1.01 0 1.97.25 2.8.7l1.46-1.46C15.03 4.46 13.57 4 12 4c-4.42 0-8 3.58-8 8H1l4 4 4-4z"}),"Cached"),cs}var Z0=J0();const $u=re(Z0);var ds={},hc;function ey(){if(hc)return ds;hc=1;var t=ne();Object.defineProperty(ds,"__esModule",{value:!0}),ds.default=void 0;var r=t(ae()),n=se();return ds.default=(0,r.default)((0,n.jsx)("path",{d:"M15 16h4v2h-4zm0-8h7v2h-7zm0 4h6v2h-6zM3 18c0 1.1.9 2 2 2h6c1.1 0 2-.9 2-2V8H3zM14 5h-3l-1-1H6L5 5H2v2h12z"}),"DeleteSweep"),ds}var ty=ey();const ry=re(ty),Ca={fontFamily:'"Roboto", "Helvetica", "Arial", sans-serif',fontSize:13,h1:{fontWeight:600,fontSize:"1.8rem"},h2:{fontWeight:600,fontSize:"1.6rem"},h3:{fontWeight:600,fontSize:"1.4rem"},h4:{fontWeight:600,fontSize:"1.2rem"},h5:{fontWeight:500,fontSize:"1.1rem"},h6:{fontWeight:500,fontSize:"1rem"},body1:{fontSize:"0.875rem"},body2:{fontSize:"0.8125rem"},button:{fontSize:"0.8125rem"},caption:{fontSize:"0.75rem"}},ka={borderRadius:12},_a={MuiButton:{styleOverrides:{root:{textTransform:"none",fontWeight:500,padding:"8px 16px",minHeight:"36px",fontSize:"0.875rem",borderRadius:"9999px",transition:"all 0.3s ease"},sizeSmall:{padding:"6px 12px",minHeight:"32px",fontSize:"0.8125rem"},sizeLarge:{padding:"10px 20px",minHeight:"40px"}}},MuiCard:{styleOverrides:{root:{backgroundImage:"none",borderRadius:"16px",transition:"transform 0.3s ease, box-shadow 0.3s ease","&:hover":{transform:"translateY(-2px)"}}}},MuiCardContent:{styleOverrides:{root:{padding:"12px","&:last-child":{paddingBottom:"12px"}}}},MuiIconButton:{styleOverrides:{root:{padding:"6px"},sizeSmall:{padding:"4px"}}},MuiChip:{styleOverrides:{root:{height:"24px",fontSize:"0.75rem"}}},MuiTableCell:{styleOverrides:{root:{padding:"8px 12px",fontSize:"0.8125rem"},head:{fontWeight:600,fontSize:"0.8125rem"}}},MuiListItem:{styleOverrides:{root:{paddingTop:"4px",paddingBottom:"4px"}}},MuiListItemButton:{styleOverrides:{root:{paddingTop:"6px",paddingBottom:"6px"}}},MuiAlert:{styleOverrides:{root:{padding:"6px 12px",fontSize:"0.8125rem"}}},MuiTextField:{styleOverrides:{root:{"& .MuiInputBase-root":{fontSize:"0.875rem"}}}},MuiAccordionSummary:{styleOverrides:{root:{minHeight:"42px","&.Mui-expanded":{minHeight:"42px"}},content:{margin:"8px 0","&.Mui-expanded":{margin:"8px 0"}}}},MuiAccordionDetails:{styleOverrides:{root:{padding:"8px 16px 16px"}}}},ny=fa({palette:{mode:"dark",primary:{main:"#22d3ee",light:"#67e8f9",dark:"#06b6d4",contrastText:"#ffffff"},secondary:{main:"#fbbf24",light:"#fcd34d",dark:"#f59e0b",contrastText:"#000000"},background:{default:"#0f172a",paper:"#1e293b"},text:{primary:"#f8fafc",secondary:"#94a3b8"},success:{main:"#10b981"},error:{main:"#ef4444"},warning:{main:"#fbbf24"},info:{main:"#22d3ee"}},typography:Ca,shape:ka,components:_a}),sy=fa({palette:{mode:"dark",primary:{main:"#13ec6a",light:"#4fff92",dark:"#0db855"},secondary:{main:"#00BCD4",light:"#4DD0E1",dark:"#0097A7"},background:{default:"#0D1B2A",paper:"#1B263B"},text:{primary:"#E0F7FA",secondary:"#B3E5FC"},success:{main:"#13ec6a"},error:{main:"#FF5252"},warning:{main:"#FFD740"},info:{main:"#13ec6a"}},typography:Ca,shape:ka,components:_a}),ay=fa({palette:{mode:"light",primary:{main:"#13ec6a",light:"#4fff92",dark:"#0db855"},secondary:{main:"#13ec6a",light:"#4fff92",dark:"#0db855"},background:{default:"#f6f8f7",paper:"#FFFFFF"},text:{primary:"#0f172a",secondary:"#64748b"},success:{main:"#13ec6a"},error:{main:"#D32F2F"},warning:{main:"#F57C00"},info:{main:"#13ec6a"}},typography:Ca,shape:ka,components:{..._a,MuiCard:{styleOverrides:{root:{backgroundImage:"none",boxShadow:"0 2px 8px rgba(0,0,0,0.05)"}}}}}),oy=fa({palette:{mode:"dark",primary:{main:"#13ec6a",light:"#4fff92",dark:"#0db855"},secondary:{main:"#13ec6a",light:"#4fff92",dark:"#0db855"},background:{default:"#102217",paper:"#162e21"},text:{primary:"#ffffff",secondary:"rgba(255, 255, 255, 0.6)"},success:{main:"#13ec6a"},error:{main:"#EF5350"},warning:{main:"#FFA726"},info:{main:"#13ec6a"}},typography:Ca,shape:ka,components:_a}),iy=fa({palette:{mode:"light",primary:{main:"#06b6d4",light:"#22d3ee",dark:"#0891b2",contrastText:"#ffffff"},secondary:{main:"#0ea5e9",light:"#38bdf8",dark:"#0284c7",contrastText:"#ffffff"},background:{default:"#ecfeff",paper:"#ffffff"},text:{primary:"#0c4a6e",secondary:"#0369a1"},success:{main:"#10b981"},error:{main:"#ef4444"},warning:{main:"#f59e0b"},info:{main:"#06b6d4"}},typography:Ca,shape:ka,components:_a}),fc={dark:ny,blue:sy,white:ay,green:oy,lightBlue:iy},xc={dark:"Dark",blue:"Ocean Blue",white:"Light",green:"Forest Green",lightBlue:"Light Blue"},ly=t=>fc[t]||fc.dark,cy=t=>{localStorage.setItem("themeMode",t)},dy=()=>localStorage.getItem("themeMode")||"dark";var us={},pc;function uy(){if(pc)return us;pc=1;var t=ne();Object.defineProperty(us,"__esModule",{value:!0}),us.default=void 0;var r=t(ae()),n=se();return us.default=(0,r.default)((0,n.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8z"}),"CheckCircle"),us}var hy=uy();const ua=re(hy),fy={dark:{primary:"#22d3ee",secondary:"#fbbf24",bg1:"#0f172a",bg2:"#1e293b",text:"#f8fafc"},blue:{primary:"#2196F3",secondary:"#00BCD4",bg1:"#0D1B2A",bg2:"#1B263B",text:"#E0F7FA"},white:{primary:"#1976D2",secondary:"#9C27B0",bg1:"#F5F7FA",bg2:"#FFFFFF",text:"#1A202C"},green:{primary:"#4CAF50",secondary:"#00E676",bg1:"#0D1F12",bg2:"#1A2F23",text:"#E8F5E9"},lightBlue:{primary:"#06b6d4",secondary:"#0ea5e9",bg1:"#ecfeff",bg2:"#ffffff",text:"#0c4a6e"}};function xy({name:t,mode:r,isSelected:n,onClick:s}){const a=fy[r];return e.jsxs(h,{onClick:s,sx:{position:"relative",height:100,borderRadius:2,cursor:"pointer",border:3,borderColor:n?a.primary:"divider",transition:"all 0.3s ease",overflow:"hidden","&:hover":{transform:"scale(1.05)",boxShadow:`0 4px 20px ${a.primary}40`}},children:[e.jsx(h,{sx:{position:"absolute",inset:0,background:`linear-gradient(135deg, ${a.bg1} 0%, ${a.bg2} 100%)`}}),e.jsxs(h,{sx:{position:"absolute",top:8,left:8,right:8,bottom:8,display:"flex",flexDirection:"column",gap:.5},children:[e.jsx(h,{sx:{height:8,borderRadius:.5,bgcolor:a.primary,width:"60%"}}),e.jsx(h,{sx:{height:4,borderRadius:.5,bgcolor:a.text,opacity:.7,width:"80%"}}),e.jsx(h,{sx:{height:4,borderRadius:.5,bgcolor:a.text,opacity:.5,width:"60%"}}),e.jsx(h,{sx:{height:4,borderRadius:.5,bgcolor:a.secondary,opacity:.7,width:"40%",mt:.5}})]}),e.jsxs(h,{sx:{position:"absolute",bottom:4,left:8,right:8,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx(x,{sx:{color:a.text,fontSize:"0.75rem",fontWeight:600,textShadow:r==="white"?"none":"0 1px 2px rgba(0,0,0,0.5)"},children:t}),n&&e.jsx(ua,{sx:{fontSize:16,color:a.primary}})]})]})}const Ir=[{id:"radial-metallic",name:"Radial Metallic ",style:"radial-bars",colorScheme:"theme",description:"Modern radial bars with metallic grey tones and theme accent",preview:{primaryColor:"#8B9DC3",secondaryColor:"#5D6D7E",accentColor:"#ABB2BF"}},{id:"bars-classic",name:"Bars Classic",style:"bars-classic",colorScheme:"rainbow",description:"Traditional frequency spectrum with colorful vertical bars",preview:{primaryColor:"#4BBBC1",secondaryColor:"#3AADB3",accentColor:"#2A9DA3"}},{id:"bars-mirrored",name:"Bars Mirrored",style:"bars-mirrored",colorScheme:"neon",description:"Mirrored bars extending from center line",preview:{primaryColor:"#FF00FF",secondaryColor:"#00FFFF",accentColor:"#00FF00"}},{id:"bars-circular",name:"Bars Circular",style:"bars-circular",colorScheme:"sunset",description:"Bars arranged in a circle radiating outward",preview:{primaryColor:"#FF6B6B",secondaryColor:"#FFE66D",accentColor:"#FF8E53"}},{id:"wave-line",name:"Wave Line",style:"wave-line",colorScheme:"ocean",description:"Simple oscilloscope-style line waveform",preview:{primaryColor:"#4BBBC1",secondaryColor:"#3AADB3"}},{id:"wave-fill",name:"Wave Fill",style:"wave-fill",colorScheme:"aurora",description:"Filled waveform with gradient effect",preview:{primaryColor:"#00FF87",secondaryColor:"#7B68EE",accentColor:"#FF69B4"}},{id:"circle-pulse",name:"Circle Pulse",style:"circle-pulse",colorScheme:"theme",description:"Pulsing rings that react to bass and mids",preview:{primaryColor:"#4BBBC1",secondaryColor:"#3AADB3"}},{id:"circle-bars",name:"Circle Bars",style:"circle-bars",colorScheme:"fire",description:"Circular bars radiating from center",preview:{primaryColor:"#FF4500",secondaryColor:"#FFD700",accentColor:"#FF6347"}},{id:"particles",name:"Particles",style:"particles",colorScheme:"aurora",description:"Floating particles that react to audio intensity",preview:{primaryColor:"#00FF87",secondaryColor:"#7B68EE",accentColor:"#FF69B4"}},{id:"dna-helix",name:"DNA Helix",style:"dna-helix",colorScheme:"ocean",description:"Animated DNA double helix pattern",preview:{primaryColor:"#4BBBC1",secondaryColor:"#3AADB3"}},{id:"spectrum",name:"Spectrum",style:"spectrum",colorScheme:"theme",description:"Classic spectrum analyzer with gradient",preview:{primaryColor:"#4BBBC1",secondaryColor:"#3AADB3",accentColor:"#2A9DA3"}},{id:"oscilloscope",name:"Oscilloscope",style:"oscilloscope",colorScheme:"neon",description:"Real-time oscilloscope with glow effect",preview:{primaryColor:"#00FF00",secondaryColor:"#00FFFF"}},{id:"galaxy",name:"Galaxy",style:"galaxy",colorScheme:"aurora",description:"Spiral galaxy pattern that pulses with audio",preview:{primaryColor:"#7B68EE",secondaryColor:"#FF69B4",accentColor:"#00BFFF"}},{id:"flower",name:"Flower",style:"flower",colorScheme:"sunset",description:"Pulsing flower petals that bloom with audio",preview:{primaryColor:"#FF6B6B",secondaryColor:"#FFE66D",accentColor:"#FF8E53"}},{id:"matrix-rain",name:"Matrix Rain",style:"matrix-rain",colorScheme:"theme",description:"Matrix-style falling characters",preview:{primaryColor:"#00FF00",secondaryColor:"#00CC00"}},{id:"aurora",name:"Aurora",style:"aurora",colorScheme:"aurora",description:"Northern lights wave effect",preview:{primaryColor:"#00FF87",secondaryColor:"#7B68EE",accentColor:"#FF69B4"}}],py={theme:[],rainbow:["#FF0000","#FF7F00","#FFFF00","#00FF00","#0000FF","#4B0082","#9400D3"],fire:["#FFD700","#FFA500","#FF4500","#FF0000","#DC143C"],ocean:["#00CED1","#20B2AA","#006994","#00008B","#191970"],neon:["#FF00FF","#00FFFF","#00FF00","#FF00FF"],sunset:["#FF6B6B","#FFE66D","#FF8E53","#FF6347","#CD5C5C"],aurora:["#00FF87","#7B68EE","#FF69B4","#00BFFF","#98FB98"],monochrome:["#FFFFFF","#CCCCCC","#999999","#666666","#333333"],"purple-blue-green":["#9400D3","#4B0082","#0000FF","#00BFFF","#00FF00"]};function Oa(t,r){const n=parseInt(t.slice(1,3),16),s=parseInt(t.slice(3,5),16),a=parseInt(t.slice(5,7),16);return`rgba(${n}, ${s}, ${a}, ${r})`}function mc(t,r){const n=parseInt(t.slice(1,3),16),s=parseInt(t.slice(3,5),16),a=parseInt(t.slice(5,7),16),o=Math.min(255,Math.round(n+(255-n)*r)),i=Math.min(255,Math.round(s+(255-s)*r)),c=Math.min(255,Math.round(a+(255-a)*r));return`#${o.toString(16).padStart(2,"0")}${i.toString(16).padStart(2,"0")}${c.toString(16).padStart(2,"0")}`}function Fa(t,r){const n=parseInt(t.slice(1,3),16),s=parseInt(t.slice(3,5),16),a=parseInt(t.slice(5,7),16),o=Math.max(0,Math.round(n*(1-r))),i=Math.max(0,Math.round(s*(1-r))),c=Math.max(0,Math.round(a*(1-r)));return`#${o.toString(16).padStart(2,"0")}${i.toString(16).padStart(2,"0")}${c.toString(16).padStart(2,"0")}`}function my(t,r=!1,n){const s=Nu(t);let a,o;s.colorScheme==="theme"&&n?(a=n,o=Fa(n,.2),console.log("[Lyrics] Using MUI theme color:",n,"for theme:",t)):(a=s.preview.primaryColor,o=s.preview.secondaryColor,console.log("[Lyrics] Using visualizer theme colors:",a,"for theme:",t,"colorScheme:",s.colorScheme));let i=s.preview.accentColor||mc(a,.3);r&&(a=Fa(a,.2),o=Fa(o,.2),i=Fa(i,.2));const c=r?a:mc(a,.15);return{primary:a,secondary:o,gradientStart:c,gradientMid:i,gradientEnd:o,glow:r?Oa(a,.4):Oa(a,.6),background:Oa(a,r?.15:.2),backgroundHover:Oa(a,r?.22:.3),hoverBackground:r?"rgba(0, 0, 0, 0.06)":"rgba(255, 255, 255, 0.08)",textColor:r?"rgba(0, 0, 0, 0.55)":"rgba(255, 255, 255, 0.45)",pastTextColor:r?"rgba(0, 0, 0, 0.3)":"rgba(255, 255, 255, 0.25)",upcomingTextColor:r?"rgba(0, 0, 0, 0.8)":"rgba(255, 255, 255, 0.75)"}}function Bu(t,r,n){if(t==="theme"&&n)return Array(r).fill(n);const s=py[t];return s.length?Array.from({length:r},(a,o)=>{const i=o/(r-1),c=Math.floor(i*(s.length-1)),u=Math.min(c+1,s.length-1),d=i*(s.length-1)-c;return gy(s[c],s[u],d)}):Array(r).fill(n||"#5C6BC0")}function gy(t,r,n){const s=parseInt(t.slice(1,3),16),a=parseInt(t.slice(3,5),16),o=parseInt(t.slice(5,7),16),i=parseInt(r.slice(1,3),16),c=parseInt(r.slice(3,5),16),u=parseInt(r.slice(5,7),16),d=Math.round(s+(i-s)*n),f=Math.round(a+(c-a)*n),p=Math.round(o+(u-o)*n);return`#${d.toString(16).padStart(2,"0")}${f.toString(16).padStart(2,"0")}${p.toString(16).padStart(2,"0")}`}const qu="radial-metallic";function Nu(t){return Ir.find(r=>r.id===t)||Ir[0]}function yy({theme:t,isSelected:r,onClick:n}){const s=Pt(),[a,o]=l.useState(Array(8).fill(.3));l.useEffect(()=>{const u=setInterval(()=>{o(Array.from({length:8},()=>.2+Math.random()*.8))},200);return()=>clearInterval(u)},[]);const i=l.useMemo(()=>Bu(t.colorScheme,8,s.palette.primary.main),[t.colorScheme,s.palette.primary.main]),c=()=>{switch(t.style){case"bars-classic":return e.jsx(h,{sx:{display:"flex",alignItems:"flex-end",height:"100%",gap:"2px",p:.5},children:a.map((u,d)=>e.jsx(h,{sx:{flex:1,height:`${u*100}%`,bgcolor:i[d],borderRadius:"2px 2px 0 0",transition:"height 0.15s ease",opacity:.9}},d))});case"bars-mirrored":return e.jsx(h,{sx:{display:"flex",alignItems:"center",height:"100%",gap:"2px",p:.5},children:a.map((u,d)=>e.jsx(h,{sx:{flex:1,height:`${u*80}%`,bgcolor:i[d],borderRadius:"2px",transition:"height 0.15s ease",opacity:.8}},d))});case"bars-circular":case"circle-bars":return e.jsx(h,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:e.jsxs("svg",{width:"50",height:"50",viewBox:"0 0 50 50",children:[a.map((u,d)=>{const f=d/a.length*Math.PI*2-Math.PI/2,p=8+u*12,g=25+Math.cos(f)*8,m=25+Math.sin(f)*8,y=25+Math.cos(f)*(8+p),j=25+Math.sin(f)*(8+p);return e.jsx("line",{x1:g,y1:m,x2:y,y2:j,stroke:i[d],strokeWidth:"3",strokeLinecap:"round",style:{transition:"all 0.15s ease"}},d)}),e.jsx("circle",{cx:"25",cy:"25",r:"6",fill:i[0],opacity:"0.4"})]})});case"wave-line":case"oscilloscope":return e.jsx(h,{sx:{position:"relative",height:"100%",overflow:"hidden"},children:e.jsxs("svg",{width:"100%",height:"100%",viewBox:"0 0 100 40",preserveAspectRatio:"none",children:[e.jsx("defs",{children:e.jsx("linearGradient",{id:`wave-gradient-${t.id}`,x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:i.map((u,d)=>e.jsx("stop",{offset:`${d/(i.length-1)*100}%`,stopColor:u},d))})}),e.jsx("path",{d:`M 0 20 ${a.map((u,d)=>`Q ${(d+.5)*(100/a.length)} ${20+(u-.5)*25} ${(d+1)*(100/a.length)} 20`).join(" ")}`,fill:"none",stroke:`url(#wave-gradient-${t.id})`,strokeWidth:"2"})]})});case"wave-fill":return e.jsx(h,{sx:{position:"relative",height:"100%",overflow:"hidden"},children:e.jsxs("svg",{width:"100%",height:"100%",viewBox:"0 0 100 40",preserveAspectRatio:"none",children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:`wavefill-gradient-${t.id}`,x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:i[0],stopOpacity:"0.8"}),e.jsx("stop",{offset:"100%",stopColor:i[0],stopOpacity:"0.1"})]})}),e.jsx("path",{d:`M 0 40 ${a.map((u,d)=>`L ${(d+1)*(100/a.length)} ${40-u*35}`).join(" ")} L 100 40 Z`,fill:`url(#wavefill-gradient-${t.id})`})]})});case"circle-pulse":return e.jsx(h,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:e.jsx("svg",{width:"50",height:"50",viewBox:"0 0 50 50",children:[.8,.5].map((u,d)=>{const f=(a[d]*15+5)*u;return e.jsx("circle",{cx:"25",cy:"25",r:f,fill:"none",stroke:i[0],strokeWidth:2+a[d]*2,opacity:.3+a[d]*.5,style:{transition:"all 0.15s ease"}},d)})})});case"particles":return e.jsx(h,{sx:{position:"relative",height:"100%",overflow:"hidden"},children:a.map((u,d)=>e.jsx(h,{sx:{position:"absolute",width:4+u*6,height:4+u*6,bgcolor:i[d],borderRadius:"50%",left:`${d/a.length*100}%`,bottom:`${u*60}%`,transition:"all 0.15s ease",opacity:.8,boxShadow:`0 0 ${u*10}px ${i[d]}`}},d))});case"dna-helix":return e.jsx(h,{sx:{position:"relative",height:"100%",overflow:"hidden"},children:e.jsx("svg",{width:"100%",height:"100%",viewBox:"0 0 100 40",preserveAspectRatio:"none",children:a.map((u,d)=>{const f=(d+.5)*(100/a.length),p=20+Math.sin(d*.8)*(8+u*8),g=20-Math.sin(d*.8)*(8+u*8);return e.jsxs("g",{children:[e.jsx("circle",{cx:f,cy:p,r:"3",fill:i[d]}),e.jsx("circle",{cx:f,cy:g,r:"3",fill:i[d],opacity:"0.7"}),e.jsx("line",{x1:f,y1:p,x2:f,y2:g,stroke:i[d],strokeWidth:"1",opacity:"0.3"})]},d)})})});case"spectrum":return e.jsx(h,{sx:{display:"flex",alignItems:"flex-end",height:"100%",gap:"1px",p:.5},children:a.map((u,d)=>e.jsx(h,{sx:{flex:1,height:`${u*100}%`,background:`linear-gradient(to top, ${i[0]}, ${i[0]}CC, ${i[0]}80)`,transition:"height 0.15s ease"}},d))});case"galaxy":return e.jsx(h,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:e.jsx("svg",{width:"50",height:"50",viewBox:"0 0 50 50",children:a.map((u,d)=>{const f=d/a.length*Math.PI*4,p=5+d/a.length*15+u*5,g=25+Math.cos(f)*p,m=25+Math.sin(f)*p*.6,y=1+u*2;return e.jsx("circle",{cx:g,cy:m,r:y,fill:i[d],opacity:.3+u*.7,style:{transition:"all 0.15s ease"}},d)})})});case"flower":return e.jsx(h,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:e.jsx("svg",{width:"50",height:"50",viewBox:"0 0 50 50",children:a.map((u,d)=>{const f=d/a.length*Math.PI*2,p=5+u*12;return e.jsx("ellipse",{cx:25+Math.cos(f)*p*.3,cy:25+Math.sin(f)*p*.3,rx:p*.2,ry:p*.5,fill:i[d],opacity:.3+u*.4,transform:`rotate(${f*180/Math.PI}, ${25+Math.cos(f)*p*.3}, ${25+Math.sin(f)*p*.3})`,style:{transition:"all 0.15s ease"}},d)})})});case"matrix-rain":return e.jsx(h,{sx:{position:"relative",height:"100%",overflow:"hidden",fontFamily:"monospace",fontSize:"8px"},children:a.map((u,d)=>e.jsx(h,{sx:{position:"absolute",left:`${d/a.length*100}%`,top:`${(1-u)*50}%`,color:i[0],opacity:u,transition:"all 0.15s ease"},children:String.fromCharCode(12448+Math.floor(Math.random()*96))},d))});case"aurora":return e.jsx(h,{sx:{position:"relative",height:"100%",overflow:"hidden"},children:e.jsxs("svg",{width:"100%",height:"100%",viewBox:"0 0 100 40",preserveAspectRatio:"none",children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:`aurora-gradient-${t.id}`,x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:i[0],stopOpacity:"0.4"}),e.jsx("stop",{offset:"100%",stopColor:i[0],stopOpacity:"0"})]})}),[0,1,2].map(u=>e.jsx("path",{d:`M 0 40 ${a.map((d,f)=>`L ${(f+1)*(100/a.length)} ${40-d*(25-u*5)-u*5}`).join(" ")} L 100 40 Z`,fill:`url(#aurora-gradient-${t.id})`,opacity:1-u*.2},u))]})});case"radial-bars":return e.jsx(h,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:e.jsxs("svg",{width:"50",height:"50",viewBox:"0 0 50 50",children:[a.concat(a).map((u,d)=>{const f=d/(a.length*2)*Math.PI*2-Math.PI/2,p=5+u*10,g=6,m=25+Math.cos(f)*g,y=25+Math.sin(f)*g,j=25+Math.cos(f)*(g+p),C=25+Math.sin(f)*(g+p);return e.jsx("line",{x1:m,y1:y,x2:j,y2:C,stroke:i[d%i.length],strokeWidth:"2",strokeLinecap:"round",opacity:.7+u*.3,style:{transition:"all 0.15s ease"}},d)}),e.jsx("circle",{cx:"25",cy:"25",r:"5",fill:i[0],opacity:"0.5"})]})});default:return e.jsx(h,{sx:{display:"flex",alignItems:"flex-end",height:"100%",gap:"2px",p:.5},children:a.map((u,d)=>e.jsx(h,{sx:{flex:1,height:`${u*100}%`,bgcolor:i[d],borderRadius:"2px",transition:"height 0.15s ease",opacity:.8}},d))})}};return e.jsxs(h,{onClick:n,sx:{cursor:"pointer",borderRadius:2,overflow:"hidden",border:r?`2px solid ${s.palette.primary.main}`:"2px solid transparent",bgcolor:r?`${s.palette.primary.main}15`:s.palette.background.paper,transition:"all 0.2s ease","&:hover":{transform:"scale(1.02)",boxShadow:s.shadows[4],bgcolor:r?`${s.palette.primary.main}20`:s.palette.action.hover},position:"relative"},children:[r&&e.jsx(ua,{sx:{position:"absolute",top:8,right:8,fontSize:20,color:s.palette.primary.main,zIndex:1}}),e.jsx(h,{sx:{height:60,bgcolor:s.palette.mode==="dark"?"rgba(0,0,0,0.3)":"rgba(0,0,0,0.05)",overflow:"hidden"},children:c()}),e.jsxs(h,{sx:{p:1.5},children:[e.jsx(x,{variant:"subtitle2",sx:{fontWeight:r?600:500,color:r?s.palette.primary.main:s.palette.text.primary,mb:.5},children:t.name}),e.jsx(x,{variant:"caption",sx:{color:s.palette.text.secondary,display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",lineHeight:1.3},children:t.description}),e.jsx(h,{sx:{display:"flex",gap:.5,mt:1},children:i.slice(0,5).map((u,d)=>e.jsx(h,{sx:{width:12,height:12,bgcolor:u,borderRadius:"50%",border:`1px solid ${s.palette.divider}`}},d))})]})]})}const Uu=l.createContext(void 0),by=()=>{const t=l.useContext(Uu);if(!t)throw new Error("useQuickSync must be used within QuickSyncProvider");return t},vy=({children:t})=>{const[r,n]=l.useState(null),[s,a]=l.useState(null),[o,i]=l.useState(!0),c=async()=>{try{const p=await V.get("/audio/quick-sync/status/");n(p.data.status),a(p.data.preferences)}catch(p){p?.response?.status===401||p?.response?.status===403?(n(null),a(null)):console.error("Error fetching Quick Sync status:",p)}finally{i(!1)}},u=async p=>{try{const g=await V.post("/audio/quick-sync/preferences/",p);a(g.data.preferences),n(g.data.status)}catch(g){throw console.error("Error updating Quick Sync preferences:",g),g}},d=async()=>{try{i(!0);const p=await V.post("/audio/quick-sync/test/");await c()}catch(p){throw console.error("Error running speed test:",p),p}finally{i(!1)}},f=async()=>{i(!0),await c()};return l.useEffect(()=>{if(!localStorage.getItem("token")){i(!1);return}c()},[]),e.jsx(Uu.Provider,{value:{status:r,preferences:s,loading:o,updatePreferences:u,runSpeedTest:d,refreshStatus:f},children:t})},jy=()=>{const{status:t,preferences:r,loading:n,updatePreferences:s,runSpeedTest:a,refreshStatus:o}=by(),[i,c]=l.useState(!1),[u,d]=l.useState(null),f=async y=>{try{await s({mode:y}),d({type:"success",text:"Quality mode updated successfully"}),setTimeout(()=>d(null),3e3)}catch{d({type:"error",text:"Failed to update quality mode"})}},p=async(y,j)=>{try{await s({[y]:j}),d({type:"success",text:"Preferences updated successfully"}),setTimeout(()=>d(null),3e3)}catch{d({type:"error",text:"Failed to update preferences"})}},g=async()=>{c(!0);try{await a(),d({type:"success",text:"Speed test completed"}),setTimeout(()=>d(null),3e3)}catch{d({type:"error",text:"Speed test failed"})}finally{c(!1)}},m=y=>{switch(y){case"excellent":return e.jsx(Tr,{color:"success"});case"good":return e.jsx(Tr,{color:"primary"});case"fair":return e.jsx(_h,{color:"warning"});case"poor":return e.jsx(yd,{color:"error"});default:return e.jsx(Kr,{})}};return n?e.jsx(h,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsx(Ie,{})}):e.jsxs(h,{children:[e.jsxs(h,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsx(x,{variant:"subtitle1",fontWeight:600,children:"Quick Sync - Adaptive Streaming"}),e.jsx(X,{size:"small",onClick:o,disabled:n,children:e.jsx(qr,{})})]}),u&&e.jsx(pe,{severity:u.type,sx:{mb:2},onClose:()=>d(null),children:u.text}),e.jsxs(yt,{sx:{p:2,mb:2},children:[e.jsx(x,{variant:"body2",gutterBottom:!0,fontWeight:"bold",mb:1.5,children:"Current Status"}),t&&e.jsxs(ee,{container:!0,spacing:2,children:[e.jsxs(ee,{item:!0,xs:12,md:4,children:[e.jsxs(h,{display:"flex",alignItems:"center",mb:1,children:[e.jsx(Ai,{sx:{mr:.5,fontSize:"1.1rem"}}),e.jsx(x,{variant:"caption",fontWeight:"bold",children:"Network Speed"}),e.jsx(h,{ml:"auto",children:m(t.network.status)})]}),e.jsxs(x,{variant:"h6",color:"primary",mb:.75,children:[t.network.speed_mbps.toFixed(2)," Mbps"]}),e.jsx(ue,{label:t.network.status.toUpperCase(),size:"small",color:t.network.status==="excellent"||t.network.status==="good"?"success":t.network.status==="fair"?"warning":"error"})]}),e.jsxs(ee,{item:!0,xs:12,md:4,children:[e.jsxs(h,{display:"flex",alignItems:"center",mb:1,children:[e.jsx(kh,{sx:{mr:.5,fontSize:"1.1rem"}}),e.jsx(x,{variant:"caption",fontWeight:"bold",children:"System Resources"})]}),e.jsxs(h,{mb:1.5,children:[e.jsxs(h,{display:"flex",justifyContent:"space-between",mb:.5,children:[e.jsx(x,{variant:"caption",children:"CPU Usage"}),e.jsxs(x,{variant:"caption",children:[t.system.cpu_percent.toFixed(0),"%"]})]}),e.jsx(rt,{variant:"determinate",value:t.system.cpu_percent,color:t.system.cpu_percent>80?"error":"primary"})]}),e.jsxs(h,{children:[e.jsxs(h,{display:"flex",justifyContent:"space-between",mb:.5,children:[e.jsx(x,{variant:"caption",children:"Memory Usage"}),e.jsxs(x,{variant:"caption",children:[t.system.memory_percent.toFixed(0),"%"]})]}),e.jsx(rt,{variant:"determinate",value:t.system.memory_percent,color:t.system.memory_percent>85?"error":"primary"})]})]}),e.jsxs(ee,{item:!0,xs:12,md:4,children:[e.jsxs(h,{display:"flex",alignItems:"center",mb:1,children:[e.jsx(ro,{sx:{mr:.5,fontSize:"1.1rem"}}),e.jsx(x,{variant:"caption",fontWeight:"bold",children:"Active Quality"})]}),e.jsx(x,{variant:"h6",color:"primary",mb:.75,children:t.quality.level.toUpperCase()}),e.jsxs(x,{variant:"body2",color:"text.secondary",mb:1,children:[t.quality.bitrate," kbps"]}),t.quality.auto_selected&&e.jsx(ue,{label:"Auto-Selected",size:"small",color:"info"})]})]}),e.jsx(h,{mt:3,children:e.jsx(N,{variant:"outlined",startIcon:i?e.jsx(Ie,{size:20}):e.jsx(Ai,{}),onClick:g,disabled:i,fullWidth:!0,children:i?"Testing Connection...":"Run Speed Test"})})]}),e.jsxs(yt,{sx:{p:3,mb:3},children:[e.jsx(x,{variant:"subtitle1",gutterBottom:!0,fontWeight:"bold",children:"Quality Settings"}),e.jsxs(Ct,{fullWidth:!0,sx:{mb:3},children:[e.jsx(Wt,{children:"Quality Mode"}),e.jsxs(Rt,{value:r?.mode||"auto",onChange:y=>f(y.target.value),label:"Quality Mode",children:[e.jsx(we,{value:"auto",children:e.jsxs(h,{children:[e.jsx(x,{children:"Auto (Recommended)"}),e.jsx(x,{variant:"caption",color:"text.secondary",children:"Adapts to your connection and system"})]})}),e.jsx(we,{value:"ultra",children:e.jsxs(h,{children:[e.jsx(x,{children:"Ultra (320 kbps)"}),e.jsx(x,{variant:"caption",color:"text.secondary",children:"Maximum fidelity - requires 5+ Mbps"})]})}),e.jsx(we,{value:"high",children:e.jsxs(h,{children:[e.jsx(x,{children:"High (256 kbps)"}),e.jsx(x,{variant:"caption",color:"text.secondary",children:"Best experience - requires 2+ Mbps"})]})}),e.jsx(we,{value:"medium",children:e.jsxs(h,{children:[e.jsx(x,{children:"Medium (128 kbps)"}),e.jsx(x,{variant:"caption",color:"text.secondary",children:"Balanced - requires 1+ Mbps"})]})}),e.jsx(we,{value:"low",children:e.jsxs(h,{children:[e.jsx(x,{children:"Low (64 kbps)"}),e.jsx(x,{variant:"caption",color:"text.secondary",children:"Saves bandwidth - requires 0.5+ Mbps"})]})})]})]}),e.jsx(We,{control:e.jsx(et,{checked:r?.prefer_quality||!1,onChange:y=>p("prefer_quality",y.target.checked)}),label:e.jsxs(h,{display:"flex",alignItems:"center",children:[e.jsx(x,{children:"Prefer Higher Quality"}),e.jsx(ve,{title:"When system resources allow, automatically upgrade to higher quality",children:e.jsx(Kr,{fontSize:"small",sx:{ml:1,color:"text.secondary"}})})]})}),e.jsx(We,{control:e.jsx(et,{checked:r?.adapt_to_system||!1,onChange:y=>p("adapt_to_system",y.target.checked)}),label:e.jsxs(h,{display:"flex",alignItems:"center",children:[e.jsx(x,{children:"Adapt to System Load"}),e.jsx(ve,{title:"Automatically adjust quality based on CPU and memory usage",children:e.jsx(Kr,{fontSize:"small",sx:{ml:1,color:"text.secondary"}})})]})}),e.jsx(We,{control:e.jsx(et,{checked:r?.auto_download_quality||!1,onChange:y=>p("auto_download_quality",y.target.checked)}),label:e.jsxs(h,{display:"flex",alignItems:"center",children:[e.jsx(x,{children:"Apply to Downloads"}),e.jsx(ve,{title:"Use Quick Sync quality settings when downloading audio",children:e.jsx(Kr,{fontSize:"small",sx:{ml:1,color:"text.secondary"}})})]})})]}),t&&e.jsxs(yt,{sx:{p:3},children:[e.jsx(x,{variant:"subtitle1",gutterBottom:!0,fontWeight:"bold",children:"Buffer Settings"}),e.jsxs(ee,{container:!0,spacing:2,children:[e.jsxs(ee,{item:!0,xs:6,children:[e.jsx(x,{variant:"body2",color:"text.secondary",children:"Buffer Size"}),e.jsxs(x,{variant:"h6",children:[t.buffer.buffer_size,"s"]})]}),e.jsxs(ee,{item:!0,xs:6,children:[e.jsx(x,{variant:"body2",color:"text.secondary",children:"Max Buffer"}),e.jsxs(x,{variant:"h6",children:[t.buffer.max_buffer_size,"s"]})]}),e.jsxs(ee,{item:!0,xs:6,children:[e.jsx(x,{variant:"body2",color:"text.secondary",children:"Preload"}),e.jsx(x,{variant:"h6",children:t.buffer.preload})]}),e.jsxs(ee,{item:!0,xs:6,children:[e.jsx(x,{variant:"body2",color:"text.secondary",children:"Rebuffer Threshold"}),e.jsxs(x,{variant:"h6",children:[t.buffer.rebuffer_threshold.toFixed(1),"s"]})]})]})]})]})},wy=()=>{const{isOnline:t,canInstall:r,isInstalled:n,isUpdateAvailable:s,cacheSize:a,showInstallPrompt:o,updateApp:i,clearCache:c,requestNotifications:u}=Sa(),[d,f]=ze.useState("Notification"in window&&Notification.permission==="granted"),[p,g]=ze.useState(!1),[m,y]=ze.useState(null),j=async()=>{const A=await o();y(A?{message:"App installed successfully!",severity:"success"}:{message:"Installation cancelled or not available",severity:"info"})},C=async()=>{await i()},w=async()=>{g(!0);try{const A=await c();y(A?{message:"Cache cleared successfully",severity:"success"}:{message:"Failed to clear cache",severity:"error"})}catch{y({message:"Error clearing cache",severity:"error"})}finally{g(!1)}},b=async()=>{if(!d){const A=await u();f(A==="granted"),y(A==="granted"?{message:"Notifications enabled",severity:"success"}:{message:"Notifications permission denied",severity:"error"})}},v=A=>{if(A===0)return"0 Bytes";const E=1024,P=["Bytes","KB","MB","GB"],k=Math.floor(Math.log(A)/Math.log(E));return Math.round(A/Math.pow(E,k)*100)/100+" "+P[k]},S=a?Math.round(a.usage/a.quota*100):0;return e.jsx(_e,{children:e.jsxs(Pe,{children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1,mb:1.5},children:[e.jsx(jr,{color:"primary",sx:{fontSize:"1.25rem"}}),e.jsx(x,{variant:"subtitle1",fontWeight:600,children:"Progressive Web App (PWA)"})]}),m&&e.jsx(pe,{severity:m.severity,onClose:()=>y(null),sx:{mb:1.5},children:m.message}),e.jsxs(h,{sx:{mb:2},children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:.75},children:[e.jsx(x,{variant:"subtitle2",color:"textSecondary",children:"Connection Status"}),e.jsx(ue,{icon:t?e.jsx(ra,{}):e.jsx(Sr,{}),label:t?"Online":"Offline",color:t?"success":"warning",size:"small"})]}),!t&&e.jsx(pe,{severity:"info",icon:e.jsx(Kr,{}),sx:{mt:1},children:"You're working offline. Cached content is still available."})]}),e.jsx(Ee,{sx:{my:2}}),e.jsxs(h,{sx:{mb:2},children:[e.jsx(x,{variant:"caption",color:"textSecondary",gutterBottom:!0,display:"block",fontWeight:600,children:"Installation"}),n?e.jsx(pe,{severity:"success",icon:e.jsx(Wa,{}),children:"App is installed and ready to use"}):r?e.jsxs(h,{children:[e.jsx(x,{variant:"caption",color:"textSecondary",sx:{mb:.75,display:"block"},children:"Install SoundWave for:"}),e.jsxs(Qe,{dense:!0,sx:{py:0},children:[e.jsx(Le,{sx:{py:.25},children:e.jsx(ke,{primary:e.jsx(x,{variant:"caption",children:" Faster startup and better performance"})})}),e.jsx(Le,{sx:{py:.25},children:e.jsx(ke,{primary:e.jsx(x,{variant:"caption",children:" Offline access to cached content"})})}),e.jsx(Le,{sx:{py:.25},children:e.jsx(ke,{primary:e.jsx(x,{variant:"caption",children:" Native app-like experience"})})}),e.jsx(Le,{sx:{py:.25},children:e.jsx(ke,{primary:e.jsx(x,{variant:"caption",children:" Desktop shortcut access"})})})]}),e.jsx(N,{variant:"contained",size:"small",startIcon:e.jsx(Wa,{}),onClick:j,fullWidth:!0,children:"Install App"})]}):e.jsxs(h,{children:[/iPad|iPhone|iPod/.test(navigator.userAgent)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1?e.jsxs(pe,{severity:"info",sx:{mb:2},icon:e.jsx(Wa,{}),children:[e.jsx(x,{variant:"body2",sx:{mb:1},children:e.jsx("strong",{children:"Install on iPhone/iPad:"})}),e.jsxs(x,{variant:"caption",component:"div",sx:{mb:.5},children:["1 Tap the ",e.jsx("strong",{children:"Share"})," button (box with arrow) at the bottom of Safari"]}),e.jsxs(x,{variant:"caption",component:"div",sx:{mb:.5},children:["2 Scroll down and tap ",e.jsx("strong",{children:'"Add to Home Screen"'})]}),e.jsxs(x,{variant:"caption",component:"div",sx:{mb:.5},children:["3 Tap ",e.jsx("strong",{children:'"Add"'})," in the top right corner"]}),e.jsx(x,{variant:"caption",component:"div",sx:{mt:1,fontStyle:"italic"},children:" On iOS 26+, any website can be installed as a full PWA!"})]}):e.jsxs(pe,{severity:"info",sx:{mb:2},children:[e.jsx(x,{variant:"body2",sx:{mb:1},children:e.jsx("strong",{children:"To install SoundWave:"})}),e.jsxs(x,{variant:"caption",component:"div",children:[e.jsx("strong",{children:"Chrome/Edge:"}),' Click the install icon () in the address bar, or Menu  "Install SoundWave"']}),e.jsxs(x,{variant:"caption",component:"div",children:[e.jsx("strong",{children:"Safari (Mac):"}),' File  "Add to Dock..."']}),e.jsxs(x,{variant:"caption",component:"div",children:[e.jsx("strong",{children:"Firefox:"}),' Menu  "Install" (if available)']})]}),e.jsx(x,{variant:"caption",color:"textSecondary",display:"block",sx:{mb:1},children:"Requirements: HTTPS connection, valid manifest, service worker"}),e.jsxs(x,{variant:"caption",color:"textSecondary",display:"block",children:["Status: ",window.location.protocol==="https:"||window.location.hostname==="localhost"?" Secure context":" Not HTTPS"," |","serviceWorker"in navigator?"  SW supported":"  No SW support"]})]})]}),e.jsx(Ee,{sx:{my:2}}),s&&e.jsxs(e.Fragment,{children:[e.jsx(h,{sx:{mb:3},children:e.jsx(pe,{severity:"info",icon:e.jsx(bd,{}),action:e.jsx(N,{color:"inherit",size:"small",onClick:C,children:"Update"}),children:"New version available! Update now to get the latest features."})}),e.jsx(Ee,{sx:{my:2}})]}),e.jsxs(h,{sx:{mb:3},children:[e.jsx(x,{variant:"subtitle2",color:"textSecondary",gutterBottom:!0,children:"Cache Storage"}),a&&e.jsxs(e.Fragment,{children:[e.jsxs(h,{sx:{mb:2},children:[e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsxs(x,{variant:"body2",color:"textSecondary",children:[v(a.usage)," / ",v(a.quota)]}),e.jsxs(x,{variant:"body2",color:"textSecondary",children:[S,"%"]})]}),e.jsx(rt,{variant:"determinate",value:Math.min(S,100),sx:{height:8,borderRadius:1}})]}),e.jsx(x,{variant:"caption",color:"textSecondary",display:"block",sx:{mb:2},children:"Cached data allows offline access to previously viewed content and improves loading times."})]}),e.jsx(N,{variant:"outlined",startIcon:e.jsx(ud,{}),onClick:w,disabled:p,fullWidth:!0,children:p?"Clearing Cache...":"Clear Cache"})]}),e.jsx(Ee,{sx:{my:2}}),e.jsxs(h,{children:[e.jsx(x,{variant:"subtitle2",color:"textSecondary",gutterBottom:!0,children:"Notifications"}),e.jsx(We,{control:e.jsx(et,{checked:d,onChange:b,disabled:d}),label:e.jsxs(h,{children:[e.jsx(x,{variant:"body2",children:"Enable push notifications"}),e.jsx(x,{variant:"caption",color:"textSecondary",children:"Get notified about downloads, updates, and more"})]})})]}),e.jsx(Ee,{sx:{my:2}}),e.jsxs(h,{children:[e.jsx(x,{variant:"subtitle2",color:"textSecondary",gutterBottom:!0,children:"PWA Features"}),e.jsxs(Qe,{dense:!0,children:[e.jsxs(Le,{children:[e.jsx(ke,{primary:"Offline Mode",secondary:"Access cached content without internet"}),e.jsx(Ar,{children:e.jsx(ue,{label:"Active",color:"success",size:"small"})})]}),e.jsxs(Le,{children:[e.jsx(ke,{primary:"Background Sync",secondary:"Sync data when connection is restored"}),e.jsx(Ar,{children:e.jsx(ue,{label:"Active",color:"success",size:"small"})})]}),e.jsxs(Le,{children:[e.jsx(ke,{primary:"Audio Caching",secondary:"Cache audio files for offline playback"}),e.jsx(Ar,{children:e.jsx(ue,{label:"Active",color:"success",size:"small"})})]})]})]})]})})};var hs={},gc;function Sy(){if(gc)return hs;gc=1;var t=ne();Object.defineProperty(hs,"__esModule",{value:!0}),hs.default=void 0;var r=t(ae()),n=se();return hs.default=(0,r.default)((0,n.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 4c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6m0 14c-2.03 0-4.43-.82-6.14-2.88C7.55 15.8 9.68 15 12 15s4.45.8 6.14 2.12C16.43 19.18 14.03 20 12 20"}),"AccountCircle"),hs}var Cy=Sy();const yc=re(Cy);var fs={},bc;function ky(){if(bc)return fs;bc=1;var t=ne();Object.defineProperty(fs,"__esModule",{value:!0}),fs.default=void 0;var r=t(ae()),n=se();return fs.default=(0,r.default)((0,n.jsx)("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2m-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2m3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1z"}),"Lock"),fs}var _y=ky();const Ry=re(_y);function Iy(){const[t,r]=l.useState(null),[n,s]=l.useState(!1),[a,o]=l.useState(""),[i,c]=l.useState(""),[u,d]=l.useState(""),[f,p]=l.useState(""),[g,m]=l.useState(""),[y,j]=l.useState(""),[C,w]=l.useState(""),[b,v]=l.useState(""),[S,A]=l.useState("");l.useEffect(()=>{localStorage.getItem("token")&&E()},[]);const E=async()=>{const R=localStorage.getItem("token");if(R)try{const z=await Ne.get("/api/user/account/",{headers:{Authorization:`Token ${R}`}});r(z.data),d(z.data.username),p(z.data.first_name||""),m(z.data.last_name||""),j(z.data.email)}catch{o("Failed to load user data")}},P=async()=>{const R=u!==t?.username,z=f!==(t?.first_name||""),B=g!==(t?.last_name||""),F=y!==t?.email;if(!R&&!z&&!B&&!F){o("No changes detected");return}if((R||F)&&!C){o("Current password required to change username or email");return}if(R){if(u.length<3){o("Username must be at least 3 characters long");return}if(!/^[a-zA-Z0-9_]+$/.test(u)){o("Username can only contain letters, numbers, and underscores");return}}s(!0),o(""),c("");try{const W={};R&&(W.username=u),z&&(W.first_name=f),B&&(W.last_name=g),F&&(W.email=y),(R||F)&&C.trim()&&(W.current_password=C);const H=await Ne.patch("/api/user/profile/",W,{headers:{Authorization:`Token ${localStorage.getItem("token")}`,"Content-Type":"application/json"}});H.data.user&&(r(H.data.user),d(H.data.user.username),p(H.data.user.first_name||""),m(H.data.user.last_name||""),j(H.data.user.email)),c("Profile updated successfully!"),w(""),setTimeout(()=>c(""),3e3)}catch(W){o(W.response?.data?.error||"Failed to update profile")}finally{s(!1)}},k=async()=>{if(!C||!b||!S){o("Please fill in all password fields");return}if(b!==S){o("New passwords do not match");return}if(b.length<8){o("Password must be at least 8 characters long");return}s(!0),o(""),c("");try{await Ne.post("/api/user/change-password/",{current_password:C,new_password:b},{headers:{Authorization:`Token ${localStorage.getItem("token")}`,"Content-Type":"application/json"}}),c("Password changed successfully!"),w(""),v(""),A(""),setTimeout(()=>c(""),3e3)}catch(R){o(R.response?.data?.error||"Failed to change password")}finally{s(!1)}};return e.jsxs(yt,{sx:{p:3},children:[e.jsxs(h,{display:"flex",alignItems:"center",mb:3,children:[e.jsx(yc,{sx:{mr:1,fontSize:32,color:"primary.main"}}),e.jsx(x,{variant:"h6",children:"Profile Information"})]}),a&&e.jsx(pe,{severity:"error",sx:{mb:2},onClose:()=>o(""),children:a}),i&&e.jsx(pe,{severity:"success",sx:{mb:2},onClose:()=>c(""),children:i}),t&&e.jsxs(e.Fragment,{children:[e.jsxs(ee,{container:!0,spacing:2,sx:{mb:3},children:[e.jsxs(ee,{item:!0,xs:12,sm:6,children:[e.jsx(x,{variant:"subtitle2",color:"text.secondary",children:"Username"}),e.jsx(x,{variant:"body1",fontWeight:600,children:t.username})]}),e.jsxs(ee,{item:!0,xs:12,sm:6,children:[e.jsx(x,{variant:"subtitle2",color:"text.secondary",children:"Member Since"}),e.jsx(x,{variant:"body1",children:new Date(t.date_joined).toLocaleDateString()})]}),e.jsxs(ee,{item:!0,xs:12,sm:6,children:[e.jsx(x,{variant:"subtitle2",color:"text.secondary",children:"Storage"}),e.jsxs(x,{variant:"body1",children:[(t.storage_used_gb||0).toFixed(2)," / ",t.storage_quota_gb||0," GB"]})]}),e.jsxs(ee,{item:!0,xs:12,sm:6,children:[e.jsx(x,{variant:"subtitle2",color:"text.secondary",children:"Limits"}),e.jsxs(x,{variant:"body1",children:[t.max_channels||0," channels, ",t.max_playlists||0," playlists"]})]})]}),e.jsx(Ee,{sx:{my:3}}),e.jsxs(h,{mb:3,children:[e.jsxs(h,{display:"flex",alignItems:"center",mb:2,children:[e.jsx(yc,{sx:{mr:1,color:"primary.main"}}),e.jsx(x,{variant:"h6",children:"Update Profile"})]}),e.jsxs(ee,{container:!0,spacing:2,children:[e.jsx(ee,{item:!0,xs:12,children:e.jsx(Ce,{label:"Username (Login ID)",value:u,onChange:R=>d(R.target.value),fullWidth:!0,helperText:"Used for login - requires password to change"})}),e.jsx(ee,{item:!0,xs:12,sm:6,children:e.jsx(Ce,{label:"First Name",value:f,onChange:R=>p(R.target.value),fullWidth:!0})}),e.jsx(ee,{item:!0,xs:12,sm:6,children:e.jsx(Ce,{label:"Last Name",value:g,onChange:R=>m(R.target.value),fullWidth:!0})}),e.jsx(ee,{item:!0,xs:12,children:e.jsx(Ce,{label:"Email Address",type:"email",value:y,onChange:R=>j(R.target.value),fullWidth:!0})}),e.jsx(ee,{item:!0,xs:12,children:e.jsx(Ce,{label:"Current Password",type:"password",value:C,onChange:R=>w(R.target.value),fullWidth:!0,helperText:"Required for username or email changes"})}),e.jsx(ee,{item:!0,xs:12,children:e.jsx(N,{variant:"contained",onClick:P,disabled:n,fullWidth:!0,children:"Update Profile"})})]})]}),e.jsx(Ee,{sx:{my:3}}),e.jsxs(h,{children:[e.jsxs(h,{display:"flex",alignItems:"center",mb:2,children:[e.jsx(Ry,{sx:{mr:1,color:"primary.main"}}),e.jsx(x,{variant:"h6",children:"Change Password"})]}),e.jsxs(ee,{container:!0,spacing:2,children:[e.jsx(ee,{item:!0,xs:12,children:e.jsx(Ce,{label:"Current Password",type:"password",value:C,onChange:R=>w(R.target.value),fullWidth:!0})}),e.jsx(ee,{item:!0,xs:12,children:e.jsx(Ce,{label:"New Password",type:"password",value:b,onChange:R=>v(R.target.value),fullWidth:!0,helperText:"Minimum 8 characters"})}),e.jsx(ee,{item:!0,xs:12,children:e.jsx(Ce,{label:"Confirm New Password",type:"password",value:S,onChange:R=>A(R.target.value),fullWidth:!0})}),e.jsx(ee,{item:!0,xs:12,children:e.jsx(N,{variant:"contained",onClick:k,disabled:n,fullWidth:!0,children:"Change Password"})})]})]})]})]})}function Ay(){const t=Dt(),{themeMode:r,setThemeMode:n}=Q1(),{settings:s,updateSetting:a}=Cr(),[o,i]=l.useState({enabled:!1,backup_codes_count:0}),[c,u]=l.useState(!1),[d,f]=l.useState(!1),[p,g]=l.useState(null),[m,y]=l.useState(""),[j,C]=l.useState(""),[w,b]=l.useState(""),[v,S]=l.useState(""),[A,E]=l.useState(!1),[P,k]=l.useState(!1),[R,z]=l.useState(null),[B,F]=l.useState(!1);l.useEffect(()=>{_(),I(),W()},[]);const W=async()=>{try{const T=await dt.getCacheStats();z(T)}catch(T){console.error("Failed to load cache stats:",T)}},H=async()=>{F(!0);try{await dt.clearCache(),await W(),S("Audio cache cleared successfully")}catch{b("Failed to clear cache")}finally{F(!1)}},I=async()=>{try{const T=await Ne.get("/api/user/account/",{headers:{Authorization:`Token ${localStorage.getItem("token")}`}});k(T.data.is_admin||T.data.is_superuser)}catch(T){console.error("Failed to check admin status:",T)}},_=async()=>{try{const T=await _r.twoFactorStatus();i(T.data)}catch(T){console.error("Failed to load 2FA status:",T)}},O=async()=>{try{b("");const T=await _r.twoFactorSetup();g(T.data),u(!0),E(!1)}catch{b("Failed to setup 2FA")}},D=async()=>{try{b(""),await _r.twoFactorVerify({code:m}),S("Two-factor authentication enabled successfully!"),u(!1),y(""),_(),setTimeout(()=>S(""),3e3)}catch{b("Invalid verification code")}},Q=async()=>{try{b(""),await _r.twoFactorDisable({code:j}),S("Two-factor authentication disabled"),f(!1),C(""),_(),setTimeout(()=>S(""),3e3)}catch{b("Invalid verification code")}},J=async()=>{try{b("");const T=await _r.twoFactorRegenerateCodes();g({...p,backup_codes:T.data.backup_codes}),E(!0),S("Backup codes regenerated successfully!"),_(),setTimeout(()=>S(""),3e3)}catch{b("Failed to regenerate backup codes")}},M=async()=>{try{const T=await _r.twoFactorDownloadCodes(),te=window.URL.createObjectURL(new Blob([T.data])),$=document.createElement("a");$.href=te;const U=T.headers["content-disposition"];let K="backup_codes.pdf";if(U){const ce=U.match(/filename="?(.+)"?/);ce&&(K=ce[1])}$.setAttribute("download",K),document.body.appendChild($),$.click(),$.remove(),window.URL.revokeObjectURL(te)}catch{b("Failed to download backup codes")}};return e.jsxs(h,{children:[e.jsx(x,{variant:"h4",sx:{mb:2,fontWeight:600},children:"Settings"}),v&&e.jsx(pe,{severity:"success",sx:{mb:1.5,maxWidth:600},children:v}),w&&e.jsx(pe,{severity:"error",sx:{mb:1.5,maxWidth:600},children:w}),e.jsx(_e,{sx:{maxWidth:600,bgcolor:"background.paper",mb:1.5},children:e.jsxs(Pe,{children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",mb:1.5},children:[e.jsx(W0,{sx:{mr:1,color:"primary.main",fontSize:"1.25rem"}}),e.jsx(x,{variant:"subtitle1",fontWeight:600,children:"Appearance"})]}),e.jsx(x,{variant:"caption",color:"text.secondary",sx:{mb:2,display:"block"},children:"Customize the look and feel of SoundWave with different color themes."}),e.jsxs(Ct,{fullWidth:!0,sx:{mb:1.5},size:"small",children:[e.jsx(Wt,{children:"Theme"}),e.jsx(Rt,{value:r,label:"Theme",onChange:T=>n(T.target.value),children:Object.entries(xc).map(([T,te])=>e.jsx(we,{value:T,children:te},T))})]}),e.jsx(ee,{container:!0,spacing:1.5,children:Object.entries(xc).map(([T,te])=>e.jsx(ee,{item:!0,xs:6,sm:3,children:e.jsx(xy,{name:te,mode:T,isSelected:r===T,onClick:()=>n(T)})},T))})]})}),e.jsx(_e,{sx:{maxWidth:600,bgcolor:"background.paper",mb:1.5},children:e.jsxs(Pe,{children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",mb:1.5},children:[e.jsx(ji,{sx:{mr:1,color:"primary.main",fontSize:"1.25rem"}}),e.jsx(x,{variant:"subtitle1",fontWeight:600,children:"Audio Visualizer"})]}),e.jsx(x,{variant:"caption",color:"text.secondary",sx:{mb:2,display:"block"},children:"Choose a visualization style for the audio player. Different themes offer unique animations and color schemes."}),e.jsx(We,{control:e.jsx(et,{size:"small",checked:s.visualizer_enabled,onChange:T=>a("visualizer_enabled",T.target.checked)}),label:e.jsx(x,{variant:"body2",children:"Enable visualizer"}),sx:{mb:2,display:"block"}}),s.visualizer_enabled&&e.jsxs(e.Fragment,{children:[e.jsx(We,{control:e.jsx(et,{size:"small",checked:s.visualizer_glow,onChange:T=>a("visualizer_glow",T.target.checked)}),label:e.jsx(x,{variant:"body2",children:"Enable glow effect"}),sx:{mb:2,display:"block"}}),e.jsx(x,{variant:"body2",fontWeight:500,sx:{mb:1.5},children:"Visualizer Theme"}),e.jsx(ee,{container:!0,spacing:1.5,children:Ir.map(T=>e.jsx(ee,{item:!0,xs:4,sm:3,children:e.jsx(yy,{theme:T,isSelected:s.visualizer_theme===T.id,onClick:()=>a("visualizer_theme",T.id)})},T.id))})]})]})}),e.jsx(wy,{}),e.jsx(_e,{sx:{maxWidth:600,bgcolor:"background.paper",mb:1.5},children:e.jsxs(Pe,{children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",mb:1.5},children:[e.jsx(rc,{sx:{mr:1,color:"primary.main",fontSize:"1.25rem"}}),e.jsx(x,{variant:"subtitle1",fontWeight:600,children:"Two-Factor Authentication"})]}),e.jsx(x,{variant:"caption",color:"text.secondary",sx:{mb:1.5,display:"block"},children:"Add an extra layer of security to your account. You'll need to enter a code from your authenticator app when you sign in."}),e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1.5,mb:1.5},children:[e.jsx(ue,{label:o.enabled?"Enabled":"Disabled",color:o.enabled?"success":"default",size:"small"}),o.enabled&&e.jsxs(x,{variant:"caption",color:"text.secondary",children:[o.backup_codes_count," backup codes remaining"]})]}),e.jsx(Vo,{spacing:1.5,children:o.enabled?e.jsxs(e.Fragment,{children:[e.jsx(N,{variant:"outlined",color:"error",onClick:()=>f(!0),children:"Disable Two-Factor Authentication"}),e.jsx(Ee,{}),e.jsxs(h,{children:[e.jsx(x,{variant:"subtitle2",sx:{mb:1},children:"Backup Codes"}),e.jsxs(Vo,{direction:"row",spacing:1,children:[e.jsx(N,{variant:"outlined",size:"small",startIcon:e.jsx(Or,{}),onClick:M,children:"Download Backup Codes"}),e.jsx(N,{variant:"outlined",size:"small",startIcon:e.jsx(Zr,{}),onClick:J,children:"Regenerate Codes"})]})]})]}):e.jsx(N,{variant:"contained",size:"small",onClick:O,startIcon:e.jsx(rc,{}),children:"Enable Two-Factor Authentication"})})]})}),e.jsx(_e,{sx:{maxWidth:600,bgcolor:"background.paper",mb:1.5},children:e.jsxs(Pe,{children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",mb:1.5},children:[e.jsx(ac,{sx:{mr:1,color:"primary.main",fontSize:"1.25rem"}}),e.jsx(x,{variant:"subtitle1",fontWeight:600,children:"Playback"})]}),e.jsx(We,{control:e.jsx(et,{defaultChecked:!0,size:"small"}),label:e.jsx(x,{variant:"body2",children:"Autoplay"}),sx:{mb:2,display:"block"}}),e.jsxs(h,{sx:{mb:3},children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(ho,{sx:{mr:1,color:"text.secondary",fontSize:"1.1rem"}}),e.jsx(x,{variant:"body2",fontWeight:500,children:"Smart Shuffle"})]}),e.jsx(x,{variant:"caption",color:"text.secondary",sx:{mb:1.5,display:"block"},children:"When enabled, shuffle mode will avoid playing recently heard songs, creating a more varied listening experience."}),e.jsx(We,{control:e.jsx(et,{size:"small",checked:s.smart_shuffle_enabled,onChange:T=>a("smart_shuffle_enabled",T.target.checked)}),label:e.jsx(x,{variant:"body2",children:"Enable smart shuffle"}),sx:{mb:1,display:"block"}}),s.smart_shuffle_enabled&&e.jsxs(h,{sx:{pl:2},children:[e.jsxs(x,{variant:"caption",color:"text.secondary",sx:{mb:.5,display:"block"},children:["History size: ",s.smart_shuffle_history_size," tracks"]}),e.jsx(Pr,{value:s.smart_shuffle_history_size,onChange:(T,te)=>a("smart_shuffle_history_size",te),min:5,max:50,step:5,marks:[{value:5,label:"5"},{value:25,label:"25"},{value:50,label:"50"}],size:"small",sx:{maxWidth:300}}),e.jsx(x,{variant:"caption",color:"text.secondary",sx:{display:"block"},children:"Number of recently played songs to avoid when shuffling"})]})]}),e.jsx(Ee,{sx:{my:2}}),e.jsxs(h,{sx:{mb:3},children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(X0,{sx:{mr:1,color:"text.secondary",fontSize:"1.1rem"}}),e.jsx(x,{variant:"body2",fontWeight:500,children:"Seek Duration"})]}),e.jsx(x,{variant:"caption",color:"text.secondary",sx:{mb:1.5,display:"block"},children:"Choose how many seconds to skip forward or backward when using seek controls (media keys, headphones, etc.)."}),e.jsx(Ct,{size:"small",sx:{minWidth:120},children:e.jsxs(Rt,{value:s.seek_duration||3,onChange:T=>a("seek_duration",Number(T.target.value)),children:[e.jsx(we,{value:3,children:"3 seconds"}),e.jsx(we,{value:5,children:"5 seconds"}),e.jsx(we,{value:10,children:"10 seconds"})]})})]}),e.jsx(Ee,{sx:{my:2}}),e.jsxs(h,{sx:{mb:2},children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx($u,{sx:{mr:1,color:"text.secondary",fontSize:"1.1rem"}}),e.jsx(x,{variant:"body2",fontWeight:500,children:"Intelligent Prefetch & Caching"})]}),e.jsx(x,{variant:"caption",color:"text.secondary",sx:{mb:1.5,display:"block"},children:"Automatically download upcoming tracks for instant playback. Cached tracks play without network delay."}),e.jsx(We,{control:e.jsx(et,{size:"small",checked:s.prefetch_enabled!==!1,onChange:T=>a("prefetch_enabled",T.target.checked)}),label:e.jsx(x,{variant:"body2",children:"Enable intelligent prefetching"}),sx:{mb:1,display:"block"}}),e.jsxs(h,{sx:{display:"flex",alignItems:"center",mb:1,mt:2},children:[e.jsx(vi,{sx:{mr:1,color:"text.secondary",fontSize:"1.1rem"}}),e.jsx(x,{variant:"body2",fontWeight:500,children:"Cross-Device Playback Sync"})]}),e.jsx(x,{variant:"caption",color:"text.secondary",sx:{mb:1.5,display:"block"},children:"Sync playback position across devices. Disable to reduce battery and data usage on mobile."}),e.jsx(We,{control:e.jsx(et,{size:"small",checked:s.playback_sync_enabled!==!1,onChange:T=>a("playback_sync_enabled",T.target.checked)}),label:e.jsx(x,{variant:"body2",children:"Enable playback sync"}),sx:{mb:1,display:"block"}}),R&&e.jsxs(h,{sx:{mt:2,p:2,bgcolor:"rgba(255,255,255,0.03)",borderRadius:2,border:"1px solid",borderColor:"divider"},children:[e.jsx(x,{variant:"caption",color:"text.secondary",sx:{display:"block",mb:1},children:"Cache Statistics"}),e.jsxs(h,{sx:{display:"flex",gap:3,mb:1.5},children:[e.jsxs(h,{children:[e.jsx(x,{variant:"h6",fontWeight:600,color:"primary.main",children:R.count}),e.jsx(x,{variant:"caption",color:"text.secondary",children:"Cached tracks"})]}),e.jsxs(h,{children:[e.jsxs(x,{variant:"h6",fontWeight:600,color:"primary.main",children:[(R.totalSize/1024/1024).toFixed(1)," MB"]}),e.jsx(x,{variant:"caption",color:"text.secondary",children:"Cache size"})]}),e.jsxs(h,{children:[e.jsxs(x,{variant:"h6",fontWeight:600,color:"text.secondary",children:[(b0.maxCacheSize/1024/1024).toFixed(0)," MB"]}),e.jsx(x,{variant:"caption",color:"text.secondary",children:"Max size"})]})]}),e.jsx(N,{variant:"outlined",size:"small",color:"error",startIcon:e.jsx(ry,{}),onClick:H,disabled:B||R.count===0,sx:{mt:1},children:B?"Clearing...":"Clear Cache"})]})]}),e.jsx(Ee,{sx:{my:2}}),e.jsx(We,{control:e.jsx(et,{defaultChecked:!0,size:"small"}),label:e.jsx(x,{variant:"body2",children:"Normalize audio"}),sx:{display:"block"}})]})}),e.jsx(_e,{sx:{maxWidth:600,bgcolor:"background.paper",mb:1.5},children:e.jsxs(Pe,{children:[e.jsx(x,{variant:"subtitle1",fontWeight:600,sx:{mb:1.5},children:"Download Quality"}),e.jsx(We,{control:e.jsx(et,{defaultChecked:!0,size:"small"}),label:e.jsx(x,{variant:"body2",children:"Download in best quality"}),sx:{display:"block"}})]})}),e.jsx(_e,{sx:{maxWidth:600,bgcolor:"background.paper"},children:e.jsxs(Pe,{children:[e.jsx(x,{variant:"subtitle1",fontWeight:600,sx:{mb:1.5},children:"Lyrics"}),e.jsx(x,{variant:"caption",color:"text.secondary",sx:{mb:1.5,display:"block"},children:"Automatically fetch and cache synchronized lyrics for your audio files using LRCLIB API."}),e.jsx(We,{control:e.jsx(et,{defaultChecked:!0}),label:"Auto-fetch lyrics for new downloads",sx:{mb:2,display:"block"}}),e.jsx(We,{control:e.jsx(et,{defaultChecked:!0}),label:"Show synchronized lyrics in player",sx:{display:"block"}})]})}),e.jsxs(Ke,{open:c,onClose:()=>u(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(tt,{children:"Enable Two-Factor Authentication"}),e.jsx(Xe,{children:p&&e.jsx(h,{children:A?e.jsxs(e.Fragment,{children:[e.jsx(pe,{severity:"warning",sx:{mb:2},children:"Save these backup codes in a safe place. Each code can only be used once."}),e.jsx(h,{sx:{bgcolor:"background.default",p:2,borderRadius:1,mb:2},children:p.backup_codes.map((T,te)=>e.jsxs(x,{sx:{fontFamily:"monospace",mb:.5},children:[te+1,". ",T]},te))}),e.jsx(N,{fullWidth:!0,variant:"outlined",startIcon:e.jsx(Or,{}),onClick:()=>{const T=new Blob([p.backup_codes.join(`
`)],{type:"text/plain"}),te=URL.createObjectURL(T),$=document.createElement("a");$.href=te,$.download="soundwave-backup-codes.txt",$.click()},sx:{mb:2},children:"Download Backup Codes"}),e.jsx(N,{fullWidth:!0,variant:"text",onClick:()=>E(!1),children:"Back to Setup"})]}):e.jsxs(e.Fragment,{children:[e.jsx(x,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Scan this QR code with your authenticator app (Google Authenticator, Authy, etc.)"}),e.jsx(h,{sx:{display:"flex",justifyContent:"center",mb:2},children:e.jsx("img",{src:p.qr_code,alt:"QR Code",style:{width:200,height:200}})}),e.jsx(x,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"Or enter this code manually:"}),e.jsx(Ce,{fullWidth:!0,value:p.secret,InputProps:{readOnly:!0},sx:{mb:2}}),e.jsx(x,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"Enter the 6-digit code from your app to verify:"}),e.jsx(Ce,{fullWidth:!0,placeholder:"000000",value:m,onChange:T=>y(T.target.value),inputProps:{maxLength:6}}),w&&e.jsx(pe,{severity:"error",sx:{mt:2},children:w}),e.jsx(N,{fullWidth:!0,variant:"text",onClick:()=>E(!0),sx:{mt:2},children:"View Backup Codes"})]})})}),e.jsxs(nt,{children:[e.jsx(N,{onClick:()=>u(!1),children:"Cancel"}),!A&&e.jsx(N,{onClick:D,variant:"contained",disabled:m.length!==6,children:"Verify and Enable"})]})]}),e.jsxs(Ke,{open:d,onClose:()=>f(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(tt,{children:"Disable Two-Factor Authentication"}),e.jsxs(Xe,{children:[e.jsx(pe,{severity:"warning",sx:{mb:2},children:"Disabling two-factor authentication will make your account less secure."}),e.jsx(x,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Enter a verification code from your authenticator app or use a backup code:"}),e.jsx(Ce,{fullWidth:!0,placeholder:"000000",value:j,onChange:T=>C(T.target.value),inputProps:{maxLength:6}}),w&&e.jsx(pe,{severity:"error",sx:{mt:2},children:w})]}),e.jsxs(nt,{children:[e.jsx(N,{onClick:()=>f(!1),children:"Cancel"}),e.jsx(N,{onClick:Q,variant:"contained",color:"error",disabled:j.length!==6,children:"Disable 2FA"})]})]}),e.jsx(_e,{sx:{maxWidth:600,bgcolor:"background.paper",mb:2},children:e.jsxs(Rh,{defaultExpanded:!0,children:[e.jsx(Ih,{expandIcon:e.jsx(U0,{}),children:e.jsxs(h,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(ac,{sx:{mr:1,color:"primary.main"}}),e.jsx(x,{variant:"h6",children:"Quick Sync - Adaptive Streaming"})]})}),e.jsx(Ah,{children:e.jsx(jy,{})})]})}),e.jsx(Iy,{}),P&&e.jsx(_e,{sx:{maxWidth:600,bgcolor:"background.paper",mb:2},children:e.jsxs(Pe,{children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(lc,{sx:{mr:1,color:"primary.main"}}),e.jsx(x,{variant:"h6",children:"User Management"})]}),e.jsx(x,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Manage all users in the system. Create, edit, or delete user accounts and monitor system statistics."}),e.jsx(N,{variant:"contained",startIcon:e.jsx(lc,{}),onClick:()=>t("/admin/users"),fullWidth:!0,sx:{minHeight:{xs:"44px",sm:"48px"}},children:"Open User Management"})]})})]})}const Py="SoundWaveLocalAudio",Bt="audioFiles",Dy=1;class My{db=null;async init(){return new Promise((r,n)=>{const s=indexedDB.open(Py,Dy);s.onerror=()=>n(s.error),s.onsuccess=()=>{this.db=s.result,r()},s.onupgradeneeded=a=>{const o=a.target.result;if(!o.objectStoreNames.contains(Bt)){const i=o.createObjectStore(Bt,{keyPath:"id"});i.createIndex("title","title",{unique:!1}),i.createIndex("artist","artist",{unique:!1}),i.createIndex("album","album",{unique:!1}),i.createIndex("addedDate","addedDate",{unique:!1})}}})}async addFiles(r){this.db||await this.init();const n=this.db.transaction([Bt],"readwrite"),s=n.objectStore(Bt);for(const a of r)s.put(a);return new Promise((a,o)=>{n.oncomplete=()=>a(),n.onerror=()=>o(n.error)})}async getAll(){this.db||await this.init();const s=this.db.transaction([Bt],"readonly").objectStore(Bt).getAll();return new Promise((a,o)=>{s.onsuccess=()=>a(s.result),s.onerror=()=>o(s.error)})}async getById(r){this.db||await this.init();const a=this.db.transaction([Bt],"readonly").objectStore(Bt).get(r);return new Promise((o,i)=>{a.onsuccess=()=>o(a.result),a.onerror=()=>i(a.error)})}async delete(r){this.db||await this.init();const n=this.db.transaction([Bt],"readwrite");return n.objectStore(Bt).delete(r),new Promise((a,o)=>{n.oncomplete=()=>a(),n.onerror=()=>o(n.error)})}async updatePlayCount(r){const n=await this.getById(r);n&&(n.playCount=(n.playCount||0)+1,n.lastPlayed=new Date,await this.addFiles([n]))}async clear(){this.db||await this.init();const r=this.db.transaction([Bt],"readwrite");return r.objectStore(Bt).clear(),new Promise((s,a)=>{r.oncomplete=()=>s(),r.onerror=()=>a(r.error)})}}const Ur=new My;async function Ey(t){return new Promise(r=>{typeof window.jsmediatags<"u"?window.jsmediatags.read(t,{onSuccess:n=>{const s=n.tags,a={title:s.title||t.name.replace(/\.[^/.]+$/,""),artist:s.artist||"Unknown Artist",album:s.album||"",year:s.year?parseInt(s.year):null,genre:s.genre||""};if(s.picture){const{data:o,format:i}=s.picture,c=btoa(o.reduce((u,d)=>u+String.fromCharCode(d),""));a.coverArt=`data:${i};base64,${c}`}r(a)},onError:()=>{r({title:t.name.replace(/\.[^/.]+$/,""),artist:"Unknown Artist",album:"",year:null,genre:""})}}):r({title:t.name.replace(/\.[^/.]+$/,""),artist:"Unknown Artist",album:"",year:null,genre:""})})}async function Ty(t){return new Promise(r=>{const n=new Audio,s=URL.createObjectURL(t);n.addEventListener("loadedmetadata",()=>{r(Math.round(n.duration)),URL.revokeObjectURL(s)}),n.addEventListener("error",()=>{r(0),URL.revokeObjectURL(s)}),n.src=s})}function zy({setCurrentAudio:t}){const[r,n]=l.useState([]),[s,a]=l.useState(!1),[o,i]=l.useState(null);l.useEffect(()=>{c()},[]);const c=async()=>{try{const j=await Ur.getAll();n(j)}catch(j){console.error("Error loading files:",j)}},u=async j=>{const C=[];for(const w of j)try{const b=await Ey(w),v=await Ty(w),S={id:`${Date.now()}-${Math.random()}`,title:b.title||w.name,artist:b.artist||"Unknown Artist",album:b.album||"",year:b.year||null,genre:b.genre||"",duration:v,file:w,fileName:w.name,fileSize:w.size,mimeType:w.type,coverArt:b.coverArt,addedDate:new Date,playCount:0};C.push(S)}catch(b){console.error(`Error processing ${w.name}:`,b)}return C},d=async()=>{try{const j=document.createElement("input");j.type="file",j.multiple=!0,j.accept="audio/*",j.onchange=async C=>{const w=C.target,b=Array.from(w.files||[]);if(b.length===0)return;a(!0),i({message:`Processing ${b.length} files...`,severity:"info"});const v=await u(b);await Ur.addFiles(v),await c(),a(!1),i({message:`Added ${v.length} files successfully!`,severity:"success"})},j.click()}catch(j){console.error("Error selecting files:",j),i({message:"Failed to select files",severity:"error"}),a(!1)}},f=async()=>{try{if(!("showDirectoryPicker"in window)){i({message:"Folder selection not supported in this browser. Use Chrome, Edge, or Opera.",severity:"error"});return}if(!window.isSecureContext){i({message:'Folder selection requires HTTPS or localhost. For local network access, use "Select Files" instead or access via HTTPS.',severity:"info"});return}const C=await window.showDirectoryPicker({mode:"read"});a(!0),i({message:"Scanning folder and subfolders...",severity:"info"});const w=[],b=[".mp3",".m4a",".flac",".wav",".ogg",".opus",".aac",".wma"];async function v(A,E=""){for await(const P of A.values())if(P.kind==="file"){const k=await P.getFile(),R=k.name.toLowerCase().substring(k.name.lastIndexOf("."));b.includes(R)&&w.push(k)}else P.kind==="directory"&&await v(P,`${E}/${P.name}`)}if(await v(C),w.length===0){a(!1),i({message:"No audio files found in the selected folder",severity:"info"});return}i({message:`Processing ${w.length} audio files...`,severity:"info"});const S=await u(w);await Ur.addFiles(S),await c(),a(!1),i({message:`Successfully added ${S.length} files from folder!`,severity:"success"})}catch(j){console.error("Error selecting folder:",j),j.name==="AbortError"?i({message:"Folder selection cancelled",severity:"info"}):i({message:"Failed to read folder",severity:"error"}),a(!1)}},p=async j=>{try{await Ur.updatePlayCount(j.id);const C=j.file?URL.createObjectURL(j.file):"",w={id:parseInt(j.id.split("-")[0])||Date.now(),youtube_id:void 0,title:j.title,channel_name:j.artist,channel_id:"",description:`${j.album}${j.year?` (${j.year})`:""}`,thumbnail_url:j.coverArt||"/placeholder.jpg",duration:j.duration,file_size:j.fileSize,file_path:C,media_url:C,play_count:j.playCount,published_date:j.addedDate.toISOString(),downloaded_date:j.addedDate.toISOString(),view_count:0,like_count:0,audio_format:j.mimeType.split("/")[1]||"mp3",artist:j.artist,album:j.album,cover_art_url:j.coverArt},b=r.map(v=>{const S=v.file?URL.createObjectURL(v.file):"";return{id:parseInt(v.id.split("-")[0])||Date.now(),youtube_id:void 0,title:v.title,channel_name:v.artist,channel_id:"",description:`${v.album}${v.year?` (${v.year})`:""}`,thumbnail_url:v.coverArt||"/placeholder.jpg",duration:v.duration,file_size:v.fileSize,file_path:S,media_url:S,play_count:v.playCount,published_date:v.addedDate.toISOString(),downloaded_date:v.addedDate.toISOString(),view_count:0,like_count:0,audio_format:v.mimeType.split("/")[1]||"mp3",artist:v.artist,album:v.album,cover_art_url:v.coverArt}});t(w,b)}catch(C){console.error("Error playing file:",C),i({message:"Failed to play file",severity:"error"})}},g=async j=>{if(confirm("Remove this file from your library?"))try{await Ur.delete(j),await c(),i({message:"File removed",severity:"success"})}catch(C){console.error("Error deleting file:",C),i({message:"Failed to remove file",severity:"error"})}},m=async()=>{if(confirm("Remove ALL files from your library? This cannot be undone."))try{await Ur.clear(),await c(),i({message:"All files removed",severity:"success"})}catch(j){console.error("Error clearing library:",j),i({message:"Failed to clear library",severity:"error"})}},y=j=>{const C=Math.floor(j/60),w=j%60;return`${C}:${w.toString().padStart(2,"0")}`};return e.jsxs(h,{children:[e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,px:.5,flexWrap:"wrap",gap:2},children:[e.jsx(x,{variant:"h6",sx:{fontWeight:700,letterSpacing:"-0.02em"},children:"My Local Files"}),e.jsxs(h,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[e.jsx(N,{variant:"outlined",size:"small",startIcon:e.jsx(qr,{}),onClick:c,sx:{borderRadius:1,textTransform:"none",minWidth:"auto",px:1.5,py:.5,fontSize:"0.813rem"},children:"Refresh"}),r.length>0&&e.jsx(N,{variant:"outlined",size:"small",color:"error",onClick:m,sx:{borderRadius:1,textTransform:"none",minWidth:"auto",px:1.5,py:.5,fontSize:"0.813rem"},children:"Clear All"}),e.jsx(N,{variant:"contained",size:"small",startIcon:e.jsx(sr,{}),onClick:d,disabled:s,sx:{borderRadius:1,textTransform:"none",fontWeight:600,minWidth:"auto",px:2,py:.5,fontSize:"0.813rem"},children:"Select Files"}),e.jsx(ve,{title:window.isSecureContext?"Select a folder to scan recursively including all subfolders":'Folder selection requires HTTPS or localhost. Currently viewing over HTTP. Use "Select Files" instead, or access via HTTPS.',arrow:!0,children:e.jsx("span",{children:e.jsxs(N,{variant:"contained",size:"small",startIcon:e.jsx(Ph,{}),onClick:f,disabled:s||!window.isSecureContext,color:"secondary",sx:{borderRadius:1,textTransform:"none",fontWeight:600,minWidth:"auto",px:2,py:.5,fontSize:"0.813rem"},children:["Select Folder ",!window.isSecureContext&&""]})})})]})]}),r.length===0&&!s&&e.jsxs(pe,{severity:"info",sx:{mb:3,borderRadius:3},children:[e.jsx(x,{variant:"body2",sx:{fontWeight:600,mb:.5},children:"No local files yet"}),e.jsx(x,{variant:"caption",children:'Click "Select Files" to choose individual audio files (works everywhere), or "Select Folder" to scan an entire folder including subfolders (requires HTTPS or localhost). Files are stored in your browser and play locally without uploading.'})]}),s&&e.jsx(h,{sx:{mb:3},children:e.jsx(rt,{})}),r.length>0&&e.jsx(Lr,{component:yt,sx:{bgcolor:"background.paper",borderRadius:3,border:"1px solid",borderColor:"rgba(255, 255, 255, 0.05)","& .MuiTableCell-root":{borderColor:"rgba(255, 255, 255, 0.05)",padding:{xs:"6px 8px",sm:"8px 12px"},fontSize:{xs:"0.7rem",sm:"0.8125rem"}}},children:e.jsxs(Wr,{size:"small",children:[e.jsx($r,{children:e.jsxs(ht,{children:[e.jsx(Z,{width:30,sx:{fontWeight:600,fontSize:{xs:"0.7rem",sm:"0.75rem"}},children:"#"}),e.jsx(Z,{sx:{fontWeight:600,fontSize:{xs:"0.7rem",sm:"0.75rem"}},children:"Title"}),e.jsx(Z,{sx:{fontWeight:600,display:{xs:"none",sm:"table-cell"},fontSize:"0.75rem"},children:"Artist"}),e.jsx(Z,{sx:{fontWeight:600,display:{xs:"none",md:"table-cell"},fontSize:"0.75rem"},children:"Album"}),e.jsx(Z,{align:"right",sx:{fontWeight:600,fontSize:{xs:"0.7rem",sm:"0.75rem"}},children:"Duration"}),e.jsx(Z,{align:"center",width:80,sx:{fontWeight:600,fontSize:{xs:"0.7rem",sm:"0.75rem"}},children:"Actions"})]})}),e.jsx(Br,{children:r.map((j,C)=>e.jsxs(ht,{sx:{cursor:"pointer",transition:"background-color 0.3s ease","&:hover":{bgcolor:"rgba(19, 236, 106, 0.05)"}},onClick:()=>p(j),children:[e.jsx(Z,{sx:{color:"text.secondary",fontSize:{xs:"0.7rem",sm:"0.75rem"}},children:C+1}),e.jsx(Z,{children:e.jsxs(h,{children:[e.jsx(x,{variant:"body2",noWrap:!0,sx:{maxWidth:{xs:150,sm:200,md:300},fontWeight:500,fontSize:{xs:"0.75rem",sm:"0.813rem"},lineHeight:1.3},children:j.title}),e.jsx(x,{variant:"caption",noWrap:!0,sx:{display:{xs:"block",sm:"none"},color:"text.secondary",fontSize:"0.65rem",maxWidth:150},children:j.artist})]})}),e.jsx(Z,{sx:{display:{xs:"none",sm:"table-cell"}},children:e.jsx(x,{variant:"body2",color:"text.secondary",noWrap:!0,sx:{maxWidth:120,fontSize:"0.75rem"},children:j.artist})}),e.jsx(Z,{sx:{display:{xs:"none",md:"table-cell"}},children:e.jsx(x,{variant:"body2",color:"text.secondary",noWrap:!0,sx:{maxWidth:150,fontSize:"0.75rem"},children:j.album||"-"})}),e.jsx(Z,{align:"right",sx:{color:"text.secondary",fontSize:{xs:"0.7rem",sm:"0.75rem"}},children:y(j.duration)}),e.jsxs(Z,{align:"center",onClick:w=>w.stopPropagation(),children:[e.jsx(X,{size:"small",onClick:()=>p(j),sx:{color:"primary.main",padding:{xs:"4px",sm:"6px"},"&:hover":{bgcolor:"rgba(19, 236, 106, 0.1)"}},children:e.jsx(ar,{sx:{fontSize:{xs:"1rem",sm:"1.2rem"}}})}),e.jsx(X,{size:"small",onClick:()=>g(j.id),sx:{color:"error.main",padding:{xs:"4px",sm:"6px"},"&:hover":{bgcolor:"rgba(255, 0, 0, 0.1)"}},children:e.jsx(Er,{sx:{fontSize:{xs:"1rem",sm:"1.2rem"}}})})]})]},j.id))})]})}),e.jsx(it,{open:!!o,autoHideDuration:4e3,onClose:()=>i(null),anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(pe,{onClose:()=>i(null),severity:o?.severity,sx:{borderRadius:2},children:o?.message})})]})}const Oy=()=>{const[t,r]=l.useState([]),[n,s]=l.useState(null),[a,o]=l.useState(!0),[i,c]=l.useState(""),[u,d]=l.useState(""),[f,p]=l.useState(!1),[g,m]=l.useState(!1),[y,j]=l.useState(null),[C,w]=l.useState(!1),[b,v]=l.useState({username:"",email:"",password:"",password_confirm:"",is_admin:!1,is_active:!0,storage_quota_gb:50,max_channels:50,max_playlists:100,user_notes:""});l.useEffect(()=>{S(),A()},[]);const S=async()=>{try{o(!0);const I=await V.get("/user/admin/users/");r(I.data.results||I.data),c("")}catch(I){c(I.response?.data?.detail||"Failed to load users")}finally{o(!1)}},A=async()=>{try{const I=await V.get("/user/admin/users/system_stats/");s(I.data)}catch(I){console.error("Failed to load system stats:",I)}},E=async()=>{try{await V.post("/user/admin/users/",b),d("User created successfully"),p(!1),W(),S(),A(),setTimeout(()=>d(""),3e3)}catch(I){c(I.response?.data?.detail||"Failed to create user")}},P=async()=>{if(y)try{await V.patch(`/user/admin/users/${y.id}/`,{is_admin:b.is_admin,is_active:b.is_active,storage_quota_gb:b.storage_quota_gb,max_channels:b.max_channels,max_playlists:b.max_playlists,user_notes:b.user_notes}),d("User updated successfully"),m(!1),S(),setTimeout(()=>d(""),3e3)}catch(I){c(I.response?.data?.detail||"Failed to update user")}},k=async I=>{try{await V.post(`/user/admin/users/${I.id}/toggle_active/`),d(`User ${I.is_active?"deactivated":"activated"}`),S(),setTimeout(()=>d(""),3e3)}catch(_){c(_.response?.data?.detail||"Failed to toggle user status")}},R=async I=>{try{await V.post(`/user/admin/users/${I.id}/reset_storage/`),d("Storage reset successfully"),S(),setTimeout(()=>d(""),3e3)}catch(_){c(_.response?.data?.detail||"Failed to reset storage")}},z=async I=>{try{await V.post(`/user/admin/users/${I.id}/reset_2fa/`),d("2FA reset successfully"),S(),setTimeout(()=>d(""),3e3)}catch(_){c(_.response?.data?.detail||"Failed to reset 2FA")}},B=I=>{j(I),v({username:I.username,email:I.email,password:"",password_confirm:"",is_admin:I.is_admin,is_active:I.is_active,storage_quota_gb:I.storage_quota_gb,max_channels:I.max_channels,max_playlists:I.max_playlists,user_notes:""}),m(!0)},F=I=>{j(I),w(!0)},W=()=>{v({username:"",email:"",password:"",password_confirm:"",is_admin:!1,is_active:!0,storage_quota_gb:50,max_channels:50,max_playlists:100,user_notes:""})},H=I=>I>90?"error":I>75?"warning":"success";return e.jsxs(h,{children:[e.jsxs(h,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[e.jsx(x,{variant:"h4",fontWeight:"bold",children:"User Management"}),e.jsxs(h,{children:[e.jsx(X,{onClick:S,sx:{mr:1},children:e.jsx(qr,{})}),e.jsx(N,{variant:"contained",startIcon:e.jsx(Dh,{}),onClick:()=>p(!0),children:"Create User"})]})]}),i&&e.jsx(pe,{severity:"error",sx:{mb:2},onClose:()=>c(""),children:i}),u&&e.jsx(pe,{severity:"success",sx:{mb:2},onClose:()=>d(""),children:u}),n&&e.jsxs(ee,{container:!0,spacing:3,sx:{mb:3},children:[e.jsx(ee,{item:!0,xs:12,md:3,children:e.jsx(_e,{children:e.jsxs(Pe,{children:[e.jsxs(h,{display:"flex",alignItems:"center",mb:1,children:[e.jsx(Mh,{color:"primary",sx:{mr:1}}),e.jsx(x,{variant:"h6",children:"Users"})]}),e.jsx(x,{variant:"h4",children:n.users.total}),e.jsxs(x,{variant:"body2",color:"text.secondary",children:[n.users.active," active, ",n.users.admin," admins"]})]})})}),e.jsx(ee,{item:!0,xs:12,md:3,children:e.jsx(_e,{children:e.jsxs(Pe,{children:[e.jsxs(h,{display:"flex",alignItems:"center",mb:1,children:[e.jsx(Eh,{color:"primary",sx:{mr:1}}),e.jsx(x,{variant:"h6",children:"Content"})]}),e.jsx(x,{variant:"h4",children:n.content.channels}),e.jsxs(x,{variant:"body2",color:"text.secondary",children:[n.content.playlists," playlists, ",n.content.audio_files," audio"]})]})})}),e.jsx(ee,{item:!0,xs:12,md:3,children:e.jsx(_e,{children:e.jsxs(Pe,{children:[e.jsxs(h,{display:"flex",alignItems:"center",mb:1,children:[e.jsx(ro,{color:"primary",sx:{mr:1}}),e.jsx(x,{variant:"h6",children:"Storage"})]}),e.jsxs(x,{variant:"h4",children:[n.storage.used_gb.toFixed(1)," GB"]}),e.jsxs(x,{variant:"body2",color:"text.secondary",children:["/ ",n.storage.quota_gb," GB allocated"]})]})})})]}),e.jsx(Lr,{component:yt,children:e.jsxs(Wr,{children:[e.jsx($r,{children:e.jsxs(ht,{children:[e.jsx(Z,{children:"Username"}),e.jsx(Z,{children:"Email"}),e.jsx(Z,{children:"Status"}),e.jsx(Z,{children:"Storage"}),e.jsx(Z,{children:"Content"}),e.jsx(Z,{children:"Joined"}),e.jsx(Z,{children:"Actions"})]})}),e.jsx(Br,{children:a?e.jsx(ht,{children:e.jsx(Z,{colSpan:7,align:"center",children:e.jsx(rt,{})})}):t.length===0?e.jsx(ht,{children:e.jsx(Z,{colSpan:7,align:"center",children:"No users found"})}):t.map(I=>e.jsxs(ht,{children:[e.jsx(Z,{children:e.jsxs(h,{display:"flex",alignItems:"center",children:[I.username,I.is_admin&&e.jsx(ue,{label:"Admin",size:"small",color:"primary",sx:{ml:1}})]})}),e.jsx(Z,{children:I.email}),e.jsx(Z,{children:e.jsx(ue,{label:I.is_active?"Active":"Inactive",color:I.is_active?"success":"default",size:"small",icon:I.is_active?e.jsx(Tr,{}):e.jsx(Pi,{})})}),e.jsx(Z,{children:e.jsxs(h,{width:120,children:[e.jsxs(x,{variant:"caption",children:[I.storage_used_gb.toFixed(1)," / ",I.storage_quota_gb," GB"]}),e.jsx(rt,{variant:"determinate",value:Math.min(I.storage_percent_used,100),color:H(I.storage_percent_used)})]})}),e.jsxs(Z,{children:[e.jsxs(x,{variant:"body2",children:[I.stats.total_channels," channels"]}),e.jsxs(x,{variant:"caption",color:"text.secondary",children:[I.stats.total_playlists," playlists, ",I.stats.total_audio_files," audio"]})]}),e.jsx(Z,{children:e.jsx(x,{variant:"body2",children:new Date(I.date_joined).toLocaleDateString()})}),e.jsxs(Z,{children:[e.jsx(ve,{title:"User Details",children:e.jsx(X,{size:"small",onClick:()=>F(I),children:e.jsx(Kr,{})})}),e.jsx(ve,{title:"Edit User",children:e.jsx(X,{size:"small",onClick:()=>B(I),children:e.jsx(vd,{})})}),e.jsx(ve,{title:I.is_active?"Deactivate":"Activate",children:e.jsx(X,{size:"small",onClick:()=>k(I),children:I.is_active?e.jsx(Pi,{}):e.jsx(Tr,{})})})]})]},I.id))})]})}),e.jsxs(Ke,{open:f,onClose:()=>p(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(tt,{children:"Create New User"}),e.jsx(Xe,{children:e.jsxs(h,{sx:{pt:2,display:"flex",flexDirection:"column",gap:2},children:[e.jsx(Ce,{label:"Username",value:b.username,onChange:I=>v({...b,username:I.target.value}),fullWidth:!0,required:!0}),e.jsx(Ce,{label:"Email",type:"email",value:b.email,onChange:I=>v({...b,email:I.target.value}),fullWidth:!0,required:!0}),e.jsx(Ce,{label:"Password",type:"password",value:b.password,onChange:I=>v({...b,password:I.target.value}),fullWidth:!0,required:!0}),e.jsx(Ce,{label:"Confirm Password",type:"password",value:b.password_confirm,onChange:I=>v({...b,password_confirm:I.target.value}),fullWidth:!0,required:!0}),e.jsx(Ce,{label:"Storage Quota (GB)",type:"number",value:b.storage_quota_gb,onChange:I=>v({...b,storage_quota_gb:parseInt(I.target.value)}),fullWidth:!0}),e.jsx(Ce,{label:"Max Channels",type:"number",value:b.max_channels,onChange:I=>v({...b,max_channels:parseInt(I.target.value)}),fullWidth:!0}),e.jsx(Ce,{label:"Max Playlists",type:"number",value:b.max_playlists,onChange:I=>v({...b,max_playlists:parseInt(I.target.value)}),fullWidth:!0}),e.jsx(Ce,{label:"Notes",multiline:!0,rows:3,value:b.user_notes,onChange:I=>v({...b,user_notes:I.target.value}),fullWidth:!0}),e.jsx(We,{control:e.jsx(et,{checked:b.is_admin,onChange:I=>v({...b,is_admin:I.target.checked})}),label:"Admin User"}),e.jsx(We,{control:e.jsx(et,{checked:b.is_active,onChange:I=>v({...b,is_active:I.target.checked})}),label:"Active"})]})}),e.jsxs(nt,{children:[e.jsx(N,{onClick:()=>p(!1),children:"Cancel"}),e.jsx(N,{onClick:E,variant:"contained",children:"Create User"})]})]}),e.jsxs(Ke,{open:g,onClose:()=>m(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsxs(tt,{children:["Edit User: ",y?.username]}),e.jsx(Xe,{children:e.jsxs(h,{sx:{pt:2,display:"flex",flexDirection:"column",gap:2},children:[e.jsx(Ce,{label:"Storage Quota (GB)",type:"number",value:b.storage_quota_gb,onChange:I=>v({...b,storage_quota_gb:parseInt(I.target.value)}),fullWidth:!0}),e.jsx(Ce,{label:"Max Channels",type:"number",value:b.max_channels,onChange:I=>v({...b,max_channels:parseInt(I.target.value)}),fullWidth:!0}),e.jsx(Ce,{label:"Max Playlists",type:"number",value:b.max_playlists,onChange:I=>v({...b,max_playlists:parseInt(I.target.value)}),fullWidth:!0}),e.jsx(Ce,{label:"Notes",multiline:!0,rows:3,value:b.user_notes,onChange:I=>v({...b,user_notes:I.target.value}),fullWidth:!0}),e.jsx(We,{control:e.jsx(et,{checked:b.is_admin,onChange:I=>v({...b,is_admin:I.target.checked})}),label:"Admin User"}),e.jsx(We,{control:e.jsx(et,{checked:b.is_active,onChange:I=>v({...b,is_active:I.target.checked})}),label:"Active"}),y&&e.jsxs(h,{display:"flex",gap:1,children:[e.jsx(N,{variant:"outlined",color:"warning",onClick:()=>R(y),fullWidth:!0,children:"Reset Storage"}),e.jsx(N,{variant:"outlined",color:"warning",onClick:()=>z(y),fullWidth:!0,children:"Reset 2FA"})]})]})}),e.jsxs(nt,{children:[e.jsx(N,{onClick:()=>m(!1),children:"Cancel"}),e.jsx(N,{onClick:P,variant:"contained",children:"Save Changes"})]})]}),e.jsxs(Ke,{open:C,onClose:()=>w(!1),maxWidth:"md",fullWidth:!0,children:[e.jsxs(tt,{children:["User Details: ",y?.username]}),e.jsx(Xe,{children:y&&e.jsx(h,{sx:{pt:2},children:e.jsxs(ee,{container:!0,spacing:2,children:[e.jsxs(ee,{item:!0,xs:6,children:[e.jsx(x,{variant:"subtitle2",color:"text.secondary",children:"Email"}),e.jsx(x,{variant:"body1",children:y.email})]}),e.jsxs(ee,{item:!0,xs:6,children:[e.jsx(x,{variant:"subtitle2",color:"text.secondary",children:"Status"}),e.jsx(ue,{label:y.is_active?"Active":"Inactive",color:y.is_active?"success":"default",size:"small"})]}),e.jsxs(ee,{item:!0,xs:6,children:[e.jsx(x,{variant:"subtitle2",color:"text.secondary",children:"Role"}),e.jsx(ue,{label:y.is_admin?"Admin":"User",color:y.is_admin?"primary":"default",size:"small"})]}),e.jsxs(ee,{item:!0,xs:6,children:[e.jsx(x,{variant:"subtitle2",color:"text.secondary",children:"Storage Usage"}),e.jsxs(x,{variant:"body1",children:[y.storage_used_gb.toFixed(2)," / ",y.storage_quota_gb," GB (",y.storage_percent_used.toFixed(1),"%)"]})]}),e.jsxs(ee,{item:!0,xs:6,children:[e.jsx(x,{variant:"subtitle2",color:"text.secondary",children:"Channels"}),e.jsxs(x,{variant:"body1",children:[y.stats.total_channels," / ",y.max_channels]})]}),e.jsxs(ee,{item:!0,xs:6,children:[e.jsx(x,{variant:"subtitle2",color:"text.secondary",children:"Playlists"}),e.jsxs(x,{variant:"body1",children:[y.stats.total_playlists," / ",y.max_playlists]})]}),e.jsxs(ee,{item:!0,xs:6,children:[e.jsx(x,{variant:"subtitle2",color:"text.secondary",children:"Audio Files"}),e.jsx(x,{variant:"body1",children:y.stats.total_audio_files})]}),e.jsxs(ee,{item:!0,xs:6,children:[e.jsx(x,{variant:"subtitle2",color:"text.secondary",children:"Date Joined"}),e.jsx(x,{variant:"body1",children:new Date(y.date_joined).toLocaleString()})]}),e.jsxs(ee,{item:!0,xs:6,children:[e.jsx(x,{variant:"subtitle2",color:"text.secondary",children:"Last Login"}),e.jsx(x,{variant:"body1",children:y.last_login?new Date(y.last_login).toLocaleString():"Never"})]})]})})}),e.jsx(nt,{children:e.jsx(N,{onClick:()=>w(!1),children:"Close"})})]})]})};function Fy(){const t=Dt(),{isOnline:r,cacheSize:n,clearCache:s,removePlaylistCache:a}=Sa(),[o,i]=l.useState([]),[c,u]=l.useState(!0),[d,f]=l.useState({open:!1}),[p,g]=l.useState(!1);l.useEffect(()=>{m()},[]);const m=async()=>{try{const b=await ut.getOfflinePlaylists();i(b)}catch(b){console.error("Failed to load cached playlists:",b)}finally{u(!1)}},y=async b=>{try{const v=b.items?.map(S=>`/api/audio/${S.audio.youtube_id}/download/`)||[];await a(b.playlist_id,v),await ut.removePlaylist(b.id),await m(),f({open:!1})}catch(v){console.error("Failed to remove playlist:",v),alert("Failed to remove offline data")}},j=async()=>{try{await s(),await ut.clearAllData(),await m(),g(!1)}catch(b){console.error("Failed to clear all:",b),alert("Failed to clear all offline data")}},C=b=>{if(b===0)return"0 Bytes";const v=1024,S=["Bytes","KB","MB","GB"],A=Math.floor(Math.log(b)/Math.log(v));return Math.round(b/Math.pow(v,A)*100)/100+" "+S[A]},w=b=>new Date(b).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return c?e.jsx(h,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh"},children:e.jsx(Ie,{})}):e.jsxs(h,{sx:{maxWidth:800,mx:"auto",px:2},children:[e.jsxs(h,{sx:{mb:4},children:[e.jsx(x,{variant:"h5",sx:{fontWeight:700,letterSpacing:"-0.02em",mb:1},children:"Offline Storage"}),e.jsx(x,{variant:"body2",color:"text.secondary",children:"Manage playlists cached for offline playback"})]}),!r&&e.jsx(pe,{severity:"warning",icon:e.jsx(Sr,{}),sx:{mb:3},children:"You are currently offline. You can only play cached content."}),n&&e.jsx(_e,{sx:{mb:3},children:e.jsxs(Pe,{children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(ro,{color:"primary",sx:{fontSize:32}}),e.jsxs(h,{sx:{flex:1},children:[e.jsx(x,{variant:"subtitle1",sx:{fontWeight:600},children:"Storage Used"}),e.jsx(x,{variant:"h5",sx:{fontWeight:700,color:"primary.main"},children:C(n.usage)})]}),e.jsxs(h,{sx:{textAlign:"right"},children:[e.jsx(x,{variant:"caption",color:"text.secondary",children:"Available"}),e.jsx(x,{variant:"body2",sx:{fontWeight:600},children:C(n.quota-n.usage)})]})]}),e.jsx(rt,{variant:"determinate",value:n.usage/n.quota*100,sx:{height:8,borderRadius:1}}),e.jsxs(x,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:[(n.usage/n.quota*100).toFixed(1),"% of ",C(n.quota)," used"]})]})}),e.jsx(_e,{children:e.jsxs(Pe,{children:[e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ra,{color:"success"}),e.jsx(x,{variant:"subtitle1",sx:{fontWeight:600},children:"Offline Playlists"}),e.jsx(ue,{label:o.length,size:"small",color:"success"})]}),e.jsxs(h,{sx:{display:"flex",gap:1},children:[e.jsx(N,{size:"small",startIcon:e.jsx(qr,{}),onClick:m,children:"Refresh"}),o.length>0&&e.jsx(N,{size:"small",color:"error",startIcon:e.jsx(Er,{}),onClick:()=>g(!0),children:"Clear All"})]})]}),e.jsx(Ee,{sx:{mb:2}}),o.length===0?e.jsxs(h,{sx:{textAlign:"center",py:4},children:[e.jsx(Sr,{sx:{fontSize:48,color:"text.secondary",mb:2,opacity:.3}}),e.jsx(x,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"No playlists cached for offline use"}),e.jsx(N,{variant:"contained",onClick:()=>t("/playlists"),children:"Browse Playlists"})]}):e.jsx(Qe,{disablePadding:!0,children:o.map((b,v)=>e.jsxs(h,{children:[v>0&&e.jsx(Ee,{}),e.jsxs(Le,{sx:{py:2,cursor:"pointer","&:hover":{bgcolor:"rgba(255, 255, 255, 0.05)"}},onClick:()=>t(`/playlists/${b.playlist_id}`),children:[e.jsx(ke,{primary:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[e.jsx(x,{variant:"body1",sx:{fontWeight:600},children:b.title}),e.jsx(Tr,{sx:{fontSize:16,color:"success.main"}})]}),secondary:e.jsxs(h,{children:[e.jsx(x,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:b.channel_name}),e.jsxs(h,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsx(ue,{label:`${b.downloaded_count} tracks`,size:"small",sx:{height:20,fontSize:"0.7rem"}}),e.jsx(ue,{label:`Cached ${w(b.lastSync)}`,size:"small",sx:{height:20,fontSize:"0.7rem"},variant:"outlined"})]})]})}),e.jsx(Ar,{children:e.jsx(X,{edge:"end",color:"error",onClick:S=>{S.stopPropagation(),f({open:!0,playlistId:b.playlist_id,title:b.title})},children:e.jsx(Er,{})})})]})]},b.id))})]})}),e.jsxs(Ke,{open:d.open,onClose:()=>f({open:!1}),children:[e.jsx(tt,{children:"Remove Offline Playlist?"}),e.jsx(Xe,{children:e.jsxs(x,{children:['Are you sure you want to remove "',d.title,`" from offline storage? You'll need to re-download it to play offline.`]})}),e.jsxs(nt,{children:[e.jsx(N,{onClick:()=>f({open:!1}),children:"Cancel"}),e.jsx(N,{color:"error",variant:"contained",onClick:()=>{const b=o.find(v=>v.playlist_id===d.playlistId);b&&y(b)},children:"Remove"})]})]}),e.jsxs(Ke,{open:p,onClose:()=>g(!1),children:[e.jsx(tt,{children:"Clear All Offline Data?"}),e.jsxs(Xe,{children:[e.jsx(x,{sx:{mb:2},children:"This will remove all cached playlists and free up storage space. You'll need to re-download playlists to use them offline."}),e.jsx(pe,{severity:"warning",children:"This action cannot be undone."})]}),e.jsxs(nt,{children:[e.jsx(N,{onClick:()=>g(!1),children:"Cancel"}),e.jsx(N,{color:"error",variant:"contained",onClick:j,children:"Clear All"})]})]})]})}const Qr=t=>{if(t<60)return`${t}s`;if(t<3600)return`${Math.floor(t/60)}m`;const r=Math.floor(t/3600),n=Math.floor(t%3600/60);return n>0?`${r}h ${n}m`:`${r}h`},Hu=t=>t===0?"12 AM":t===12?"12 PM":t>12?`${t-12} PM`:`${t} AM`,yr=({title:t,value:r,subtitle:n,icon:s,color:a="primary.main"})=>{const o=Pt();return e.jsx(_e,{sx:{height:"100%",background:`linear-gradient(135deg, ${$e(o.palette.background.paper,.9)} 0%, ${$e(o.palette.background.paper,.7)} 100%)`,backdropFilter:"blur(10px)",border:"1px solid",borderColor:$e(o.palette.divider,.1)},children:e.jsx(Pe,{children:e.jsxs(h,{sx:{display:"flex",alignItems:"flex-start",justifyContent:"space-between"},children:[e.jsxs(h,{children:[e.jsx(x,{variant:"overline",color:"text.secondary",sx:{letterSpacing:1},children:t}),e.jsx(x,{variant:"h4",sx:{fontWeight:700,color:a},children:r}),n&&e.jsx(x,{variant:"body2",color:"text.secondary",children:n})]}),e.jsx(h,{sx:{p:1.5,borderRadius:2,bgcolor:$e(o.palette.primary.main,.1),color:a},children:s})]})})})},Ly=({data:t})=>{const r=Pt(),n=Math.max(...t.map(s=>s.play_count),1);return e.jsxs(h,{sx:{mt:2},children:[e.jsx(h,{sx:{display:"flex",alignItems:"flex-end",height:120,gap:.5},children:t.map(s=>e.jsx(ve,{title:`${Hu(s.hour)}: ${s.play_count} plays (${Qr(s.total_duration)})`,children:e.jsx(h,{sx:{flex:1,bgcolor:s.play_count>0?"primary.main":$e(r.palette.text.disabled,.2),borderRadius:"4px 4px 0 0",minHeight:4,height:`${s.play_count/n*100}%`,transition:"all 0.3s ease",cursor:"pointer","&:hover":{bgcolor:"primary.light",transform:"scaleY(1.05)"}}})},s.hour))}),e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",mt:1},children:[e.jsx(x,{variant:"caption",color:"text.secondary",children:"12 AM"}),e.jsx(x,{variant:"caption",color:"text.secondary",children:"6 AM"}),e.jsx(x,{variant:"caption",color:"text.secondary",children:"12 PM"}),e.jsx(x,{variant:"caption",color:"text.secondary",children:"6 PM"}),e.jsx(x,{variant:"caption",color:"text.secondary",children:"12 AM"})]})]})};function Wy(){const[t,r]=l.useState(null),[n,s]=l.useState(!0),[a,o]=l.useState(30),i=Pt();l.useEffect(()=>{c()},[a]);const c=async()=>{try{s(!0);const f=await Kt.insights(a);r(f.data)}catch(f){console.error("Failed to load insights:",f)}finally{s(!1)}};if(n)return e.jsx(h,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:400},children:e.jsx(Ie,{})});if(!t)return e.jsx(h,{sx:{textAlign:"center",py:8},children:e.jsx(x,{variant:"h6",color:"text.secondary",children:"Unable to load analytics data"})});const u=Math.max(...t.top_artists.map(f=>f.play_count),1),d=Math.max(...t.top_channels.map(f=>f.play_count),1);return e.jsxs(h,{sx:{pb:4},children:[e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsxs(h,{children:[e.jsx(x,{variant:"h4",sx:{fontWeight:700,mb:.5},children:"Listening Insights"}),e.jsx(x,{variant:"body1",color:"text.secondary",children:"Your personal listening statistics and habits"})]}),e.jsxs(Ct,{size:"small",sx:{minWidth:150},children:[e.jsx(Wt,{children:"Time Range"}),e.jsxs(Rt,{value:a,label:"Time Range",onChange:f=>o(Number(f.target.value)),children:[e.jsx(we,{value:7,children:"Last 7 days"}),e.jsx(we,{value:30,children:"Last 30 days"}),e.jsx(we,{value:90,children:"Last 3 months"}),e.jsx(we,{value:365,children:"Last year"})]})]})]}),e.jsxs(ee,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(ee,{item:!0,xs:6,sm:4,md:3,children:e.jsx(yr,{title:"Total Listening Time",value:Qr(t.total_listening_time),icon:e.jsx(no,{}),color:"primary.main"})}),e.jsx(ee,{item:!0,xs:6,sm:4,md:3,children:e.jsx(yr,{title:"Tracks Played",value:t.total_tracks_played.toLocaleString(),subtitle:`${t.total_unique_tracks} unique`,icon:e.jsx(Ht,{}),color:"secondary.main"})}),e.jsx(ee,{item:!0,xs:6,sm:4,md:3,children:e.jsx(yr,{title:"Unique Artists",value:t.total_unique_artists,icon:e.jsx(Va,{}),color:"warning.main"})}),e.jsx(ee,{item:!0,xs:6,sm:4,md:3,children:e.jsx(yr,{title:"Daily Average",value:Qr(t.avg_daily_listening),icon:e.jsx(jd,{}),color:"info.main"})}),e.jsx(ee,{item:!0,xs:6,sm:4,md:3,children:e.jsx(yr,{title:"Current Streak",value:`${t.current_streak} days`,icon:e.jsx(na,{}),color:t.current_streak>0?"error.main":"text.disabled"})}),e.jsx(ee,{item:!0,xs:6,sm:4,md:3,children:e.jsx(yr,{title:"Longest Streak",value:`${t.longest_streak} days`,icon:e.jsx(Di,{}),color:"success.main"})}),e.jsx(ee,{item:!0,xs:6,sm:4,md:3,children:e.jsx(yr,{title:"Peak Hour",value:t.favorite_hour!==null?Hu(t.favorite_hour):"N/A",icon:e.jsx(wd,{}),color:"primary.main"})}),e.jsx(ee,{item:!0,xs:6,sm:4,md:3,children:e.jsx(yr,{title:"Favorite Day",value:t.favorite_day||"N/A",icon:e.jsx(Di,{}),color:"secondary.main"})})]}),e.jsxs(ee,{container:!0,spacing:3,children:[e.jsx(ee,{item:!0,xs:12,md:6,children:e.jsx(_e,{sx:{height:"100%"},children:e.jsxs(Pe,{children:[e.jsx(x,{variant:"h6",sx:{fontWeight:600,mb:1},children:"Listening Activity by Hour"}),e.jsx(x,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"When you listen to music throughout the day"}),e.jsx(Ly,{data:t.listening_by_hour})]})})}),e.jsx(ee,{item:!0,xs:12,md:6,children:e.jsx(_e,{sx:{height:"100%"},children:e.jsxs(Pe,{children:[e.jsx(x,{variant:"h6",sx:{fontWeight:600,mb:2},children:"Top Artists"}),t.top_artists.length===0?e.jsx(x,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",py:4},children:"No listening data yet"}):e.jsx(Qe,{dense:!0,disablePadding:!0,children:t.top_artists.slice(0,5).map((f,p)=>e.jsxs(Le,{disableGutters:!0,sx:{py:1},children:[e.jsx(Ft,{children:e.jsx(Ve,{sx:{bgcolor:p===0?"primary.main":$e(i.palette.primary.main,.2),color:p===0?"primary.contrastText":"primary.main",fontWeight:700},children:p+1})}),e.jsx(ke,{primary:f.artist,secondary:`${f.play_count} plays  ${Qr(f.total_duration)}`,primaryTypographyProps:{fontWeight:500}}),e.jsx(h,{sx:{width:80},children:e.jsx(rt,{variant:"determinate",value:f.play_count/u*100,sx:{height:6,borderRadius:3}})})]},f.artist))})]})})}),e.jsx(ee,{item:!0,xs:12,md:6,children:e.jsx(_e,{sx:{height:"100%"},children:e.jsxs(Pe,{children:[e.jsx(x,{variant:"h6",sx:{fontWeight:600,mb:2},children:"Top Channels"}),t.top_channels.length===0?e.jsx(x,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",py:4},children:"No listening data yet"}):e.jsx(Qe,{dense:!0,disablePadding:!0,children:t.top_channels.slice(0,5).map((f,p)=>e.jsxs(Le,{disableGutters:!0,sx:{py:1},children:[e.jsx(Ft,{children:e.jsx(Ve,{sx:{bgcolor:$e(i.palette.error.main,.1),color:"error.main"},children:e.jsx(Ha,{})})}),e.jsx(ke,{primary:f.channel_name,secondary:`${f.play_count} plays  ${Qr(f.total_duration)}`,primaryTypographyProps:{fontWeight:500,sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}}),e.jsx(h,{sx:{width:80},children:e.jsx(rt,{variant:"determinate",value:f.play_count/d*100,color:"error",sx:{height:6,borderRadius:3}})})]},f.channel_name))})]})})}),e.jsx(ee,{item:!0,xs:12,md:6,children:e.jsx(_e,{sx:{height:"100%"},children:e.jsxs(Pe,{children:[e.jsx(x,{variant:"h6",sx:{fontWeight:600,mb:2},children:"Most Played Tracks"}),t.top_tracks.length===0?e.jsx(x,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",py:4},children:"No listening data yet"}):e.jsx(Qe,{dense:!0,disablePadding:!0,children:t.top_tracks.slice(0,5).map((f,p)=>e.jsxs(Le,{disableGutters:!0,sx:{py:1},children:[e.jsx(Ft,{children:e.jsx(Ve,{variant:"rounded",src:f.thumbnail_url,sx:{width:48,height:48},children:e.jsx(Ht,{})})}),e.jsx(ke,{primary:f.title,secondary:f.artist,primaryTypographyProps:{fontWeight:500,sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},secondaryTypographyProps:{sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}}),e.jsx(ue,{label:`${f.play_count}`,size:"small",color:"primary",sx:{ml:1}})]},`${f.youtube_id}-${p}`))})]})})}),e.jsx(ee,{item:!0,xs:12,children:e.jsx(_e,{children:e.jsxs(Pe,{children:[e.jsx(x,{variant:"h6",sx:{fontWeight:600,mb:2},children:"Recent Listening History"}),t.recent_history.length===0?e.jsx(x,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",py:4},children:"No recent listening history"}):e.jsx(Qe,{disablePadding:!0,children:t.recent_history.map(f=>e.jsxs(Le,{sx:{borderRadius:2,mb:1,"&:hover":{bgcolor:$e(i.palette.primary.main,.05)}},children:[e.jsx(Ft,{children:e.jsx(Ve,{variant:"rounded",src:f.thumbnail_url,sx:{width:48,height:48},children:e.jsx(Ht,{})})}),e.jsx(ke,{primary:f.title,secondary:e.jsxs(h,{component:"span",sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx("span",{children:f.artist||f.channel_name}),e.jsx("span",{children:""}),e.jsx("span",{children:Qr(f.duration_listened)}),f.completed&&e.jsx(ue,{label:"Completed",size:"small",color:"success",sx:{height:18,fontSize:"0.65rem"}})]}),primaryTypographyProps:{fontWeight:500,sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}}),e.jsx(x,{variant:"caption",color:"text.secondary",children:new Date(f.listened_at).toLocaleString()})]},f.id))})]})})}),t.genre_distribution.length>0&&e.jsx(ee,{item:!0,xs:12,md:6,children:e.jsx(_e,{children:e.jsxs(Pe,{children:[e.jsx(x,{variant:"h6",sx:{fontWeight:600,mb:2},children:"Genre Distribution"}),e.jsx(h,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:t.genre_distribution.map(f=>e.jsx(ue,{label:`${f.genre} (${f.play_count})`,variant:"outlined",color:"primary"},f.genre))})]})})})]})]})}function Hr(t){const{children:r,value:n,index:s,...a}=t;return e.jsx("div",{hidden:n!==s,...a,children:n===s&&e.jsx(h,{sx:{py:3},children:r})})}function $y(){const[t,r]=l.useState(0),[n,s]=l.useState(!0),[a,o]=l.useState(""),[i,c]=l.useState([]),[u,d]=l.useState(null),[f,p]=l.useState(!1),[g,m]=l.useState("");l.useEffect(()=>{y()},[]);const y=async()=>{try{s(!0);const[S,A]=await Promise.all([Kt.achievements({progress:!0}),Kt.streak()]);c(S.data),d(A.data),o("")}catch(S){console.error("Failed to load achievements:",S),o("Failed to load achievements data")}finally{s(!1)}},j=async()=>{try{const S=await Kt.checkAchievements();S.data.new_achievements?.length>0?(m(` ${S.data.total_new} new achievement(s) unlocked!`),p(!0),y()):(m("No new achievements yet. Keep listening!"),p(!0))}catch(S){console.error("Failed to check achievements:",S),m("Failed to check achievements"),p(!0)}},C={tracks:i.filter(S=>S.type.startsWith("tracks_")),time:i.filter(S=>S.type.startsWith("hours_")),streaks:i.filter(S=>S.type.startsWith("streak_")),variety:i.filter(S=>S.type.startsWith("artists_")||S.type.startsWith("channels_")),special:i.filter(S=>!S.type.startsWith("tracks_")&&!S.type.startsWith("hours_")&&!S.type.startsWith("streak_")&&!S.type.startsWith("artists_")&&!S.type.startsWith("channels_"))},w=i.filter(S=>S.unlocked).length,b=i.length,v=b>0?Math.round(w/b*100):0;return n?e.jsx(h,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:400},children:e.jsx(Ie,{})}):a?e.jsx(h,{sx:{p:3},children:e.jsx(pe,{severity:"error",children:a})}):e.jsxs(h,{children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:3,flexWrap:"wrap",gap:2},children:[e.jsxs(h,{children:[e.jsx(x,{variant:"h4",sx:{fontWeight:700,letterSpacing:"-0.02em"},children:" Achievements"}),e.jsx(x,{variant:"body2",color:"text.secondary",children:"Track your listening milestones and earn badges"})]}),e.jsx(N,{variant:"outlined",startIcon:e.jsx(qr,{}),onClick:j,children:"Check for New"})]}),u&&e.jsx(_e,{sx:{mb:3,bgcolor:u.streak_at_risk?"rgba(255, 152, 0, 0.1)":u.current_streak>0?"rgba(19, 236, 106, 0.1)":"background.paper",border:"1px solid",borderColor:u.streak_at_risk?"warning.main":u.current_streak>0?"primary.main":"divider"},children:e.jsxs(Pe,{children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:2,mb:2,flexWrap:"wrap"},children:[e.jsx(na,{sx:{fontSize:48,color:u.current_streak>0?"warning.main":"text.secondary",animation:u.current_streak>=7?"pulse 2s infinite":"none","@keyframes pulse":{"0%, 100%":{transform:"scale(1)"},"50%":{transform:"scale(1.1)"}}}}),e.jsxs(h,{sx:{flex:1,minWidth:200},children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1,flexWrap:"wrap"},children:[e.jsxs(x,{variant:"h4",sx:{fontWeight:700},children:[u.current_streak," Day Streak"]}),u.streak_at_risk&&e.jsx(ue,{label:" At Risk!",color:"warning",size:"small"}),u.current_streak>=7&&e.jsx(ue,{label:" On Fire!",color:"error",size:"small"})]}),e.jsx(x,{variant:"body2",color:"text.secondary",children:u.listened_today?"Great job! You've listened today. Keep it up!":"Listen to a track today to maintain your streak!"})]}),e.jsxs(h,{sx:{textAlign:"center",px:2,borderLeft:"1px solid",borderColor:"divider"},children:[e.jsx(x,{variant:"caption",color:"text.secondary",children:"Best Streak"}),e.jsx(x,{variant:"h5",sx:{fontWeight:700,color:"success.main"},children:u.longest_streak}),e.jsx(x,{variant:"caption",color:"text.secondary",children:"days"})]})]}),e.jsx(x,{variant:"subtitle2",sx:{mb:1},children:"This Week"}),e.jsx(h,{sx:{display:"flex",gap:1.5,justifyContent:"space-between"},children:u.recent_days.map(S=>e.jsx(ve,{title:`${S.day_name}: ${S.tracks_played} tracks played`,arrow:!0,children:e.jsxs(h,{sx:{textAlign:"center",flex:1},children:[e.jsx(x,{variant:"caption",sx:{color:S.has_activity?"primary.main":"text.secondary",fontWeight:S.has_activity?600:400},children:S.day_name}),e.jsx(h,{sx:{width:"100%",aspectRatio:"1",maxWidth:48,borderRadius:1.5,mx:"auto",mt:.5,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:S.has_activity?"primary.main":"rgba(255, 255, 255, 0.05)",color:S.has_activity?"background.dark":"text.secondary",fontWeight:700,fontSize:"0.875rem",transition:"all 0.3s ease",border:"2px solid",borderColor:S.has_activity?"primary.main":"transparent"},children:S.has_activity?S.tracks_played:""})]})},S.date))}),u.next_milestone&&u.current_streak>0&&e.jsxs(h,{sx:{mt:3},children:[e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",mb:.5},children:[e.jsxs(x,{variant:"body2",color:"text.secondary",children:["Next milestone: ",e.jsxs("strong",{children:[u.next_milestone,"-day streak"]})]}),e.jsxs(x,{variant:"body2",color:"primary.main",fontWeight:600,children:[u.days_to_milestone," days to go"]})]}),e.jsx(rt,{variant:"determinate",value:u.current_streak/u.next_milestone*100,sx:{height:8,borderRadius:1}})]})]})}),e.jsx(_e,{sx:{mb:3},children:e.jsx(Pe,{children:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(Ya,{sx:{fontSize:48,color:"warning.main"}}),e.jsxs(h,{sx:{flex:1},children:[e.jsxs(x,{variant:"h6",sx:{fontWeight:600,mb:.5},children:[w," of ",b," Achievements Unlocked"]}),e.jsx(rt,{variant:"determinate",value:v,sx:{height:10,borderRadius:1}})]}),e.jsxs(x,{variant:"h3",sx:{fontWeight:700,color:"primary.main",minWidth:80,textAlign:"right"},children:[v,"%"]})]})})}),e.jsxs(oi,{value:t,onChange:(S,A)=>r(A),variant:"scrollable",scrollButtons:"auto",sx:{mb:2,borderBottom:1,borderColor:"divider","& .MuiTab-root":{minHeight:48,textTransform:"none",fontWeight:500}},children:[e.jsx(Ut,{label:`All (${w}/${b})`,icon:e.jsx(Ya,{sx:{fontSize:20}}),iconPosition:"start"}),e.jsx(Ut,{label:`Tracks (${C.tracks.filter(S=>S.unlocked).length})`,icon:e.jsx(Ht,{sx:{fontSize:20}}),iconPosition:"start"}),e.jsx(Ut,{label:`Time (${C.time.filter(S=>S.unlocked).length})`,icon:e.jsx(no,{sx:{fontSize:20}}),iconPosition:"start"}),e.jsx(Ut,{label:`Streaks (${C.streaks.filter(S=>S.unlocked).length})`,icon:e.jsx(na,{sx:{fontSize:20}}),iconPosition:"start"}),e.jsx(Ut,{label:`Variety (${C.variety.filter(S=>S.unlocked).length})`,icon:e.jsx(jd,{sx:{fontSize:20}}),iconPosition:"start"}),e.jsx(Ut,{label:`Special (${C.special.filter(S=>S.unlocked).length})`,icon:e.jsx(fr,{sx:{fontSize:20}}),iconPosition:"start"})]}),e.jsx(Hr,{value:t,index:0,children:e.jsx(Vr,{achievements:i})}),e.jsx(Hr,{value:t,index:1,children:e.jsx(Vr,{achievements:C.tracks})}),e.jsx(Hr,{value:t,index:2,children:e.jsx(Vr,{achievements:C.time})}),e.jsx(Hr,{value:t,index:3,children:e.jsx(Vr,{achievements:C.streaks})}),e.jsx(Hr,{value:t,index:4,children:e.jsx(Vr,{achievements:C.variety})}),e.jsx(Hr,{value:t,index:5,children:e.jsx(Vr,{achievements:C.special})}),e.jsx(it,{open:f,autoHideDuration:4e3,onClose:()=>p(!1),message:g})]})}function Vr({achievements:t}){const r=[...t].sort((n,s)=>n.unlocked&&!s.unlocked?-1:!n.unlocked&&s.unlocked?1:s.progress-n.progress);return r.length===0?e.jsx(h,{sx:{textAlign:"center",py:4},children:e.jsx(x,{color:"text.secondary",children:"No achievements in this category"})}):e.jsx(ee,{container:!0,spacing:2,children:r.map(n=>e.jsx(ee,{item:!0,xs:12,sm:6,md:4,children:e.jsx(_e,{sx:{height:"100%",bgcolor:n.unlocked?"rgba(19, 236, 106, 0.08)":"background.paper",border:"1px solid",borderColor:n.unlocked?"primary.main":"divider",opacity:n.unlocked?1:.8,transition:"all 0.3s ease","&:hover":{transform:"translateY(-4px)",boxShadow:n.unlocked?"0 8px 24px rgba(19, 236, 106, 0.2)":"0 8px 24px rgba(0, 0, 0, 0.2)"}},children:e.jsxs(Pe,{children:[e.jsxs(h,{sx:{display:"flex",alignItems:"flex-start",gap:1.5,mb:2},children:[e.jsx(h,{sx:{fontSize:40,lineHeight:1,filter:n.unlocked?"none":"grayscale(100%)",opacity:n.unlocked?1:.5},children:n.icon}),e.jsxs(h,{sx:{flex:1,minWidth:0},children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(x,{variant:"subtitle1",sx:{fontWeight:600,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:n.name}),n.unlocked?e.jsx(Tr,{sx:{fontSize:18,color:"success.main",flexShrink:0}}):e.jsx(Th,{sx:{fontSize:16,color:"text.secondary",flexShrink:0}})]}),e.jsx(x,{variant:"body2",color:"text.secondary",sx:{mt:.25},children:n.description})]})]}),e.jsxs(h,{children:[e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",mb:.5},children:[e.jsx(x,{variant:"caption",color:"text.secondary",children:n.unlocked?"Completed!":"Progress"}),e.jsxs(x,{variant:"caption",sx:{fontWeight:600,color:n.unlocked?"success.main":"text.primary"},children:[typeof n.current=="number"&&n.current<1?n.current.toFixed(1):Math.floor(n.current)," / ",n.threshold]})]}),e.jsx(rt,{variant:"determinate",value:n.progress,color:n.unlocked?"success":"primary",sx:{height:8,borderRadius:1,bgcolor:"rgba(255, 255, 255, 0.1)"}})]})]})})},n.type))})}function By(){const t=new Date().getFullYear(),[r,n]=l.useState(t),[s,a]=l.useState(null),[o,i]=l.useState(!0),[c,u]=l.useState(""),d=Array.from({length:6},(m,y)=>t-y);l.useEffect(()=>{f()},[r]);const f=async()=>{try{i(!0),u("");const m=await Kt.yearlyWrapped(r);a(m.data)}catch(m){console.error("Failed to load yearly wrapped:",m),m.response?.status===404?u(`No listening data found for ${r}`):u("Failed to load yearly wrapped"),a(null)}finally{i(!1)}},p=m=>{if(m<60)return`${m} minutes`;const y=Math.floor(m/60);return y<24?`${y} hours`:`${Math.floor(y/24)} days, ${y%24} hours`},g=m=>m===null?"N/A":m===0?"12 AM":m===12?"12 PM":m>12?`${m-12} PM`:`${m} AM`;return o?e.jsx(h,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:400},children:e.jsx(Ie,{})}):e.jsxs(h,{sx:{pb:4},children:[e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4,flexWrap:"wrap",gap:2},children:[e.jsxs(h,{children:[e.jsxs(x,{variant:"h4",sx:{fontWeight:700},children:[" Your ",r," Wrapped"]}),e.jsx(x,{variant:"body1",color:"text.secondary",children:"A look back at your listening journey"})]}),e.jsxs(Ct,{size:"small",sx:{minWidth:120},children:[e.jsx(Wt,{children:"Year"}),e.jsx(Rt,{value:r,label:"Year",onChange:m=>n(Number(m.target.value)),children:d.map(m=>e.jsx(we,{value:m,children:m},m))})]})]}),c?e.jsxs(pe,{severity:"info",sx:{mb:3},children:[c,". Start listening to build your wrapped!"]}):s&&e.jsxs(e.Fragment,{children:[e.jsx(_e,{sx:{mb:4,background:"linear-gradient(135deg, rgba(19, 236, 106, 0.2) 0%, rgba(103, 58, 183, 0.2) 100%)",border:"2px solid",borderColor:"primary.main"},children:e.jsxs(Pe,{sx:{textAlign:"center",py:4},children:[e.jsx(x,{variant:"h5",sx:{mb:1},children:"Your Listening Personality"}),e.jsx(x,{variant:"h3",sx:{fontWeight:700,color:"primary.main"},children:s.listening_personality})]})}),e.jsxs(ee,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(ee,{item:!0,xs:6,md:3,children:e.jsx(La,{icon:e.jsx(no,{sx:{fontSize:32}}),label:"Minutes Listened",value:s.total_minutes_listened.toLocaleString(),subtitle:p(s.total_minutes_listened),color:"primary.main"})}),e.jsx(ee,{item:!0,xs:6,md:3,children:e.jsx(La,{icon:e.jsx(Ht,{sx:{fontSize:32}}),label:"Tracks Played",value:s.total_tracks_played.toLocaleString(),subtitle:`${s.total_unique_tracks} unique`,color:"secondary.main"})}),e.jsx(ee,{item:!0,xs:6,md:3,children:e.jsx(La,{icon:e.jsx(Va,{sx:{fontSize:32}}),label:"Artists Discovered",value:s.total_unique_artists.toString(),color:"warning.main"})}),e.jsx(ee,{item:!0,xs:6,md:3,children:e.jsx(La,{icon:e.jsx(na,{sx:{fontSize:32}}),label:"Longest Streak",value:`${s.longest_streak} days`,subtitle:`${s.total_listening_days} days active`,color:"error.main"})})]}),e.jsxs(ee,{container:!0,spacing:3,sx:{mb:4},children:[s.top_artist&&e.jsx(ee,{item:!0,xs:12,md:6,children:e.jsx(_e,{sx:{height:"100%"},children:e.jsxs(Pe,{children:[e.jsx(x,{variant:"overline",color:"text.secondary",children:"#1 Artist"}),e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:2,mt:1},children:[e.jsx(Ve,{sx:{width:64,height:64,bgcolor:"warning.main"},children:e.jsx(Va,{sx:{fontSize:32}})}),e.jsxs(h,{children:[e.jsx(x,{variant:"h5",sx:{fontWeight:700},children:s.top_artist.artist}),e.jsxs(x,{variant:"body2",color:"text.secondary",children:[s.top_artist.play_count," plays  ",s.top_artist.total_minutes," minutes"]})]})]})]})})}),s.top_track&&e.jsx(ee,{item:!0,xs:12,md:6,children:e.jsx(_e,{sx:{height:"100%"},children:e.jsxs(Pe,{children:[e.jsx(x,{variant:"overline",color:"text.secondary",children:"#1 Track"}),e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:2,mt:1},children:[s.top_track.thumbnail_url?e.jsx(Ve,{src:s.top_track.thumbnail_url,variant:"rounded",sx:{width:64,height:64}}):e.jsx(Ve,{sx:{width:64,height:64,bgcolor:"primary.main"},variant:"rounded",children:e.jsx(Ht,{sx:{fontSize:32}})}),e.jsxs(h,{sx:{overflow:"hidden"},children:[e.jsx(x,{variant:"h6",sx:{fontWeight:700},noWrap:!0,children:s.top_track.title}),e.jsx(x,{variant:"body2",color:"text.secondary",noWrap:!0,children:s.top_track.artist}),e.jsxs(x,{variant:"caption",color:"primary.main",children:[s.top_track.play_count," plays"]})]})]})]})})})]}),e.jsxs(ee,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(ee,{item:!0,xs:12,md:6,children:e.jsx(_e,{sx:{height:"100%"},children:e.jsxs(Pe,{children:[e.jsx(x,{variant:"h6",sx:{fontWeight:600,mb:2},children:" Top 5 Artists"}),s.top_5_artists.map((m,y)=>e.jsx(h,{sx:{mb:1.5},children:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(x,{variant:"h6",sx:{width:28,fontWeight:700,color:y===0?"warning.main":"text.secondary"},children:y+1}),e.jsxs(h,{sx:{flex:1,minWidth:0},children:[e.jsx(x,{variant:"body1",sx:{fontWeight:500},noWrap:!0,children:m.artist}),e.jsxs(x,{variant:"caption",color:"text.secondary",children:[m.play_count," plays"]})]})]})},m.artist))]})})}),e.jsx(ee,{item:!0,xs:12,md:6,children:e.jsx(_e,{sx:{height:"100%"},children:e.jsxs(Pe,{children:[e.jsx(x,{variant:"h6",sx:{fontWeight:600,mb:2},children:" Top 5 Tracks"}),s.top_5_tracks.map((m,y)=>e.jsx(h,{sx:{mb:1.5},children:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(x,{variant:"h6",sx:{width:28,fontWeight:700,color:y===0?"warning.main":"text.secondary"},children:y+1}),m.thumbnail_url&&e.jsx(Ve,{src:m.thumbnail_url,variant:"rounded",sx:{width:40,height:40}}),e.jsxs(h,{sx:{flex:1,minWidth:0},children:[e.jsx(x,{variant:"body2",sx:{fontWeight:500},noWrap:!0,children:m.title}),e.jsxs(x,{variant:"caption",color:"text.secondary",noWrap:!0,children:[m.artist,"  ",m.play_count," plays"]})]})]})},m.youtube_id))]})})})]}),e.jsx(_e,{sx:{mb:4},children:e.jsxs(Pe,{children:[e.jsx(x,{variant:"h6",sx:{fontWeight:600,mb:2},children:" Monthly Listening"}),e.jsx(h,{sx:{display:"flex",gap:1,alignItems:"flex-end",height:150},children:s.monthly_minutes.map(m=>{const y=Math.max(...s.monthly_minutes.map(C=>C.minutes),1),j=m.minutes/y*100;return e.jsxs(h,{sx:{flex:1,display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsx(h,{sx:{width:"100%",height:`${j}%`,minHeight:4,bgcolor:m.month===s.peak_month?"primary.main":"rgba(19, 236, 106, 0.3)",borderRadius:"4px 4px 0 0",transition:"all 0.3s ease","&:hover":{bgcolor:"primary.main"}}}),e.jsx(x,{variant:"caption",sx:{mt:.5,fontSize:"0.65rem",color:m.month===s.peak_month?"primary.main":"text.secondary",fontWeight:m.month===s.peak_month?600:400},children:m.month.substring(0,3)})]},m.month_num)})}),e.jsxs(h,{sx:{mt:2,display:"flex",gap:2,justifyContent:"center",flexWrap:"wrap"},children:[e.jsx(ue,{icon:e.jsx(so,{}),label:`Peak Month: ${s.peak_month}`,color:"primary",variant:"outlined"}),e.jsx(ue,{icon:s.peak_hour!==null&&s.peak_hour>=18?e.jsx(zh,{}):e.jsx(Oh,{}),label:`Peak Time: ${g(s.peak_hour)}`,variant:"outlined"}),e.jsx(ue,{label:`Favorite Day: ${s.peak_day_of_week}`,variant:"outlined"})]})]})}),e.jsx(_e,{children:e.jsxs(Pe,{sx:{textAlign:"center"},children:[e.jsx(Ya,{sx:{fontSize:48,color:"warning.main",mb:1}}),e.jsxs(x,{variant:"h5",sx:{fontWeight:600},children:[s.achievements_unlocked," Achievements Unlocked"]}),e.jsxs(x,{variant:"body2",color:"text.secondary",children:["in ",r]})]})})]})]})}function La({icon:t,label:r,value:n,subtitle:s,color:a}){return e.jsx(_e,{sx:{height:"100%"},children:e.jsxs(Pe,{children:[e.jsx(h,{sx:{color:a,mb:1},children:t}),e.jsx(x,{variant:"overline",color:"text.secondary",sx:{fontSize:"0.7rem"},children:r}),e.jsx(x,{variant:"h4",sx:{fontWeight:700,color:a},children:n}),s&&e.jsx(x,{variant:"caption",color:"text.secondary",children:s})]})})}const qy=t=>{const r=Math.floor(t/60),n=t%60;return`${r}:${n.toString().padStart(2,"0")}`},Ny=t=>{const r=new Date(t),s=new Date().getTime()-r.getTime(),a=Math.floor(s/6e4),o=Math.floor(s/36e5),i=Math.floor(s/864e5);return a<1?"Just now":a<60?`${a}m ago`:o<24?`${o}h ago`:i<7?`${i}d ago`:r.toLocaleDateString()},Uy=l.memo(({entry:t,onPlay:r})=>{const n=Pt();return e.jsxs(Le,{sx:{borderRadius:2,mb:.5,cursor:"pointer",transition:"background-color 0.15s ease","&:hover":{bgcolor:$e(n.palette.primary.main,.08)}},onClick:()=>r(t),children:[e.jsx(Ft,{children:e.jsx(Ve,{src:t.thumbnail_url,variant:"rounded",sx:{width:56,height:56,boxShadow:2},children:e.jsx(Ht,{})})}),e.jsx(ke,{primary:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(x,{variant:"body1",fontWeight:500,noWrap:!0,sx:{maxWidth:"70%"},children:t.title}),t.completed&&e.jsx(ue,{label:"",size:"small",color:"success",variant:"outlined",sx:{height:18,fontSize:"0.65rem",minWidth:24}})]}),secondary:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1,mt:.5},children:[e.jsx(x,{variant:"body2",color:"text.secondary",noWrap:!0,children:t.artist||t.channel_name}),e.jsx(x,{variant:"caption",color:"text.disabled",children:""}),e.jsx(x,{variant:"caption",color:"text.secondary",children:qy(t.duration_listened)})]}),sx:{ml:1}}),e.jsx(Ar,{children:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ve,{title:new Date(t.listened_at).toLocaleString(),children:e.jsx(x,{variant:"caption",color:"text.secondary",children:Ny(t.listened_at)})}),e.jsx(X,{size:"small",color:"primary",onClick:s=>{s.stopPropagation(),r(t)},children:e.jsx(ar,{})})]})})]})}),Hy=l.memo(({label:t,count:r,isExpanded:n,onToggle:s})=>e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1,mb:1,cursor:"pointer",userSelect:"none",py:.5},onClick:s,children:[t==="Today"&&e.jsx(Fh,{color:"primary",fontSize:"small"}),t==="Yesterday"&&e.jsx(no,{color:"secondary",fontSize:"small"}),!["Today","Yesterday"].includes(t)&&e.jsx(so,{color:"action",fontSize:"small"}),e.jsx(x,{variant:"subtitle1",fontWeight:600,color:"text.primary",children:t}),e.jsx(ue,{label:r,size:"small",variant:"outlined",sx:{height:20,fontSize:"0.7rem"}}),e.jsx(h,{sx:{flex:1}}),e.jsx(X,{size:"small",children:n?e.jsx(Sd,{}):e.jsx(Cd,{})})]}));function Vy({onTrackSelect:t}){const r=Pt(),[n,s]=l.useState([]),[a,o]=l.useState({}),[i,c]=l.useState(!0),[u,d]=l.useState(!1),[f,p]=l.useState(1),[g,m]=l.useState(1),[y,j]=l.useState(null),[C,w]=l.useState(!1),[b,v]=l.useState(!1),[S,A]=l.useState(new Set),[E,P]=l.useState(!0);l.useEffect(()=>{const _=J=>{const M=J.target;M&&v(M.scrollTop>400)},D=(()=>{let J=document.querySelector("[data-history-page]")?.parentElement;for(;J;){const M=window.getComputedStyle(J);if(M.overflow==="auto"||M.overflowY==="auto"||M.overflow==="scroll"||M.overflowY==="scroll")return J;J=J.parentElement}return null})();if(D)return D.addEventListener("scroll",_,{passive:!0}),()=>D.removeEventListener("scroll",_);const Q=()=>{const J=window.scrollY||document.documentElement.scrollTop;v(J>400)};return window.addEventListener("scroll",Q,{passive:!0}),()=>window.removeEventListener("scroll",Q)},[]);const k=l.useCallback(()=>{const O=(()=>{let D=document.querySelector("[data-history-page]")?.parentElement;for(;D;){const Q=window.getComputedStyle(D);if(Q.overflow==="auto"||Q.overflowY==="auto"||Q.overflow==="scroll"||Q.overflowY==="scroll")return D;D=D.parentElement}return null})();O?O.scrollTo({top:0,behavior:"smooth"}):window.scrollTo({top:0,behavior:"smooth"})},[]),R=l.useCallback(async(_=1,O=!1)=>{try{_===1?c(!0):d(!0),j(null);const D=await Kt.history({page:_,page_size:100});s(O?Q=>[...Q,...D.data.results]:D.data.results),p(_),m(D.data.total_pages)}catch(D){j(D.message||"Failed to load history")}finally{c(!1),d(!1)}},[]),z=l.useCallback(async()=>{try{const _=await Kt.onThisDay();o(_.data)}catch(_){console.error("Failed to load On This Day data:",_)}},[]);l.useEffect(()=>{R(),z()},[R,z]);const B=l.useMemo(()=>{if(n.length===0)return[];const _={},O=new Date,D=new Date(O.getFullYear(),O.getMonth(),O.getDate()),Q=new Date(D.getTime()-1440*60*1e3),J=new Date(D.getTime()-D.getDay()*24*60*60*1e3),M=new Date(J.getTime()-10080*60*1e3),T=new Date(O.getFullYear(),O.getMonth(),1),te=new Date(O.getFullYear(),O.getMonth()-1,1);for(const ce of n){const q=new Date(ce.listened_at);let oe;q>=D?oe="Today":q>=Q?oe="Yesterday":q>=J?oe="This Week":q>=M?oe="Last Week":q>=T?oe="This Month":q>=te?oe="Last Month":oe=q.toLocaleDateString("en-US",{month:"long",year:"numeric"}),_[oe]||(_[oe]=[]),_[oe].push(ce)}const $=["Today","Yesterday","This Week","Last Week","This Month","Last Month"],U=[];for(const ce of $)_[ce]&&(U.push({label:ce,entries:_[ce]}),delete _[ce]);const K=Object.keys(_).sort((ce,q)=>{const oe=new Date(_[ce][0].listened_at);return new Date(_[q][0].listened_at).getTime()-oe.getTime()});for(const ce of K)U.push({label:ce,entries:_[ce]});return U},[n]),F=l.useCallback(_=>{if(t){const O={id:_.audio_id,youtube_id:_.youtube_id,title:_.title,channel_name:_.channel_name,thumbnail_url:_.thumbnail_url,duration:_.duration_listened,file_size:0,play_count:0,is_favorite:!1};t(O)}},[t]),W=l.useCallback(async _=>{try{await Kt.clearHistory(_),w(!1),R(),z()}catch(O){console.error("Failed to clear history:",O)}},[R,z]),H=l.useCallback(_=>{A(O=>{const D=new Set(O);return D.has(_)?D.delete(_):D.add(_),D})},[]),I=l.useMemo(()=>Object.keys(a).length>0?e.jsx(_e,{sx:{mb:3,background:`linear-gradient(135deg, ${$e(r.palette.secondary.main,.1)} 0%, ${$e(r.palette.primary.main,.1)} 100%)`,border:`1px solid ${$e(r.palette.secondary.main,.2)}`},children:e.jsxs(Pe,{children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",userSelect:"none",mb:E?2:0},onClick:()=>P(O=>!O),children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Lh,{color:"secondary"}),e.jsx(x,{variant:"h6",fontWeight:600,children:"On This Day"}),e.jsx(ue,{label:`${Object.keys(a).length} memories`,size:"small",color:"secondary",variant:"outlined"})]}),e.jsx(X,{size:"small",children:E?e.jsx(Sd,{}):e.jsx(Cd,{})})]}),e.jsx(Yo,{in:E,timeout:200,children:e.jsx(ee,{container:!0,spacing:2,children:Object.entries(a).map(([O,D])=>e.jsx(ee,{item:!0,xs:12,md:4,children:e.jsxs(yt,{sx:{p:2,bgcolor:$e(r.palette.background.paper,.8),height:"100%"},children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(so,{fontSize:"small",color:"primary"}),e.jsx(x,{variant:"subtitle1",fontWeight:600,children:D.label})]}),e.jsx(x,{variant:"caption",color:"text.secondary",display:"block",mb:1,children:new Date(D.date).toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"})}),e.jsx(Qe,{dense:!0,sx:{py:0},children:D.tracks.slice(0,3).map(Q=>e.jsxs(Le,{sx:{px:0,cursor:"pointer",borderRadius:1,"&:hover":{bgcolor:$e(r.palette.primary.main,.1)}},onClick:()=>F(Q),children:[e.jsx(Ft,{sx:{minWidth:48},children:e.jsx(Ve,{src:Q.thumbnail_url,variant:"rounded",sx:{width:40,height:40},children:e.jsx(Ht,{})})}),e.jsx(ke,{primary:Q.title,secondary:Q.artist||Q.channel_name,primaryTypographyProps:{noWrap:!0,fontSize:"0.875rem",fontWeight:500},secondaryTypographyProps:{noWrap:!0,fontSize:"0.75rem"}}),e.jsx(X,{size:"small",color:"primary",onClick:J=>{J.stopPropagation(),F(Q)},children:e.jsx(ar,{fontSize:"small"})})]},Q.id))}),D.tracks.length>3&&e.jsxs(x,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:["+",D.tracks.length-3," more tracks"]})]})},O))})})]})}):null,[a,E,r,F]);return i?e.jsxs(h,{sx:{p:3},children:[e.jsx(Mi,{variant:"rectangular",height:200,sx:{mb:3,borderRadius:2}}),[1,2,3,4,5].map(_=>e.jsx(Mi,{variant:"rectangular",height:72,sx:{mb:1,borderRadius:2}},_))]}):y?e.jsxs(h,{sx:{p:3},children:[e.jsx(pe,{severity:"error",sx:{mb:2},children:y}),e.jsx(N,{variant:"contained",onClick:()=>R(),children:"Retry"})]}):e.jsxs(h,{"data-history-page":!0,sx:{p:{xs:2,md:3},maxWidth:1200,mx:"auto"},children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:3},children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(gd,{sx:{fontSize:32,color:"primary.main"}}),e.jsxs(h,{children:[e.jsx(x,{variant:"h4",fontWeight:700,children:"Listening History"}),e.jsxs(x,{variant:"body2",color:"text.secondary",children:[n.length," tracks in your history"]})]})]}),e.jsxs(h,{sx:{display:"flex",gap:1},children:[e.jsx(ve,{title:"Refresh",children:e.jsx(X,{onClick:()=>{R(),z()},children:e.jsx(qr,{})})}),e.jsx(N,{variant:"outlined",color:"error",startIcon:e.jsx(Er,{}),onClick:()=>w(!0),children:"Clear"})]})]}),I,B.length===0?e.jsxs(_e,{sx:{textAlign:"center",py:8},children:[e.jsx(Ht,{sx:{fontSize:64,color:"text.disabled",mb:2}}),e.jsx(x,{variant:"h6",color:"text.secondary",children:"No listening history yet"}),e.jsx(x,{variant:"body2",color:"text.disabled",children:"Start playing some music to build your history!"})]}):B.map(_=>{const O=!S.has(_.label);return e.jsxs(h,{sx:{mb:3},children:[e.jsx(Hy,{label:_.label,count:_.entries.length,isExpanded:O,onToggle:()=>H(_.label)}),e.jsx(Yo,{in:O,timeout:150,unmountOnExit:!0,children:e.jsx(_e,{variant:"outlined",sx:{borderRadius:2},children:e.jsxs(Qe,{sx:{py:0},children:[_.entries.slice(0,50).map((D,Q)=>e.jsxs(h,{children:[e.jsx(Uy,{entry:D,onPlay:F}),Q<Math.min(_.entries.length,50)-1&&e.jsx(Ee,{variant:"inset"})]},D.id)),_.entries.length>50&&e.jsx(h,{sx:{p:2,textAlign:"center"},children:e.jsxs(x,{variant:"caption",color:"text.secondary",children:["Showing first 50 of ",_.entries.length," tracks"]})})]})})})]},_.label)}),f<g&&e.jsx(h,{sx:{display:"flex",justifyContent:"center",mt:3},children:e.jsx(N,{variant:"outlined",onClick:()=>R(f+1,!0),disabled:u,startIcon:u?e.jsx(Ie,{size:16}):null,children:u?"Loading...":"Load More"})}),e.jsxs(Ke,{open:C,onClose:()=>w(!1),children:[e.jsx(tt,{children:"Clear Listening History"}),e.jsxs(Xe,{children:[e.jsx(x,{gutterBottom:!0,children:"Choose how much history to clear:"}),e.jsxs(h,{sx:{display:"flex",flexDirection:"column",gap:1,mt:2},children:[e.jsx(N,{variant:"outlined",onClick:()=>W(7),fullWidth:!0,children:"Clear older than 1 week"}),e.jsx(N,{variant:"outlined",onClick:()=>W(30),fullWidth:!0,children:"Clear older than 1 month"}),e.jsx(N,{variant:"outlined",onClick:()=>W(90),fullWidth:!0,children:"Clear older than 3 months"}),e.jsx(Ee,{sx:{my:1}}),e.jsx(N,{variant:"contained",color:"error",onClick:()=>W(),fullWidth:!0,children:"Clear All History"})]})]}),e.jsx(nt,{children:e.jsx(N,{onClick:()=>w(!1),children:"Cancel"})})]}),e.jsx(id,{in:b,children:e.jsx(ld,{color:"primary",size:"medium",onClick:k,sx:{position:"fixed",bottom:{xs:80,md:24},right:24,zIndex:1e3},"aria-label":"scroll to top",children:e.jsx(Wh,{})})})]})}function Yy({children:t}){const[r,n]=l.useState(!0),[s,a]=l.useState(!1);return l.useEffect(()=>{(async()=>{try{const c=(await V.get("/user/account/")).data;a(c.is_admin||c.is_superuser||c.is_staff)}catch(i){console.error("Error checking admin status:",i),a(!1)}finally{n(!1)}})()},[]),r?e.jsx(h,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:e.jsx(Ie,{})}):s?e.jsx(e.Fragment,{children:t}):e.jsx(Rd,{to:"/",replace:!0})}var xs={},vc;function Gy(){if(vc)return xs;vc=1;var t=ne();Object.defineProperty(xs,"__esModule",{value:!0}),xs.default=void 0;var r=t(ae()),n=se();return xs.default=(0,r.default)((0,n.jsx)("path",{d:"M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"}),"Home"),xs}var Qy=Gy();const Ky=re(Qy);var ps={},jc;function Xy(){if(jc)return ps;jc=1;var t=ne();Object.defineProperty(ps,"__esModule",{value:!0}),ps.default=void 0;var r=t(ae()),n=se();return ps.default=(0,r.default)((0,n.jsx)("path",{d:"M20 2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m-2 5h-3v5.5c0 1.38-1.12 2.5-2.5 2.5S10 13.88 10 12.5s1.12-2.5 2.5-2.5c.57 0 1.08.19 1.5.51V5h4zM4 6H2v14c0 1.1.9 2 2 2h14v-2H4z"}),"LibraryMusic"),ps}var Jy=Xy();const Zy=re(Jy);var ms={},wc;function eb(){if(wc)return ms;wc=1;var t=ne();Object.defineProperty(ms,"__esModule",{value:!0}),ms.default=void 0;var r=t(ae()),n=se();return ms.default=(0,r.default)((0,n.jsx)("path",{d:"M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6"}),"Settings"),ms}var tb=eb();const rb=re(tb);var gs={},Sc;function nb(){if(Sc)return gs;Sc=1;var t=ne();Object.defineProperty(gs,"__esModule",{value:!0}),gs.default=void 0;var r=t(ae()),n=se();return gs.default=(0,r.default)((0,n.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M14 13v4h-4v-4H7l5-5 5 5z"}),"CloudUpload"),gs}var sb=nb();const Vu=re(sb);var ys={},Cc;function ab(){if(Cc)return ys;Cc=1;var t=ne();Object.defineProperty(ys,"__esModule",{value:!0}),ys.default=void 0;var r=t(ae()),n=se();return ys.default=(0,r.default)((0,n.jsx)("path",{d:"m19 9 1.25-2.75L23 5l-2.75-1.25L19 1l-1.25 2.75L15 5l2.75 1.25zm-7.5.5L9 4 6.5 9.5 1 12l5.5 2.5L9 20l2.5-5.5L17 12zM19 15l-1.25 2.75L15 19l2.75 1.25L19 23l1.25-2.75L23 19l-2.75-1.25z"}),"AutoAwesome"),ys}var ob=ab();const eo=re(ob);var bs={},kc;function ib(){if(kc)return bs;kc=1;var t=ne();Object.defineProperty(bs,"__esModule",{value:!0}),bs.default=void 0;var r=t(ae()),n=se();return bs.default=(0,r.default)([(0,n.jsx)("path",{d:"M21 8c-1.45 0-2.26 1.44-1.93 2.51l-3.55 3.56c-.3-.09-.74-.09-1.04 0l-2.55-2.55C12.27 10.45 11.46 9 10 9c-1.45 0-2.27 1.44-1.93 2.52l-4.56 4.55C2.44 15.74 1 16.55 1 18c0 1.1.9 2 2 2 1.45 0 2.26-1.44 1.93-2.51l4.55-4.56c.3.09.74.09 1.04 0l2.55 2.55C12.73 16.55 13.54 18 15 18c1.45 0 2.27-1.44 1.93-2.52l3.56-3.55c1.07.33 2.51-.48 2.51-1.93 0-1.1-.9-2-2-2"},"0"),(0,n.jsx)("path",{d:"m15 9 .94-2.07L18 6l-2.06-.93L15 3l-.92 2.07L12 6l2.08.93zM3.5 11 4 9l2-.5L4 8l-.5-2L3 8l-2 .5L3 9z"},"1")],"Insights"),bs}var lb=ib();const cb=re(lb);var vs={},_c;function db(){if(_c)return vs;_c=1;var t=ne();Object.defineProperty(vs,"__esModule",{value:!0}),vs.default=void 0;var r=t(ae()),n=se();return vs.default=(0,r.default)((0,n.jsx)("path",{d:"M19 5h-2V3H7v2H5c-1.1 0-2 .9-2 2v1c0 2.55 1.92 4.63 4.39 4.94.63 1.5 1.98 2.63 3.61 2.96V19H7v2h10v-2h-4v-3.1c1.63-.33 2.98-1.46 3.61-2.96C19.08 12.63 21 10.55 21 8V7c0-1.1-.9-2-2-2M5 8V7h2v3.82C5.84 10.4 5 9.3 5 8m14 0c0 1.3-.84 2.4-2 2.82V7h2z"}),"EmojiEvents"),vs}var ub=db();const hb=re(ub);var js={},Rc;function fb(){if(Rc)return js;Rc=1;var t=ne();Object.defineProperty(js,"__esModule",{value:!0}),js.default=void 0;var r=t(ae()),n=se();return js.default=(0,r.default)((0,n.jsx)("path",{d:"M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2m-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1M9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1m11 15H4v-2h16zm0-5H4V8h5.08L7 10.83 8.62 12 11 8.76l1-1.36 1 1.36L15.38 12 17 10.83 14.92 8H20z"}),"CardGiftcard"),js}var xb=fb();const pb=re(xb),mb=[{title:"Home",path:"/",icon:e.jsx(Ky,{})},{title:"Search",path:"/search",icon:e.jsx(wr,{})},{title:"Library",path:"/library",icon:e.jsx(Zy,{})},{title:"Favorites",path:"/favorites",icon:e.jsx(ya,{})},{title:"History",path:"/history",icon:e.jsx(Gs,{})},{title:"Channels",path:"/channels",icon:e.jsx(en,{})},{title:"Playlists",path:"/playlists",icon:e.jsx(oa,{})},{title:"Smart Playlists",path:"/smart-playlists",icon:e.jsx(eo,{})},{title:"Analytics",path:"/analytics",icon:e.jsx(cb,{})},{title:"Achievements",path:"/achievements",icon:e.jsx(hb,{})},{title:"Yearly Wrapped",path:"/wrapped",icon:e.jsx(pb,{})},{title:"Local Files",path:"/local-files",icon:e.jsx(Vu,{})},{title:"Offline",path:"/offline",icon:e.jsx(Wu,{}),isPWA:!0}];function gb({mobileOpen:t=!1,onMobileClose:r}){const n=Dt(),s=_d(),a=i=>{n(i),r&&r()},o=e.jsxs(h,{sx:{width:240,bgcolor:"background.default",display:"flex",flexDirection:"column",height:"100%"},children:[e.jsxs(h,{sx:{p:2,display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(h,{component:"img",src:"/img/logo.png",alt:"SoundWave",sx:{width:40,height:40,borderRadius:"50%",objectFit:"cover"}}),e.jsx(h,{sx:{fontWeight:700,fontSize:20,letterSpacing:"-0.02em"},children:"SoundWave"})]}),e.jsx(Qe,{sx:{flexGrow:1,px:1.5,py:2},children:mb.map(i=>e.jsx(Le,{disablePadding:!0,sx:{mb:1},children:e.jsxs(tr,{selected:s.pathname===i.path,onClick:()=>a(i.path),sx:{borderRadius:"9999px",py:1.5,px:2,transition:"all 0.3s ease","&.Mui-selected":{bgcolor:"rgba(19, 236, 106, 0.15)",color:"primary.main","&:hover":{bgcolor:"rgba(19, 236, 106, 0.2)"}},"&:not(.Mui-selected)":{color:"text.secondary","&:hover":{bgcolor:"rgba(255, 255, 255, 0.05)",color:"text.primary"}}},children:[e.jsx(Ge,{sx:{color:"inherit",minWidth:36},children:i.icon}),e.jsx(ke,{primary:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:.5},children:[i.title,i.isPWA&&e.jsx(ue,{label:"PWA",size:"small",sx:{height:16,fontSize:"0.6rem",fontWeight:700,bgcolor:"success.main",color:"white","& .MuiChip-label":{px:.5}}})]}),primaryTypographyProps:{fontWeight:s.pathname===i.path?600:500,fontSize:"0.875rem"}})]})},i.path))}),e.jsx(h,{sx:{p:1.5,pb:2},children:e.jsxs(tr,{selected:s.pathname==="/settings",onClick:()=>a("/settings"),sx:{borderRadius:"9999px",py:1.5,px:2,transition:"all 0.3s ease","&.Mui-selected":{bgcolor:"rgba(19, 236, 106, 0.15)",color:"primary.main","&:hover":{bgcolor:"rgba(19, 236, 106, 0.2)"}},"&:not(.Mui-selected)":{color:"text.secondary","&:hover":{bgcolor:"rgba(255, 255, 255, 0.05)",color:"text.primary"}}},children:[e.jsx(Ge,{sx:{color:"inherit",minWidth:36},children:e.jsx(rb,{})}),e.jsx(ke,{primary:"Settings",primaryTypographyProps:{fontWeight:s.pathname==="/settings"?600:500,fontSize:"0.875rem"}})]})})]});return e.jsxs(e.Fragment,{children:[e.jsx(kd,{variant:"temporary",open:t,onClose:r,ModalProps:{keepMounted:!0},sx:{display:{xs:"block",md:"none"},"& .MuiDrawer-paper":{boxSizing:"border-box",width:240,bgcolor:"background.default",borderRight:"1px solid",borderColor:"rgba(255, 255, 255, 0.05)"}},children:o}),e.jsx(h,{sx:{width:240,flexShrink:0,display:{xs:"none",md:"block"},borderRight:"1px solid",borderColor:"rgba(255, 255, 255, 0.05)"},children:o})]})}var ws={},Ic;function yb(){if(Ic)return ws;Ic=1;var t=ne();Object.defineProperty(ws,"__esModule",{value:!0}),ws.default=void 0;var r=t(ae()),n=se();return ws.default=(0,r.default)((0,n.jsx)("path",{d:"M3 18h18v-2H3zm0-5h18v-2H3zm0-7v2h18V6z"}),"Menu"),ws}var bb=yb();const vb=re(bb);var Ss={},Ac;function jb(){if(Ac)return Ss;Ac=1;var t=ne();Object.defineProperty(Ss,"__esModule",{value:!0}),Ss.default=void 0;var r=t(ae()),n=se();return Ss.default=(0,r.default)((0,n.jsx)("path",{d:"m17 7-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4z"}),"Logout"),Ss}var wb=jb();const Sb=re(wb);var Cs={},Pc;function Cb(){if(Pc)return Cs;Pc=1;var t=ne();Object.defineProperty(Cs,"__esModule",{value:!0}),Cs.default=void 0;var r=t(ae()),n=se();return Cs.default=(0,r.default)((0,n.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close"),Cs}var kb=Cb();const Gt=re(kb);function _b({open:t,onClose:r,currentAvatar:n,onAvatarChange:s}){const[a,o]=l.useState(null),[i,c]=l.useState(!1),[u,d]=l.useState(null),[f,p]=l.useState(null),g=[1,2,3,4,5],m=async w=>{d(null),p(null),o(w);try{const b=await fetch("/api/user/avatar/preset/",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Token ${localStorage.getItem("token")}`},body:JSON.stringify({preset:w})});if(!b.ok)throw new Error("Failed to set preset avatar");const v=await b.json();p("Avatar updated successfully!"),s(`/avatars/preset_${w}.svg`)}catch(b){d(b instanceof Error?b.message:"Failed to set preset avatar")}},y=async w=>{const b=w.target.files?.[0];if(!b)return;if(b.size>20*1024*1024){d("File too large. Maximum size is 20MB");return}if(!["image/jpeg","image/png","image/gif","image/webp"].includes(b.type)){d("Invalid file type. Please upload JPEG, PNG, GIF, or WebP");return}d(null),p(null),c(!0),o(null);const v=new FormData;v.append("avatar",b);try{const S=await fetch("/api/user/avatar/upload/",{method:"POST",headers:{Authorization:`Token ${localStorage.getItem("token")}`},body:v});if(!S.ok){const P=await S.json();throw new Error(P.error||"Failed to upload avatar")}const A=await S.json();p("Avatar uploaded successfully!");const E=A.avatar.split("/").pop();s(`/api/user/avatar/file/${E}/`)}catch(S){d(S instanceof Error?S.message:"Failed to upload avatar")}finally{c(!1)}},j=async()=>{d(null),p(null);try{if(!(await fetch("/api/user/avatar/upload/",{method:"DELETE",headers:{Authorization:`Token ${localStorage.getItem("token")}`}})).ok)throw new Error("Failed to remove avatar");p("Avatar removed successfully!"),o(null),s(null)}catch(w){d(w instanceof Error?w.message:"Failed to remove avatar")}},C=w=>n?.includes(`preset_${w}`);return e.jsxs(Ke,{open:t,onClose:r,maxWidth:"sm",fullWidth:!0,children:[e.jsx(tt,{children:e.jsxs(h,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsx(x,{variant:"h6",children:"Choose Your Avatar"}),e.jsx(X,{onClick:r,size:"small",children:e.jsx(Gt,{})})]})}),e.jsxs(Xe,{children:[u&&e.jsx(pe,{severity:"error",sx:{mb:2},onClose:()=>d(null),children:u}),f&&e.jsx(pe,{severity:"success",sx:{mb:2},onClose:()=>p(null),children:f}),e.jsx(x,{variant:"subtitle2",gutterBottom:!0,sx:{mt:1},children:"Preset Avatars"}),e.jsx(ee,{container:!0,spacing:2,sx:{mb:3},children:g.map(w=>e.jsx(ee,{item:!0,xs:4,sm:2.4,children:e.jsxs(h,{sx:{position:"relative",cursor:"pointer","&:hover":{opacity:.8}},onClick:()=>m(w),children:[e.jsx(Ve,{src:`/avatars/preset_${w}.svg`,sx:{width:80,height:80,border:C(w)?"3px solid":"2px solid",borderColor:C(w)?"primary.main":"rgba(255, 255, 255, 0.1)"}}),C(w)&&e.jsx(ua,{sx:{position:"absolute",top:-8,right:-8,color:"primary.main",bgcolor:"background.paper",borderRadius:"50%"}})]})},w))}),e.jsx(x,{variant:"subtitle2",gutterBottom:!0,children:"Custom Avatar"}),e.jsx(h,{sx:{border:"2px dashed",borderColor:"rgba(255, 255, 255, 0.2)",borderRadius:2,p:3,textAlign:"center",bgcolor:"rgba(255, 255, 255, 0.02)"},children:i?e.jsx(Ie,{size:40}):e.jsxs(e.Fragment,{children:[e.jsx("input",{accept:"image/jpeg,image/png,image/gif,image/webp",style:{display:"none"},id:"avatar-upload",type:"file",onChange:y}),e.jsx("label",{htmlFor:"avatar-upload",children:e.jsx(N,{variant:"outlined",component:"span",startIcon:e.jsx(Vu,{}),sx:{mb:1},children:"Upload Image"})}),e.jsx(x,{variant:"caption",display:"block",color:"text.secondary",children:"Max 20MB  JPEG, PNG, GIF, WebP"})]})})]}),e.jsxs(nt,{sx:{px:3,pb:2},children:[n&&e.jsx(N,{onClick:j,startIcon:e.jsx(jo,{}),color:"error",sx:{mr:"auto"},children:"Remove Avatar"}),e.jsx(N,{onClick:r,children:"Close"})]})]})}class Rb{swRegistration=null;isSupported=!1;authToken=null;statusPollingInterval=null;statusListeners=new Set;constructor(){this.checkSupport(),this.setupServiceWorker(),this.setupNetworkListeners()}checkSupport(){this.isSupported="serviceWorker"in navigator&&"SyncManager"in window,console.log("[BackgroundDownload] Support:",{serviceWorker:"serviceWorker"in navigator,syncManager:"SyncManager"in window,periodicSync:"PeriodicSyncManager"in window})}async setupServiceWorker(){if("serviceWorker"in navigator)try{if(this.swRegistration=await navigator.serviceWorker.ready,console.log("[BackgroundDownload] Service Worker ready"),"periodicSync"in this.swRegistration)try{(await navigator.permissions.query({name:"periodic-background-sync"})).state==="granted"&&(await this.swRegistration.periodicSync.register("check-download-status",{minInterval:60*1e3}),console.log("[BackgroundDownload] Periodic sync registered"))}catch{console.log("[BackgroundDownload] Periodic sync not available")}navigator.serviceWorker.addEventListener("message",this.handleServiceWorkerMessage.bind(this))}catch(r){console.error("[BackgroundDownload] Setup error:",r)}}setupNetworkListeners(){window.addEventListener("online",()=>{console.log("[BackgroundDownload] Network online, triggering sync"),this.triggerSync()})}handleServiceWorkerMessage(r){const{type:n,...s}=r.data||{};if(n==="GET_AUTH_TOKEN"){const a=this.authToken||localStorage.getItem("token");r.ports?.[0]?.postMessage({token:a})}n==="DOWNLOAD_STATUS_UPDATE"&&this.notifyStatusListeners(s.downloads),n==="PLAY_AUDIO"&&window.dispatchEvent(new CustomEvent("playAudio",{detail:s}))}setAuthToken(r){this.authToken=r,r&&this.swRegistration&&this.sendMessage("UPDATE_AUTH_TOKEN",{authToken:r})}async queueDownload(r,n){const s=this.authToken||localStorage.getItem("token");if(!s)return{success:!1,error:"Not authenticated"};if(navigator.onLine&&!this.isSupported)return this.directDownload(r,s);try{return await this.sendMessage("QUEUE_DOWNLOAD",{url:r,title:n,authToken:s})}catch(a){return console.error("[BackgroundDownload] Queue error:",a),navigator.onLine?this.directDownload(r,s):{success:!1,error:"Failed to queue download"}}}async queueDownloads(r){const n=this.authToken||localStorage.getItem("token");if(!n)return{success:!1,error:"Not authenticated"};if(navigator.onLine&&!this.isSupported)return this.directDownloadBatch(r.map(s=>s.url),n);try{return await this.sendMessage("QUEUE_DOWNLOADS_BATCH",{downloads:r,authToken:n})}catch(s){return console.error("[BackgroundDownload] Batch queue error:",s),navigator.onLine?this.directDownloadBatch(r.map(a=>a.url),n):{success:!1,error:"Failed to queue downloads"}}}async getPendingDownloads(){try{return(await this.sendMessage("GET_PENDING_DOWNLOADS",{})).downloads||[]}catch(r){return console.error("[BackgroundDownload] Get pending error:",r),[]}}async removePendingDownload(r){try{return(await this.sendMessage("REMOVE_PENDING_DOWNLOAD",{id:r})).success}catch(n){return console.error("[BackgroundDownload] Remove error:",n),!1}}async triggerSync(){if(!this.swRegistration)return!1;try{return"sync"in this.swRegistration?(await this.swRegistration.sync.register("sync-downloads"),console.log("[BackgroundDownload] Sync triggered via Background Sync API"),!0):(await this.sendMessage("TRIGGER_DOWNLOAD_SYNC",{})).success}catch(r){return console.error("[BackgroundDownload] Trigger sync error:",r),!1}}startStatusPolling(r=5e3){if(this.statusPollingInterval)return;const n=async()=>{if(navigator.onLine){if(!hr.downloads.shouldAttempt()){console.debug("[BackgroundDownload] Skipping poll due to backoff");return}try{const a=this.authToken||localStorage.getItem("token");if(!a)return;const o=await fetch("/api/download/?filter=pending",{headers:{Authorization:`Token ${a}`}}),i=await fetch("/api/download/?filter=downloading",{headers:{Authorization:`Token ${a}`}});if(o.ok&&i.ok){const c=await o.json(),u=await i.json(),d=[...c.data||[],...u.data||[]];this.notifyStatusListeners(d),hr.downloads.recordSuccess()}else hr.downloads.recordFailure()}catch(a){console.error("[BackgroundDownload] Status polling error:",a),hr.downloads.recordFailure()}}};(()=>{const a=Jl(r),o=Mr();console.debug(`[BackgroundDownload] Setting poll interval: ${Math.round(a/1e3)}s (network: ${o.quality})`),this.statusPollingInterval=window.setInterval(()=>{n();const i=Jl(r);Math.abs(i-a)>1e3&&(this.stopStatusPolling(),this.startStatusPolling(r))},a)})()}stopStatusPolling(){this.statusPollingInterval&&(clearInterval(this.statusPollingInterval),this.statusPollingInterval=null)}onStatusUpdate(r){return this.statusListeners.add(r),()=>this.statusListeners.delete(r)}notifyStatusListeners(r){this.statusListeners.forEach(n=>n(r))}async directDownload(r,n){try{const s=await fetch("/api/download/",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Token ${n}`},body:JSON.stringify({urls:[r],auto_start:!0})});return s.ok?{success:!0,id:(await s.json())[0]?.id}:{success:!1,error:await s.text()}}catch(s){return{success:!1,error:String(s)}}}async directDownloadBatch(r,n){try{const s=await fetch("/api/download/",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Token ${n}`},body:JSON.stringify({urls:r,auto_start:!0})});return s.ok?{success:!0,ids:(await s.json()).map(o=>o.id)}:{success:!1,error:await s.text()}}catch(s){return{success:!1,error:String(s)}}}sendMessage(r,n){return new Promise((s,a)=>{if(!navigator.serviceWorker.controller){console.log("[BackgroundDownload] No service worker controller, returning empty"),s({downloads:[],success:!0});return}const o=new MessageChannel,i=setTimeout(()=>{console.log("[BackgroundDownload] Service worker message timeout, returning empty"),s({downloads:[],success:!0})},5e3);o.port1.onmessage=c=>{clearTimeout(i),s(c.data)},navigator.serviceWorker.controller.postMessage({type:r,...n},[o.port2])})}get supported(){return this.isSupported}get online(){return navigator.onLine}}const qt=new Rb;function Ib(){const[t,r]=l.useState(navigator.onLine),[n,s]=l.useState([]),[a,o]=l.useState([]),[i,c]=l.useState(!1);l.useEffect(()=>{const b=localStorage.getItem("token");b&&qt.setAuthToken(b)},[]),l.useEffect(()=>{const b=()=>{r(!0),qt.triggerSync()},v=()=>{r(!1)};return window.addEventListener("online",b),window.addEventListener("offline",v),()=>{window.removeEventListener("online",b),window.removeEventListener("offline",v)}},[]);const[u,d]=l.useState(!1);l.useEffect(()=>{const b=qt.onStatusUpdate(v=>{o(v)});return()=>{b(),qt.stopStatusPolling()}},[]);const f=l.useCallback(()=>{t&&!u&&(console.debug("[BackgroundDownload] Starting polling (UI visible)"),qt.startStatusPolling(1e4),d(!0))},[t,u]),p=l.useCallback(()=>{u&&(console.debug("[BackgroundDownload] Stopping polling (UI hidden)"),qt.stopStatusPolling(),d(!1))},[u]);l.useEffect(()=>{g()},[]);const g=async()=>{const b=await qt.getPendingDownloads();s(b)},m=l.useCallback(async()=>{c(!0);try{await g();const b=localStorage.getItem("token");if(b&&navigator.onLine){const[v,S]=await Promise.all([fetch("/api/download/?filter=pending",{headers:{Authorization:`Token ${b}`}}),fetch("/api/download/?filter=downloading",{headers:{Authorization:`Token ${b}`}})]);if(v.ok&&S.ok){const A=await v.json(),E=await S.json();o([...A.data||[],...E.data||[]])}}}finally{c(!1)}},[]),y=l.useCallback(async(b,v)=>{c(!0);try{const S=await qt.queueDownload(b,v);return S.success&&await g(),S.success}finally{c(!1)}},[]),j=l.useCallback(async b=>{c(!0);try{const v=await qt.queueDownloads(b);return v.success&&await g(),v.success}finally{c(!1)}},[]),C=l.useCallback(async b=>{const v=await qt.removePendingDownload(b);return v&&s(S=>S.filter(A=>A.id!==b)),v},[]),w=l.useCallback(async()=>{c(!0);try{const b=await qt.triggerSync();return await g(),b}finally{c(!1)}},[]);return{isSupported:qt.supported,isOnline:t,pendingDownloads:n,activeDownloads:a,isLoading:i,queueDownload:y,queueDownloads:j,removePendingDownload:C,triggerSync:w,refreshStatus:m,startPolling:f,stopPolling:p}}function Ab({variant:t="icon"}){const r=Pt(),[n,s]=l.useState(null),{isSupported:a,isOnline:o,pendingDownloads:i,activeDownloads:c,isLoading:u,removePendingDownload:d,triggerSync:f,refreshStatus:p,startPolling:g,stopPolling:m}=Ib(),y=!!n,j=i.filter(k=>k.status==="pending").length,C=c.filter(k=>k.status==="downloading").length,w=j+C+c.filter(k=>k.status==="pending").length,b=w>0,v=k=>{s(k.currentTarget),g(),p()},S=()=>{s(null),m()},A=async()=>{await f(),await p()},E=k=>{switch(k){case"pending":return e.jsx(wd,{color:"action"});case"downloading":return e.jsx(Ie,{size:20});case"completed":return e.jsx(Tr,{color:"success"});case"failed":return e.jsx(yd,{color:"error"});case"submitted":return e.jsx(ko,{color:"info"});default:return e.jsx(jr,{})}},P=k=>{switch(k){case"pending":return"default";case"downloading":return"primary";case"completed":return"success";case"failed":return"error";case"submitted":return"info";default:return"default"}};return e.jsxs(e.Fragment,{children:[t==="icon"?e.jsx(ve,{title:o?"Download Status":"Offline - Downloads will sync when online",children:e.jsxs(X,{onClick:v,sx:{color:b?"primary.main":"text.secondary",position:"relative"},children:[e.jsx($h,{badgeContent:w,color:"primary",max:99,invisible:w===0,children:o?e.jsx(jr,{}):e.jsx(Sr,{})}),C>0&&e.jsx(Ie,{size:36,sx:{position:"absolute",color:$e(r.palette.primary.main,.3)}})]})}):e.jsxs(N,{variant:"outlined",startIcon:o?e.jsx(jr,{}):e.jsx(Sr,{}),onClick:v,sx:{position:"relative"},children:["Downloads",w>0&&e.jsx(ue,{label:w,size:"small",color:"primary",sx:{ml:1,height:20}})]}),e.jsxs(Bh,{open:y,anchorEl:n,onClose:S,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},PaperProps:{sx:{width:360,maxHeight:480}},children:[e.jsxs(h,{sx:{p:2,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx(x,{variant:"h6",sx:{fontWeight:600},children:"Downloads"}),e.jsxs(h,{sx:{display:"flex",gap:1,alignItems:"center"},children:[!o&&e.jsx(ue,{icon:e.jsx(Sr,{}),label:"Offline",size:"small",color:"warning"}),e.jsx(ve,{title:"Refresh",children:e.jsx(X,{size:"small",onClick:p,disabled:u,children:e.jsx(qr,{sx:{fontSize:20}})})}),!o&&i.length>0&&e.jsx(ve,{title:"Sync when online",children:e.jsx(X,{size:"small",onClick:A,disabled:u||!o,children:e.jsx(ko,{sx:{fontSize:20}})})})]})]}),e.jsx(Ee,{}),a&&e.jsx(h,{sx:{px:2,py:1,bgcolor:$e(r.palette.success.main,.1)},children:e.jsx(x,{variant:"caption",color:"success.main",children:" Background downloads enabled - Downloads continue when app is closed"})}),u&&e.jsx(rt,{}),c.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(h,{sx:{px:2,py:1,bgcolor:"action.hover"},children:e.jsxs(x,{variant:"overline",color:"text.secondary",children:["Active Downloads (",c.length,")"]})}),e.jsx(Qe,{dense:!0,disablePadding:!0,children:c.map(k=>e.jsxs(Le,{children:[e.jsx(Ge,{sx:{minWidth:36},children:E(k.status)}),e.jsx(ke,{primary:k.title||`Download #${k.id}`,secondary:e.jsxs(h,{component:"span",sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ue,{label:k.status,size:"small",color:P(k.status),sx:{height:18,fontSize:"0.65rem"}}),k.error_message&&e.jsx(x,{variant:"caption",color:"error",sx:{ml:1},children:k.error_message})]}),primaryTypographyProps:{noWrap:!0,sx:{maxWidth:220}}})]},`server-${k.id}`))})]}),i.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(h,{sx:{px:2,py:1,bgcolor:"action.hover"},children:e.jsxs(x,{variant:"overline",color:"text.secondary",children:["Queued for Sync (",i.length,")"]})}),e.jsx(Qe,{dense:!0,disablePadding:!0,children:i.map(k=>e.jsxs(Le,{children:[e.jsx(Ge,{sx:{minWidth:36},children:E(k.status)}),e.jsx(ke,{primary:k.title||k.url,secondary:e.jsxs(h,{component:"span",sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ue,{label:k.status,size:"small",color:P(k.status),sx:{height:18,fontSize:"0.65rem"}}),k.error&&e.jsx(x,{variant:"caption",color:"error",children:k.error})]}),primaryTypographyProps:{noWrap:!0,sx:{maxWidth:200}}}),e.jsx(Ar,{children:e.jsx(X,{edge:"end",size:"small",onClick:()=>d(k.id),children:e.jsx(Er,{fontSize:"small"})})})]},`local-${k.id}`))})]}),c.length===0&&i.length===0&&e.jsxs(h,{sx:{p:4,textAlign:"center"},children:[e.jsx(jr,{sx:{fontSize:48,color:"text.disabled",mb:1}}),e.jsx(x,{variant:"body2",color:"text.secondary",children:"No active downloads"}),e.jsx(x,{variant:"caption",color:"text.disabled",children:o?"Downloads you start will appear here":"Queue downloads offline and they will sync when online"})]}),!o&&i.filter(k=>k.status==="pending").length>0&&e.jsx(h,{sx:{p:2,borderTop:1,borderColor:"divider"},children:e.jsxs(N,{fullWidth:!0,variant:"contained",startIcon:e.jsx(ko,{}),disabled:!0,children:["Will sync when online (",i.filter(k=>k.status==="pending").length," pending)"]})})]})]})}function Pb({onLogout:t,onMenuClick:r}){const[n,s]=l.useState(!1),[a,o]=l.useState(null),[i,c]=l.useState(null);l.useEffect(()=>{localStorage.getItem("token")&&u()},[]);const u=async()=>{const p=localStorage.getItem("token");if(p)try{const g=await fetch("/api/user/account/",{headers:{Authorization:`Token ${p}`}});if(g.ok){const m=await g.json();o(m),c(m.avatar_url)}}catch(g){console.error("Failed to fetch user data:",g)}},d=()=>{const p=new Date().getHours();return p<12?"Good Morning":p<18?"Good Afternoon":"Good Evening"},f=p=>{c(p)};return e.jsxs(qh,{position:"static",elevation:0,sx:{bgcolor:"transparent",borderBottom:"none"},children:[e.jsxs(Nh,{sx:{minHeight:{xs:"64px",md:"80px"},px:{xs:2,md:3}},children:[e.jsx(X,{color:"inherit","aria-label":"open drawer",edge:"start",onClick:r,sx:{mr:2,display:{md:"none"}},children:e.jsx(vb,{})}),e.jsxs(h,{sx:{flexGrow:1,display:"flex",alignItems:"center",gap:{xs:1.5,md:2.5}},children:[e.jsxs(h,{sx:{position:"relative"},children:[e.jsx(Ve,{src:i||void 0,onClick:()=>s(!0),sx:{width:{xs:40,md:64},height:{xs:40,md:64},border:"2px solid",borderColor:"rgba(255, 255, 255, 0.1)",cursor:"pointer",transition:"all 0.3s ease","&:hover":{transform:"scale(1.05)",borderColor:"primary.main"}},children:a?.username?.charAt(0).toUpperCase()}),e.jsx(h,{sx:{position:"absolute",bottom:0,right:0,width:{xs:12,md:20},height:{xs:12,md:20},bgcolor:"primary.main",borderRadius:"50%",border:{xs:"2px solid",md:"4px solid"},borderColor:"background.default"}})]}),e.jsxs(h,{children:[e.jsx(x,{variant:"h5",sx:{fontWeight:700,letterSpacing:"-0.02em",mb:.5,fontSize:{xs:"1.1rem",md:"1.5rem"}},children:d()}),e.jsx(x,{variant:"body2",color:"text.secondary",sx:{fontWeight:500,display:{xs:"none",sm:"block"}},children:a?.first_name||a?.last_name?`${a.first_name||""} ${a.last_name||""}`.trim():a?.username||"Music Lover"})]})]}),e.jsxs(h,{sx:{display:"flex",gap:1.5,alignItems:"center"},children:[e.jsx(Ab,{}),e.jsx(ve,{title:"Logout",arrow:!0,children:e.jsx(X,{onClick:t,sx:{width:{xs:44,md:48},height:{xs:44,md:48},border:"1px solid",borderColor:"rgba(255, 255, 255, 0.1)",transition:"all 0.3s ease","&:hover":{bgcolor:"rgba(255, 82, 82, 0.1)",borderColor:"rgba(255, 82, 82, 0.5)",color:"#ff5252"}},children:e.jsx(Sb,{})})})]})]}),e.jsx(_b,{open:n,onClose:()=>s(!1),currentAvatar:i,onAvatarChange:f})]})}const Db="modulepreload",Mb=function(t){return"/"+t},Dc={},Eb=function(r,n,s){let a=Promise.resolve();if(n&&n.length>0){let u=function(d){return Promise.all(d.map(f=>Promise.resolve(f).then(p=>({status:"fulfilled",value:p}),p=>({status:"rejected",reason:p}))))};document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),c=i?.nonce||i?.getAttribute("nonce");a=u(n.map(d=>{if(d=Mb(d),d in Dc)return;Dc[d]=!0;const f=d.endsWith(".css"),p=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${p}`))return;const g=document.createElement("link");if(g.rel=f?"stylesheet":Db,f||(g.as="script"),g.crossOrigin="",g.href=d,c&&g.setAttribute("nonce",c),document.head.appendChild(g),f)return new Promise((m,y)=>{g.addEventListener("load",m),g.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${d}`)))})}))}function o(i){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=i,window.dispatchEvent(c),!c.defaultPrevented)throw i}return a.then(i=>{for(const c of i||[])c.status==="rejected"&&o(c.reason);return r().catch(o)})};var ks={},Mc;function Tb(){if(Mc)return ks;Mc=1;var t=ne();Object.defineProperty(ks,"__esModule",{value:!0}),ks.default=void 0;var r=t(ae()),n=se();return ks.default=(0,r.default)((0,n.jsx)("path",{d:"M6 6h2v12H6zm3.5 6 8.5 6V6z"}),"SkipPrevious"),ks}var zb=Tb();const Ob=re(zb);var _s={},Ec;function Fb(){if(Ec)return _s;Ec=1;var t=ne();Object.defineProperty(_s,"__esModule",{value:!0}),_s.default=void 0;var r=t(ae()),n=se();return _s.default=(0,r.default)((0,n.jsx)("path",{d:"m6 18 8.5-6L6 6zM16 6v12h2V6z"}),"SkipNext"),_s}var Lb=Fb();const Wb=re(Lb);var Rs={},Tc;function $b(){if(Tc)return Rs;Tc=1;var t=ne();Object.defineProperty(Rs,"__esModule",{value:!0}),Rs.default=void 0;var r=t(ae()),n=se();return Rs.default=(0,r.default)((0,n.jsx)("path",{d:"M7 7h10v3l4-4-4-4v3H5v6h2zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2z"}),"Repeat"),Rs}var Bb=$b();const qb=re(Bb);var Is={},zc;function Nb(){if(zc)return Is;zc=1;var t=ne();Object.defineProperty(Is,"__esModule",{value:!0}),Is.default=void 0;var r=t(ae()),n=se();return Is.default=(0,r.default)((0,n.jsx)("path",{d:"M7 7h10v3l4-4-4-4v3H5v6h2zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2zm-4-2V9h-1l-2 1v1h1.5v4z"}),"RepeatOne"),Is}var Ub=Nb();const Hb=re(Ub);var As={},Oc;function Vb(){if(Oc)return As;Oc=1;var t=ne();Object.defineProperty(As,"__esModule",{value:!0}),As.default=void 0;var r=t(ae()),n=se();return As.default=(0,r.default)((0,n.jsx)("path",{d:"M3 9v6h4l5 5V4L7 9zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02M14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77"}),"VolumeUp"),As}var Yb=Vb();const Gb=re(Yb);var Ps={},Fc;function Qb(){if(Fc)return Ps;Fc=1;var t=ne();Object.defineProperty(Ps,"__esModule",{value:!0}),Ps.default=void 0;var r=t(ae()),n=se();return Ps.default=(0,r.default)((0,n.jsx)("path",{d:"M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63m2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71M4.27 3 3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9zM12 4 9.91 6.09 12 8.18z"}),"VolumeOff"),Ps}var Kb=Qb();const Xb=re(Kb);var Ds={},Lc;function Jb(){if(Lc)return Ds;Lc=1;var t=ne();Object.defineProperty(Ds,"__esModule",{value:!0}),Ds.default=void 0;var r=t(ae()),n=se();return Ds.default=(0,r.default)((0,n.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit"),Ds}var Zb=Jb();const ev=re(Zb);var Ms={},Wc;function tv(){if(Wc)return Ms;Wc=1;var t=ne();Object.defineProperty(Ms,"__esModule",{value:!0}),Ms.default=void 0;var r=t(ae()),n=se();return Ms.default=(0,r.default)((0,n.jsx)("path",{d:"M12.34 2.02C6.59 1.82 2 6.42 2 12c0 5.52 4.48 10 10 10 3.71 0 6.93-2.02 8.66-5.02-7.51-.25-12.09-8.43-8.32-14.96"}),"Bedtime"),Ms}var rv=tv();const si=re(rv),$c={isActive:!1,mode:"minutes",remainingMinutes:0,remainingSongs:0,fadeOut:!0,fadeDuration:30,isFading:!1,startedAt:null},Yu=l.createContext(null);function nv({children:t}){const[r,n]=l.useState($c),[s,a]=l.useState(!1),o=l.useRef(null),i=l.useRef(null),c=l.useRef(null),u=l.useCallback(()=>{o.current&&(clearInterval(o.current),o.current=null),i.current=null,c.current=null},[]),d=l.useCallback(j=>{u(),a(!1);const C=new Date;if(j.mode==="minutes"){const w=C.getTime()+j.minutes*60*1e3;c.current=w;const b=j.fadeOut?w-j.fadeDuration*1e3:w;n({isActive:!0,mode:"minutes",remainingMinutes:j.minutes,remainingSongs:0,fadeOut:j.fadeOut,fadeDuration:j.fadeDuration,isFading:!1,startedAt:C}),o.current=setInterval(()=>{const v=Date.now(),S=Math.max(0,w-v),A=S/6e4,E=j.fadeOut&&v>=b;if(S<=0){u(),a(!0),n(P=>({...P,isActive:!1,remainingMinutes:0,isFading:!1}));return}E&&!i.current&&(i.current=v),n(P=>({...P,remainingMinutes:A,isFading:E}))},1e3)}else j.mode==="songs"?n({isActive:!0,mode:"songs",remainingMinutes:0,remainingSongs:j.songs,fadeOut:j.fadeOut,fadeDuration:j.fadeDuration,isFading:!1,startedAt:C}):j.mode==="endOfTrack"&&n({isActive:!0,mode:"endOfTrack",remainingMinutes:0,remainingSongs:1,fadeOut:j.fadeOut,fadeDuration:j.fadeDuration,isFading:!1,startedAt:C});console.log("[SleepTimer] Started:",j)},[u]),f=l.useCallback(()=>{u(),a(!1),n($c),console.log("[SleepTimer] Stopped")},[u]),p=l.useCallback(()=>{if(!r.isActive)return!1;if(r.mode==="songs"||r.mode==="endOfTrack"){const j=r.remainingSongs-1;if(j<=0)return u(),a(!0),n(C=>({...C,isActive:!1,remainingSongs:0})),console.log("[SleepTimer] Song count reached, stopping"),!0;n(C=>({...C,remainingSongs:j}))}return!1},[r.isActive,r.mode,r.remainingSongs,u]),g=l.useCallback(()=>{if(!r.isFading||!i.current)return 1;const j=(Date.now()-i.current)/1e3,C=Math.min(1,j/r.fadeDuration);return Math.max(0,1-C*C)},[r.isFading,r.fadeDuration]),m=l.useCallback(()=>s?(a(!1),!0):!1,[s]);l.useEffect(()=>()=>{u()},[u]);const y={timerState:r,startTimer:d,stopTimer:f,onSongEnded:p,getFadeVolume:g,shouldStop:m};return e.jsx(Yu.Provider,{value:y,children:t})}function Gu(){const t=l.useContext(Yu);if(!t)throw new Error("useSleepTimer must be used within a SleepTimerProvider");return t}const sv=[32,64,125,250,500,1e3,2e3,4e3,8e3,16e3],av=["32","64","125","250","500","1K","2K","4K","8K","16K"],to=-12,Js=12,ai=[{id:"flat",name:"Flat",gains:[0,0,0,0,0,0,0,0,0,0]},{id:"bass-boost",name:"Bass Boost",gains:[6,5,4,2,0,0,0,0,0,0]},{id:"treble-boost",name:"Treble Boost",gains:[0,0,0,0,0,0,2,4,5,6]},{id:"rock",name:"Rock",gains:[5,4,2,0,-1,-1,2,3,4,4]},{id:"pop",name:"Pop",gains:[-1,1,3,4,3,0,-1,-1,1,2]},{id:"jazz",name:"Jazz",gains:[3,2,1,2,-1,-1,0,1,2,3]},{id:"classical",name:"Classical",gains:[4,3,2,1,-1,-1,0,2,3,4]},{id:"electronic",name:"Electronic",gains:[5,4,2,0,-2,-1,0,2,4,5]},{id:"hip-hop",name:"Hip-Hop",gains:[6,5,3,1,-1,-1,1,0,2,3]},{id:"acoustic",name:"Acoustic",gains:[3,2,1,1,2,1,2,2,3,2]},{id:"vocal",name:"Vocal Boost",gains:[-2,-1,0,2,4,4,3,1,0,-1]},{id:"loudness",name:"Loudness",gains:[5,4,2,0,-2,-2,0,2,4,5]}],Qu=l.createContext(null);function ov({children:t}){const{getExtraSetting:r,updateExtraSetting:n}=Cr(),[s,a]=l.useState(!0),[o,i]=l.useState("flat"),[c,u]=l.useState(Array(10).fill(0)),[d,f]=l.useState([]),[p,g]=l.useState(!1);l.useEffect(()=>{const I=r("equalizer",null);I&&!p&&(I.enabled!==void 0&&a(I.enabled),I.activePresetId&&i(I.activePresetId),I.gains?.length===10&&u(I.gains),I.customPresets&&f(I.customPresets),g(!0))},[r,p]);const m=l.useRef([]),y=l.useRef(null),j=l.useRef(null),C=l.useRef(null),w=l.useRef(!1),b=[...ai,...d],v=l.useCallback(async I=>{const _={enabled:s,activePresetId:o,gains:c,customPresets:d,...I};await n("equalizer",_)},[s,o,c,d,n]),S=l.useCallback(I=>{m.current.forEach((_,O)=>{_&&I[O]!==void 0&&(_.gain.value=s?I[O]:0)})},[s]),A=l.useCallback(I=>{m.current=[],sv.forEach((_,O)=>{const D=I.createBiquadFilter();D.type="peaking",D.frequency.value=_,D.Q.value=1.4,D.gain.value=s?c[O]:0,m.current.push(D)});for(let _=0;_<m.current.length-1;_++)m.current[_].connect(m.current[_+1]);return{input:m.current[0],output:m.current[m.current.length-1]}},[s,c]),E=l.useCallback((I,_,O)=>{y.current=O,j.current=I,C.current=_,m.current.length===0&&A(O),m.current.length>0&&(I.connect(m.current[0]),m.current[m.current.length-1].connect(_),w.current=!0,console.log("[EQ] Connected audio source through equalizer"))},[A]),P=l.useCallback(()=>{if(w.current&&j.current&&m.current.length>0){try{j.current.disconnect(),m.current.forEach(I=>I.disconnect())}catch{}w.current=!1}},[]),k=l.useCallback(I=>{a(I),S(I?c:Array(10).fill(0)),v({enabled:I})},[c,S,v]),R=l.useCallback((I,_)=>{const O=[...c];O[I]=Math.max(to,Math.min(Js,_)),u(O),i("custom"),S(O),v({gains:O,activePresetId:"custom"})},[c,S,v]),z=l.useCallback(I=>{const _=I.map(O=>Math.max(to,Math.min(Js,O)));u(_),S(_),v({gains:_})},[S,v]),B=l.useCallback(I=>{const _=b.find(O=>O.id===I);_&&(i(I),u(_.gains),S(_.gains),v({activePresetId:I,gains:_.gains}))},[b,S,v]),F=l.useCallback(I=>{const _=`custom-${Date.now()}`,O={id:_,name:I,gains:[...c],isCustom:!0},D=[...d,O];f(D),i(_),v({customPresets:D,activePresetId:_})},[c,d,v]),W=l.useCallback(I=>{const _=d.filter(O=>O.id!==I);f(_),o===I&&(i("flat"),u(Array(10).fill(0)),S(Array(10).fill(0))),v({customPresets:_,activePresetId:o===I?"flat":o,gains:o===I?Array(10).fill(0):c})},[d,o,c,S,v]),H=l.useCallback(()=>{B("flat")},[B]);return l.useEffect(()=>{S(s?c:Array(10).fill(0))},[s,c,S]),e.jsx(Qu.Provider,{value:{enabled:s,activePresetId:o,gains:c,presets:b,customPresets:d,setEnabled:k,setGain:R,setGains:z,selectPreset:B,saveCustomPreset:F,deleteCustomPreset:W,resetToFlat:H,connectAudioSource:E,disconnectAudio:P},children:t})}function Ku(){const t=l.useContext(Qu);if(!t)throw new Error("useEqualizer must be used within EqualizerProvider");return t}var Fo,Bc;function iv(){if(Bc)return Fo;Bc=1;var t={linear:function(r,n,s,a){var o=s-n;return o*r/a+n},easeInQuad:function(r,n,s,a){var o=s-n;return o*(r/=a)*r+n},easeOutQuad:function(r,n,s,a){var o=s-n;return-o*(r/=a)*(r-2)+n},easeInOutQuad:function(r,n,s,a){var o=s-n;return(r/=a/2)<1?o/2*r*r+n:-o/2*(--r*(r-2)-1)+n},easeInCubic:function(r,n,s,a){var o=s-n;return o*(r/=a)*r*r+n},easeOutCubic:function(r,n,s,a){var o=s-n;return o*((r=r/a-1)*r*r+1)+n},easeInOutCubic:function(r,n,s,a){var o=s-n;return(r/=a/2)<1?o/2*r*r*r+n:o/2*((r-=2)*r*r+2)+n},easeInQuart:function(r,n,s,a){var o=s-n;return o*(r/=a)*r*r*r+n},easeOutQuart:function(r,n,s,a){var o=s-n;return-o*((r=r/a-1)*r*r*r-1)+n},easeInOutQuart:function(r,n,s,a){var o=s-n;return(r/=a/2)<1?o/2*r*r*r*r+n:-o/2*((r-=2)*r*r*r-2)+n},easeInQuint:function(r,n,s,a){var o=s-n;return o*(r/=a)*r*r*r*r+n},easeOutQuint:function(r,n,s,a){var o=s-n;return o*((r=r/a-1)*r*r*r*r+1)+n},easeInOutQuint:function(r,n,s,a){var o=s-n;return(r/=a/2)<1?o/2*r*r*r*r*r+n:o/2*((r-=2)*r*r*r*r+2)+n},easeInSine:function(r,n,s,a){var o=s-n;return-o*Math.cos(r/a*(Math.PI/2))+o+n},easeOutSine:function(r,n,s,a){var o=s-n;return o*Math.sin(r/a*(Math.PI/2))+n},easeInOutSine:function(r,n,s,a){var o=s-n;return-o/2*(Math.cos(Math.PI*r/a)-1)+n},easeInExpo:function(r,n,s,a){var o=s-n;return r==0?n:o*Math.pow(2,10*(r/a-1))+n},easeOutExpo:function(r,n,s,a){var o=s-n;return r==a?n+o:o*(-Math.pow(2,-10*r/a)+1)+n},easeInOutExpo:function(r,n,s,a){var o=s-n;return r===0?n:r===a?n+o:(r/=a/2)<1?o/2*Math.pow(2,10*(r-1))+n:o/2*(-Math.pow(2,-10*--r)+2)+n},easeInCirc:function(r,n,s,a){var o=s-n;return-o*(Math.sqrt(1-(r/=a)*r)-1)+n},easeOutCirc:function(r,n,s,a){var o=s-n;return o*Math.sqrt(1-(r=r/a-1)*r)+n},easeInOutCirc:function(r,n,s,a){var o=s-n;return(r/=a/2)<1?-o/2*(Math.sqrt(1-r*r)-1)+n:o/2*(Math.sqrt(1-(r-=2)*r)+1)+n},easeInElastic:function(r,n,s,a){var o=s-n,i,c,u;return u=1.70158,c=0,i=o,r===0?n:(r/=a)===1?n+o:(c||(c=a*.3),i<Math.abs(o)?(i=o,u=c/4):u=c/(2*Math.PI)*Math.asin(o/i),-(i*Math.pow(2,10*(r-=1))*Math.sin((r*a-u)*(2*Math.PI)/c))+n)},easeOutElastic:function(r,n,s,a){var o=s-n,i,c,u;return u=1.70158,c=0,i=o,r===0?n:(r/=a)===1?n+o:(c||(c=a*.3),i<Math.abs(o)?(i=o,u=c/4):u=c/(2*Math.PI)*Math.asin(o/i),i*Math.pow(2,-10*r)*Math.sin((r*a-u)*(2*Math.PI)/c)+o+n)},easeInOutElastic:function(r,n,s,a){var o=s-n,i,c,u;return u=1.70158,c=0,i=o,r===0?n:(r/=a/2)===2?n+o:(c||(c=a*(.3*1.5)),i<Math.abs(o)?(i=o,u=c/4):u=c/(2*Math.PI)*Math.asin(o/i),r<1?-.5*(i*Math.pow(2,10*(r-=1))*Math.sin((r*a-u)*(2*Math.PI)/c))+n:i*Math.pow(2,-10*(r-=1))*Math.sin((r*a-u)*(2*Math.PI)/c)*.5+o+n)},easeInBack:function(r,n,s,a,o){var i=s-n;return o===void 0&&(o=1.70158),i*(r/=a)*r*((o+1)*r-o)+n},easeOutBack:function(r,n,s,a,o){var i=s-n;return o===void 0&&(o=1.70158),i*((r=r/a-1)*r*((o+1)*r+o)+1)+n},easeInOutBack:function(r,n,s,a,o){var i=s-n;return o===void 0&&(o=1.70158),(r/=a/2)<1?i/2*(r*r*(((o*=1.525)+1)*r-o))+n:i/2*((r-=2)*r*(((o*=1.525)+1)*r+o)+2)+n},easeInBounce:function(r,n,s,a){var o=s-n,i;return i=t.easeOutBounce(a-r,0,o,a),o-i+n},easeOutBounce:function(r,n,s,a){var o=s-n;return(r/=a)<1/2.75?o*(7.5625*r*r)+n:r<2/2.75?o*(7.5625*(r-=1.5/2.75)*r+.75)+n:r<2.5/2.75?o*(7.5625*(r-=2.25/2.75)*r+.9375)+n:o*(7.5625*(r-=2.625/2.75)*r+.984375)+n},easeInOutBounce:function(r,n,s,a){var o=s-n,i;return r<a/2?(i=t.easeInBounce(r*2,0,o,a),i*.5+n):(i=t.easeOutBounce(r*2-a,0,o,a),i*.5+o*.5+n)}};return Fo=t,Fo}var lv=iv();function cv(t){return t*Math.PI/180}function Ot(t,r){return t+Math.random()*(r-t)}function dv(t,r){return Math.floor(t+Math.random()*(r-t+1))}var Zs;(function(t){t[t.Circle=0]="Circle",t[t.Square=1]="Square",t[t.Strip=2]="Strip"})(Zs||(Zs={}));var vr;(function(t){t[t.Positive=1]="Positive",t[t.Negative=-1]="Negative"})(vr||(vr={}));const uv=1e3/60;class hv{constructor(r,n,s,a){this.getOptions=n;const{colors:o,initialVelocityX:i,initialVelocityY:c}=this.getOptions();this.context=r,this.x=s,this.y=a,this.w=Ot(5,20),this.h=Ot(5,20),this.radius=Ot(5,10),this.vx=typeof i=="number"?Ot(-i,i):Ot(i.min,i.max),this.vy=typeof c=="number"?Ot(-c,0):Ot(c.min,c.max),this.shape=dv(0,2),this.angle=cv(Ot(0,360)),this.angularSpin=Ot(-.2,.2),this.color=o[Math.floor(Math.random()*o.length)],this.rotateY=Ot(0,1),this.rotationDirection=Ot(0,1)?vr.Positive:vr.Negative}update(r){const{gravity:n,wind:s,friction:a,opacity:o,drawShape:i}=this.getOptions(),c=r/uv;this.x+=this.vx*c,this.y+=this.vy*c,this.vy+=n*c,this.vx+=s*c,this.vx*=a**c,this.vy*=a**c,this.rotateY>=1&&this.rotationDirection===vr.Positive?this.rotationDirection=vr.Negative:this.rotateY<=-1&&this.rotationDirection===vr.Negative&&(this.rotationDirection=vr.Positive);const u=.1*this.rotationDirection*c;if(this.rotateY+=u,this.angle+=this.angularSpin,this.context.save(),this.context.translate(this.x,this.y),this.context.rotate(this.angle),this.context.scale(1,this.rotateY),this.context.rotate(this.angle),this.context.beginPath(),this.context.fillStyle=this.color,this.context.strokeStyle=this.color,this.context.globalAlpha=o,this.context.lineCap="round",this.context.lineWidth=2,i&&typeof i=="function")i.call(this,this.context);else switch(this.shape){case Zs.Circle:{this.context.beginPath(),this.context.arc(0,0,this.radius,0,2*Math.PI),this.context.fill();break}case Zs.Square:{this.context.fillRect(-this.w/2,-this.h/2,this.w,this.h);break}case Zs.Strip:{this.context.fillRect(-this.w/6,-this.h/2,this.w/3,this.h);break}}this.context.closePath(),this.context.restore()}}class fv{constructor(r,n){this.x=0,this.y=0,this.w=0,this.h=0,this.lastNumberOfPieces=0,this.tweenProgress=0,this.tweenFrom=0,this.particles=[],this.particlesGenerated=0,this.removeParticleAt=a=>{this.particles.splice(a,1)},this.getParticle=()=>{const a=Ot(this.x,this.w+this.x),o=Ot(this.y,this.h+this.y);return new hv(this.context,this.getOptions,a,o)},this.animate=a=>{const{canvas:o,context:i,particlesGenerated:c,lastNumberOfPieces:u}=this,{run:d,recycle:f,numberOfPieces:p,debug:g,tweenFunction:m,tweenDuration:y}=this.getOptions();if(!d)return!1;const j=this.particles.length,C=f?j:c;if(C<p){u!==p&&(this.tweenProgress=0,this.tweenFrom=C,this.lastNumberOfPieces=p),this.tweenProgress=Math.min(y,Math.max(0,this.tweenProgress+a));const w=m(this.tweenProgress,this.tweenFrom,p,y),b=Math.round(w-C);for(let v=0;v<b;v++)this.particles.push(this.getParticle());this.particlesGenerated+=b}g&&(i.font="12px sans-serif",i.fillStyle="#333",i.textAlign="right",i.fillText(`Particles: ${j}`,o.width-10,o.height-20));for(let w=this.particles.length-1;w>=0;w--){const b=this.particles[w];b.update(a),(b.y>o.height||b.y<-100||b.x>o.width+100||b.x<-100)&&(f&&C<=p?this.particles[w]=this.getParticle():this.removeParticleAt(w))}return j>0||C<p},this.canvas=r;const s=this.canvas.getContext("2d");if(!s)throw new Error("Could not get canvas context");this.context=s,this.getOptions=n}}const wi={width:typeof window<"u"?window.innerWidth:300,height:typeof window<"u"?window.innerHeight:200,numberOfPieces:200,friction:.99,wind:0,gravity:.1,initialVelocityX:4,initialVelocityY:10,colors:["#f44336","#e91e63","#9c27b0","#673ab7","#3f51b5","#2196f3","#03a9f4","#00bcd4","#009688","#4CAF50","#8BC34A","#CDDC39","#FFEB3B","#FFC107","#FF9800","#FF5722","#795548"],opacity:1,debug:!1,tweenFunction:lv.easeInOutQuad,tweenDuration:5e3,recycle:!0,run:!0};class xv{constructor(r,n){this.lastFrameTime=0,this.setOptionsWithDefaults=a=>{const o={confettiSource:{x:0,y:0,w:this.canvas.width,h:0}};this._options={...o,...wi,...a},Object.assign(this,a.confettiSource)},this.update=(a=0)=>{const{options:{run:o,onConfettiComplete:i,frameRate:c},canvas:u,context:d}=this,f=Math.min(a-this.lastFrameTime,50);if(c&&f<1e3/c){this.rafId=requestAnimationFrame(this.update);return}this.lastFrameTime=a-(c?f%c:0),o&&(d.fillStyle="white",d.clearRect(0,0,u.width,u.height)),this.generator.animate(f)?this.rafId=requestAnimationFrame(this.update):(i&&typeof i=="function"&&this.generator.particlesGenerated>0&&i.call(this,this),this._options.run=!1)},this.reset=()=>{this.generator&&this.generator.particlesGenerated>0&&(this.generator.particlesGenerated=0,this.generator.particles=[],this.generator.lastNumberOfPieces=0)},this.stop=()=>{this.options={run:!1},this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=void 0)},this.canvas=r;const s=this.canvas.getContext("2d");if(!s)throw new Error("Could not get canvas context");this.context=s,this.generator=new fv(this.canvas,()=>this.options),this.options=n,this.update()}get options(){return this._options}set options(r){const n=this._options?.run,s=this._options?.recycle;this.setOptionsWithDefaults(r),this.generator&&(Object.assign(this.generator,this.options.confettiSource),typeof r.recycle=="boolean"&&r.recycle&&s===!1&&(this.generator.lastNumberOfPieces=this.generator.particles.length)),typeof r.run=="boolean"&&r.run&&n===!1&&this.update()}}const pv=ze.createRef();class Si extends ze.Component{constructor(r){super(r),this.canvas=ze.createRef(),this.canvas=r.canvasRef||pv}componentDidMount(){if(this.canvas.current){const r=Lo(this.props)[0];this.confetti=new xv(this.canvas.current,r)}}componentDidUpdate(){const r=Lo(this.props)[0];this.confetti&&(this.confetti.options=r)}componentWillUnmount(){this.confetti&&this.confetti.stop(),this.confetti=void 0}render(){const[r,n]=Lo(this.props),s={zIndex:2,position:"absolute",pointerEvents:"none",top:0,left:0,bottom:0,right:0,...n.style};return e.jsx("canvas",{width:r.width,height:r.height,ref:this.canvas,...n,style:s})}}Si.defaultProps={...wi};Si.displayName="ReactConfetti";function Lo(t){const r={},n={},s={},a=[...Object.keys(wi),"confettiSource","drawShape","onConfettiComplete","frameRate"],o=["canvasRef"];for(const i in t){const c=t[i];a.includes(i)?r[i]=c:o.includes(i)?o[i]=c:s[i]=c}return[r,s,n]}const mv=ze.forwardRef((t,r)=>e.jsx(Si,{canvasRef:r,...t}));function gv({achievements:t,onClose:r}){const[n,s]=l.useState(0),[a,o]=l.useState(!0),[i,c]=l.useState({width:0,height:0}),u=Dt();l.useEffect(()=>{c({width:window.innerWidth,height:window.innerHeight});const g=setTimeout(()=>o(!1),5e3);return()=>clearTimeout(g)},[n]);const d=t[n],f=l.useCallback(()=>{n<t.length-1?(s(n+1),o(!0)):r()},[n,t.length,r]),p=()=>{r(),u("/achievements")};return d?e.jsxs(e.Fragment,{children:[a&&e.jsx(mv,{width:i.width,height:i.height,recycle:!1,numberOfPieces:200,gravity:.3,colors:["#13ec6a","#FFD700","#FF6B6B","#4ECDC4","#45B7D1"],style:{position:"fixed",top:0,left:0,zIndex:9999,pointerEvents:"none"}}),e.jsxs(Ke,{open:!0,onClose:r,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{bgcolor:"background.paper",backgroundImage:"linear-gradient(135deg, rgba(19, 236, 106, 0.1) 0%, rgba(103, 58, 183, 0.1) 100%)",border:"2px solid",borderColor:"primary.main",borderRadius:3}},children:[e.jsx(X,{onClick:r,sx:{position:"absolute",right:8,top:8,color:"text.secondary"},children:e.jsx(sa,{})}),e.jsxs(Xe,{sx:{textAlign:"center",py:4},children:[t.length>1&&e.jsxs(x,{variant:"caption",color:"text.secondary",sx:{mb:2,display:"block"},children:["Achievement ",n+1," of ",t.length]}),e.jsx(h,{sx:{fontSize:80,mb:2,animation:"bounce 0.6s ease infinite","@keyframes bounce":{"0%, 100%":{transform:"translateY(0)"},"50%":{transform:"translateY(-10px)"}}},children:d.icon}),e.jsxs(h,{sx:{display:"inline-flex",alignItems:"center",gap:1,bgcolor:"rgba(19, 236, 106, 0.2)",color:"primary.main",px:2,py:.5,borderRadius:2,mb:2},children:[e.jsx(Ya,{sx:{fontSize:18}}),e.jsx(x,{variant:"caption",sx:{fontWeight:600,letterSpacing:1,textTransform:"uppercase"},children:"Achievement Unlocked!"})]}),e.jsx(x,{variant:"h4",sx:{fontWeight:700,mb:1},children:d.name}),e.jsx(x,{variant:"body1",color:"text.secondary",sx:{mb:3},children:d.description}),d.context&&Object.keys(d.context).length>0&&e.jsx(x,{variant:"body2",color:"primary.main",sx:{mb:3},children:d.context.artist&&`Artist: ${d.context.artist}`}),e.jsxs(h,{sx:{display:"flex",gap:2,justifyContent:"center"},children:[e.jsx(N,{variant:"outlined",onClick:p,children:"View All Achievements"}),e.jsx(N,{variant:"contained",onClick:f,children:n<t.length-1?"Next":"Awesome!"})]})]})]})]}):null}const Xu=l.createContext(void 0);function yv({children:t}){const[r,n]=l.useState([]),s=l.useCallback(o=>{o.length>0&&n(o)},[]),a=l.useCallback(()=>{n([])},[]);return e.jsxs(Xu.Provider,{value:{showAchievements:s},children:[t,r.length>0&&e.jsx(gv,{achievements:r,onClose:a})]})}function bv(){const t=l.useContext(Xu);if(t===void 0)throw new Error("useAchievementNotification must be used within an AchievementNotificationProvider");return t}function vv(t,{onSwipeLeft:r,onSwipeRight:n,onSwipeUp:s,onSwipeDown:a,threshold:o=50}){const i=l.useRef(null);l.useEffect(()=>{const c=t.current;if(!c)return;const u=f=>{i.current={x:f.touches[0].clientX,y:f.touches[0].clientY}},d=f=>{if(!i.current)return;const p={x:f.changedTouches[0].clientX,y:f.changedTouches[0].clientY},g=p.x-i.current.x,m=p.y-i.current.y;Math.abs(g)>Math.abs(m)?Math.abs(g)>o&&(g>0?n?.():r?.()):Math.abs(m)>o&&(m>0?a?.():s?.()),i.current=null};return c.addEventListener("touchstart",u,{passive:!0}),c.addEventListener("touchend",d,{passive:!0}),()=>{c.removeEventListener("touchstart",u),c.removeEventListener("touchend",d)}},[t,r,n,s,a,o])}function Ju(t){const r=t.length,n=Math.floor(r*.15),s=Math.floor(r*.5);let a=0,o=0,i=0;for(let c=0;c<r;c++)c<n?a+=t[c]:c<s?o+=t[c]:i+=t[c];return{bass:a/n,mid:o/(s-n),high:i/(r-s)}}function jv({data:t,isPlaying:r,themeId:n=qu,style:s,colorScheme:a,height:o=120,showGlow:i=!0}){const c=Pt(),u=l.useRef(null),d=l.useRef(null),f=l.useRef([]),p=l.useRef(Date.now()),g=l.useMemo(()=>Nu(n),[n]),m=s||g.style,y=a||g.colorScheme,j=l.useMemo(()=>Bu(y,t.length,c.palette.primary.main),[y,t.length,c.palette.primary.main]),C=l.useMemo(()=>y==="theme"?c.palette.primary.main:j[0],[y,c.palette.primary.main,j]),w=l.useCallback((b,v,S)=>{const A=Math.floor(Math.random()*j.length);return{x:b,y:v,vx:(Math.random()-.5)*4*S,vy:-Math.random()*3*S-1,life:1,maxLife:.5+Math.random()*.5,size:2+Math.random()*4*S,color:j[A]}},[j]);return l.useEffect(()=>{const b=u.current;if(!b)return;const v=b.getContext("2d");if(!v)return;const S=window.devicePixelRatio||1,A=b.getBoundingClientRect();b.width=A.width*S,b.height=A.height*S,v.scale(S,S);const E=()=>{const P=A.width,k=A.height,R=Ju(t);switch(p.current=Date.now(),v.clearRect(0,0,P,k),m){case"bars-classic":qc(v,t,j,P,k);break;case"bars-mirrored":wv(v,t,j,P,k);break;case"bars-circular":Sv(v,t,j,P,k);break;case"wave-line":Cv(v,t,C,P,k);break;case"wave-fill":kv(v,t,C,P,k);break;case"circle-pulse":_v(v,R,C,P,k);break;case"circle-bars":Rv(v,t,j,P,k);break;case"particles":Iv(v,t,j,P,k,f,w,r);break;case"dna-helix":Av(v,t,C,P,k,p.current);break;case"spectrum":Pv(v,t,C,P,k);break;case"oscilloscope":Dv(v,t,C,P,k);break;case"galaxy":Mv(v,t,C,P,k,p.current);break;case"flower":Ev(v,t,j,P,k,p.current);break;case"matrix-rain":Tv(v,t,C,P,k,p.current);break;case"aurora":zv(v,t,C,P,k,p.current);break;case"radial-bars":Ov(v,t,j,P,k,i);break;default:qc(v,t,j,P,k)}d.current=requestAnimationFrame(E)};return E(),()=>{d.current&&cancelAnimationFrame(d.current)}},[t,j,C,m,i,r,w]),e.jsx(h,{sx:{width:"100%",height:o,position:"relative"},children:e.jsx("canvas",{ref:u,style:{width:"100%",height:"100%",display:"block"}})})}function qc(t,r,n,s,a){const o=r.length,i=s/o;for(let c=0;c<o;c++){const u=r[c]*a*.9,d=c*i,f=c/o*60+170;t.fillStyle=`hsl(${f}, 70%, 50%)`,t.fillRect(d,a-u,i-1,u)}}function wv(t,r,n,s,a){const o=r.length,i=s/o,c=a/2;for(let u=0;u<o;u++){const d=r[u]*a*.45,f=u*i,p=u/o*60+170;t.fillStyle=`hsl(${p}, 70%, 50%)`,t.fillRect(f,c-d,i-1,d*2)}}function Sv(t,r,n,s,a){const o=s/2,i=a/2,c=64,u=r.length;for(let d=0;d<c;d++){const f=Math.floor(d*u/c),p=r[f]*35+5,g=d/c*Math.PI*2-Math.PI/2,m=Math.min(s,a)*.15;t.beginPath(),t.moveTo(o+Math.cos(g)*m,i+Math.sin(g)*m),t.lineTo(o+Math.cos(g)*(m+p),i+Math.sin(g)*(m+p));const y=d/c*60+170;t.strokeStyle=`hsl(${y}, 70%, 50%)`,t.lineWidth=3,t.stroke()}}function Cv(t,r,n,s,a){const o=a/2,i=r.length;t.beginPath(),t.moveTo(0,o);for(let c=0;c<i;c++){const u=c/i*s,d=o+(r[c]-.5)*2*(a/2)*.8;t.lineTo(u,d)}t.strokeStyle=n,t.lineWidth=2,t.stroke()}function kv(t,r,n,s,a){const o=r.length;t.beginPath(),t.moveTo(0,a);for(let c=0;c<o;c++){const u=c/o*s,d=a-r[c]*a*.9;t.lineTo(u,d)}t.lineTo(s,a),t.closePath();const i=t.createLinearGradient(0,0,0,a);i.addColorStop(0,n+"CC"),i.addColorStop(1,n+"1A"),t.fillStyle=i,t.fill()}function _v(t,r,n,s,a){const o=s/2,i=a/2,c=Math.min(s,a)*.4,u=15+r.bass*c;t.beginPath(),t.arc(o,i,u,0,Math.PI*2),t.strokeStyle=n,t.globalAlpha=.3+r.bass*.7,t.lineWidth=2+r.bass*4,t.stroke(),t.beginPath(),t.arc(o,i,u*.6,0,Math.PI*2),t.globalAlpha=.2+r.mid*.5,t.lineWidth=1+r.mid*2,t.stroke(),t.globalAlpha=1}function Rv(t,r,n,s,a){const o=s/2,i=a/2,c=48,u=r.length,d=Math.min(s,a)*.12;for(let f=0;f<c;f++){const p=Math.floor(f*u/c),g=r[p]*30+5,m=f/c*Math.PI*2-Math.PI/2;t.beginPath(),t.moveTo(o+Math.cos(m)*d,i+Math.sin(m)*d),t.lineTo(o+Math.cos(m)*(d+g),i+Math.sin(m)*(d+g));const y=175+r[p]*30;t.strokeStyle=`hsl(${y}, 70%, 50%)`,t.lineWidth=3,t.stroke()}}function Iv(t,r,n,s,a,o,i,c){const u=Ju(r);if(o.current=o.current.filter(d=>(d.x+=d.vx,d.y+=d.vy,d.vy+=.03,d.life-=.015,d.life<=0?!1:(t.fillStyle=d.color,t.globalAlpha=d.life/d.maxLife,t.beginPath(),t.arc(d.x,d.y,d.size*(d.life/d.maxLife),0,Math.PI*2),t.fill(),!0))),t.globalAlpha=1,c){const d=Math.floor(20+u.bass*40);for(let f=0;f<d;f++){const p=Math.floor(f*r.length/d),g=f/d*s+(Math.random()-.5)*20,m=a-r[p]*a*.9,y=r[p]*6+1,j=r[p];Math.random()<r[p]*.3&&(t.beginPath(),t.arc(g,m,y,0,Math.PI*2),t.fillStyle=n[p%n.length],t.globalAlpha=j,t.fill())}t.globalAlpha=1}}function Av(t,r,n,s,a,o){const i=a/2,c=o/500,u=r.length;for(let d=0;d<s;d+=8){const f=Math.floor(d/s*u),p=r[f]*25+10,g=i+Math.sin(d/20+c)*p,m=i-Math.sin(d/20+c)*p;t.beginPath(),t.arc(d,g,3,0,Math.PI*2),t.fillStyle=n,t.fill(),t.beginPath(),t.arc(d,m,3,0,Math.PI*2),t.fillStyle=n,t.globalAlpha=.7,t.fill(),t.globalAlpha=1,t.beginPath(),t.moveTo(d,g),t.lineTo(d,m),t.strokeStyle=n,t.globalAlpha=.3,t.lineWidth=1,t.stroke(),t.globalAlpha=1}}function Pv(t,r,n,s,a){const o=r.length,i=s/o,c=t.createLinearGradient(0,a,0,0);c.addColorStop(0,n),c.addColorStop(.5,n+"CC"),c.addColorStop(1,n+"80"),t.fillStyle=c;for(let u=0;u<o;u++){const d=r[u]*a*.9;t.fillRect(u*i,a-d,i-1,d)}}function Dv(t,r,n,s,a){const o=a/2,i=r.length;t.beginPath(),t.moveTo(0,o);for(let c=0;c<i;c++){const u=c/i*s,d=o+(r[c]-.5)*2*o*.8;c===0?t.moveTo(u,d):t.lineTo(u,d)}t.strokeStyle=n,t.lineWidth=2,t.stroke(),t.shadowColor=n,t.shadowBlur=8,t.stroke(),t.shadowBlur=0}function Mv(t,r,n,s,a,o){const i=s/2,c=a/2,u=o/1e3,d=r.length;for(let f=0;f<80;f++){const p=f/80*Math.PI*4+u,g=Math.floor(f/80*d),m=10+f/80*40+r[g]*15,y=i+Math.cos(p)*m,j=c+Math.sin(p)*m*.6,C=r[g]*3+1,w=.3+r[g]*.7;t.beginPath(),t.arc(y,j,C,0,Math.PI*2),t.fillStyle=n,t.globalAlpha=w,t.fill()}t.globalAlpha=1}function Ev(t,r,n,s,a,o){const i=s/2,c=a/2,u=12,d=r.length;for(let f=0;f<u;f++){const p=Math.floor(f/u*d),g=15+r[p]*30,m=f/u*Math.PI*2+o/3e3;t.beginPath(),t.ellipse(i+Math.cos(m)*g*.3,c+Math.sin(m)*g*.3,g*.2,g*.6,m,0,Math.PI*2);const y=175+f/u*30;t.fillStyle=`hsla(${y}, 70%, 50%, ${.3+r[p]*.4})`,t.fill()}}function Tv(t,r,n,s,a,o){t.font="10px monospace";const i=Math.floor(s/12),c=r.length;for(let u=0;u<i;u++){const d=u*12,f=Math.floor(u/i*c),p=Math.floor(r[f]*6)+2;for(let g=0;g<p;g++){const m=String.fromCharCode(12448+Math.random()*96),y=(1-g/p)*r[f];t.fillStyle=n,t.globalAlpha=y,t.fillText(m,d,(g+1)*12+(o/50+u*20)%a)}}t.globalAlpha=1}function zv(t,r,n,s,a,o){const i=r.length;for(let c=0;c<3;c++){t.beginPath(),t.moveTo(0,a);for(let f=0;f<=s;f+=8){const p=Math.floor(f/s*i),g=Math.sin(f/40+o/(800+c*150)+c)*15,m=a-r[p]*(60-c*15)-g-c*15;t.lineTo(f,m)}t.lineTo(s,a),t.closePath();const u=t.createLinearGradient(0,0,0,a),d=Math.floor((.4-c*.1)*255).toString(16).padStart(2,"0");u.addColorStop(0,n+d),u.addColorStop(1,n+"00"),t.fillStyle=u,t.fill()}}function Ov(t,r,n,s,a,o){const i=s/2,c=a/2,u=Math.min(s,a)*.15,d=Math.min(s,a)*.35,f=r.length*2;for(let m=0;m<f;m++){const y=m%r.length,j=r[y],C=m/f*Math.PI*2-Math.PI/2,w=j*d+5,b=i+Math.cos(C)*u,v=c+Math.sin(C)*u,S=i+Math.cos(C)*(u+w),A=c+Math.sin(C)*(u+w),E=t.createLinearGradient(b,v,S,A);E.addColorStop(0,n[y%n.length]),E.addColorStop(1,n[(y+1)%n.length]),t.strokeStyle=E,t.lineWidth=Math.max(2,2*Math.PI*u/f*.6),t.lineCap="round",t.globalAlpha=.7+j*.3,o&&j>.5&&(t.shadowColor=n[y%n.length],t.shadowBlur=12*j),t.beginPath(),t.moveTo(b,v),t.lineTo(S,A),t.stroke()}t.globalAlpha=1,t.shadowBlur=0;const p=r.reduce((m,y)=>m+y,0)/r.length,g=t.createRadialGradient(i,c,0,i,c,u);g.addColorStop(0,n[0]),g.addColorStop(1,n[n.length-1]),t.fillStyle=g,t.globalAlpha=.4+p*.3,t.beginPath(),t.arc(i,c,u*.9,0,Math.PI*2),t.fill(),t.globalAlpha=1}const Yr=new Map;function Fv({audioElement:t,currentTime:r,duration:n,onSeek:s,onSeekCommitted:a,streamUrl:o}){const i=Pt(),c=l.useRef(null),u=l.useRef(null),[d,f]=l.useState([]),[p,g]=l.useState(!1),[m,y]=l.useState(null),j=l.useRef(null),C=l.useCallback(F=>{const H=[],I=F*1e3;for(let _=0;_<100;_++){const O=.3+Math.sin(_*.1+I*.001)*.2,D=Math.sin(_*.5+I*.002)*.15+Math.sin(_*.3)*.1,Q=(Math.sin(_*7.3+I*.003)*.5+.5)*.25;H.push(Math.min(1,Math.max(.15,O+D+Q)))}return H},[]);l.useCallback(async F=>{if(Yr.has(F))return Yr.get(F);try{const W=new(window.AudioContext||window.webkitAudioContext),I=await(await fetch(F)).arrayBuffer(),O=(await W.decodeAudioData(I)).getChannelData(0),D=100,Q=Math.floor(O.length/D),J=[];for(let M=0;M<D;M++){let T=0;const te=M*Q,$=te+Q;for(let ce=te;ce<$&&ce<O.length;ce++)T+=O[ce]*O[ce];const U=Math.sqrt(T/Q),K=Math.min(1,U*3);J.push(Math.max(.1,K))}return Yr.set(F,J),W.close(),J}catch(W){return console.log("Waveform generation failed, using fallback:",W),[]}},[]),l.useEffect(()=>{if(!o||!n){f(C(n||180));return}if(Yr.has(o)){f(Yr.get(o));return}const F=C(n);f(F),Yr.set(o,F)},[o,n,C]);const w=l.useCallback(()=>{const F=c.current;if(!F||d.length===0)return;const W=F.getContext("2d");if(!W)return;const H=window.devicePixelRatio||1,I=F.getBoundingClientRect();F.width=I.width*H,F.height=I.height*H,W.scale(H,H);const _=I.width,O=I.height,D=d.length,Q=_/D,J=1;W.clearRect(0,0,_,O);const T=(n>0?r/n:0)*_,te=i.palette.primary.main,$=i.palette.mode==="dark";for(let U=0;U<D;U++){const K=U*Q,ce=d[U]*O*.85,q=(O-ce)/2;if(K<T){const ie=W.createLinearGradient(0,q,0,q+ce);ie.addColorStop(0,te+"E6"),ie.addColorStop(.5,te),ie.addColorStop(1,te+"B3"),W.fillStyle=ie}else W.fillStyle=$?"rgba(255, 255, 255, 0.25)":"rgba(0, 0, 0, 0.15)";const oe=Math.min(Q/2,2);W.beginPath(),W.roundRect(K+J/2,q,Q-J,ce,oe),W.fill()}if(m!==null){const U=m*_;W.strokeStyle=$?"rgba(255, 255, 255, 0.5)":"rgba(0, 0, 0, 0.3)",W.lineWidth=2,W.beginPath(),W.moveTo(U,0),W.lineTo(U,O),W.stroke()}},[d,r,n,i,m]);l.useEffect(()=>{const F=()=>{w(),j.current=requestAnimationFrame(F)};return F(),()=>{j.current&&cancelAnimationFrame(j.current)}},[w]);const b=l.useCallback(F=>{const W=u.current;if(!W)return 0;const H=W.getBoundingClientRect();let I;"touches"in F?I=F.touches[0]?.clientX||F.changedTouches?.[0]?.clientX||0:I=F.clientX;const _=I-H.left;return Math.max(0,Math.min(1,_/H.width))},[]),v=l.useCallback(F=>{F.preventDefault(),g(!0);const H=b(F)*n;s(H)},[n,s,b]),S=l.useCallback(F=>{const W=b(F);if(y(W),p){const H=W*n;s(H)}},[p,n,s,b]),A=l.useCallback(F=>{if(p){const H=b(F)*n;a(H),g(!1)}},[p,n,a,b]),E=l.useCallback(()=>{y(null),p&&g(!1)},[p]),P=l.useCallback(F=>{g(!0);const H=b(F)*n;s(H)},[n,s,b]),k=l.useCallback(F=>{if(p){const H=b(F)*n;s(H)}},[p,n,s,b]),R=l.useCallback(F=>{if(p){const H=b(F)*n;a(H),g(!1)}},[p,n,a,b]),z=F=>{const W=Math.floor(F/60),H=Math.floor(F%60);return`${W}:${H.toString().padStart(2,"0")}`},B=l.useMemo(()=>m===null?null:z(m*n),[m,n]);return e.jsxs(h,{sx:{width:"100%",position:"relative"},children:[e.jsxs(h,{ref:u,onMouseDown:v,onMouseMove:S,onMouseUp:A,onMouseLeave:E,onTouchStart:P,onTouchMove:k,onTouchEnd:R,sx:{position:"relative",height:48,cursor:"pointer",borderRadius:1,overflow:"hidden","&:hover":{"& .waveform-handle":{opacity:1}}},children:[e.jsx("canvas",{ref:c,style:{width:"100%",height:"100%",display:"block"}}),e.jsx(h,{className:"waveform-handle",sx:{position:"absolute",top:"50%",left:`${n>0?r/n*100:0}%`,transform:"translate(-50%, -50%)",width:14,height:14,bgcolor:i.palette.mode==="dark"?"#fff":i.palette.primary.main,borderRadius:"50%",boxShadow:i.palette.mode==="dark"?"0 0 10px rgba(255, 255, 255, 0.5)":`0 0 10px ${i.palette.primary.main}40`,opacity:p?1:0,transition:"opacity 0.2s",pointerEvents:"none",zIndex:2}}),m!==null&&B&&e.jsx(h,{sx:{position:"absolute",top:-28,left:`${m*100}%`,transform:"translateX(-50%)",bgcolor:"rgba(0, 0, 0, 0.8)",color:"#fff",px:1,py:.5,borderRadius:1,fontSize:"0.7rem",fontWeight:500,pointerEvents:"none",whiteSpace:"nowrap",zIndex:3},children:B})]}),e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",mt:1},children:[e.jsx(x,{variant:"caption",sx:{color:"text.secondary",fontWeight:500,fontSize:"0.75rem",fontVariantNumeric:"tabular-nums"},children:z(r)}),e.jsx(x,{variant:"caption",sx:{color:"text.secondary",fontWeight:500,fontSize:"0.75rem",fontVariantNumeric:"tabular-nums"},children:z(n)})]})]})}function Lv({audio:t,open:r,onClose:n,onUpdate:s}){const[a,o]=l.useState(!1),[i,c]=l.useState(!1),[u,d]=l.useState([]),[f,p]=l.useState(null),[g,m]=l.useState(null),[y,j]=l.useState(!1),[C,w]=l.useState(t.artist||""),[b,v]=l.useState(t.album||""),[S,A]=l.useState(t.year?.toString()||""),[E,P]=l.useState(t.genre||""),[k,R]=l.useState(t.title),[z,B]=l.useState(t.artist||t.channel_name||"");l.useEffect(()=>{r&&(w(t.artist||""),v(t.album||""),A(t.year?.toString()||""),P(t.genre||""),R(t.title),B(t.artist||t.channel_name||""),d([]),p(null),m(null),j(!1))},[r,t]);const F=async()=>{if(t.youtube_id){c(!0),p(null),d([]);try{const _=await kt.searchMetadata(t.youtube_id,{title:k,artist:z});d(_.data.results||[]),_.data.results.length===0&&p("No matches found. Try adjusting the search terms.")}catch(_){p("Failed to search metadata"),console.error("Metadata search error:",_)}finally{c(!1)}}},W=async()=>{if(t.youtube_id){o(!0),p(null),m(null);try{const _=await kt.autoFetchMetadata(t.youtube_id);if(console.log("[MetadataEditor] Auto-fetch response:",_.data),_.data.audio){const O=_.data.audio;m(` Found: ${O.artist||"Unknown"} - ${O.album||"Unknown"} (${O.year||"?"})`),s?.(O),w(O.artist||""),v(O.album||""),A(O.year?.toString()||""),P(O.genre||"")}else p(_.data.message||"No metadata found")}catch(_){p("Failed to auto-fetch metadata"),console.error("Auto-fetch error:",_)}finally{o(!1)}}},H=async _=>{if(!(!t.youtube_id||!_.musicbrainz_id)){o(!0),p(null),m(null);try{console.log("[MetadataEditor] Applying result:",_);const O=await kt.applyMetadata(t.youtube_id,{musicbrainz_id:_.musicbrainz_id});if(console.log("[MetadataEditor] Apply response:",O.data),O.data.audio){const D=O.data.audio;m(` Applied: ${D.artist||"Unknown"} - ${D.album||"Unknown"} (${D.year||"?"})`),s?.(D),w(D.artist||""),v(D.album||""),A(D.year?.toString()||""),P(D.genre||"")}}catch(O){p("Failed to apply metadata"),console.error("Apply metadata error:",O)}finally{o(!1)}}},I=async()=>{if(t.youtube_id){o(!0),p(null),m(null);try{const _=await kt.applyMetadata(t.youtube_id,{artist:C,album:b,year:S?parseInt(S):null,genre:E,source:"manual"});_.data.audio&&(m("Metadata saved"),s?.(_.data.audio),j(!1))}catch(_){p("Failed to save metadata"),console.error("Save metadata error:",_)}finally{o(!1)}}};return e.jsxs(Ke,{open:r,onClose:n,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(tt,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ht,{color:"primary"}),e.jsx(x,{variant:"h6",children:"Edit Metadata"})]}),e.jsx(X,{onClick:n,size:"small",children:e.jsx(sa,{})})]}),e.jsxs(Xe,{dividers:!0,children:[a&&e.jsx(rt,{sx:{mb:2}}),f&&e.jsx(pe,{severity:"error",sx:{mb:2},onClose:()=>p(null),children:f}),g&&e.jsx(pe,{severity:"success",sx:{mb:2},onClose:()=>m(null),children:g}),e.jsxs(h,{sx:{mb:3},children:[e.jsx(x,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Track"}),e.jsx(x,{variant:"body1",fontWeight:500,noWrap:!0,children:t.title}),e.jsx(x,{variant:"body2",color:"text.secondary",children:t.channel_name})]}),e.jsxs(h,{sx:{mb:3,p:2,bgcolor:"background.default",borderRadius:1},children:[e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx(x,{variant:"subtitle2",color:"text.secondary",children:"Current Metadata"}),e.jsx(N,{size:"small",startIcon:e.jsx(vd,{}),onClick:()=>j(!y),children:y?"Cancel Edit":"Edit Manually"})]}),y?e.jsxs(h,{sx:{display:"flex",flexDirection:"column",gap:2,mt:2},children:[e.jsx(Ce,{label:"Artist",value:C,onChange:_=>w(_.target.value),size:"small",fullWidth:!0}),e.jsx(Ce,{label:"Album",value:b,onChange:_=>v(_.target.value),size:"small",fullWidth:!0}),e.jsxs(h,{sx:{display:"flex",gap:2},children:[e.jsx(Ce,{label:"Year",value:S,onChange:_=>A(_.target.value),size:"small",type:"number",sx:{width:120}}),e.jsx(Ce,{label:"Genre",value:E,onChange:_=>P(_.target.value),size:"small",fullWidth:!0})]}),e.jsx(N,{variant:"contained",onClick:I,disabled:a,children:"Save Changes"})]}):e.jsxs(h,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:[t.artist&&e.jsx(ue,{icon:e.jsx(Va,{}),label:t.artist,size:"small"}),t.album&&e.jsx(ue,{icon:e.jsx(md,{}),label:t.album,size:"small"}),t.year&&e.jsx(ue,{icon:e.jsx(so,{}),label:t.year,size:"small"}),t.genre&&e.jsx(ue,{icon:e.jsx(Ht,{}),label:t.genre,size:"small"}),!t.artist&&!t.album&&!t.year&&!t.genre&&e.jsx(x,{variant:"body2",color:"text.secondary",children:"No metadata available"}),t.metadata_source&&e.jsxs(x,{variant:"caption",color:"text.secondary",sx:{width:"100%",mt:1},children:["Source: ",t.metadata_source]})]})]}),e.jsx(Ee,{sx:{my:2}}),e.jsxs(h,{sx:{mb:3},children:[e.jsx(N,{variant:"contained",color:"primary",startIcon:e.jsx(fr,{}),onClick:W,disabled:a||!t.youtube_id,fullWidth:!0,children:"Auto-Fetch Best Match"}),e.jsx(x,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:1,textAlign:"center"},children:"Automatically finds and applies the best matching metadata from MusicBrainz"})]}),e.jsx(Ee,{sx:{my:2}}),e.jsxs(h,{sx:{mb:2},children:[e.jsx(x,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Search MusicBrainz"}),e.jsxs(h,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(Ce,{label:"Title",value:k,onChange:_=>R(_.target.value),size:"small",fullWidth:!0}),e.jsx(Ce,{label:"Artist",value:z,onChange:_=>B(_.target.value),size:"small",fullWidth:!0})]}),e.jsx(N,{variant:"outlined",startIcon:i?e.jsx(Ie,{size:16}):e.jsx(Uh,{}),onClick:F,disabled:i||!t.youtube_id,fullWidth:!0,children:i?"Searching...":"Search"})]}),u.length>0&&e.jsx(Qe,{dense:!0,sx:{bgcolor:"background.default",borderRadius:1,maxHeight:300,overflow:"auto"},children:u.map((_,O)=>e.jsxs(Le,{sx:{borderBottom:"1px solid",borderColor:"divider","&:last-child":{borderBottom:"none"}},children:[e.jsx(ke,{primary:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1,flexWrap:"wrap"},children:[e.jsx(x,{variant:"body2",fontWeight:500,children:_.title||"Unknown Title"}),e.jsx(ue,{label:`${Math.round(_.confidence*100)}%`,size:"small",color:_.confidence>=.8?"success":_.confidence>=.5?"warning":"default",sx:{height:20}})]}),secondary:e.jsxs(h,{sx:{display:"flex",flexDirection:"column",gap:.5,mt:.5},children:[_.artist&&e.jsxs(x,{variant:"caption",color:"text.secondary",children:["Artist: ",_.artist]}),_.album&&e.jsxs(x,{variant:"caption",color:"text.secondary",children:["Album: ",_.album," ",_.year&&`(${_.year})`]})]})}),e.jsx(Ar,{children:e.jsx(ve,{title:"Apply this metadata",children:e.jsx(X,{edge:"end",onClick:()=>H(_),disabled:a||!_.musicbrainz_id,color:"primary",children:e.jsx(cd,{})})})})]},O))})]}),e.jsx(nt,{children:e.jsx(N,{onClick:n,children:"Close"})})]})}var Es={},Nc;function Wv(){if(Nc)return Es;Nc=1;var t=ne();Object.defineProperty(Es,"__esModule",{value:!0}),Es.default=void 0;var r=t(ae()),n=se();return Es.default=(0,r.default)([(0,n.jsx)("path",{d:"M14 9c0-2.04 1.24-3.79 3-4.57V4c0-1.1-.9-2-2-2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h9c1.1 0 2-.9 2-2v-2.42c-1.76-.78-3-2.53-3-4.58m-4 5H6v-2h4zm3-3H6V9h7zm0-3H6V6h7z"},"0"),(0,n.jsx)("path",{d:"M20 6.18c-.31-.11-.65-.18-1-.18-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3V3h2V1h-4z"},"1")],"Lyrics"),Es}var $v=Wv();const Bv=re($v);var Ts={},Uc;function qv(){if(Uc)return Ts;Uc=1;var t=ne();Object.defineProperty(Ts,"__esModule",{value:!0}),Ts.default=void 0;var r=t(ae()),n=se();return Ts.default=(0,r.default)((0,n.jsx)("path",{d:"M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2M8.5 13.5l2.5 3.01L14.5 12l4.5 6H5z"}),"Image"),Ts}var Nv=qv();const Uv=re(Nv);var zs={},Hc;function Hv(){if(Hc)return zs;Hc=1;var t=ne();Object.defineProperty(zs,"__esModule",{value:!0}),zs.default=void 0;var r=t(ae()),n=se();return zs.default=(0,r.default)((0,n.jsx)("path",{d:"M19 4H5c-1.11 0-2 .9-2 2v12c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m-8 11H9.5v-2h-2v2H6V9h1.5v2.5h2V9H11zm7-1c0 .55-.45 1-1 1h-.75v1.5h-1.5V15H14c-.55 0-1-.45-1-1v-4c0-.55.45-1 1-1h3c.55 0 1 .45 1 1zm-3.5-.5h2v-3h-2z"}),"HighQuality"),zs}var Vv=Hv();const Yv=re(Vv);function Gv({open:t,onClose:r,youtubeId:n,title:s}){const[a,o]=l.useState(!0),[i,c]=l.useState(!1),[u,d]=l.useState(""),[f,p]=l.useState(null),[g,m]=l.useState("mp3"),[y,j]=l.useState("high"),[C,w]=l.useState(!0),[b,v]=l.useState(!0),[S,A]=l.useState("");l.useEffect(()=>{t&&n&&E()},[t,n]);const E=async()=>{try{o(!0),d(""),console.log(`[Export] Loading options for ${n}`);const R=await V.get(`/audio/${n}/export/`);console.log("[Export] Response:",R.data),console.log(`[Export] has_lyrics=${R.data.has_lyrics}, has_synced=${R.data.has_synced_lyrics}`),p(R.data),R.data.artwork_sources?.length>0&&A(R.data.artwork_sources[0].url)}catch(R){console.error("[Export] Error:",R),d(R.response?.data?.error||"Failed to load export options")}finally{o(!1)}},P=async()=>{try{c(!0),d("");const R=await V.post(`/audio/${n}/export/`,{format:g,quality:y,embed_lyrics:C,embed_artwork:b,artwork_url:b?S:""},{responseType:"blob"}),z=R.headers["content-disposition"];let B=`${f?.title||"audio"}.${g}`;if(z){const I=z.match(/filename="(.+)"/);I&&(B=I[1])}const F=new Blob([R.data],{type:g==="mp3"?"audio/mpeg":"audio/flac"}),W=window.URL.createObjectURL(F),H=document.createElement("a");H.href=W,H.download=B,document.body.appendChild(H),H.click(),document.body.removeChild(H),window.URL.revokeObjectURL(W),r()}catch(R){console.error("Export failed:",R),d(R.response?.data?.error||"Export failed. Please try again.")}finally{c(!1)}},k=R=>{switch(R){case"high":return"High (320 kbps)";case"medium":return"Medium (192 kbps)";case"low":return"Low (128 kbps)";default:return R}};return e.jsxs(Ke,{open:t,onClose:r,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(tt,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Or,{}),"Export Track"]}),e.jsx(Xe,{dividers:!0,children:a?e.jsx(h,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(Ie,{})}):u&&!f?e.jsx(pe,{severity:"error",children:u}):f?e.jsxs(h,{sx:{display:"flex",flexDirection:"column",gap:3},children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(Ve,{src:f.artwork_sources?.[0]?.url,variant:"rounded",sx:{width:64,height:64},children:e.jsx(Lt,{})}),e.jsxs(h,{children:[e.jsx(x,{variant:"subtitle1",fontWeight:600,children:f.title}),e.jsx(x,{variant:"body2",color:"text.secondary",children:f.artist}),f.album&&e.jsx(x,{variant:"caption",color:"text.secondary",children:f.album})]})]}),e.jsx(Ee,{}),e.jsxs(Ct,{component:"fieldset",children:[e.jsxs(Hh,{component:"legend",sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Lt,{fontSize:"small"}),"Output Format"]}),e.jsxs(xd,{value:g,onChange:R=>m(R.target.value),children:[e.jsx(We,{value:"mp3",control:e.jsx(Ho,{}),label:e.jsxs(h,{children:[e.jsx(x,{variant:"body2",children:"MP3"}),e.jsx(x,{variant:"caption",color:"text.secondary",children:"Compressed, universal compatibility, embedded synced lyrics (SYLT)"})]})}),e.jsx(We,{value:"flac",control:e.jsx(Ho,{}),label:e.jsxs(h,{children:[e.jsx(x,{variant:"body2",children:"FLAC"}),e.jsx(x,{variant:"caption",color:"text.secondary",children:"Lossless quality, larger file, embedded LRC in metadata"})]})})]})]}),g==="mp3"&&e.jsxs(Ct,{fullWidth:!0,size:"small",children:[e.jsx(Wt,{children:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Yv,{fontSize:"small"}),"Quality"]})}),e.jsxs(Rt,{value:y,onChange:R=>j(R.target.value),label:"Quality",children:[e.jsx(we,{value:"high",children:k("high")}),e.jsx(we,{value:"medium",children:k("medium")}),e.jsx(we,{value:"low",children:k("low")})]})]}),e.jsx(Ee,{}),e.jsxs(h,{children:[e.jsxs(x,{variant:"subtitle2",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Bv,{fontSize:"small"}),"Lyrics"]}),e.jsx(We,{control:e.jsx(qo,{checked:C,onChange:R=>w(R.target.checked),disabled:!f.has_lyrics}),label:e.jsxs(h,{children:[e.jsx(x,{variant:"body2",children:"Embed lyrics in file"}),e.jsx(Vo,{direction:"row",spacing:1,sx:{mt:.5},children:f.has_synced_lyrics?e.jsx(ue,{label:` Synced lyrics will be embedded${g==="mp3"?" (SYLT)":" (LRC)"}`,size:"small",color:"success"}):f.has_lyrics?e.jsx(ue,{label:" Plain lyrics will be embedded",size:"small",color:"info"}):e.jsx(ue,{label:"No lyrics to embed",size:"small",color:"default",variant:"outlined"})})]})})]}),e.jsxs(h,{children:[e.jsxs(x,{variant:"subtitle2",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Uv,{fontSize:"small"}),"Album Artwork"]}),e.jsx(We,{control:e.jsx(qo,{checked:b,onChange:R=>v(R.target.checked),disabled:!f.has_artwork}),label:"Embed album artwork"}),b&&f.artwork_sources&&f.artwork_sources.length>0&&e.jsxs(Ct,{fullWidth:!0,size:"small",sx:{mt:1},children:[e.jsx(Wt,{children:"Artwork Source"}),e.jsx(Rt,{value:S,onChange:R=>A(R.target.value),label:"Artwork Source",children:f.artwork_sources.map((R,z)=>e.jsx(we,{value:R.url,children:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ve,{src:R.url,variant:"rounded",sx:{width:32,height:32}}),R.label]})},z))})]})]}),u&&e.jsx(pe,{severity:"error",sx:{mt:1},children:u})]}):null}),e.jsxs(nt,{children:[e.jsx(N,{onClick:r,disabled:i,children:"Cancel"}),e.jsx(N,{variant:"contained",onClick:P,disabled:a||i||!f,startIcon:i?e.jsx(Ie,{size:20}):e.jsx(Or,{}),children:i?"Exporting...":`Export as ${g.toUpperCase()}`})]})]})}var Os={},Vc;function Qv(){if(Vc)return Os;Vc=1;var t=ne();Object.defineProperty(Os,"__esModule",{value:!0}),Os.default=void 0;var r=t(ae()),n=se();return Os.default=(0,r.default)((0,n.jsx)("path",{d:"M9 1h6v2H9zm10.03 6.39 1.42-1.42c-.43-.51-.9-.99-1.41-1.41l-1.42 1.42C16.07 4.74 14.12 4 12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9 9-4.03 9-9c0-2.12-.74-4.07-1.97-5.61M13 14h-2V8h2z"}),"Timer"),Os}var Kv=Qv();const Xv=re(Kv);var Fs={},Yc;function Jv(){if(Yc)return Fs;Yc=1;var t=ne();Object.defineProperty(Fs,"__esModule",{value:!0}),Fs.default=void 0;var r=t(ae()),n=se();return Fs.default=(0,r.default)((0,n.jsx)("path",{d:"M5.59 7.41 10.18 12l-4.59 4.59L7 18l6-6-6-6zM16 6h2v12h-2z"}),"LastPage"),Fs}var Zv=Jv();const e1=re(Zv),t1=[5,10,15,30,45,60,90,120],r1=[1,3,5,10,15,20];function n1({open:t,onClose:r}){const{timerState:n,startTimer:s,stopTimer:a}=Gu(),[o,i]=l.useState(n.mode||"minutes"),[c,u]=l.useState(n.remainingMinutes||30),[d,f]=l.useState(n.remainingSongs||5),[p,g]=l.useState(n.fadeOut??!0),[m,y]=l.useState(n.fadeDuration||30),j=(S,A)=>{A&&i(A)},C=()=>{s({mode:o,minutes:c,songs:d,fadeOut:p,fadeDuration:m}),r()},w=()=>{a(),r()},b=S=>{if(S<60)return`${Math.round(S)} min`;const A=Math.floor(S/60),E=Math.round(S%60);return E===0?`${A} hr`:`${A} hr ${E} min`},v=()=>{if(!n.isActive)return"";if(n.mode==="minutes"){const S=n.remainingMinutes;return S<1?`${Math.round(S*60)} seconds remaining`:`${b(S)} remaining`}else return n.mode==="songs"?`${n.remainingSongs} song${n.remainingSongs!==1?"s":""} remaining`:"Stopping after this track"};return e.jsxs(Ke,{open:t,onClose:r,maxWidth:"xs",fullWidth:!0,PaperProps:{sx:{borderRadius:3,bgcolor:"background.paper"}},children:[e.jsxs(tt,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(si,{sx:{color:"primary.main"}}),"Sleep Timer",e.jsx(X,{onClick:r,sx:{ml:"auto"},size:"small",children:e.jsx(Gt,{})})]}),e.jsxs(Xe,{children:[n.isActive&&e.jsxs(h,{sx:{mb:3,p:2,borderRadius:2,bgcolor:"primary.main",color:"primary.contrastText",textAlign:"center"},children:[e.jsx(x,{variant:"body2",sx:{opacity:.9,mb:.5},children:"Timer Active"}),e.jsx(x,{variant:"h6",sx:{fontWeight:600},children:v()}),n.isFading&&e.jsx(ue,{label:"Fading out...",size:"small",sx:{mt:1,bgcolor:"rgba(255,255,255,0.2)"}})]}),e.jsx(x,{variant:"subtitle2",sx:{mb:1,color:"text.secondary"},children:"Stop playback after"}),e.jsxs(Vh,{value:o,exclusive:!0,onChange:j,fullWidth:!0,sx:{mb:3},children:[e.jsx(_o,{value:"minutes",sx:{flex:1},children:e.jsxs(h,{sx:{display:"flex",flexDirection:"column",alignItems:"center",py:.5},children:[e.jsx(Xv,{sx:{mb:.5}}),e.jsx(x,{variant:"caption",children:"Time"})]})}),e.jsx(_o,{value:"songs",sx:{flex:1},children:e.jsxs(h,{sx:{display:"flex",flexDirection:"column",alignItems:"center",py:.5},children:[e.jsx(Lt,{sx:{mb:.5}}),e.jsx(x,{variant:"caption",children:"Songs"})]})}),e.jsx(_o,{value:"endOfTrack",sx:{flex:1},children:e.jsxs(h,{sx:{display:"flex",flexDirection:"column",alignItems:"center",py:.5},children:[e.jsx(e1,{sx:{mb:.5}}),e.jsx(x,{variant:"caption",children:"This Track"})]})})]}),o==="minutes"&&e.jsxs(h,{sx:{mb:3},children:[e.jsx(x,{variant:"body2",sx:{mb:1.5,textAlign:"center",fontWeight:500},children:b(c)}),e.jsx(Pr,{value:c,onChange:(S,A)=>u(A),min:5,max:120,step:5,marks:[{value:5,label:"5m"},{value:30,label:"30m"},{value:60,label:"1h"},{value:120,label:"2h"}],sx:{mb:2}}),e.jsx(h,{sx:{display:"flex",gap:1,flexWrap:"wrap",justifyContent:"center"},children:t1.map(S=>e.jsx(ue,{label:b(S),size:"small",variant:c===S?"filled":"outlined",color:c===S?"primary":"default",onClick:()=>u(S),sx:{cursor:"pointer"}},S))})]}),o==="songs"&&e.jsxs(h,{sx:{mb:3},children:[e.jsxs(x,{variant:"body2",sx:{mb:1.5,textAlign:"center",fontWeight:500},children:[d," song",d!==1?"s":""]}),e.jsx(Pr,{value:d,onChange:(S,A)=>f(A),min:1,max:30,step:1,marks:[{value:1,label:"1"},{value:10,label:"10"},{value:20,label:"20"},{value:30,label:"30"}],sx:{mb:2}}),e.jsx(h,{sx:{display:"flex",gap:1,flexWrap:"wrap",justifyContent:"center"},children:r1.map(S=>e.jsx(ue,{label:`${S} song${S!==1?"s":""}`,size:"small",variant:d===S?"filled":"outlined",color:d===S?"primary":"default",onClick:()=>f(S),sx:{cursor:"pointer"}},S))})]}),o==="endOfTrack"&&e.jsx(h,{sx:{mb:3,textAlign:"center"},children:e.jsx(x,{variant:"body2",color:"text.secondary",children:"Playback will stop when the current track ends."})}),e.jsxs(h,{sx:{p:2,borderRadius:2,bgcolor:"rgba(255,255,255,0.03)",border:"1px solid",borderColor:"rgba(255,255,255,0.1)"},children:[e.jsx(We,{control:e.jsx(et,{checked:p,onChange:S=>g(S.target.checked),color:"primary"}),label:e.jsxs(h,{children:[e.jsx(x,{variant:"body2",children:"Fade out before stopping"}),e.jsx(x,{variant:"caption",color:"text.secondary",children:"Gradually reduce volume for a smoother ending"})]})}),p&&o==="minutes"&&e.jsxs(h,{sx:{mt:2,pl:2},children:[e.jsxs(x,{variant:"caption",color:"text.secondary",gutterBottom:!0,children:["Fade duration: ",m," seconds"]}),e.jsx(Pr,{value:m,onChange:(S,A)=>y(A),min:10,max:60,step:5,size:"small",marks:[{value:10,label:"10s"},{value:30,label:"30s"},{value:60,label:"60s"}]})]})]})]}),e.jsx(nt,{sx:{px:3,pb:3,gap:1},children:n.isActive?e.jsxs(e.Fragment,{children:[e.jsx(N,{onClick:w,variant:"outlined",color:"error",fullWidth:!0,children:"Cancel Timer"}),e.jsx(N,{onClick:C,variant:"contained",fullWidth:!0,children:"Update Timer"})]}):e.jsx(N,{onClick:C,variant:"contained",fullWidth:!0,startIcon:e.jsx(si,{}),children:"Start Sleep Timer"})})]})}const s1=t=>{if(!t||t<=0)return"--:--";const r=Math.floor(t/60),n=Math.floor(t%60);return`${r}:${n.toString().padStart(2,"0")}`};function a1({open:t,onClose:r,queue:n,currentIndex:s,onPlayTrack:a,onRemoveTrack:o,onReorderTrack:i,onClearQueue:c}){const u=Pt(),d=ao(u.breakpoints.down("md")),[f,p]=l.useState(null),[g,m]=l.useState(null),y=n.slice(s+1),j=n.slice(0,s),C=n[s],w=(P,k)=>{if(k===s){P.preventDefault();return}p(k),P.dataTransfer.effectAllowed="move",P.dataTransfer.setData("text/plain",k.toString())},b=(P,k)=>{P.preventDefault(),k!==s&&m(k)},v=()=>{m(null)},S=(P,k)=>{P.preventDefault();const R=f;p(null),m(null),!(R===null||R===k||k===s)&&i(R,k)},A=()=>{p(null),m(null)},E=(P,k,R=!1)=>{const z=k===s,B=k===f,F=k===g,W=!z;return e.jsxs(Le,{draggable:W,onDragStart:H=>w(H,k),onDragOver:H=>b(H,k),onDragLeave:v,onDrop:H=>S(H,k),onDragEnd:A,sx:{borderRadius:2,mb:.5,transition:"all 0.2s ease",opacity:B?.5:R?.6:1,bgcolor:z?$e(u.palette.primary.main,.15):F?$e(u.palette.primary.main,.1):"transparent",borderLeft:z?`3px solid ${u.palette.primary.main}`:F?`3px solid ${$e(u.palette.primary.main,.5)}`:"3px solid transparent",cursor:W?"grab":"default","&:hover":{bgcolor:z?$e(u.palette.primary.main,.2):$e(u.palette.action.hover,.1)},"&:active":W?{cursor:"grabbing"}:{}},secondaryAction:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:.5},children:[!z&&e.jsxs(e.Fragment,{children:[e.jsx(ve,{title:"Play",children:e.jsx(X,{size:"small",onClick:()=>a(k),sx:{opacity:.7,"&:hover":{opacity:1}},children:e.jsx(ar,{fontSize:"small"})})}),e.jsx(ve,{title:"Remove from queue",children:e.jsx(X,{size:"small",onClick:()=>o(k),sx:{opacity:.7,"&:hover":{opacity:1,color:"error.main"}},children:e.jsx(Er,{fontSize:"small"})})})]}),z&&e.jsx(Qh,{fontSize:"small",sx:{color:"primary.main",animation:"pulse 1.5s ease-in-out infinite","@keyframes pulse":{"0%, 100%":{opacity:1},"50%":{opacity:.5}}}})]}),children:[W&&e.jsx(Gh,{sx:{mr:1,color:"text.disabled",cursor:"grab","&:hover":{color:"text.secondary"}}}),e.jsx(Ft,{children:e.jsx(Ve,{variant:"rounded",src:P.cover_art_url||P.thumbnail_url,sx:{width:48,height:48,bgcolor:"background.paper"},children:e.jsx(Ht,{})})}),e.jsx(ke,{primary:e.jsx(x,{variant:"body2",noWrap:!0,sx:{fontWeight:z?600:400,color:z?"primary.main":"text.primary"},children:P.title}),secondary:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(x,{variant:"caption",color:"text.secondary",noWrap:!0,children:P.channel_name||P.artist||"Unknown Artist"}),e.jsx(x,{variant:"caption",color:"text.disabled",children:s1(P.duration)})]}),sx:{mr:8}})]},`${P.id}-${k}`)};return e.jsx(kd,{anchor:"right",open:t,onClose:r,PaperProps:{sx:{width:d?"100%":400,maxWidth:"100%",bgcolor:"background.default",backgroundImage:"none"}},children:e.jsxs(h,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs(h,{sx:{p:2,display:"flex",alignItems:"center",justifyContent:"space-between",borderBottom:1,borderColor:"divider"},children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(No,{color:"primary"}),e.jsx(x,{variant:"h6",fontWeight:600,children:"Queue"}),e.jsx(ue,{label:n.length,size:"small",sx:{ml:1,height:22}})]}),e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1},children:[n.length>1&&e.jsx(ve,{title:"Clear queue (except current)",children:e.jsx(X,{size:"small",onClick:c,sx:{color:"text.secondary"},children:e.jsx(Yh,{})})}),e.jsx(X,{onClick:r,children:e.jsx(sa,{})})]})]}),e.jsx(h,{sx:{flex:1,overflow:"auto",p:1},children:n.length===0?e.jsxs(h,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",opacity:.6},children:[e.jsx(No,{sx:{fontSize:64,mb:2,color:"text.disabled"}}),e.jsx(x,{color:"text.secondary",children:"Your queue is empty"}),e.jsx(x,{variant:"caption",color:"text.disabled",sx:{mt:1},children:"Play something or add tracks to the queue"})]}):e.jsxs(Qe,{disablePadding:!0,children:[C&&e.jsxs(e.Fragment,{children:[e.jsx(x,{variant:"overline",sx:{px:2,py:1,display:"block",color:"text.secondary"},children:"Now Playing"}),E(C,s)]}),y.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(Ee,{sx:{my:1}}),e.jsxs(x,{variant:"overline",sx:{px:2,py:1,display:"block",color:"text.secondary"},children:["Up Next (",y.length,")"]}),y.map((P,k)=>E(P,s+1+k))]}),j.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(Ee,{sx:{my:1}}),e.jsxs(x,{variant:"overline",sx:{px:2,py:1,display:"block",color:"text.disabled"},children:["Previously Played (",j.length,")"]}),j.map((P,k)=>E(P,k,!0))]})]})}),n.length>0&&e.jsx(h,{sx:{p:2,borderTop:1,borderColor:"divider",bgcolor:"background.paper"},children:e.jsxs(x,{variant:"caption",color:"text.secondary",children:[y.length," track",y.length!==1?"s":""," remaining","  ",o1(y)]})})]})})}function o1(t){const r=t.reduce((a,o)=>a+(o.duration||0),0);if(r<=0)return"Unknown duration";const n=Math.floor(r/3600),s=Math.floor(r%3600/60);return n>0?`${n}h ${s}m`:`${s} min`}var Ls={},Gc;function i1(){if(Gc)return Ls;Gc=1;var t=ne();Object.defineProperty(Ls,"__esModule",{value:!0}),Ls.default=void 0;var r=t(ae()),n=se();return Ls.default=(0,r.default)((0,n.jsx)("path",{d:"M12 5V2L8 6l4 4V7c3.31 0 6 2.69 6 6 0 2.97-2.17 5.43-5 5.91v2.02c3.95-.49 7-3.85 7-7.93 0-4.42-3.58-8-8-8m-6 8c0-1.65.67-3.15 1.76-4.24L6.34 7.34C4.9 8.79 4 10.79 4 13c0 4.08 3.05 7.44 7 7.93v-2.02c-2.83-.48-5-2.94-5-5.91"}),"RestartAlt"),Ls}var l1=i1();const c1=re(l1);var Ws={},Qc;function d1(){if(Qc)return Ws;Qc=1;var t=ne();Object.defineProperty(Ws,"__esModule",{value:!0}),Ws.default=void 0;var r=t(ae()),n=se();return Ws.default=(0,r.default)((0,n.jsx)("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m3-10H5V5h10z"}),"Save"),Ws}var u1=d1();const h1=re(u1);var $s={},Kc;function f1(){if(Kc)return $s;Kc=1;var t=ne();Object.defineProperty($s,"__esModule",{value:!0}),$s.default=void 0;var r=t(ae()),n=se();return $s.default=(0,r.default)((0,n.jsx)("path",{d:"M3 17v2h6v-2zM3 5v2h10V5zm10 16v-2h8v-2h-8v-2h-2v6zM7 9v2H3v2h4v2h2V9zm14 4v-2H11v2zm-6-4h2V7h4V5h-4V3h-2z"}),"Tune"),$s}var x1=f1();const Zu=re(x1);function p1({open:t,onClose:r}){const n=Pt(),s=ao(n.breakpoints.down("sm")),{enabled:a,activePresetId:o,gains:i,presets:c,customPresets:u,setEnabled:d,setGain:f,selectPreset:p,saveCustomPreset:g,deleteCustomPreset:m,resetToFlat:y}=Ku(),[j,C]=l.useState(!1),[w,b]=l.useState(""),v=c.find(R=>R.id===o),S=o==="custom"||v?.isCustom,A=R=>{p(R.target.value)},E=R=>(z,B)=>{f(R,B)},P=()=>{w.trim()&&(g(w.trim()),b(""),C(!1))},k=l.useMemo(()=>{const R=s?280:500,z=80,B=10,F=i.map((H,I)=>{const _=B+I/(i.length-1)*(R-B*2),O=z/2-H/Js*(z/2-B);return{x:_,y:O}});let W=`M ${F[0].x} ${F[0].y}`;for(let H=1;H<F.length;H++){const I=F[H-1],_=F[H],O=(I.x+_.x)/2;W+=` Q ${O} ${I.y} ${O} ${(I.y+_.y)/2}`,W+=` Q ${O} ${_.y} ${_.x} ${_.y}`}return e.jsx(h,{sx:{width:"100%",display:"flex",justifyContent:"center",mb:2,opacity:a?1:.3,transition:"opacity 0.3s"},children:e.jsxs("svg",{width:R,height:z,style:{overflow:"visible"},children:[e.jsx("line",{x1:B,y1:z/2,x2:R-B,y2:z/2,stroke:$e(n.palette.text.secondary,.2),strokeDasharray:"4 4"}),e.jsx("line",{x1:B,y1:z/4,x2:R-B,y2:z/4,stroke:$e(n.palette.text.secondary,.1),strokeDasharray:"2 4"}),e.jsx("line",{x1:B,y1:3*z/4,x2:R-B,y2:3*z/4,stroke:$e(n.palette.text.secondary,.1),strokeDasharray:"2 4"}),e.jsx("defs",{children:e.jsxs("linearGradient",{id:"curveGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:n.palette.primary.main,stopOpacity:.4}),e.jsx("stop",{offset:"100%",stopColor:n.palette.primary.main,stopOpacity:.05})]})}),e.jsx("path",{d:`${W} L ${F[F.length-1].x} ${z/2} L ${F[0].x} ${z/2} Z`,fill:"url(#curveGradient)"}),e.jsx("path",{d:W,fill:"none",stroke:n.palette.primary.main,strokeWidth:2,strokeLinecap:"round"}),F.map((H,I)=>e.jsx("circle",{cx:H.x,cy:H.y,r:4,fill:n.palette.primary.main,stroke:n.palette.background.paper,strokeWidth:1},I))]})})},[i,a,n,s]);return e.jsxs(e.Fragment,{children:[e.jsxs(Ke,{open:t,onClose:r,maxWidth:"md",fullWidth:!0,fullScreen:s,PaperProps:{sx:{bgcolor:"background.paper",backgroundImage:"none"}},children:[e.jsxs(tt,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ji,{color:"primary"}),e.jsx(x,{variant:"h6",sx:{flexGrow:1},children:"Equalizer"}),e.jsx(We,{control:e.jsx(et,{checked:a,onChange:R=>d(R.target.checked),color:"primary"}),label:a?"On":"Off"})]}),e.jsxs(Xe,{children:[k,e.jsxs(h,{sx:{display:"flex",gap:2,mb:3,flexWrap:"wrap",alignItems:"center"},children:[e.jsxs(Ct,{size:"small",sx:{minWidth:150},children:[e.jsx(Wt,{children:"Preset"}),e.jsxs(Rt,{value:o==="custom"?"":o,onChange:A,label:"Preset",displayEmpty:!0,children:[o==="custom"&&e.jsx(we,{value:"",disabled:!0,children:e.jsx("em",{children:"Custom"})}),e.jsx(we,{disabled:!0,sx:{opacity:.7,fontSize:"0.75rem"},children:" Built-in "}),ai.map(R=>e.jsx(we,{value:R.id,children:R.name},R.id)),u.length>0&&e.jsx(we,{disabled:!0,sx:{opacity:.7,fontSize:"0.75rem"},children:" Custom "}),u.map(R=>e.jsx(we,{value:R.id,children:R.name},R.id))]})]}),e.jsx(ve,{title:"Reset to Flat",children:e.jsx(X,{onClick:y,size:"small",children:e.jsx(c1,{})})}),e.jsx(ve,{title:"Save as Custom Preset",children:e.jsx(X,{onClick:()=>C(!0),size:"small",color:"primary",children:e.jsx(h1,{})})}),v?.isCustom&&e.jsx(ve,{title:"Delete Custom Preset",children:e.jsx(X,{onClick:()=>m(o),size:"small",color:"error",children:e.jsx(jo,{})})}),S&&e.jsx(ue,{icon:e.jsx(Zu,{sx:{fontSize:16}}),label:"Custom",size:"small",color:"secondary",variant:"outlined"})]}),e.jsx(Ee,{sx:{mb:3}}),e.jsx(h,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-end",gap:s?.5:1,px:s?0:2,opacity:a?1:.4,transition:"opacity 0.3s",pointerEvents:a?"auto":"none"},children:av.map((R,z)=>e.jsxs(h,{sx:{display:"flex",flexDirection:"column",alignItems:"center",flex:1},children:[e.jsxs(x,{variant:"caption",sx:{mb:1,color:i[z]>0?"success.main":i[z]<0?"error.main":"text.secondary",fontWeight:600,fontSize:s?"0.65rem":"0.75rem"},children:[i[z]>0?"+":"",i[z]]}),e.jsx(Pr,{orientation:"vertical",value:i[z],min:to,max:Js,step:1,onChange:E(z),sx:{height:s?100:150,"& .MuiSlider-track":{width:4,background:B=>i[z]>=0?`linear-gradient(to top, ${B.palette.primary.main}, ${B.palette.success.main})`:`linear-gradient(to bottom, ${B.palette.primary.main}, ${B.palette.error.main})`},"& .MuiSlider-rail":{width:4,opacity:.3},"& .MuiSlider-thumb":{width:s?14:16,height:s?14:16,"&:hover, &.Mui-focusVisible":{boxShadow:B=>`0 0 0 8px ${$e(B.palette.primary.main,.16)}`}}}}),e.jsx(x,{variant:"caption",sx:{mt:1,color:"text.secondary",fontSize:s?"0.6rem":"0.7rem",fontWeight:500},children:R})]},R))}),e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",mt:2,px:2},children:[e.jsxs(x,{variant:"caption",color:"text.secondary",children:["+",Js,"dB"]}),e.jsx(x,{variant:"caption",color:"text.secondary",children:"0dB"}),e.jsxs(x,{variant:"caption",color:"text.secondary",children:[to,"dB"]})]}),s&&e.jsx(h,{sx:{mt:3,display:"flex",flexWrap:"wrap",gap:1,justifyContent:"center"},children:ai.slice(0,6).map(R=>e.jsx(ue,{label:R.name,size:"small",variant:o===R.id?"filled":"outlined",color:o===R.id?"primary":"default",onClick:()=>p(R.id),sx:{fontSize:"0.75rem"}},R.id))})]}),e.jsx(nt,{children:e.jsx(N,{onClick:r,children:"Close"})})]}),e.jsxs(Ke,{open:j,onClose:()=>C(!1),maxWidth:"xs",fullWidth:!0,children:[e.jsx(tt,{children:"Save Custom Preset"}),e.jsx(Xe,{children:e.jsx(Ce,{autoFocus:!0,margin:"dense",label:"Preset Name",fullWidth:!0,variant:"outlined",value:w,onChange:R=>b(R.target.value),onKeyDown:R=>{R.key==="Enter"&&w.trim()&&P()}})}),e.jsxs(nt,{children:[e.jsx(N,{onClick:()=>C(!1),children:"Cancel"}),e.jsx(N,{onClick:P,variant:"contained",disabled:!w.trim(),children:"Save"})]})]})]})}var Bs={},Xc;function m1(){if(Xc)return Bs;Xc=1;var t=ne();Object.defineProperty(Bs,"__esModule",{value:!0}),Bs.default=void 0;var r=t(ae()),n=se();return Bs.default=(0,r.default)((0,n.jsx)("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8zm4 18H6V4h7v5h5zM8 15.01l1.41 1.41L11 14.84V19h2v-4.16l1.59 1.59L16 15.01 12.01 11z"}),"UploadFile"),Bs}var g1=m1();const Wo=re(g1);var qs={},Jc;function y1(){if(Jc)return qs;Jc=1;var t=ne();Object.defineProperty(qs,"__esModule",{value:!0}),qs.default=void 0;var r=t(ae()),n=se();return qs.default=(0,r.default)((0,n.jsx)("path",{d:"m20.41 8.41-4.83-4.83c-.37-.37-.88-.58-1.41-.58H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V9.83c0-.53-.21-1.04-.59-1.42M7 7h7v2H7zm10 10H7v-2h10zm0-4H7v-2h10z"}),"TextSnippet"),qs}var b1=y1();const v1=re(b1);var Ns={},Zc;function j1(){if(Zc)return Ns;Zc=1;var t=ne();Object.defineProperty(Ns,"__esModule",{value:!0}),Ns.default=void 0;var r=t(ae()),n=se();return Ns.default=(0,r.default)((0,n.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM8 9h8v10H8zm7.5-5-1-1h-5l-1 1H5v2h14V4z"}),"DeleteOutline"),Ns}var w1=j1();const S1=re(w1);var Us={},ed;function C1(){if(ed)return Us;ed=1;var t=ne();Object.defineProperty(Us,"__esModule",{value:!0}),Us.default=void 0;var r=t(ae()),n=se();return Us.default=(0,r.default)((0,n.jsx)("path",{d:"M6.99 11 3 15l3.99 4v-3H14v-2H6.99zM21 9l-3.99-4v3H10v2h7.01v3z"}),"SwapHoriz"),Us}var k1=C1();const _1=re(k1);function R1({youtubeId:t,currentTime:r,onClose:n,embedded:s=!1,onSeek:a,visualizerTheme:o,isLightMode:i}){const{settings:c}=Cr(),u=Pt(),d=o||c.visualizer_theme||qu,f=i!==void 0?i:u.palette.mode==="light",p=u.palette.primary.main,[g,m]=l.useState(null),[y,j]=l.useState(!0),[C,w]=l.useState(""),[b,v]=l.useState([]),[S,A]=l.useState(-1),[E,P]=l.useState(0),[k,R]=l.useState(!0),[z,B]=l.useState(0),F=l.useMemo(()=>(console.log("[LyricsPlayer] Getting colors - theme:",d,"lightMode:",f,"muiColor:",p),my(d,f,p)),[d,f,p]),[W,H]=l.useState([]),[I,_]=l.useState(!1),[O,D]=l.useState(!1),[Q,J]=l.useState(""),[M,T]=l.useState(null),[te,$]=l.useState(!1),[U,K]=l.useState(!1),[ce,q]=l.useState(null),[oe,ie]=l.useState(!1),[Ue,Be]=l.useState(!1),le=l.useRef(null),xe=l.useRef(null),ge=l.useRef(null);l.useEffect(()=>{me()},[t]),l.useEffect(()=>{g?.is_synced&&b.length>0&&bt()},[r,b]),l.useEffect(()=>{if(k&&ge.current&&xe.current){const G=xe.current,fe=ge.current,be=G.clientHeight,Se=fe.offsetTop;G.scrollTo({top:Se-be/2+fe.clientHeight/2,behavior:"smooth"})}},[S,k]);const me=async()=>{try{j(!0),w("");let G=null;try{const be=ut.getLyrics(t),Se=new Promise((De,Oe)=>setTimeout(()=>Oe(new Error("Cache timeout")),2e3));G=await Promise.race([be,Se])}catch(be){console.log("[Lyrics] Cache check failed or timed out:",be)}if(G){if(console.log("[Lyrics] Loading from offline cache"),m(G),G.is_synced){const be=Vt(G.synced_lyrics);v(be)}j(!1),navigator.onLine&&V.get(`/audio/${t}/lyrics/`).then(be=>{if(m(be.data),be.data.is_synced){const Se=Vt(be.data.synced_lyrics);v(Se)}ut.saveLyrics(t,be.data).catch(()=>{})}).catch(()=>{});return}if(!navigator.onLine){w("Lyrics not available offline"),j(!1);return}const fe=await V.get(`/audio/${t}/lyrics/`);if(m(fe.data),fe.data.is_synced){const be=Vt(fe.data.synced_lyrics);v(be)}ut.saveLyrics(t,fe.data).catch(()=>{})}catch(G){w(G.response?.data?.error||"Failed to load lyrics")}finally{j(!1)}},ye=async()=>{try{j(!0),w("");const G=await V.post(`/audio/${t}/lyrics/fetch/`,{force:!0});if(m(G.data),G.data.is_synced){const fe=Vt(G.data.synced_lyrics);v(fe)}!G.data.has_lyrics&&!G.data.is_instrumental&&Et()}catch(G){w(G.response?.data?.error||"Failed to fetch lyrics")}finally{j(!1)}},Et=async G=>{try{_(!0);const fe=G?`?q=${encodeURIComponent(G)}`:"",be=await V.get(`/audio/${t}/lyrics/suggestions/${fe}`);H(be.data.suggestions||[]),D(!0)}catch(fe){console.error("Failed to load suggestions:",fe)}finally{_(!1)}},xr=async G=>{try{T(G.id);const fe=await V.post(`/audio/${t}/lyrics/apply/`,{synced_lyrics:G.synced_lyrics,plain_lyrics:G.plain_lyrics,instrumental:G.instrumental,language:G.language,track_name:G.track_name,artist_name:G.artist_name});if(m(fe.data),fe.data.is_synced){const be=Vt(fe.data.synced_lyrics);v(be)}D(!1),H([]),$(!1)}catch(fe){w(fe.response?.data?.error||"Failed to apply lyrics")}finally{T(null)}},ft=async()=>{try{K(!0),await V.delete(`/audio/${t}/lyrics/delete/`),m({audio_id:t,audio_title:g?.audio_title||"",synced_lyrics:"",plain_lyrics:"",is_instrumental:!1,source:"",language:"",has_lyrics:!1,is_synced:!1,display_lyrics:"",fetch_attempted:!0,fetch_attempts:0,last_error:""}),v([]),$(!1),Et()}catch(G){w(G.response?.data?.error||"Failed to delete lyrics")}finally{K(!1)}},ir=G=>{G.preventDefault(),Q.trim()&&Et(Q.trim())},Zt=G=>{const fe=Math.floor(G/60),be=G%60;return`${fe}:${be.toString().padStart(2,"0")}`},pr=async G=>{q(null);try{const fe=await V.get(`/audio/${t}/lyrics/download/?type=${G}`,{responseType:"blob"}),be=new Blob([fe.data],{type:"text/plain;charset=utf-8"}),Se=window.URL.createObjectURL(be),De=document.createElement("a");De.href=Se;const Oe=fe.headers["content-disposition"];let vt=`lyrics.${G}`;if(Oe){const Yt=Oe.match(/filename="(.+)"/);Yt&&(vt=Yt[1])}De.download=vt,document.body.appendChild(De),De.click(),document.body.removeChild(De),window.URL.revokeObjectURL(Se)}catch(fe){console.error("Download failed:",fe),w(fe.response?.data?.error||"Failed to download lyrics")}},Tt=()=>{le.current?.click()},kr=async G=>{const fe=G.target.files?.[0];if(fe){if(!fe.name.toLowerCase().endsWith(".lrc")){w("Please select a valid .lrc file");return}if(fe.size>1024*1024){w("LRC file must be smaller than 1MB");return}try{ie(!0),w("");const be=await kt.uploadLrcFile(t,fe);if(m(be.data),be.data.is_synced){const Se=Vt(be.data.synced_lyrics);v(Se)}ut.saveLyrics(t,be.data).catch(()=>{}),Be(!0),$(!1)}catch(be){console.error("Upload failed:",be),w(be.response?.data?.error||"Failed to upload LRC file")}finally{ie(!1),le.current&&(le.current.value="")}}},Vt=G=>{const fe=[],be=G.split(`
`);for(const De of be){const Oe=De.match(/\[(\d{2}):(\d{2})\.(\d{2,3})\](.*)/);if(Oe){const vt=parseInt(Oe[1]),Yt=parseInt(Oe[2]),lr=parseInt(Oe[3].padEnd(2,"0").substring(0,2)),fn=vt*60+Yt+lr/100,zt=Oe[4].trim();zt&&fe.push({time:fn,text:zt})}}const Se=fe.sort((De,Oe)=>De.time-Oe.time);for(let De=0;De<Se.length;De++)De<Se.length-1?Se[De].endTime=Se[De+1].time:Se[De].endTime=Se[De].time+5;return Se},bt=()=>{let G=-1;for(let fe=b.length-1;fe>=0;fe--)if(r>=b[fe].time){G=fe;break}if(A(G),G>=0&&G<b.length){const fe=b[G],be=fe.time,De=(fe.endTime||(G<b.length-1?b[G+1].time:be+5))-be;if(De>0){const Oe=Math.min(1,Math.max(0,(r-be)/De));P(Oe)}else P(1)}else P(0)};return y?e.jsxs(h,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[n&&e.jsx(h,{sx:{display:"flex",justifyContent:"flex-end",p:1},children:e.jsx(X,{size:"small",onClick:n,children:e.jsx(Gt,{})})}),e.jsx(h,{sx:{flex:1,display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx(Ie,{})})]}):C?e.jsxs(h,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[n&&e.jsx(h,{sx:{display:"flex",justifyContent:"flex-end",p:1},children:e.jsx(X,{size:"small",onClick:n,children:e.jsx(Gt,{})})}),e.jsxs(h,{sx:{flex:1,p:2},children:[e.jsx(pe,{severity:"error",sx:{mb:2},children:C}),e.jsx(N,{variant:"contained",onClick:ye,startIcon:e.jsx(Zr,{}),children:"Try Fetch Lyrics"})]})]}):g?g.is_instrumental?e.jsxs(h,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[n&&e.jsx(h,{sx:{display:"flex",justifyContent:"flex-end",p:1},children:e.jsx(X,{size:"small",onClick:n,children:e.jsx(Gt,{})})}),e.jsxs(h,{sx:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",p:4},children:[e.jsx(Lt,{sx:{fontSize:64,color:"text.secondary",mb:2}}),e.jsx(x,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"Instrumental Track"}),e.jsx(x,{variant:"body2",color:"text.secondary",sx:{mb:3,textAlign:"center"},children:"This track was marked as instrumental. If it has lyrics, you can search for them or upload an LRC file."}),e.jsxs(h,{sx:{display:"flex",gap:1,flexWrap:"wrap",justifyContent:"center"},children:[e.jsx(N,{variant:"outlined",size:"small",startIcon:U?e.jsx(Ie,{size:16}):e.jsx(wr,{}),onClick:ft,disabled:U,children:U?"Clearing...":"Search for Lyrics"}),e.jsx(N,{variant:"outlined",size:"small",startIcon:oe?e.jsx(Ie,{size:16}):e.jsx(Wo,{}),onClick:Tt,disabled:oe,color:"secondary",children:oe?"Uploading...":"Upload .LRC"})]}),e.jsx("input",{ref:le,type:"file",accept:".lrc",style:{display:"none"},onChange:kr}),e.jsx(it,{open:Ue,autoHideDuration:3e3,onClose:()=>Be(!1),message:"LRC file uploaded successfully!",anchorOrigin:{vertical:"bottom",horizontal:"center"}})]})]}):g.has_lyrics?e.jsxs(_e,{sx:{height:"100%",display:"flex",flexDirection:"column",bgcolor:"background.paper"},children:[e.jsxs(h,{sx:{borderBottom:1,borderColor:"divider",display:"flex",alignItems:"center",px:2,pt:1},children:[e.jsx(x,{variant:"h6",sx:{flexGrow:1},children:"Lyrics"}),e.jsx(X,{size:"small",onClick:()=>{$(!te),!te&&W.length===0&&Et()},sx:{mr:1},title:"Find different lyrics",color:te?"primary":"default",children:e.jsx(_1,{})}),e.jsx(X,{size:"small",onClick:G=>q(G.currentTarget),sx:{mr:1},title:"Download lyrics",children:e.jsx(Or,{})}),e.jsxs(ha,{anchorEl:ce,open:!!ce,onClose:()=>q(null),children:[g.is_synced&&e.jsxs(we,{onClick:()=>pr("lrc"),children:[e.jsx(Ge,{children:e.jsx(Lt,{fontSize:"small"})}),"Download .LRC (synced)"]}),e.jsxs(we,{onClick:()=>pr("txt"),children:[e.jsx(Ge,{children:e.jsx(v1,{fontSize:"small"})}),"Download .TXT (plain)"]})]}),e.jsx(ve,{title:"Upload .LRC file",children:e.jsx(X,{size:"small",onClick:Tt,sx:{mr:1},disabled:oe,children:oe?e.jsx(Ie,{size:20}):e.jsx(Wo,{})})}),e.jsx("input",{ref:le,type:"file",accept:".lrc",style:{display:"none"},onChange:kr}),e.jsx(X,{size:"small",onClick:ye,sx:{mr:1},title:"Refresh lyrics",children:e.jsx(Zr,{})}),n&&e.jsx(X,{size:"small",onClick:n,children:e.jsx(Gt,{})})]}),e.jsx(it,{open:Ue,autoHideDuration:3e3,onClose:()=>Be(!1),message:"LRC file uploaded successfully!",anchorOrigin:{vertical:"bottom",horizontal:"center"}}),e.jsx(Yo,{in:te,children:e.jsxs(h,{sx:{p:2,bgcolor:"action.hover",borderBottom:1,borderColor:"divider"},children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[e.jsx(x,{variant:"subtitle2",color:"primary",children:"Find Different Lyrics"}),e.jsx(N,{size:"small",color:"error",variant:"outlined",startIcon:U?e.jsx(Ie,{size:16}):e.jsx(S1,{}),onClick:ft,disabled:U,children:U?"Clearing...":"Clear & Search"})]}),e.jsx(h,{component:"form",onSubmit:ir,sx:{mb:2},children:e.jsx(Ce,{fullWidth:!0,size:"small",placeholder:"Search by song title or artist...",value:Q,onChange:G=>J(G.target.value),InputProps:{startAdornment:e.jsx(nr,{position:"start",children:e.jsx(wr,{sx:{color:"text.secondary"}})}),endAdornment:e.jsx(nr,{position:"end",children:e.jsx(N,{type:"submit",size:"small",disabled:I,children:I?"Searching...":"Search"})})}})}),I&&e.jsx(h,{sx:{display:"flex",justifyContent:"center",py:2},children:e.jsx(Ie,{size:24})}),!I&&W.length>0&&e.jsxs(h,{sx:{maxHeight:250,overflow:"auto",position:"relative",zIndex:1},children:[e.jsxs(x,{variant:"caption",color:"text.secondary",sx:{mb:1,display:"block"},children:[W.length," suggestions found - select one to replace current lyrics:"]}),e.jsx(Qe,{dense:!0,sx:{bgcolor:"background.paper",borderRadius:1},children:W.map(G=>e.jsx(Le,{sx:{borderBottom:"1px solid",borderColor:"divider","&:last-child":{borderBottom:"none"},display:"flex",alignItems:"center",pr:1},secondaryAction:e.jsx(N,{size:"small",variant:"contained",color:"primary",onClick:()=>xr(G),disabled:M===G.id,startIcon:M===G.id?e.jsx(Ie,{size:16}):e.jsx(ua,{}),sx:{minWidth:70},children:M===G.id?"...":"Use"}),children:e.jsx(ke,{sx:{pr:8},primary:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1,flexWrap:"wrap"},children:[e.jsxs(x,{variant:"body2",sx:{fontWeight:500,wordBreak:"break-word"},noWrap:!0,children:['"',G.track_name,'"']}),e.jsxs(x,{variant:"body2",color:"text.secondary",noWrap:!0,children:["by ",G.artist_name]})]}),secondary:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1,mt:.5},children:[G.has_synced&&e.jsx(ue,{label:"Synced",size:"small",color:"success",sx:{height:20}}),G.has_plain&&!G.has_synced&&e.jsx(ue,{label:"Plain",size:"small",sx:{height:20}}),G.instrumental&&e.jsx(ue,{label:"Instrumental",size:"small",color:"info",sx:{height:20}}),e.jsx(x,{variant:"caption",color:"text.secondary",children:Zt(G.duration)})]})})},G.id))})]}),!I&&W.length===0&&e.jsx(x,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",py:2},children:"No suggestions loaded yet. Enter a search term or click Search to find lyrics."})]})}),g.is_synced&&e.jsxs(h,{sx:{px:2,py:1,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(x,{variant:"caption",color:"text.secondary",children:["Source: ",g.source==="upload"&&g.uploaded_filename?` ${g.uploaded_filename}`:g.source," ",g.language&&` ${g.language}`]}),e.jsx(We,{control:e.jsx(et,{size:"small",checked:k,onChange:G=>R(G.target.checked)}),label:e.jsx(x,{variant:"caption",children:"Auto-scroll"})})]}),g.is_synced&&g.plain_lyrics&&e.jsxs(oi,{value:z,onChange:(G,fe)=>B(fe),sx:{px:2,minHeight:40},children:[e.jsx(Ut,{label:"Synced",sx:{minHeight:40,py:.5}}),e.jsx(Ut,{label:"Plain Text",sx:{minHeight:40,py:.5}})]}),e.jsx(Pe,{ref:xe,sx:{flexGrow:1,overflow:"auto",background:`linear-gradient(180deg, transparent 0%, ${F.background} 50%, transparent 100%)`,"&::-webkit-scrollbar":{width:"6px"},"&::-webkit-scrollbar-track":{backgroundColor:"rgba(255,255,255,0.05)",borderRadius:"3px"},"&::-webkit-scrollbar-thumb":{backgroundColor:F.glow,borderRadius:"3px","&:hover":{backgroundColor:F.primary}}},children:z===0&&g.is_synced?e.jsx(h,{sx:{py:2},children:b.map((G,fe)=>{const be=fe===S,Se=fe<S,De=fe===S+1,Oe=fe>S&&fe<=S+2;return e.jsx(h,{ref:be?ge:null,onClick:()=>a?.(G.time),sx:{py:1.5,px:2,my:.5,borderRadius:2,cursor:a?"pointer":"default",transition:"all 0.35s cubic-bezier(0.4, 0, 0.2, 1)",backgroundColor:be?F.background:"transparent",transform:be?"scale(1.03)":"scale(1)",boxShadow:be?`0 4px 20px ${F.glow}, inset 0 0 20px ${F.glow}`:"none",borderLeft:be?`3px solid ${F.primary}`:"3px solid transparent","&:hover":a?{backgroundColor:be?F.backgroundHover:F.hoverBackground,transform:be?"scale(1.03)":"scale(1.01)"}:{}},children:be?e.jsxs(h,{sx:{position:"relative",overflow:"hidden"},children:[e.jsx(x,{variant:"body1",sx:{fontSize:"1.3rem",fontWeight:700,lineHeight:1.6,letterSpacing:"0.02em",background:`linear-gradient(135deg, ${F.gradientStart} 0%, ${F.gradientMid} 50%, ${F.gradientEnd} 100%)`,backgroundClip:"text",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",filter:`drop-shadow(0 0 8px ${F.glow})`,animation:"lyricsPulse 2s ease-in-out infinite","@keyframes lyricsPulse":{"0%, 100%":{filter:`drop-shadow(0 0 8px ${F.glow})`},"50%":{filter:`drop-shadow(0 0 15px ${F.glow})`}}},children:G.text}),e.jsx(h,{sx:{position:"absolute",bottom:-6,left:0,height:3,borderRadius:1.5,background:`linear-gradient(90deg, ${F.gradientStart}, ${F.gradientMid}, ${F.gradientEnd})`,width:`${E*100}%`,transition:"width 0.1s linear",boxShadow:`0 0 12px ${F.glow}, 0 0 4px ${F.primary}`}})]}):e.jsx(x,{variant:"body1",sx:{fontSize:De?"1.15rem":"1rem",fontWeight:Se?400:De?500:400,lineHeight:1.6,color:Se?F.pastTextColor:Oe?F.upcomingTextColor:F.textColor,transition:"all 0.35s ease",...De&&{textShadow:`0 0 20px ${F.glow}`}},children:G.text})},fe)})}):e.jsx(h,{sx:{px:1},children:g.plain_lyrics.split(`
`).map((G,fe)=>e.jsx(x,{variant:"body1",sx:{py:.5,lineHeight:1.8,color:"text.primary"},children:G||""},fe))})}),g.last_error&&e.jsxs(pe,{severity:"warning",sx:{m:2,mt:0},children:["Last fetch error: ",g.last_error]})]}):e.jsxs(h,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[n&&e.jsx(h,{sx:{display:"flex",justifyContent:"flex-end",p:1},children:e.jsx(X,{size:"small",onClick:n,children:e.jsx(Gt,{})})}),e.jsxs(h,{sx:{flex:1,p:2,overflow:"auto"},children:[e.jsxs(pe,{severity:"info",sx:{mb:2},children:["No lyrics found for this track",g.fetch_attempted&&` (Attempted ${g.fetch_attempts} times)`]}),e.jsxs(h,{sx:{display:"flex",gap:1,mb:2,flexWrap:"wrap"},children:[e.jsx(N,{variant:"contained",onClick:ye,startIcon:e.jsx(Zr,{}),size:"small",children:"Retry Fetch"}),e.jsx(N,{variant:"outlined",onClick:()=>Et(),startIcon:e.jsx(wr,{}),size:"small",disabled:I,children:I?"Searching...":"Find Suggestions"}),e.jsx(N,{variant:"outlined",onClick:Tt,startIcon:oe?e.jsx(Ie,{size:16}):e.jsx(Wo,{}),size:"small",disabled:oe,color:"secondary",children:oe?"Uploading...":"Upload .LRC"})]}),e.jsx("input",{ref:le,type:"file",accept:".lrc",style:{display:"none"},onChange:kr}),e.jsx(it,{open:Ue,autoHideDuration:3e3,onClose:()=>Be(!1),message:"LRC file uploaded successfully!",anchorOrigin:{vertical:"bottom",horizontal:"center"}}),e.jsx(h,{component:"form",onSubmit:ir,sx:{mb:2},children:e.jsx(Ce,{fullWidth:!0,size:"small",placeholder:"Search by song title or artist...",value:Q,onChange:G=>J(G.target.value),InputProps:{startAdornment:e.jsx(nr,{position:"start",children:e.jsx(wr,{sx:{color:"text.secondary"}})}),endAdornment:Q&&e.jsx(nr,{position:"end",children:e.jsx(N,{type:"submit",size:"small",disabled:I,children:"Search"})})}})}),W.length>0&&e.jsxs(h,{sx:{maxHeight:300,overflow:"auto",position:"relative"},children:[e.jsxs(x,{variant:"subtitle2",sx:{mb:1,color:"text.secondary"},children:["Found ",W.length," suggestions:"]}),e.jsx(Qe,{dense:!0,sx:{bgcolor:"background.paper",borderRadius:1},children:W.map(G=>e.jsx(Le,{sx:{borderBottom:"1px solid",borderColor:"divider","&:last-child":{borderBottom:"none"},display:"flex",alignItems:"center",pr:1},secondaryAction:e.jsx(N,{size:"small",variant:"contained",color:"primary",onClick:()=>xr(G),disabled:M===G.id,startIcon:M===G.id?e.jsx(Ie,{size:16}):e.jsx(ua,{}),sx:{minWidth:70},children:M===G.id?"...":"Use"}),children:e.jsx(ke,{sx:{pr:8},primary:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1,flexWrap:"wrap"},children:[e.jsxs(x,{variant:"body2",sx:{fontWeight:500},noWrap:!0,children:['"',G.track_name,'"']}),e.jsxs(x,{variant:"body2",color:"text.secondary",noWrap:!0,children:["by ",G.artist_name]})]}),secondary:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1,mt:.5,flexWrap:"wrap"},children:[G.has_synced&&e.jsx(ue,{label:"Synced",size:"small",color:"success",sx:{height:20}}),G.has_plain&&!G.has_synced&&e.jsx(ue,{label:"Plain",size:"small",sx:{height:20}}),G.instrumental&&e.jsx(ue,{label:"Instrumental",size:"small",color:"info",sx:{height:20}}),e.jsx(x,{variant:"caption",color:"text.secondary",children:Zt(G.duration)}),G.album_name&&e.jsxs(x,{variant:"caption",color:"text.secondary",noWrap:!0,children:[" ",G.album_name]})]})})},G.id))})]}),I&&e.jsx(h,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(Ie,{size:32})})]})]}):null}class I1{isSupported;constructor(){this.isSupported="mediaSession"in navigator}setMetadata(r){if(!this.isSupported)return;const n=r.artwork||[{src:"/img/icons/icon-96x96.png",sizes:"96x96",type:"image/png"},{src:"/img/icons/icon-128x128.png",sizes:"128x128",type:"image/png"},{src:"/img/icons/icon-192x192.png",sizes:"192x192",type:"image/png"},{src:"/img/icons/icon-384x384.png",sizes:"384x384",type:"image/png"},{src:"/img/icons/icon-512x512.png",sizes:"512x512",type:"image/png"}];navigator.mediaSession.metadata=new MediaMetadata({title:r.title,artist:r.artist,album:r.album||"",artwork:n})}setActionHandlers(r){if(!this.isSupported)return;["play","pause","previoustrack","nexttrack","seekbackward","seekforward","seekto"].forEach(s=>{try{r[s]?navigator.mediaSession.setActionHandler(s,r[s]):navigator.mediaSession.setActionHandler(s,null)}catch{console.warn(`Media Session API doesn't support ${s} action`)}})}setPlaybackState(r){this.isSupported&&(navigator.mediaSession.playbackState=r)}setPositionState(r){if(this.isSupported)try{if("setPositionState"in navigator.mediaSession){const n=r.duration||0;let s=r.position||0;n>0?s=Math.max(0,Math.min(s,n)):s=0,n>0&&isFinite(n)&&isFinite(s)&&navigator.mediaSession.setPositionState({duration:n,playbackRate:r.playbackRate||1,position:s})}}catch(n){console.warn("Failed to set position state:",n)}}clear(){if(!this.isSupported)return;navigator.mediaSession.metadata=null,this.setPlaybackState("none"),["play","pause","previoustrack","nexttrack","seekbackward","seekforward","seekto"].forEach(n=>{try{navigator.mediaSession.setActionHandler(n,null)}catch{}})}isAPISupported(){return this.isSupported}}const Ra=new I1,A1=t=>Ra.setMetadata(t),P1=t=>Ra.setActionHandlers(t),td=t=>Ra.setPlaybackState(t),D1=t=>Ra.setPositionState(t),M1=()=>Ra.clear(),E1=l.lazy(()=>Eb(()=>import("./RelatedTracks-2Uo9X4J2.js"),__vite__mapDeps([0,1,2])));function rd({audio:t,isPlaying:r,setIsPlaying:n,onClose:s,onMinimize:a,onNext:o,onPrevious:i,hasNext:c=!1,hasPrevious:u=!1,onFavoriteToggle:d,onTrackSelect:f,onTimeUpdate:p,initialSeek:g,isRadioMode:m=!1,queue:y=[],currentQueueIndex:j=0,onQueueReorder:C,onRemoveFromQueue:w,onPlayQueueTrack:b,onClearQueue:v}){const{settings:S,updateSetting:A}=Cr(),{isRadioMode:E,stopRadio:P}=fo(),{timerState:k,getFadeVolume:R,shouldStop:z,onSongEnded:B}=Gu(),{enabled:F,gains:W,connectAudioSource:H}=Ku(),{showAchievements:I}=bv(),_=Pt();ao(_.breakpoints.down("md"));const[O,D]=l.useState(0),[Q,J]=l.useState(S.volume),[M,T]=l.useState(S.repeat_mode),[te,$]=l.useState(S.shuffle_enabled),[U,K]=l.useState(!1),[ce,q]=l.useState(!1),[oe,ie]=l.useState(!1),[Ue,Be]=l.useState(!1),[le,xe]=l.useState(!1),[ge,me]=l.useState(null),[ye,Et]=l.useState(!1),[xr,ft]=l.useState(!1),[ir,Zt]=l.useState(!1),[pr,Tt]=l.useState(null),[kr,Vt]=l.useState(!1),[bt,G]=l.useState(t),[fe,be]=l.useState(0),[Se,De]=l.useState(""),[Oe,vt]=l.useState(!0),[Yt,lr]=l.useState(!1),[fn,zt]=l.useState(!1),[xn,Ia]=l.useState(Array(16).fill(0)),[Nr,st]=l.useState(t.is_favorite||!1),[jt,xt]=l.useState(!1),de=l.useRef(null),wt=l.useRef(null),He=l.useRef(null),Je=l.useRef(null),cr=l.useRef(null),Ye=l.useRef([]),St=l.useRef(null),_t=l.useRef(null),lt=l.useRef(r),Ze=l.useRef(!1),mr=l.useRef(t.id),$t=l.useRef(null),dr=l.useRef(0),gr=l.useRef(0),Aa=l.useRef(!1),wo=l.useRef(!1),th=[32,64,125,250,500,1e3,2e3,4e3,8e3,16e3];l.useEffect(()=>{G(t)},[t]),l.useEffect(()=>{if(g&&g>0&&!wo.current&&de.current&&Se){const Y=()=>{de.current&&de.current.readyState>=2&&(console.log(`[Player] Resuming playback at ${g}s`),de.current.currentTime=g,D(g),wo.current=!0)};if(de.current.readyState>=2)Y();else{const he=()=>{Y(),de.current?.removeEventListener("canplay",he)};return de.current.addEventListener("canplay",he),()=>{de.current?.removeEventListener("canplay",he)}}}},[g,Se]),l.useEffect(()=>{wo.current=!1},[t.id]),vv(wt,{onSwipeLeft:()=>c&&o?.(),onSwipeRight:()=>u&&i?.(),onSwipeDown:a||s,threshold:80}),l.useEffect(()=>{const Y=he=>{if(!(he.target instanceof HTMLInputElement||he.target instanceof HTMLTextAreaElement)&&de.current&&Se&&!Oe){const je=S.seek_duration||3;he.key==="ArrowLeft"?(he.preventDefault(),Ze.current=!0,de.current.currentTime=Math.max(0,de.current.currentTime-je),D(de.current.currentTime),setTimeout(()=>{Ze.current=!1},100)):he.key==="ArrowRight"?(he.preventDefault(),Ze.current=!0,de.current.currentTime=Math.min(t.duration,de.current.currentTime+je),D(de.current.currentTime),setTimeout(()=>{Ze.current=!1},100)):he.key===" "&&(he.preventDefault(),n(!r))}};return window.addEventListener("keydown",Y),()=>window.removeEventListener("keydown",Y)},[t.duration,Se,Oe,r,n,S.seek_duration]),l.useEffect(()=>{console.log("[Player] Settings sync triggered - volume:",S.volume,"repeat:",S.repeat_mode,"shuffle:",S.shuffle_enabled),J(S.volume),T(S.repeat_mode),$(S.shuffle_enabled)},[S.volume,S.repeat_mode,S.shuffle_enabled]),mr.current!==t.id&&(mr.current=t.id,De(""),vt(!0),zt(!1),st(t.is_favorite||!1),xt(!1),dr.current=0,gr.current=0,Aa.current=!1);const So=l.useCallback(async Y=>{if(!t.youtube_id||Aa.current)return;const he=gr.current;if(he<10)return;Aa.current=!0;const je=t.youtube_id;setTimeout(async()=>{try{const Te=await Kt.recordListening({youtube_id:je,duration_listened:Math.floor(he),completed:Y});Te.data?.new_achievements&&Te.data.new_achievements.length>0&&I(Te.data.new_achievements)}catch(Te){console.error("Failed to record listening history:",Te)}},0)},[t.youtube_id,I]);l.useEffect(()=>{let Y=null;return r&&!Oe&&(dr.current===0&&(dr.current=Date.now()),Y=setInterval(()=>{gr.current+=1},1e3)),()=>{Y&&clearInterval(Y)}},[r,Oe]),l.useEffect(()=>()=>{gr.current>=10&&t.youtube_id&&!Aa.current&&So(!1)},[t.id,t.youtube_id,So]);const Ci=l.useRef(0),ki=l.useRef(0),pn=l.useCallback(async(Y=!1)=>{if(!navigator.onLine){console.debug("[Player] Skipping progress save - offline");return}if(!t.youtube_id)return;const he=Math.floor(O);if(!(!Y&&Math.abs(he-ki.current)<10))try{await kt.updateProgress(t.youtube_id,{position:he,completed:Y}),ki.current=he,Ci.current=Date.now()}catch(je){console.debug("[Player] Progress save failed:",je)}},[t.youtube_id,O]);l.useEffect(()=>{if(!r||!t.youtube_id)return;const Y=setInterval(()=>{navigator.onLine&&Date.now()-Ci.current>6e4&&pn(!1)},3e4);return()=>clearInterval(Y)},[r,t.youtube_id,pn]),l.useEffect(()=>{!r&&O>10&&t.youtube_id&&navigator.onLine&&pn(!1)},[r,O,t.youtube_id,pn]),l.useEffect(()=>()=>{if(navigator.onLine&&O>10&&t.youtube_id){const Y=Math.floor(O),he=localStorage.getItem("token");he&&fetch(`/api/audio/${t.youtube_id}/progress/`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Token ${he}`},body:JSON.stringify({position:Y,completed:!1}),keepalive:!0}).catch(()=>{})}},[t.youtube_id,O]),l.useEffect(()=>{(async()=>{if(t.media_url){De(t.media_url),vt(!1),zt(!1);return}if(t.youtube_id)try{vt(!0);const he=await dt.getAnyCachedUrl(t.youtube_id);if(he){console.log(`[Player]  Playing from ${he.source} cache (saves data/battery):`,t.title),De(he.url),vt(!1),zt(!0);return}if(!navigator.onLine){console.warn("[Player]  Offline and no cached audio available:",t.title),vt(!1),zt(!1);return}if(t.file_path){const pt=t.file_path.split("/").map(hh=>encodeURIComponent(hh)).join("/"),Pa=localStorage.getItem("token"),Co=`/media/${pt}${Pa?`?token=${Pa}`:""}`;console.log("[Player]  Streaming directly (no API call):",t.title),De(Co),vt(!1),zt(!1),S.prefetch_enabled!==!1&&dt.prefetchTrack(t,"low").catch(console.error);return}console.log("[Player]  Fetching stream URL from API:",t.title);const Te=await(await fetch(`/api/audio/${t.youtube_id}/player/`,{headers:{Authorization:`Token ${localStorage.getItem("token")}`}})).json();De(Te.stream_url),vt(!1),zt(!1),Te.stream_url&&S.prefetch_enabled!==!1&&dt.prefetchTrack(t,"low").catch(console.error)}catch(he){console.error("Failed to fetch stream URL:",he);const je=await dt.getAnyCachedUrl(t.youtube_id);je&&(console.log(`[Player]  Fallback to ${je.source} cache after fetch error:`,t.title),De(je.url),zt(!0)),vt(!1)}})()},[t.id]),l.useEffect(()=>{const Y=t.cover_art_url||t.thumbnail_url,he=`/api/audio/${t.youtube_id}/artwork/`,je=Te=>{A1({title:t.title,artist:t.artist||t.channel_name||"Unknown Artist",album:t.album,artwork:Te})};return je(Y?[{src:he,sizes:"96x96",type:"image/jpeg"},{src:he,sizes:"128x128",type:"image/jpeg"},{src:he,sizes:"256x256",type:"image/jpeg"},{src:he,sizes:"512x512",type:"image/jpeg"}]:void 0),P1({play:()=>{lt.current||n(!0)},pause:()=>{lt.current&&n(!1)},previoustrack:()=>{u&&i&&i()},nexttrack:()=>{c&&o&&o()},seekbackward:Te=>{if(de.current){Ze.current=!0;const pt=Te?.seekOffset||S.seek_duration||3;de.current.currentTime=Math.max(0,de.current.currentTime-pt),D(de.current.currentTime),setTimeout(()=>{Ze.current=!1},100)}},seekforward:Te=>{if(de.current){Ze.current=!0;const pt=Te?.seekOffset||S.seek_duration||3;de.current.currentTime=Math.min(t.duration,de.current.currentTime+pt),D(de.current.currentTime),setTimeout(()=>{Ze.current=!1},100)}},seekto:Te=>{de.current&&Te.seekTime!==void 0&&(Ze.current=!0,de.current.currentTime=Te.seekTime,setTimeout(()=>{Ze.current=!1},100))}}),()=>{M1()}},[t,c,u,o,i,n,S.seek_duration]),l.useEffect(()=>{if(de.current){const Y=R();de.current.volume=Q/100*Y}},[Q,R]),l.useEffect(()=>{if(!k.isFading||!de.current)return;const Y=setInterval(()=>{if(de.current){const he=R();de.current.volume=Q/100*he}},500);return()=>clearInterval(Y)},[k.isFading,Q,R]),l.useEffect(()=>{z()&&(console.log("[Player] Sleep timer triggered stop"),n(!1))},[z,n]),l.useEffect(()=>{const Y=()=>{He.current&&He.current.state==="suspended"&&(console.log("[Player] Resuming suspended AudioContext (iOS)"),He.current.resume().catch(console.error))},he=["touchstart","touchend","click","keydown"];return he.forEach(je=>{document.addEventListener(je,Y,{once:!0,passive:!0})}),()=>{he.forEach(je=>{document.removeEventListener(je,Y)})}},[]),l.useEffect(()=>{if(!de.current||!Se)return;if(!He.current){const he=()=>{try{He.current=new(window.AudioContext||window.webkitAudioContext),cr.current=He.current.createMediaElementSource(de.current),Ye.current=th.map(Te=>{const pt=He.current.createBiquadFilter();return pt.type="peaking",pt.frequency.value=Te,pt.Q.value=1.4,pt.gain.value=0,pt}),Je.current=He.current.createAnalyser(),Je.current.fftSize=64,Je.current.smoothingTimeConstant=.85,Je.current.minDecibels=-90,Je.current.maxDecibels=-10;let je=cr.current;Ye.current.forEach(Te=>{je.connect(Te),je=Te}),je.connect(Je.current),Je.current.connect(He.current.destination),St.current=new Uint8Array(Je.current.frequencyBinCount),console.log("[Player] Audio chain initialized (optimized)")}catch(je){console.error("Web Audio API not supported:",je)}};"requestIdleCallback"in window?window.requestIdleCallback(he,{timeout:100}):setTimeout(he,0)}const Y=()=>{if(Je.current&&St.current&&lt.current){Je.current.getByteFrequencyData(St.current);const he=[],je=Math.floor(St.current.length/16);for(let Te=0;Te<16;Te++){const pt=Math.min(Te*je,St.current.length-1),Pa=St.current[pt]/255,Co=Te<8?1.3:1;he.push(Math.min(Pa*Co,1))}Ia(he)}else lt.current||Ia(he=>he.map(je=>je*.9));_t.current=requestAnimationFrame(Y)};return Y(),()=>{_t.current&&cancelAnimationFrame(_t.current)}},[Se]),l.useEffect(()=>{if(Ye.current.length>0){const Y=F?W:Array(10).fill(0);Ye.current.forEach((he,je)=>{he.gain.value!==Y[je]&&(he.gain.value=Y[je])})}},[W,F]);const rh=l.useCallback((Y,he)=>{const je=he;J(je),K(je===0),$t.current&&clearTimeout($t.current),$t.current=setTimeout(()=>{A("volume",je)},300)},[A]),nh=l.useCallback(()=>{const Y=["none","one","all"],he=Y.indexOf(M),je=Y[(he+1)%Y.length];T(je),A("repeat_mode",je)},[M,A]),sh=l.useCallback(()=>{const Y=!te;$(Y),A("shuffle_enabled",Y)},[te,A]);l.useEffect(()=>{de.current&&Se&&(de.current.pause(),D(0),lt.current=!1)},[Se]),l.useEffect(()=>{if(!(Ze.current||Oe)&&de.current&&Se&&r!==lt.current)if(lt.current=r,r){if(de.current.paused){const Y=de.current.play();Y!==void 0&&Y.then(()=>{td("playing")}).catch(he=>{console.error("Playback failed:",he),n(!1),lt.current=!1})}}else de.current.paused||(de.current.pause(),td("paused"))},[r,n,Oe,Se]);const ah=l.useCallback(()=>{if(de.current&&!Ze.current){const Y=de.current.currentTime;D(Y),p?.(Y),D1({duration:t.duration,playbackRate:de.current.playbackRate,position:Y})}},[t.duration]),oh=l.useCallback((Y,he)=>{Ze.current=!0,D(he)},[]),ih=l.useCallback((Y,he)=>{const je=he;if(de.current&&!Oe){Ze.current=!0;const Te=!de.current.paused;if(de.current.currentTime=je,de.current.readyState<2){const pt=()=>{de.current&&(de.current.currentTime=je,Te&&de.current.play().catch(console.error),de.current.removeEventListener("canplay",pt))};de.current.addEventListener("canplay",pt)}}},[t.duration,Oe]),lh=l.useCallback(()=>{Ze.current=!1},[]);l.useCallback(Y=>{const he=Math.floor(Y/60),je=Math.floor(Y%60);return`${he}:${je.toString().padStart(2,"0")}`},[]);const ch=l.useCallback(()=>{K(!U),de.current&&(de.current.muted=!U)},[U]),dh=l.useCallback(async()=>{if(!t.youtube_id){console.warn("Cannot toggle favorite for files without youtube_id");return}try{await kt.toggleFavorite(t.youtube_id);const Y=!Nr;st(Y),d&&d(t.id,Y)}catch(Y){console.error("Failed to toggle favorite:",Y)}},[t.id,t.youtube_id,Nr,d]),_i=l.useCallback(()=>{const he=(Ir.findIndex(je=>je.id===S.visualizer_theme)+1)%Ir.length;A("visualizer_theme",Ir[he].id)},[S.visualizer_theme,A]),uh=l.useMemo(()=>S.visualizer_enabled?e.jsx(h,{onClick:_i,sx:{cursor:"pointer","&:hover":{opacity:.9},transition:"opacity 0.2s ease"},title:`Click to change visualizer theme (Current: ${Ir.find(Y=>Y.id===S.visualizer_theme)?.name||"Classic Bars"})`,children:e.jsx(jv,{data:xn,isPlaying:r,themeId:S.visualizer_theme,height:120,showGlow:S.visualizer_glow})}):null,[xn,r,S.visualizer_theme,S.visualizer_enabled,S.visualizer_glow,_i]);return e.jsxs(h,{ref:wt,sx:{height:"100%",display:"flex",flexDirection:"column",position:"relative",overflow:"hidden",touchAction:"pan-y"},children:[e.jsxs(h,{sx:{position:"absolute",inset:0,zIndex:0},children:[e.jsx(h,{sx:{position:"absolute",inset:0,background:Y=>Y.palette.mode==="dark"?`linear-gradient(to bottom, ${Y.palette.background.paper} 0%, ${Y.palette.background.paper}e6 50%, ${Y.palette.background.default} 100%)`:`linear-gradient(to bottom, ${Y.palette.background.paper}f0 0%, ${Y.palette.background.paper}f5 50%, ${Y.palette.background.default}ff 100%)`,zIndex:10}}),e.jsx(h,{sx:{position:"absolute",inset:0,background:Y=>{const he=r?Math.max(...xn)*.15:0,Te=Y.palette.mode==="dark"?he:he*.4;return`radial-gradient(ellipse at center, ${Y.palette.primary.main}${Math.round(Te*255).toString(16).padStart(2,"0")} 0%, transparent 70%)`},zIndex:11,transition:"background 0.15s ease",pointerEvents:"none"}}),e.jsx(h,{sx:{width:"100%",height:"100%",backgroundImage:t.cover_art_url||t.thumbnail_url?`url(${t.cover_art_url||t.thumbnail_url})`:"none",backgroundSize:"cover",backgroundPosition:"center",filter:"blur(60px)",opacity:.3,transform:"scale(1.5)"}})]}),e.jsxs(h,{sx:{position:"relative",zIndex:20,display:"flex",flexDirection:"column",height:"100%",p:3,justifyContent:"space-between"},children:[Se?e.jsx("audio",{ref:de,src:Se,preload:"auto",playsInline:!0,"x-webkit-airplay":"allow",onTimeUpdate:ah,onSeeked:lh,onWaiting:()=>lr(!0),onCanPlay:()=>lr(!1),onPlaying:()=>lr(!1),onStalled:()=>{console.warn("[Player] Audio stalled"),lr(!0)},onEnded:()=>{if(So(!0),pn(!0),B()){console.log("[Player] Sleep timer triggered stop - not playing next track"),n(!1);return}M==="one"?de.current&&(de.current.currentTime=0,de.current.play().catch(console.error)):c&&o||M==="all"&&o?o():n(!1)},onError:Y=>{console.error("Audio playback error:",Y),console.error("Stream URL:",Se),console.error("Audio element:",de.current)}}):e.jsx("audio",{ref:de}),uh,e.jsxs(h,{sx:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",py:4},children:[(t.cover_art_url||t.thumbnail_url)&&!jt?e.jsxs(h,{onClick:()=>t.youtube_id&&q(!ce),sx:{width:200,height:200,borderRadius:3,bgcolor:"background.paper",backgroundSize:"cover",backgroundPosition:"center",mb:3,boxShadow:r?"0 8px 32px rgba(19, 236, 106, 0.4), 0 0 60px rgba(19, 236, 106, 0.2)":Y=>Y.palette.mode==="dark"?"0 8px 32px rgba(0, 0, 0, 0.4)":"0 8px 24px rgba(0, 0, 0, 0.1)",cursor:t.youtube_id?"pointer":"default",transition:"all 0.3s ease",position:"relative",overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",animation:r?"album-pulse 2s ease-in-out infinite":"none","&:hover":t.youtube_id?{transform:"scale(1.05) rotate(2deg)",boxShadow:Y=>Y.palette.mode==="dark"?"0 12px 40px rgba(19, 236, 106, 0.5)":`0 12px 40px ${Y.palette.primary.main}40`}:{},"&::after":Yt?{content:'""',position:"absolute",inset:0,background:"rgba(0, 0, 0, 0.5)",borderRadius:3,display:"flex",alignItems:"center",justifyContent:"center"}:{},"@keyframes album-pulse":{"0%, 100%":{boxShadow:"0 8px 32px rgba(19, 236, 106, 0.4), 0 0 60px rgba(19, 236, 106, 0.2)"},"50%":{boxShadow:"0 8px 32px rgba(19, 236, 106, 0.6), 0 0 80px rgba(19, 236, 106, 0.4)"}}},title:t.youtube_id?"Click to toggle lyrics":"Lyrics not available for local files",children:[e.jsx("img",{src:t.cover_art_url||t.thumbnail_url,alt:"",style:{width:"100%",height:"100%",objectFit:"cover",position:"absolute",inset:0},onError:()=>xt(!0)}),Yt&&e.jsx(h,{sx:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",zIndex:1},children:e.jsx(Ie,{size:48,sx:{color:"primary.main"}})})]}):e.jsx(h,{onClick:()=>t.youtube_id&&q(!ce),sx:{width:200,height:200,borderRadius:3,mb:3,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"rgba(19, 236, 106, 0.1)",border:"2px solid",borderColor:"primary.main",cursor:t.youtube_id?"pointer":"default",boxShadow:r?"0 8px 32px rgba(19, 236, 106, 0.4), 0 0 60px rgba(19, 236, 106, 0.2)":"0 8px 32px rgba(0, 0, 0, 0.4)",animation:r?"album-pulse 2s ease-in-out infinite":"none",transition:"all 0.3s ease","&:hover":t.youtube_id?{transform:"scale(1.05)",bgcolor:"rgba(19, 236, 106, 0.2)"}:{},"@keyframes album-pulse":{"0%, 100%":{boxShadow:"0 8px 32px rgba(19, 236, 106, 0.4), 0 0 60px rgba(19, 236, 106, 0.2)"},"50%":{boxShadow:"0 8px 32px rgba(19, 236, 106, 0.6), 0 0 80px rgba(19, 236, 106, 0.4)"}}},title:t.youtube_id?"Click to toggle lyrics":"Lyrics not available for local files",children:e.jsx(Lt,{sx:{fontSize:80,color:"primary.main",opacity:.7}})}),e.jsx(x,{variant:"h5",sx:{fontWeight:700,mb:.5,textAlign:"center",px:2,color:"text.primary"},children:t.title}),e.jsxs(h,{sx:{display:"flex",alignItems:"center",justifyContent:"center",gap:1,flexWrap:"wrap"},children:[e.jsx(x,{variant:"body1",sx:{fontWeight:500,color:"primary.main"},children:bt.artist||t.channel_name}),bt.album&&e.jsxs(x,{variant:"body2",color:"text.secondary",children:[" ",bt.album," ",bt.year&&`(${bt.year})`]}),fn&&e.jsx(ve,{title:"Playing from cache",children:e.jsx($u,{sx:{fontSize:16,color:"success.main"}})})]}),e.jsxs(h,{sx:{display:"flex",gap:1,mt:1},children:[e.jsx(ve,{title:"Track options",children:e.jsx(X,{onClick:Y=>Tt(Y.currentTarget),sx:{color:"text.secondary",transition:"all 0.2s ease","&:hover":{transform:"scale(1.1)",color:"primary.main"}},children:e.jsx(tu,{})})}),e.jsxs(ha,{anchorEl:pr,open:!!pr,onClose:()=>Tt(null),children:[e.jsxs(we,{onClick:()=>{Vt(!0),Tt(null)},children:[e.jsx(Ge,{children:e.jsx(nu,{fontSize:"small"})}),e.jsx(ke,{children:"Add to Playlist"})]}),e.jsxs(we,{onClick:()=>{dh(),Tt(null)},children:[e.jsx(Ge,{children:Nr?e.jsx(ya,{fontSize:"small",sx:{color:"error.main"}}):e.jsx(ru,{fontSize:"small"})}),e.jsx(ke,{children:Nr?"Remove from Favorites":"Add to Favorites"})]}),t.youtube_id&&e.jsxs(e.Fragment,{children:[e.jsx(Ee,{}),e.jsxs(we,{onClick:()=>{xe(!0),Tt(null)},children:[e.jsx(Ge,{children:e.jsx(Or,{fontSize:"small"})}),e.jsx(ke,{children:"Export Track"})]}),e.jsxs(we,{onClick:()=>{Be(!0),Tt(null)},children:[e.jsx(Ge,{children:e.jsx(ev,{fontSize:"small"})}),e.jsx(ke,{children:"Edit Metadata"})]})]})]}),t.youtube_id&&f&&e.jsx(ve,{title:"Related tracks",children:e.jsx(X,{onClick:()=>ie(!oe),sx:{color:oe?"primary.main":"text.secondary",transition:"all 0.2s ease","&:hover":{transform:"scale(1.1)",color:"primary.main"}},children:e.jsx(eo,{})})}),t.youtube_id&&!E&&e.jsx(ve,{title:"Start Radio",children:e.jsx(X,{onClick:Y=>me(Y.currentTarget),sx:{color:"text.secondary",transition:"all 0.2s ease","&:hover":{transform:"scale(1.1)",color:"secondary.main"}},children:e.jsx(an,{})})}),E&&e.jsx(ve,{title:"Click to stop radio",children:e.jsx(ue,{icon:e.jsx(an,{sx:{fontSize:16}}),label:"RADIO",size:"small",color:"secondary",onClick:()=>P(),sx:{cursor:"pointer",animation:"pulse 2s ease-in-out infinite","@keyframes pulse":{"0%, 100%":{opacity:1},"50%":{opacity:.7}},"&:hover":{opacity:.8}}})}),e.jsx(ve,{title:k.isActive?"Sleep timer active":"Sleep timer",children:e.jsxs(X,{onClick:()=>Et(!0),sx:{color:k.isActive?"warning.main":"text.secondary",transition:"all 0.2s ease",position:"relative","&:hover":{transform:"scale(1.1)",color:"warning.main"}},children:[e.jsx(si,{}),k.isActive&&e.jsx(h,{sx:{position:"absolute",top:4,right:4,width:8,height:8,borderRadius:"50%",bgcolor:"warning.main",animation:"pulse 2s ease-in-out infinite"}})]})}),e.jsx(ve,{title:`Queue (${y.length} tracks)`,children:e.jsxs(X,{onClick:()=>ft(!0),sx:{color:y.length>1?"primary.main":"text.secondary",transition:"all 0.2s ease",position:"relative","&:hover":{transform:"scale(1.1)",color:"primary.main"}},children:[e.jsx(su,{}),y.length>1&&e.jsx(h,{sx:{position:"absolute",top:2,right:2,minWidth:16,height:16,borderRadius:"50%",bgcolor:"primary.main",color:"primary.contrastText",fontSize:10,fontWeight:"bold",display:"flex",alignItems:"center",justifyContent:"center"},children:y.length>99?"99+":y.length})]})}),e.jsx(ve,{title:F?"Equalizer (on)":"Equalizer",children:e.jsx(X,{onClick:()=>Zt(!0),sx:{color:F?"secondary.main":"text.secondary",transition:"all 0.2s ease","&:hover":{transform:"scale(1.1)",color:"secondary.main"}},children:e.jsx(ji,{})})})]})]}),e.jsxs(h,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(Fv,{audioElement:de.current,currentTime:O,duration:t.duration,onSeek:Y=>oh(null,Y),onSeekCommitted:Y=>ih(null,Y),streamUrl:Se}),e.jsxs(h,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",px:1},children:[e.jsxs(h,{sx:{position:"relative"},children:[e.jsx(X,{size:"small",onClick:sh,sx:{color:te?"primary.main":"text.secondary",transition:"all 0.2s ease","&:hover":{color:"primary.main",transform:"scale(1.1)"},"&:active":{transform:"scale(0.95)"}},children:e.jsx(ho,{})}),te&&e.jsx(h,{sx:{position:"absolute",bottom:8,left:"50%",transform:"translateX(-50%)",width:4,height:4,borderRadius:"50%",bgcolor:"primary.main",boxShadow:"0 0 4px rgba(19, 236, 106, 0.8)"}})]}),e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:3},children:[e.jsx(X,{onClick:i,disabled:!u,sx:{color:"text.primary",transition:"all 0.2s ease","&:hover":{color:"primary.main",transform:"scale(1.1)"},"&:active":{transform:"scale(0.95)"},"&:disabled":{color:"text.disabled"}},children:e.jsx(Ob,{sx:{fontSize:30}})}),e.jsx(X,{onClick:()=>n(!r),disabled:Oe,sx:{width:64,height:64,bgcolor:"primary.main",color:"background.dark",boxShadow:"0 0 20px rgba(19, 236, 106, 0.4)","&:hover":{bgcolor:"primary.main",transform:"scale(1.05)",boxShadow:"0 0 30px rgba(19, 236, 106, 0.6)"},"&:active":{transform:"scale(0.95)"},"&:disabled":{bgcolor:"rgba(19, 236, 106, 0.3)",color:"rgba(0, 0, 0, 0.3)"},transition:"all 0.2s ease"},children:Oe?e.jsx(Ie,{size:28,sx:{color:"background.dark"}}):r?e.jsx(Id,{sx:{fontSize:36}}):e.jsx(gt,{sx:{fontSize:36}})}),e.jsx(X,{onClick:o,disabled:!c,sx:{color:"text.primary",transition:"all 0.2s ease","&:hover":{color:"primary.main",transform:"scale(1.1)"},"&:active":{transform:"scale(0.95)"},"&:disabled":{color:"text.disabled"}},children:e.jsx(Wb,{sx:{fontSize:30}})})]}),e.jsxs(h,{sx:{position:"relative"},children:[e.jsx(X,{size:"small",onClick:nh,sx:{color:M!=="none"?"primary.main":"text.secondary",transition:"all 0.2s ease","&:hover":{color:"primary.main",transform:"scale(1.1)"},"&:active":{transform:"scale(0.95)"}},children:M==="one"?e.jsx(Hb,{}):e.jsx(qb,{})}),M!=="none"&&e.jsx(h,{sx:{position:"absolute",bottom:8,left:"50%",transform:"translateX(-50%)",width:4,height:4,borderRadius:"50%",bgcolor:"primary.main",boxShadow:"0 0 4px rgba(19, 236, 106, 0.8)"}})]})]}),e.jsxs(h,{sx:{display:"flex",alignItems:"center",justifyContent:"center",gap:1.5,mt:1},children:[e.jsx(X,{onClick:ch,size:"small",sx:{color:U?"text.disabled":"primary.main",transition:"color 0.2s ease","&:hover":{color:"primary.main"}},children:U||Q===0?e.jsx(Xb,{sx:{fontSize:20}}):e.jsx(Gb,{sx:{fontSize:20}})}),e.jsx(h,{sx:{width:120},children:e.jsx(Pr,{value:U?0:Q,onChange:rh,min:0,max:100,size:"small",sx:{color:"primary.main","& .MuiSlider-thumb":{width:10,height:10,transition:"all 0.2s ease","&:hover":{boxShadow:"0 0 0 8px rgba(19, 236, 106, 0.16)"}},"& .MuiSlider-track":{border:"none",height:3},"& .MuiSlider-rail":{opacity:.3,height:3}}})}),e.jsxs(x,{variant:"caption",sx:{color:"text.secondary",minWidth:32,textAlign:"right",fontWeight:500},children:[Math.round(U?0:Q),"%"]})]})]})]}),oe&&t.youtube_id&&f&&e.jsx(l.Suspense,{fallback:e.jsx(h,{sx:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"rgba(0, 0, 0, 0.95)",zIndex:20},children:e.jsx(Ie,{size:60,sx:{color:"primary.main"}})}),children:e.jsx(ea,{in:oe,children:e.jsxs(h,{sx:{position:"absolute",inset:0,bgcolor:Y=>Y.palette.mode==="dark"?"rgba(0, 0, 0, 0.95)":"rgba(255, 255, 255, 0.98)",backdropFilter:"blur(10px)",zIndex:20,overflow:"auto",display:"flex",flexDirection:"column"},children:[e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",p:2,borderBottom:1,borderColor:"divider"},children:[e.jsxs(x,{variant:"h6",sx:{fontWeight:600,display:"flex",alignItems:"center",gap:1},children:[e.jsx(eo,{sx:{color:"primary.main"}}),"Related Tracks"]}),e.jsx(X,{onClick:()=>ie(!1),size:"small",children:e.jsx(Gt,{})})]}),e.jsx(h,{sx:{flex:1,overflow:"auto",p:1},children:e.jsx(E1,{currentAudio:t,onTrackSelect:Y=>{ie(!1),f(Y)},onFavoriteToggle:d?Y=>d(Y.id,!Y.is_favorite):void 0,compact:!0})})]})})}),ce&&t.youtube_id&&e.jsx(ea,{in:ce,children:e.jsx(h,{sx:{position:"absolute",inset:0,bgcolor:"rgba(0, 0, 0, 0.95)",backdropFilter:"blur(10px)",zIndex:20,overflow:"auto"},children:e.jsx(R1,{youtubeId:t.youtube_id,currentTime:O,onClose:()=>q(!1),embedded:!0,visualizerTheme:S.visualizer_theme,isLightMode:_.palette.mode==="light",onSeek:Y=>{de.current&&(de.current.currentTime=Y,D(Y))}})})}),t.youtube_id&&e.jsx(Lv,{audio:bt,open:Ue,onClose:()=>Be(!1),onUpdate:Y=>G(Y)}),t.youtube_id&&e.jsx(Gv,{youtubeId:t.youtube_id,title:t.title,open:le,onClose:()=>xe(!1)}),e.jsx(ou,{anchorEl:ge,open:!!ge,onClose:()=>me(null),track:t}),e.jsx(n1,{open:ye,onClose:()=>Et(!1)}),e.jsx(a1,{open:xr,onClose:()=>ft(!1),queue:y,currentIndex:j,onPlayTrack:Y=>{b?.(Y),ft(!1)},onRemoveTrack:Y=>w?.(Y),onReorderTrack:(Y,he)=>C?.(Y,he),onClearQueue:()=>{v?.(),ft(!1)}}),e.jsx(p1,{open:ir,onClose:()=>Zt(!1)}),e.jsx(iu,{open:kr,onClose:()=>Vt(!1),track:t})]})}const T1=()=>{const{isOnline:t,canInstall:r,isUpdateAvailable:n,showInstallPrompt:s,updateApp:a}=Sa(),[o,i]=ze.useState(!1),[c,u]=ze.useState(!1),[d,f]=ze.useState(!1),[p,g]=ze.useState(!1),[m,y]=ze.useState(!1);ze.useEffect(()=>{if(t)m&&(i(!1),u(!0),y(!1));else{i(!0),y(!0);const w=setTimeout(()=>{i(!1)},5e3);return()=>clearTimeout(w)}},[t,m]),ze.useEffect(()=>{if(r){const w=setTimeout(()=>{f(!0)},3e3);return()=>clearTimeout(w)}},[r]),ze.useEffect(()=>{n&&g(!0)},[n]);const j=async()=>{await s()&&f(!1)},C=async()=>{await a(),g(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(it,{open:o,autoHideDuration:5e3,onClose:()=>i(!1),anchorOrigin:{vertical:"bottom",horizontal:"center"},sx:{bottom:{xs:80,sm:24}},children:e.jsxs(pe,{severity:"warning",icon:e.jsx(Sr,{}),onClose:()=>i(!1),sx:{width:"100%"},children:[e.jsx(x,{variant:"body2",fontWeight:600,children:"You're offline"}),e.jsx(x,{variant:"caption",children:"Cached content is still available"})]})}),e.jsx(it,{open:c,autoHideDuration:4e3,onClose:()=>u(!1),anchorOrigin:{vertical:"bottom",horizontal:"center"},sx:{bottom:{xs:80,sm:24}},children:e.jsx(pe,{severity:"success",icon:e.jsx(ra,{}),onClose:()=>u(!1),sx:{width:"100%"},children:"You're back online!"})}),e.jsx(it,{open:d,anchorOrigin:{vertical:"bottom",horizontal:"center"},sx:{bottom:{xs:80,sm:24}},children:e.jsx(pe,{severity:"info",icon:e.jsx(Wa,{}),action:e.jsxs(h,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e.jsx(N,{color:"inherit",size:"small",variant:"outlined",onClick:j,sx:{fontWeight:600},children:"Install"}),e.jsx(X,{size:"small",color:"inherit",onClick:()=>f(!1),children:e.jsx(sa,{fontSize:"small"})})]}),sx:{width:"100%",alignItems:"center"},children:e.jsxs(h,{children:[e.jsx(x,{variant:"body2",fontWeight:600,gutterBottom:!0,children:"Install SoundWave"}),e.jsx(x,{variant:"caption",children:"Install the app for faster access and offline playback"})]})})}),e.jsx(it,{open:p,anchorOrigin:{vertical:"bottom",horizontal:"center"},sx:{bottom:{xs:80,sm:24}},children:e.jsx(pe,{severity:"info",icon:e.jsx(bd,{}),action:e.jsxs(h,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e.jsx(N,{color:"inherit",size:"small",variant:"outlined",onClick:C,sx:{fontWeight:600},children:"Update"}),e.jsx(X,{size:"small",color:"inherit",onClick:()=>g(!1),children:e.jsx(sa,{fontSize:"small"})})]}),sx:{width:"100%",alignItems:"center"},children:e.jsxs(h,{children:[e.jsx(x,{variant:"body2",fontWeight:600,gutterBottom:!0,children:"Update Available"}),e.jsx(x,{variant:"caption",children:"A new version of SoundWave is ready to install"})]})})}),!t&&e.jsxs(h,{sx:{position:"fixed",top:0,left:0,right:0,bgcolor:"warning.main",color:"warning.contrastText",py:.5,px:2,display:"flex",alignItems:"center",justifyContent:"center",gap:1,zIndex:9999},children:[e.jsx(Sr,{fontSize:"small"}),e.jsx(x,{variant:"caption",fontWeight:600,children:"Offline Mode"})]})]})};var Hs={},nd;function z1(){if(nd)return Hs;nd=1;var t=ne();Object.defineProperty(Hs,"__esModule",{value:!0}),Hs.default=void 0;var r=t(ae()),n=se();return Hs.default=(0,r.default)((0,n.jsx)("path",{d:"M4 6h18V4H4c-1.1 0-2 .9-2 2v11H0v3h14v-3H4zm19 2h-6c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h6c.55 0 1-.45 1-1V9c0-.55-.45-1-1-1m-1 9h-4v-7h4z"}),"Devices"),Hs}var O1=z1();const F1=re(O1);var Vs={},sd;function L1(){if(sd)return Vs;sd=1;var t=ne();Object.defineProperty(Vs,"__esModule",{value:!0}),Vs.default=void 0;var r=t(ae()),n=se();return Vs.default=(0,r.default)([(0,n.jsx)("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"},"0"),(0,n.jsx)("path",{d:"M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"},"1")],"AccessTime"),Vs}var W1=L1();const $1=re(W1),$o=t=>{const r=Math.floor(t/60),n=Math.floor(t%60);return`${r}:${n.toString().padStart(2,"0")}`},B1=t=>t<60?"just now":t<3600?`${Math.floor(t/60)} minutes ago`:t<86400?`${Math.floor(t/3600)} hours ago`:`${Math.floor(t/86400)} days ago`;function q1({open:t,session:r,onResume:n,onDismiss:s}){if(!r?.audio_details)return null;const{audio_details:a,position:o,device_name:i,seconds_since_update:c}=r,u=o/a.duration*100,d=Math.max(0,o-5);return e.jsxs(Ke,{open:t,onClose:s,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:3,bgcolor:"background.paper",backgroundImage:"none"}},children:[e.jsxs(tt,{sx:{pb:1,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(F1,{color:"primary"}),e.jsx(x,{variant:"h6",component:"span",children:"Continue Listening?"})]}),e.jsx(X,{size:"small",onClick:s,sx:{color:"text.secondary"},children:e.jsx(Gt,{})})]}),e.jsxs(Xe,{sx:{pt:2},children:[e.jsxs(h,{sx:{display:"flex",gap:2,p:2,borderRadius:2,bgcolor:"action.hover",mb:2},children:[e.jsx(Ve,{variant:"rounded",src:a.cover_art_url||a.thumbnail_url,sx:{width:80,height:80},children:e.jsx(Lt,{})}),e.jsxs(h,{sx:{flex:1,minWidth:0},children:[e.jsx(x,{variant:"subtitle1",fontWeight:600,noWrap:!0,children:a.title}),e.jsx(x,{variant:"body2",color:"text.secondary",noWrap:!0,children:a.artist||a.channel_name}),e.jsxs(h,{sx:{mt:1.5},children:[e.jsx(rt,{variant:"determinate",value:u,sx:{height:4,borderRadius:2,bgcolor:"rgba(255,255,255,0.1)","& .MuiLinearProgress-bar":{borderRadius:2}}}),e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",mt:.5},children:[e.jsx(x,{variant:"caption",color:"text.secondary",children:$o(d)}),e.jsx(x,{variant:"caption",color:"text.secondary",children:$o(a.duration)})]})]})]})]}),e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1,color:"text.secondary"},children:[e.jsx($1,{fontSize:"small"}),e.jsxs(x,{variant:"body2",children:["Last played ",B1(c),i&&` on ${i}`]})]})]}),e.jsxs(nt,{sx:{p:2,pt:1},children:[e.jsx(N,{onClick:s,color:"inherit",sx:{color:"text.secondary"},children:"Not Now"}),e.jsxs(N,{onClick:n,variant:"contained",startIcon:e.jsx(gt,{}),sx:{px:3},children:["Resume at ",$o(d)]})]})]})}const ad={track:"Track Radio",artist:"Artist Radio",favorites:"Favorites Mix",discovery:"Discovery Mode",recent:"New Additions"},N1={track:"",artist:"",favorites:"",discovery:"",recent:""};function U1({compact:t=!1}){const{isRadioMode:r,radioSession:n,stopRadio:s,currentReason:a,isLoading:o}=fo(),[i,c]=l.useState(null),[u,d]=l.useState(n?.variety_level??50);if(!r||!n)return null;const f=y=>{d(n.variety_level),c(y.currentTarget)},p=()=>{c(null)},g=async(y,j)=>{const C=j;d(C);try{await ur.updateSettings({variety_level:C})}catch(w){console.error("Failed to update variety level:",w)}},m=async()=>{try{await ur.updateSettings({reset_learning:!0}),p()}catch(y){console.error("Failed to reset learning:",y)}};return t?e.jsx(ve,{title:`${ad[n.mode]}: ${n.seed_title}`,children:e.jsx(ue,{icon:e.jsx(an,{sx:{fontSize:16}}),label:"RADIO",size:"small",color:"primary",onDelete:s,deleteIcon:e.jsx(Gt,{sx:{fontSize:14}}),sx:{animation:"pulse 2s ease-in-out infinite","@keyframes pulse":{"0%, 100%":{opacity:1},"50%":{opacity:.7}}}})}):e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1.5,px:2,py:1,borderRadius:2,bgcolor:"primary.main",color:"primary.contrastText",background:"linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)"},children:[e.jsx(an,{sx:{fontSize:20,animation:"pulse 2s ease-in-out infinite","@keyframes pulse":{"0%, 100%":{transform:"scale(1)"},"50%":{transform:"scale(1.1)"}}}}),e.jsxs(h,{sx:{flex:1,minWidth:0},children:[e.jsx(h,{sx:{display:"flex",alignItems:"center",gap:.5},children:e.jsxs(x,{variant:"caption",sx:{fontWeight:600,textTransform:"uppercase",letterSpacing:1},children:[N1[n.mode]," ",ad[n.mode]]})}),e.jsx(x,{variant:"body2",noWrap:!0,sx:{opacity:.9},children:n.seed_title}),a&&e.jsxs(x,{variant:"caption",sx:{opacity:.7,display:"flex",alignItems:"center",gap:.5},children:[e.jsx(eo,{sx:{fontSize:12}}),a]}),e.jsxs(x,{variant:"caption",sx:{opacity:.7},children:[n.tracks_played," played  ",n.tracks_skipped," skipped"]})]}),e.jsx(ve,{title:"Radio Settings",children:e.jsx(X,{size:"small",onClick:f,sx:{color:"inherit"},children:e.jsx(Zu,{fontSize:"small"})})}),e.jsx(ve,{title:"Stop Radio",children:e.jsx(X,{size:"small",onClick:s,sx:{color:"inherit"},children:e.jsx(Gt,{fontSize:"small"})})}),o&&e.jsx(rt,{sx:{position:"absolute",bottom:0,left:0,right:0,height:2,borderBottomLeftRadius:8,borderBottomRightRadius:8}}),e.jsxs(ha,{anchorEl:i,open:!!i,onClose:p,PaperProps:{sx:{width:280,p:1}},children:[e.jsxs(h,{sx:{px:2,py:1},children:[e.jsx(x,{variant:"subtitle2",gutterBottom:!0,children:"Variety Level"}),e.jsx(x,{variant:"caption",color:"text.secondary",gutterBottom:!0,sx:{display:"block",mb:1},children:"Lower = stick to similar tracks, Higher = more variety"}),e.jsx(Pr,{value:u,onChange:g,min:0,max:100,valueLabelDisplay:"auto",marks:[{value:0,label:"Similar"},{value:50,label:"Balanced"},{value:100,label:"Varied"}]})]}),e.jsx(Ee,{sx:{my:1}}),e.jsx(we,{onClick:m,children:"Reset Learning Data"})]})]})}const H1=10,Bo="soundwave_play_history",V1=(t={})=>{const{historySize:r=H1,enabled:n=!0}=t,[s,a]=l.useState([]),o=l.useRef([]);l.useEffect(()=>{try{const f=localStorage.getItem(Bo);if(f){const p=JSON.parse(f);Array.isArray(p)&&(a(p.slice(-r)),o.current=p.slice(-r))}}catch(f){console.error("Failed to load play history:",f)}},[r]),l.useEffect(()=>{try{localStorage.setItem(Bo,JSON.stringify(s)),o.current=s}catch(f){console.error("Failed to save play history:",f)}},[s]);const i=l.useCallback(f=>{a(p=>[...p.filter(m=>m!==f),f].slice(-r))},[r]),c=l.useCallback(()=>{a([]),localStorage.removeItem(Bo)},[]),u=l.useCallback((f,p,g=!0)=>{if(!f||f.length===0)return null;if(f.length===1)return{audio:f[0],index:0};const m=o.current;let y=f.map((C,w)=>({audio:C,index:w}));if(g&&p>=0&&(y=y.filter(C=>C.index!==p)),n&&m.length>0){const C=y.filter(w=>!m.includes(w.audio.id));C.length>0&&(y=C)}if(y.length===0)return null;const j=Math.floor(Math.random()*y.length);return y[j]},[n]),d=l.useCallback((f,p)=>{if(!f||f.length===0)return[];if(f.length===1)return[...f];const g=o.current,m=[],y=[...f];if(p){const j=y.findIndex(C=>C.id===p.id);j!==-1&&m.push(y.splice(j,1)[0])}for(;y.length>0;){let j;if(n&&g.length>0){const C=y.map((w,b)=>({audio:w,index:b})).filter(w=>!g.includes(w.audio.id)).map(w=>w.index);C.length>0?j=C[Math.floor(Math.random()*C.length)]:j=Math.floor(Math.random()*y.length)}else j=Math.floor(Math.random()*y.length);m.push(y.splice(j,1)[0])}return m},[n]);return{playHistory:s,addToHistory:i,clearHistory:c,getSmartShuffledNext:u,generateSmartShuffledQueue:d}};function Y1({enabled:t,queue:r,currentIndex:n,currentAudio:s,isPlaying:a,shuffleEnabled:o=!1}){const i=l.useRef(-1),c=l.useRef(0),u=l.useRef(0);l.useEffect(()=>{t&&dt.init().catch(console.error)},[t]),l.useEffect(()=>{if(a&&s)c.current=Date.now();else if(!a&&c.current>0){const y=(Date.now()-c.current)/1e3;u.current+=y,c.current=0}},[a,s]),l.useEffect(()=>()=>{if(s&&s.youtube_id&&u.current>0){const y=s.duration||0,j=y>0&&u.current>=y*.8;dt.recordPlay(s.youtube_id,j,u.current),u.current=0}},[s?.youtube_id]),l.useEffect(()=>{if(!t||r.length===0||n===i.current)return;i.current=n;const y=setTimeout(()=>{console.log("[Prefetch] Prefetching upcoming tracks from index:",n),dt.prefetchUpcoming(r,n,o)},2e3);return()=>clearTimeout(y)},[t,r,n,o]);const d=l.useCallback(async y=>t?dt.getCachedUrl(y):null,[t]),f=l.useCallback(async y=>t?dt.isCached(y):!1,[t]),p=l.useCallback(async y=>{if(t)return dt.prefetchTrack(y,"high")},[t]),g=l.useCallback(async()=>dt.getCacheStats(),[]),m=l.useCallback(async()=>dt.clearCache(),[]);return{getCachedUrl:d,isCached:f,prefetchTrack:p,getCacheStats:g,clearCache:m}}async function od(){try{const t=await Na.getSession();if(t.data?.has_session&&t.data?.session)return t.data.session}catch(t){t?.response?.status!==404&&console.debug("[PlaybackSync] Check session failed:",t)}return null}function G1(){const[t,r]=l.useState(!1),[n,s]=l.useState(null),[a,o]=l.useState(!1),[i,c]=l.useState(!1),[u,d]=l.useState(!1),[f,p]=l.useState([]),[g,m]=l.useState(0),[y,j]=l.useState(0),C=Pt(),w=ao(C.breakpoints.up("lg")),b=Dt(),[v,S]=l.useState(null),[A,E]=l.useState(!1),P=l.useRef(0),k=l.useRef(null),R=(()=>{try{return Cr()}catch{return null}})(),{isRadioMode:z,getNextTrack:B,reportPlayed:F,reportSkip:W,stopRadio:H,setCurrentTrackInfo:I}=fo();l.useEffect(()=>{z&&n?.youtube_id&&I(n.youtube_id,n.duration)},[z,n?.youtube_id,n?.duration,I]);const _=V1({historySize:R?.settings?.smart_shuffle_history_size??10,enabled:R?.settings?.smart_shuffle_enabled??!0});Y1({enabled:R?.settings?.prefetch_enabled!==!1&&t,queue:f,currentIndex:g,currentAudio:n,isPlaying:a,shuffleEnabled:R?.settings?.shuffle_enabled??!1}),l.useEffect(()=>{localStorage.getItem("token")&&(r(!0),R?.loadSettings&&R.loadSettings(),(async()=>{try{const me=await od();me&&me.audio_details&&(console.log("[App] Found existing playback session on page load:",me),S(me),E(!0))}catch{console.debug("[App] No playback session to resume")}})());const xe=ge=>{console.log("[App] Token expired:",ge.detail?.message),te()};return window.addEventListener("token-expired",xe),()=>{window.removeEventListener("token-expired",xe)}},[]),l.useEffect(()=>{n&&o(!0)},[n]),l.useEffect(()=>{if(!R?.settings?.playback_sync_enabled){k.current&&(clearInterval(k.current),k.current=null);return}if(!t||!n?.youtube_id){k.current&&(clearInterval(k.current),k.current=null);return}const le=()=>{let ye=localStorage.getItem("soundwave_device_id");return ye||(ye="device_"+Date.now()+"_"+Math.random().toString(36).substring(2,9),localStorage.setItem("soundwave_device_id",ye)),ye},xe=()=>{const ye=navigator.userAgent;return/iPhone/i.test(ye)?"iPhone":/iPad/i.test(ye)?"iPad":/Android/i.test(ye)?"Android":/Mac/i.test(ye)?"Mac":/Windows/i.test(ye)?"Windows":/Linux/i.test(ye)?"Linux":"Web Browser"},ge=async()=>{if(!navigator.onLine){console.debug("[PlaybackSync] Skipping sync - offline");return}if(n?.youtube_id)try{await Na.syncPlayback({youtube_id:n.youtube_id,position:y,duration:n.duration,is_playing:a,volume:R?.settings?.volume??100,queue_youtube_ids:f.map(ye=>ye.youtube_id).filter(Boolean),queue_index:g,device_id:le(),device_name:xe()}),P.current=Date.now()}catch(ye){console.debug("[PlaybackSync] Sync failed:",ye)}},me=setTimeout(()=>{ge()},3e3);return k.current=setInterval(()=>{a&&navigator.onLine&&ge()},6e4),()=>{clearTimeout(me),k.current&&(clearInterval(k.current),k.current=null)}},[t,n?.youtube_id,n?.duration,a,y,f,g,R?.settings?.volume,R?.settings?.playback_sync_enabled]),l.useEffect(()=>{if(!(!t||!n?.youtube_id)&&R?.settings?.playback_sync_enabled&&navigator.onLine&&!a&&y>0&&n?.youtube_id){const le=n.youtube_id,xe=setTimeout(()=>{if(!navigator.onLine)return;const ge=()=>localStorage.getItem("soundwave_device_id")||"unknown",me=()=>{const ye=navigator.userAgent;return/iPhone|iPad/i.test(ye)?"iOS":/Android/i.test(ye)?"Android":/Mac/i.test(ye)?"Mac":/Windows/i.test(ye)?"Windows":"Web"};Na.syncPlayback({youtube_id:le,position:y,duration:n.duration,is_playing:!1,volume:R?.settings?.volume??100,queue_youtube_ids:f.map(ye=>ye.youtube_id).filter(Boolean),queue_index:g,device_id:ge(),device_name:me()}).catch(()=>{})},2e3);return()=>clearTimeout(xe)}},[a]);const O=l.useCallback(le=>{j(le)},[]),D=(le,xe)=>{n&&n.id===le&&s({...n,is_favorite:xe})},Q=le=>{s(le),o(!0)},J=async()=>{r(!0),R?.loadSettings&&R.loadSettings();try{const le=await od();le&&le.audio_details&&(console.log("[App] Found existing playback session:",le),S(le),E(!0))}catch{console.debug("[App] No playback session to resume")}},M=async()=>{if(v?.audio_details){try{const xe=(await kt.get(v.youtube_id)).data;if(xe){const ge=Math.max(0,v.position-5);if(v.queue_youtube_ids?.length>0)try{const me=await kt.list({youtube_ids:v.queue_youtube_ids.join(","),page_size:100}),ye=me.data?.data||me.data||[];ye.length>0?(p(ye),m(v.queue_index)):(p([xe]),m(0))}catch{p([xe]),m(0)}else p([xe]),m(0);s({...xe,_initialSeek:ge}),o(!0)}}catch(le){console.error("[App] Failed to resume playback:",le)}E(!1),S(null)}},T=()=>{E(!1),S(null),Na.clearSession().catch(()=>{})},te=async()=>{localStorage.removeItem("token");try{await fetch("/api/user/logout/",{method:"POST",headers:{"Content-Type":"application/json"}})}catch(le){console.error("Logout error:",le)}try{await ut.clearAllData(),console.log("[Logout] Cleared IndexedDB offline data")}catch(le){console.error("Failed to clear offline data:",le)}try{await qe.clearCache(),console.log("[Logout] Cleared Service Worker caches")}catch(le){console.error("Failed to clear SW cache:",le)}document.cookie.split(";").forEach(le=>{document.cookie=le.replace(/^ +/,"").replace(/=.*/,"=;expires="+new Date().toUTCString()+";path=/")}),s(null),p([]),m(0),o(!1),d(!1),c(!1),b("/",{replace:!0}),r(!1)},$=()=>{c(!i)};l.useEffect(()=>{n&&a&&_.addToHistory(n.id)},[n?.id,a]);const U=l.useCallback(async()=>{if(z)try{n&&await F();const me=await B();if(me){s(me),p(ye=>[...ye,me]),m(ye=>ye+1);return}}catch(me){console.error("[Radio] Failed to get next track:",me)}if(f.length===0)return;const le=R?.settings?.shuffle_enabled??!1,xe=R?.settings?.smart_shuffle_enabled??!0,ge=R?.settings?.repeat_mode??"none";if(le&&xe){const me=_.getSmartShuffledNext(f,g);if(me){m(me.index),s(me.audio);return}}if(le&&!xe){const me=f.map((ye,Et)=>Et).filter(ye=>ye!==g);if(me.length>0){const ye=me[Math.floor(Math.random()*me.length)];m(ye),s(f[ye]);return}}if(g<f.length-1){const me=g+1;m(me),s(f[me])}else ge==="all"&&(m(0),s(f[0]))},[f,g,R?.settings?.shuffle_enabled,R?.settings?.smart_shuffle_enabled,R?.settings?.repeat_mode,_,z,B,F,n]),K=()=>{if(f.length>0&&g>0){const le=g-1;m(le),s(f[le])}},ce=l.useCallback(async()=>{z&&await W(),await U()},[z,W,U]),q=(le,xe)=>{if(s(le),xe&&xe.length>0){p(xe);const ge=xe.findIndex(me=>me.id===le.id);m(ge>=0?ge:0)}else p([le]),m(0)},oe=l.useCallback((le,xe)=>{le!==xe&&(p(ge=>{const me=[...ge],[ye]=me.splice(le,1);return me.splice(xe,0,ye),me}),m(ge=>le===ge?xe:le<ge&&xe>=ge?ge-1:le>ge&&xe<=ge?ge+1:ge))},[]),ie=l.useCallback(le=>{le!==g&&(p(xe=>{const ge=[...xe];return ge.splice(le,1),ge}),m(xe=>le<xe?xe-1:xe))},[g]),Ue=l.useCallback(le=>{le>=0&&le<f.length&&(m(le),s(f[le]))},[f]),Be=l.useCallback(()=>{n&&(p([n]),m(0))},[n]);return l.useCallback(le=>{p(xe=>{const ge=xe.findIndex(ye=>ye.id===le.id),me=[...xe];if(ge!==-1&&ge!==g){me.splice(ge,1);const ye=ge<g+1?g:g+1;me.splice(ye,0,le)}else ge===-1&&me.splice(g+1,0,le);return me})},[g]),l.useCallback(le=>{p(xe=>xe.some(ge=>ge.id===le.id)?xe:[...xe,le])},[]),t?e.jsxs(h,{sx:{display:"flex",height:"100vh",backgroundColor:"background.default"},children:[e.jsx(gb,{mobileOpen:i,onMobileClose:()=>c(!1)}),e.jsxs(h,{sx:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",position:"relative"},children:[e.jsx(h,{sx:{position:"absolute",top:0,left:0,right:0,height:"96px",background:le=>`linear-gradient(to bottom, ${le.palette.background.default} 0%, transparent 100%)`,zIndex:10,pointerEvents:"none"}}),e.jsx(Pb,{onLogout:te,onMenuClick:$}),z&&e.jsx(h,{sx:{px:4,pt:1},children:e.jsx(U1,{})}),e.jsx(h,{sx:{flex:1,overflow:"auto",px:4,py:2,pb:3,"&::-webkit-scrollbar":{display:"none"},msOverflowStyle:"none",scrollbarWidth:"none"},children:e.jsxs(rf,{children:[e.jsx(at,{path:"/",element:e.jsx(dp,{setCurrentAudio:q})}),e.jsx(at,{path:"/search",element:e.jsx(sm,{setCurrentAudio:q})}),e.jsx(at,{path:"/library",element:e.jsx(Vp,{setCurrentAudio:q})}),e.jsx(at,{path:"/favorites",element:e.jsx(am,{setCurrentAudio:q})}),e.jsx(at,{path:"/channels",element:e.jsx(d0,{})}),e.jsx(at,{path:"/channels/:channelId",element:e.jsx(u0,{setCurrentAudio:q})}),e.jsx(at,{path:"/playlists",element:e.jsx(P0,{})}),e.jsx(at,{path:"/playlists/:playlistId",element:e.jsx(D0,{setCurrentAudio:q})}),e.jsx(at,{path:"/smart-playlists",element:e.jsx(E0,{setCurrentAudio:q})}),e.jsx(at,{path:"/smart-playlist/:playlistId",element:e.jsx(T0,{setCurrentAudio:q})}),e.jsx(at,{path:"/analytics",element:e.jsx(Wy,{})}),e.jsx(at,{path:"/achievements",element:e.jsx($y,{})}),e.jsx(at,{path:"/wrapped",element:e.jsx(By,{})}),e.jsx(at,{path:"/history",element:e.jsx(Vy,{onTrackSelect:q})}),e.jsx(at,{path:"/local-files",element:e.jsx(zy,{setCurrentAudio:q})}),e.jsx(at,{path:"/offline",element:e.jsx(Fy,{})}),e.jsx(at,{path:"/settings",element:e.jsx(Ay,{})}),e.jsx(at,{path:"/admin/users",element:e.jsx(Yy,{children:e.jsx(Oy,{})})}),e.jsx(at,{path:"*",element:e.jsx(Rd,{to:"/",replace:!0})})]})})]}),n&&w&&e.jsx(h,{sx:{width:380,display:"flex",flexDirection:"column",bgcolor:"background.paper",borderLeft:"1px solid",borderColor:"rgba(255, 255, 255, 0.05)",position:"relative",overflow:"hidden"},children:e.jsx(rd,{audio:n,isPlaying:a,setIsPlaying:o,onClose:()=>{s(null),z&&H()},onNext:ce,onPrevious:K,hasNext:z||f.length>1&&(R?.settings?.shuffle_enabled||R?.settings?.repeat_mode==="all"||g<f.length-1),hasPrevious:g>0,onFavoriteToggle:D,onTrackSelect:Q,onTimeUpdate:O,initialSeek:n._initialSeek,isRadioMode:z,queue:f,currentQueueIndex:g,onQueueReorder:oe,onRemoveFromQueue:ie,onPlayQueueTrack:Ue,onClearQueue:Be})}),n&&!w&&e.jsxs(e.Fragment,{children:[!u&&e.jsx(h,{onClick:()=>d(!0),sx:{position:"fixed",top:0,left:0,right:0,bottom:0,bgcolor:"rgba(0, 0, 0, 0.5)",zIndex:999,backdropFilter:"blur(4px)"}}),e.jsx(h,{sx:{position:"fixed",bottom:0,left:0,right:0,zIndex:1e3,maxHeight:"85vh",overflowY:"auto",transform:u?"translateY(100%)":"translateY(0)",transition:"transform 0.3s ease-in-out",visibility:u?"hidden":"visible"},children:e.jsx(rd,{audio:n,isPlaying:a,setIsPlaying:o,onClose:()=>{s(null),z&&H()},onMinimize:()=>d(!0),onNext:ce,onPrevious:K,hasNext:z||f.length>1&&(R?.settings?.shuffle_enabled||R?.settings?.repeat_mode==="all"||g<f.length-1),hasPrevious:g>0,onFavoriteToggle:D,onTrackSelect:Q,onTimeUpdate:O,initialSeek:n._initialSeek,isRadioMode:z,queue:f,currentQueueIndex:g,onQueueReorder:oe,onRemoveFromQueue:ie,onPlayQueueTrack:Ue,onClearQueue:Be})}),u&&e.jsxs(h,{onClick:()=>d(!1),sx:{display:{xs:"flex",lg:"none"},position:"fixed",bottom:0,left:0,right:0,height:72,bgcolor:"background.paper",borderTop:"1px solid",borderColor:"rgba(255, 255, 255, 0.1)",alignItems:"center",px:2,gap:2,zIndex:1e3,cursor:"pointer",transition:"all 0.2s ease","&:active":{bgcolor:"rgba(255, 255, 255, 0.05)"}},children:[e.jsx(h,{component:"img",src:n.cover_art_url||"/img/icons/icon-192x192.png",alt:n.title,sx:{width:48,height:48,borderRadius:1,objectFit:"cover",flexShrink:0}}),e.jsxs(h,{sx:{flex:1,minWidth:0},children:[e.jsx(x,{variant:"body2",sx:{fontWeight:600,color:"text.primary",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:n.title}),e.jsx(x,{variant:"caption",sx:{color:"text.secondary",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"block"},children:n.artist||"Unknown Artist"})]}),e.jsx(X,{onClick:le=>{le.stopPropagation(),o(!a)},sx:{bgcolor:"primary.main",color:"background.dark",width:40,height:40,flexShrink:0,"&:hover":{bgcolor:"primary.main",transform:"scale(1.05)"}},children:a?e.jsx(Id,{}):e.jsx(gt,{})})]})]}),e.jsx(q1,{open:A,session:v,onResume:M,onDismiss:T}),e.jsx(T1,{})]}):e.jsx(ap,{onLoginSuccess:J})}const eh=l.createContext({themeMode:"dark",setThemeMode:()=>{}}),Q1=()=>l.useContext(eh);function K1(){const{settings:t,updateSetting:r,loading:n}=Cr(),[s,a]=l.useState(t.theme||dy());l.useEffect(()=>{!n&&t.theme&&a(t.theme)},[t.theme,n]);const o=c=>{a(c),cy(c),r("theme",c)},i=ly(s);return e.jsx(eh.Provider,{value:{themeMode:s,setThemeMode:o},children:e.jsxs(Kh,{theme:i,children:[e.jsx(Xh,{}),e.jsx(G1,{})]})})}const X1=l.createContext(null);function J1({children:t}){const[r,n]=l.useState([]),[s,a]=l.useState(0),[o,i]=l.useState([]),c=l.useRef(!1),u=l.useCallback((k,R=0)=>{c.current=!0,n(k),a(Math.max(0,Math.min(R,k.length-1))),i([]),c.current=!1},[]),d=l.useCallback((k,R)=>{n(k),a(R)},[]),f=l.useCallback(()=>{n([]),a(0),i([])},[]),p=l.useCallback(k=>{n(R=>{const z=s+1,B=[...R],F=B.findIndex(W=>W.id===k.id);if(F!==-1&&F!==s){B.splice(F,1);const W=F<z?z-1:z;B.splice(W,0,k)}else F===-1&&B.splice(z,0,k);return B})},[s]),g=l.useCallback(k=>{n(R=>R.some(z=>z.id===k.id)?R:[...R,k])},[]),m=l.useCallback(k=>{n(R=>{const z=[...R],B=s+1,F=k.filter(W=>!z.some(H=>H.id===W.id)||z.findIndex(H=>H.id===W.id)===s);return z.splice(B,0,...F),z})},[s]),y=l.useCallback(k=>{n(R=>{const z=k.filter(B=>!R.some(F=>F.id===B.id));return[...R,...z]})},[]),j=l.useCallback(k=>k<0||k>=r.length?null:(r[s]&&i(R=>[...R.slice(-49),r[s]]),a(k),r[k]),[r,s]),C=l.useCallback(()=>{if(s>=r.length-1)return null;r[s]&&i(R=>[...R.slice(-49),r[s]]);const k=s+1;return a(k),r[k]},[r,s]),w=l.useCallback(()=>{if(s>0){const k=s-1;return a(k),r[k]}if(o.length>0){const k=o[o.length-1];return i(R=>R.slice(0,-1)),n(R=>[k,...R]),k}return null},[r,s,o]),b=l.useCallback((k,R)=>{k!==R&&(k<0||k>=r.length||R<0||R>=r.length||(n(z=>{const B=[...z],[F]=B.splice(k,1);return B.splice(R,0,F),B}),a(z=>k===z?R:k<z&&R>=z?z-1:k>z&&R<=z?z+1:z)))},[r.length]),v=l.useCallback(k=>{k<0||k>=r.length||k!==s&&(n(R=>{const z=[...R];return z.splice(k,1),z}),a(R=>k<R?R-1:R))},[r.length,s]),S=r[s]||null,A=s<r.length-1,E=s>0||o.length>0,P={queue:r,currentIndex:s,history:o,setQueue:u,clearQueue:f,playNext:p,addToQueue:g,playNextMultiple:m,addToQueueMultiple:y,playTrackAtIndex:j,goToNext:C,goToPrevious:w,moveTrack:b,removeTrack:v,currentTrack:S,hasNext:A,hasPrevious:E,setCurrentIndex:a,syncQueueFromExternal:d};return e.jsx(X1.Provider,{value:P,children:t})}of.createRoot(document.getElementById("root")).render(e.jsx(ze.StrictMode,{children:e.jsx(nf,{children:e.jsx(v0,{children:e.jsx(vy,{children:e.jsx($g,{children:e.jsx(ov,{children:e.jsx(Hp,{children:e.jsx(nv,{children:e.jsx(J1,{children:e.jsx(yv,{children:e.jsx(K1,{})})})})})})})})})})}));export{kt as a};
